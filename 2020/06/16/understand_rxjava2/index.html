<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ä¸¤å¼ å›¾å½»åº•ç†è§£ RxJava2 çš„æ ¸å¿ƒåŸç† Â· Solartisan</title><meta name="description" content="ä¸¤å¼ å›¾å½»åº•ç†è§£ RxJava2 çš„æ ¸å¿ƒåŸç† - solart"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://solart.cc/atom.xml" title="Solartisan"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/solartisan" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">ä¸¤å¼ å›¾å½»åº•ç†è§£ RxJava2 çš„æ ¸å¿ƒåŸç†</h1><div class="post-info">Jun 16, 2020</div><div class="post-content"><p>ä½œè€…ï¼š<a href="mailto://imilko7@gmail.com" target="_blank" rel="external">solart</a></p>
<blockquote>
<p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
<p>æ–‡ç« ä¼¼ä¹æœ‰äº›æ ‡é¢˜å…šçš„å«Œç–‘ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡æ ¹æ®æˆ‘çš„ç†è§£ç”»å‡ºä¸¤å¹…å›¾å¯ä»¥è®©å¤§å®¶ç†è§£ RxJava2 çš„æ ¸å¿ƒåŸç†ï¼Œç¨åä¸è¦åå•¬ï¼Œè¯·å«æˆ‘çµé­‚ç”»æ‰‹ğŸ˜„ï¼ç›¸ä¿¡ <code>RxJava</code> æ˜¯å¤§å®¶ä¸šåŠ¡ä¸­ç”¨åˆ°æ¯”è¾ƒå¤šçš„ä¸€ä¸ªä¾èµ–åº“ï¼ŒRxJava çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæ”¹å˜äº†ç¨‹åºå‘˜çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œç›¸æ¯”è¾ƒå…¶ä»–çš„å¼€æºé¡¹ç›®ï¼ŒRxjava æ˜¯æœ€å¼¯å¼¯ç»•çš„ä¸€ä¸ªã€‚å¯¹äº RxJava ç§ç±»ç¹å¤šçš„æ“ä½œç¬¦ï¼Œå¤§å¤šæ•°åŒå­¦éƒ½è¡¨ç¤ºå¾ˆæ˜¯å¤´ç–¼ï¼Œä¹Ÿæœ‰ä¸å°‘åŒå­¦é™·å…¥äº†å­¦ä¹ æ“ä½œç¬¦ä¸èƒ½åœçš„æ€ªåœˆã€‚æ“ä½œç¬¦è¦ä¸è¦å­¦ï¼Œå½“ç„¶è¦ï¼Œä½†æ˜¯å¦‚æœèƒ½ç†è§£ RxJava çš„æ ¸å¿ƒï¼Œæ“ä½œç¬¦çš„ä½¿ç”¨å°±åƒæ˜¯å­¦ä¼šä¹é˜³ç¥åŠŸçš„å¼ æ— å¿Œå­¦æ‹›æ•°ï¼Œå¿…å®šæ˜¯æ‰‹åˆ°æ“’æ¥ã€‚æ‰€è°“å™¨æ¬²å°½å…¶ç”¨ï¼Œå¿…å…ˆå¾—å…¶æ³•ã€‚</p>
<h3 id="è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ"><a href="#è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ" class="headerlink" title="è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ"></a>è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ</h3><ul>
<li>RxJava2 åŸºæœ¬çš„è¿è¡Œæµç¨‹</li>
<li>RxJava2 çº¿ç¨‹åˆ‡æ¢çš„åŸç†ï¼ˆæ¶‰åŠåˆ°ä¸ºä»€ä¹ˆ subscribeOn() åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼‰</li>
<li>ä¸ºä»€ä¹ˆä¸€è®¢é˜…å°±å›è°ƒäº† onSubscribe</li>
<li>ä¸ºä»€ä¹ˆ subscribeOn() å¯¹ä¸Šé¢çš„ä»£ç ç”Ÿæ•ˆï¼ŒobserverOn() å¯¹ä¸‹é¢ä»£ç ç”Ÿæ•ˆ</li>
</ul>
<p>ä»¥ä¸‹å†…å®¹å¦‚æœæ¶‰åŠåˆ°è‡ªå·±å†™çš„ä»£ç æˆ‘ä¼šé‡‡ç”¨ Kotlin è¿›è¡Œç¤ºä¾‹å±•ç¤ºï¼Œæ¶‰åŠåˆ° RxJava2 ä¼šå±•ç¤ºéƒ¨åˆ†æºç ã€‚</p>
<h2 id="1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰"><a href="#1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰" class="headerlink" title="1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰"></a>1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰</h2><a id="more"></a>
<p>å…ˆæ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">object</span> : ObservableOnSubscribe<span class="type">&lt;String&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">subscribe</span><span class="params">(emitter: <span class="typename">ObservableEmitter&lt;String&gt;</span>)</span> &#123;</span></span><br><span class="line">                Log.d(<span class="string">"solart"</span>, <span class="string">"subscribe &gt; $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                emitter.onNext(<span class="string">"test"</span>)</span><br><span class="line">                emitter.onComplete()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).flatMap(<span class="keyword">object</span> : Function<span class="type">&lt;String, Observable&lt;String&gt;</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">apply</span><span class="params">(t: <span class="typename">String</span>)</span>: Observable<span class="type">&lt;String&gt;</span> &#123;</span></span><br><span class="line">                <span class="keyword">return</span> Observable.just(t)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).map(<span class="keyword">object</span> : Function<span class="type">&lt;String, Int&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">apply</span><span class="params">(t: <span class="typename">String</span>)</span>: Int &#123;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribe(<span class="keyword">object</span> : Observer<span class="type">&lt;Int&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(d: <span class="typename">Disposable</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onSubscribe &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="typename">Int</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onNext &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onComplete &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="typename">Throwable</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onError &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ç®€å•ç”¨äº† <code>create</code>ã€<code>flatMap</code>ã€<code>map</code>ç­‰æ“ä½œç¬¦ï¼Œè¿›è¡Œäº†æµå¼çš„æ•°æ®è½¬æ¢ï¼Œæœ€åæˆ‘ä»¬é€šè¿‡ <code>subscribe</code> è®¢é˜…äº†æ•°æ®æµï¼Œå…¶å®é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ RxJava æœ¬èº«æ˜¯ä¸ªé€†å‘è®¢é˜…çš„è¿‡ç¨‹ï¼Œè¯ä¸å¤šè¯´å…ˆçœ‹å›¾</p>
<p><img src="/images/rxjava2.png" alt="rxjava2"></p>
<p><a href="http://solart.cc/images/rxjava2.png" target="_blank">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</a></p>
<h4 id="1-1-æ•°æ®æºçš„åŒ…è£¹"><a href="#1-1-æ•°æ®æºçš„åŒ…è£¹" class="headerlink" title="1.1 æ•°æ®æºçš„åŒ…è£¹"></a>1.1 æ•°æ®æºçš„åŒ…è£¹</h4><p>æ¯”ç…§ç€è¿™å¼ å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œé¦–å…ˆ<code>è“è‰²è™šçº¿</code>éƒ¨åˆ†æ˜¯æˆ‘ä»¬ä»£ç ä¸­å®é™…è°ƒç”¨çš„é¡ºåºï¼ŒæŸ¥çœ‹ <code>Observable.create</code> æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œæ­¤å¤„å°±æ˜¯äº§ç”Ÿäº†ä¸€ä¸ª <code>ObservableCreate</code> å®ä¾‹ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">create</span><span class="params">(ObservableOnSubscribe&lt;T&gt; source)</span> </span>&#123;</span><br><span class="line">       ObjectHelper.requireNonNull(source, <span class="string">"source is null"</span>);</span><br><span class="line">       <span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableCreate&lt;T&gt;(source));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æˆ‘ä»¬å›¾ä¸­æ‰€ç¤ºï¼Œ <code>ObservableCreate</code> å†…éƒ¨åŒ…å«ä¸€ä¸ªç±»å‹ä¸º <code>ObservableOnSubscribe&lt;T&gt;</code> çš„ <code>source</code> å˜é‡ï¼Œæ ¹æ®æˆ‘ä»¬ä»£ç ä¸­çš„è°ƒç”¨ï¼Œè¿™ä¸ª <code>source</code> å°±æ˜¯æˆ‘ä»¬ Kotlin ä»£ç ä¸­çš„åŒ¿åå¯¹è±¡ <code>object : ObservableOnSubscribe&lt;String&gt;</code> ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableCreate</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ObservableOnSubscribe&lt;T&gt; source;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObservableCreate</span><span class="params">(ObservableOnSubscribe&lt;T&gt; source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.source = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é¡ºç€ä»£ç çš„è°ƒç”¨é¡ºåºï¼Œç»§ç»­çœ‹ä¸€ä¸‹ <code>flatMap</code> çš„æ–¹æ³•ä¸­åˆåšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> &lt;R&gt; <span class="function">Observable&lt;R&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends ObservableSource&lt;? extends R&gt;&gt; mapper,</span><br><span class="line">            <span class="keyword">boolean</span> delayErrors, <span class="keyword">int</span> maxConcurrency, <span class="keyword">int</span> bufferSize)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableFlatMap&lt;T, R&gt;(<span class="keyword">this</span>, mapper, delayErrors, maxConcurrency, bufferSize));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼çš„äº§ç”Ÿäº†ä¸€ä¸ª <code>ObservableFlatMap</code> å®ä¾‹ï¼Œè€Œå…¶å†…éƒ¨æŒæœ‰ä¸€ä¸ªç±»å‹ä¸º <code>ObservableSource&lt;T&gt;</code>çš„ <code>source</code> å˜é‡ï¼Œè€Œè¯¥ source åˆ™æ˜¯ä¸Šä¸€æ­¥ä¸­çš„ <code>ObservableCreate</code> å®ä¾‹ï¼Œä¾æ¬¡æˆ‘ä»¬çœ‹ <code>map</code> ä¾ç„¶æ˜¯ç±»ä¼¼çš„ä»£ç ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œæ‰€ä»¥åˆ°æ­¤æˆ‘ä»¬å¾—åˆ°äº†å›¾ä¸­è“è‰²è™šçº¿éƒ¨åˆ†çš„å†…å®¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå°†æ•°æ®æºå±‚å±‚æ‰“åŒ…çš„è¿‡ç¨‹ã€‚</p>
<h4 id="1-2-é€†å‘è®¢é˜…æ•°æ®æº"><a href="#1-2-é€†å‘è®¢é˜…æ•°æ®æº" class="headerlink" title="1.2 é€†å‘è®¢é˜…æ•°æ®æº"></a>1.2 é€†å‘è®¢é˜…æ•°æ®æº</h4><p>æˆ‘ä»¬çŸ¥é“ä»¥ä¸Šçš„ä»£ç è°ƒç”¨å¹¶æ²¡æœ‰å‡ºå‘æ•°æ®çš„æµè½¬ï¼Œåªæœ‰å½“æˆ‘ä»¬è°ƒç”¨ <code>subscribe</code> æ—¶ï¼ˆå›¾ä¸­ä¸ŠåŠéƒ¨åˆ†çº¢è‰²å®çº¿éƒ¨åˆ†ï¼‰æ‰çœŸæ­£è§¦å‘äº† RxJava çš„æ•°æ®æµï¼Œæˆ‘ä»¬æ¥çœ‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        ObjectHelper.requireNonNull(observer, <span class="string">"observer is null"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            observer = RxJavaPlugins.onSubscribe(<span class="keyword">this</span>, observer);</span><br><span class="line"></span><br><span class="line">            ObjectHelper.requireNonNull(observer, <span class="string">"Plugin returned null Observer"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é‡ç‚¹ï¼ï¼ï¼ å‘ç”Ÿè®¢é˜…çš„æ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line">            subscribeActual(observer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123; <span class="comment">// NOPMD</span></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">throw</span> npe;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æï¼Œæ‰§è¡Œ <code>subscribeActual</code> çš„å¯¹è±¡å…¶å®æ˜¯ <code>ObservableMap</code> ï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒçš„ <code>subscribeActual</code> çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableMap</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractObservableWithUpstream</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> U&gt; t)</span> </span>&#123;</span><br><span class="line">        source.subscribe(<span class="keyword">new</span> MapObserver&lt;T, U&gt;(t, function));</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œæ­¤æ—¶äº§ç”Ÿäº†ä¸€ä¸ª <code>MapObserver</code> å¯¹è±¡ï¼Œ<code>MapObserver</code> ä¸­é€šè¿‡ <code>actual</code> æŒæœ‰äº†æˆ‘ä»¬è‡ªå·±çš„åŒ¿åå¯¹è±¡ <code>object : Observer&lt;Int&gt;</code> ï¼ŒåŒæ ·çš„ï¼Œ<code>ObservableMap</code> æ‰§è¡Œ subscribeActual åˆè°ƒç”¨äº†ä¸Šå±‚çš„ <code>source.subscribe</code> ï¼Œä¾æ¬¡é€†å‘è°ƒç”¨ï¼Œå°±å¾—åˆ°äº†æˆ‘ä»¬å›¾ä¸­ä¸ŠåŠéƒ¨åˆ†çš„çº¢çº¿å†…å®¹ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºæ•°æ®æºçš„é€†å‘è®¢é˜…ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªå±‚å±‚æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡å®ƒæ‰“åŒ…çš„å¯¹è±¡æ¢æˆäº†è§‚å¯Ÿè€… Observerã€‚</p>
<h4 id="1-3-è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬"><a href="#1-3-è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬" class="headerlink" title="1.3 è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬"></a>1.3 è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬</h4><p>å½“è®¢é˜…å‘ç”Ÿåœ¨æœ€é¡¶å±‚æ—¶ï¼Œä¹Ÿå°±æ˜¯ <code>ObservableCreate</code> ä¸­çš„ <code>subscribeActual</code> ï¼Œæ­¤æ—¶è§¦å‘äº†æ•°æ®æºçš„äº§ç”Ÿï¼Œé€šè¿‡ <code>emitter</code> å‘å°„æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableCreate</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        CreateEmitter&lt;T&gt; parent = <span class="keyword">new</span> CreateEmitter&lt;T&gt;(observer);</span><br><span class="line">        observer.onSubscribe(parent); <span class="comment">//æ­¤æ—¶è§¦å‘äº† onSubscribe å›è°ƒï¼Œè¿™é‡Œå…ˆæä¸€ä¸‹</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            source.subscribe(parent);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            Exceptions.throwIfFatal(ex);</span><br><span class="line">            parent.onError(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œæˆ‘ä»¬ä»£ç ä¸­æ­¤æ—¶äº§ç”Ÿäº†çœŸæ­£çš„æ•°æ®</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">subscribe</span><span class="params">(emitter: <span class="typename">ObservableEmitter&lt;String&gt;</span>)</span> &#123;</span></span><br><span class="line">                Log.d(<span class="string">"solart"</span>, <span class="string">"subscribe &gt; $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                emitter.onNext(<span class="string">"test"</span>)</span><br><span class="line">                emitter.onComplete()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹ <code>CreateEmitter</code> çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateEmitter</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    <span class="keyword">extends</span> <span class="title">AtomicReference</span>&lt;<span class="title">Disposable</span>&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title">ObservableEmitter</span>&lt;<span class="title">T</span>&gt;, <span class="title">Disposable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Observer&lt;? <span class="keyword">super</span> T&gt; observer;</span><br><span class="line"></span><br><span class="line">        CreateEmitter(Observer&lt;? <span class="keyword">super</span> T&gt; observer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.observer = observer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span> (!isDisposed()) &#123;</span><br><span class="line">                observer.onNext(t);  <span class="comment">//å‘ä¸‹å±‚åˆ†å‘æ•°æ®</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æ <code>CreateEmitter</code> ä¸­æŒæœ‰çš„ <code>observer</code> å³æ˜¯ <code>FlatMapObserver</code> çš„å®ä¾‹ï¼Œè€Œ <code>FlatMapObserver</code> è°ƒç”¨ onNext æ—¶ï¼Œåˆä¼šè°ƒç”¨ <code>MapObserver</code> çš„ onNext ï¼Œä¾æ¬¡è°ƒç”¨è‡³æˆ‘ä»¬è‡ªå·±å®ç°çš„è§‚å¯Ÿè€…çš„ onNext å¤„ç†æ•°æ®ï¼Œæ­¤æ—¶æ•°æ®æµè½¬å®Œæ¯•ã€‚</p>
<p>è§‚å¯Ÿæˆ‘ä»¬è¿™ä¸ªå›¾ï¼Œä½ ä¼šå‘ç°ï¼Œ<code>æ“ä½œç¬¦</code> å¯¹åº”äº§ç”Ÿçš„è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…å‘½åè§„åˆ™å¾ˆæœ‰è§„å¾‹ï¼Œæ¯”å¦‚è¯´è¢«è§‚å¯Ÿè€…çš„å‘½å <code>Observable + æ“ä½œç¬¦</code> ï¼Œä¾‹å¦‚ <code>ObservableMap</code> = Observable + mapï¼Œè§‚å¯Ÿè€…å‘½åå¤§å¤šéµå¾ª <code>æ“ä½œç¬¦ + Observer</code> ï¼Œä¾‹å¦‚ <code>FlatMapObserver</code> = flatMap + Observerã€‚é™¤äº†å‘½åè§„åˆ™å¤–ï¼Œæˆ‘ä»¬è§‚å¯Ÿæ•´ä¸ªæµç¨‹ï¼Œä½ ä¹Ÿä¼šå‘ç°æœ‰ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§ä»£ç é¡ºåºçš„æ“ä½œç¬¦äº§ç”Ÿäº†ä¸€ä¸ªä¸€å±‚å±‚çš„æ•°æ®æºåŒ…è£¹ï¼ˆè“è‰²è™šçº¿çš„æµç¨‹éƒ¨åˆ†ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨é€†å‘è®¢é˜…æ—¶ï¼Œå°†è§‚å¯Ÿè€…æŒ‰ç…§è®¢é˜…é¡ºåºæ‰“åŒ…æˆä¸€ä¸ªä¸€å±‚å±‚çš„è§‚å¯Ÿè€…åŒ…è£¹ï¼ˆä¸Šéƒ¨åˆ†çš„çº¢è‰²æµç¨‹éƒ¨åˆ†ï¼‰ã€‚</p>
<h2 id="2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰"><a href="#2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰" class="headerlink" title="2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰"></a>2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰</h2><p>ç›¸ä¿¡æœ‰äº†ä¸Šé¢çš„åˆ†æï¼Œå¤§å®¶å¯¹ RxJava çš„é€†å‘è®¢é˜…ä»¥åŠæ•°æ®æµè½¬æœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œä½†æ˜¯ RxJava çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹æ–¹å¼ï¼Œéšå¿ƒæ‰€æ¬²çš„åˆ‡æ¢å·¥ä½œçº¿ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æå®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ã€‚</p>
<p>åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯å…ˆç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">object</span> : ObservableOnSubscribe<span class="type">&lt;String&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">subscribe</span><span class="params">(emitter: <span class="typename">ObservableEmitter&lt;String&gt;</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"subscribe &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                    emitter.onNext(<span class="string">"test"</span>)</span><br><span class="line">                    emitter.onComplete()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).subscribeOn(Schedulers.io())</span><br><span class="line">                .map(<span class="keyword">object</span> : Function<span class="type">&lt;String, Int&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">apply</span><span class="params">(t: <span class="typename">String</span>)</span>: Int &#123;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(<span class="keyword">object</span> : Observer<span class="type">&lt;Int&gt;</span> &#123;</span><br><span class="line">               </span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(d: <span class="typename">Disposable</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onSubscribe &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="typename">Int</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onNext &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onComplete &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="typename">Throwable</span>)</span> &#123;</span></span><br><span class="line">                    Log.d(<span class="string">"solart"</span>, <span class="string">"onError &gt;  $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç®€åŒ–äº†æ“ä½œç¬¦çš„è°ƒç”¨ï¼Œä»¥åˆ‡æ¢çº¿ç¨‹ä¸ºç¤ºä¾‹ï¼Œæ ¹æ®è¿™æ®µä»£ç ï¼Œæˆ‘ç”»å‡ºäº†è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾ï¼ˆçµé­‚ç”»æ‰‹æœ‰æ²¡æœ‰ï¼Ÿï¼‰å¦‚ä¸‹ï¼š</p>
<p><img src="/images/rxjava2_with_scheduler.png" alt="rxjava2_with_scheduler"></p>
<p><a href="http://solart.cc/images/rxjava2_with_scheduler.png" target="_blank">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</a></p>
<p>å›¾ä¸­ä¸åŒé¢œè‰²ï¼ˆçº¢ã€ç»¿ã€ç´«ï¼‰çš„å®çº¿è¡¨ç¤ºæµç¨‹æ‰€å±ä¸åŒçº¿ç¨‹ï¼Œä½“ç°åœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è¿‡ç¨‹ï¼Œä¸”æ ‡ä¸Šäº†å¯¹åº”çš„åºå·ï¼Œæ–¹ä¾¿å¤§å®¶è§‚çœ‹ï¼Œè¿™ä¸ªå›¾å·²ç»èƒ½å¤Ÿæ­ç¤º RxJava è¿è½¬çš„æ ¸å¿ƒåŸç†ã€‚</p>
<h4 id="2-1-é€†å‘è®¢é˜…æ—¶è§¦å‘-subscribeOn-çš„çº¿ç¨‹åˆ‡æ¢"><a href="#2-1-é€†å‘è®¢é˜…æ—¶è§¦å‘-subscribeOn-çš„çº¿ç¨‹åˆ‡æ¢" class="headerlink" title="2.1 é€†å‘è®¢é˜…æ—¶è§¦å‘ subscribeOn çš„çº¿ç¨‹åˆ‡æ¢"></a>2.1 é€†å‘è®¢é˜…æ—¶è§¦å‘ subscribeOn çš„çº¿ç¨‹åˆ‡æ¢</h4><p>æ ¹æ®æˆ‘ä»¬ç¬¬ä¸€éƒ¨åˆ†çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ RxJava æœ‰ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§ä»£ç é¡ºåºçš„æ“ä½œç¬¦äº§ç”Ÿäº†ä¸€ä¸ªä¸€å±‚å±‚çš„æ•°æ®æºåŒ…è£¹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨é€†å‘è®¢é˜…æ—¶ï¼Œå°†è§‚å¯Ÿè€…æŒ‰ç…§è®¢é˜…é¡ºåºæ‰“åŒ…æˆä¸€ä¸ªä¸€å±‚å±‚çš„è§‚å¯Ÿè€…åŒ…è£¹ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨ä»£ç è°ƒç”¨è¿‡ç¨‹ä¸­ä½¿ç”¨äº†çº¿ç¨‹åˆ‡æ¢ï¼ˆsubscribeOn å’Œ observerOnï¼‰è¿™ä¸¤ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­ä¾ç„¶éµå¾ªäº†è¿™ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡å®ƒçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå¤„ç†æ—¶å®Œæˆäº†æµç¨‹ä¸Šçš„çº¿ç¨‹åˆ‡æ¢ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹è®¢é˜…æ—¶ï¼ˆå›¾ä¸­â‘¦â‘§çš„æµç¨‹ï¼‰åˆ‡æ¢çº¿ç¨‹çš„ <code>ObservableSubscribeOn</code> çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableSubscribeOn</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractObservableWithUpstream</span>&lt;<span class="title">T</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Scheduler scheduler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObservableSubscribeOn</span><span class="params">(ObservableSource&lt;T&gt; source, Scheduler scheduler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">        <span class="keyword">this</span>.scheduler = scheduler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(<span class="keyword">final</span> Observer&lt;? <span class="keyword">super</span> T&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> SubscribeOnObserver&lt;T&gt; parent = <span class="keyword">new</span> SubscribeOnObserver&lt;T&gt;(s);</span><br><span class="line"></span><br><span class="line">        s.onSubscribe(parent);</span><br><span class="line"></span><br><span class="line">        parent.setDisposable(scheduler.scheduleDirect(<span class="keyword">new</span> SubscribeTask(parent)));</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨é€†å‘è®¢é˜…çš„æµç¨‹ä¸­ï¼Œé€šè¿‡æŒ‡å®š <code>Scheduler</code> å°† <code>SubscribeTask</code> ä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ <code>SubscribeTask</code> çš„ä»£ç ï¼Œå°±æ˜¯æ‰§è¡Œäº†è®¢é˜…ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SubscribeTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SubscribeOnObserver&lt;T&gt; parent;</span><br><span class="line"></span><br><span class="line">        SubscribeTask(SubscribeOnObserver&lt;T&gt; parent) &#123;</span><br><span class="line">            <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            source.subscribe(parent); <span class="comment">// ä»…ä»…è®¢é˜…äº†ä¸€ä¸‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†æ¥çœ‹ <code>scheduler.scheduleDirect()</code> ä¸­æ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹åˆ‡æ¢çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Worker <span class="title">createWorker</span><span class="params">()</span></span>; <span class="comment">// å®ç°ç±»ä¸­å®ç°</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Disposable <span class="title">scheduleDirect</span><span class="params">(@NonNull Runnable run, <span class="keyword">long</span> delay, @NonNull TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Worker w = createWorker(); <span class="comment">// åˆ›å»ºä¸€ä¸ª worker</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Runnable decoratedRun = RxJavaPlugins.onSchedule(run);</span><br><span class="line"></span><br><span class="line">        DisposeTask task = <span class="keyword">new</span> DisposeTask(decoratedRun, w);</span><br><span class="line"></span><br><span class="line">        w.schedule(task, delay, unit); <span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> task;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç¤ºä¾‹ä¸­æ˜¯åˆ‡æ¢åˆ°äº† <code>io</code> çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹åº”çš„çœ‹ä¸€ä¸‹ <code>IoScheduler</code> çš„éƒ¨åˆ†ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">IoScheduler</span> <span class="keyword">extends</span> <span class="title">Scheduler</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@NonNull</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Worker <span class="title">createWorker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EventLoopWorker(pool.get());</span><br><span class="line">    &#125;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EventLoopWorker</span> <span class="keyword">extends</span> <span class="title">Scheduler</span>.<span class="title">Worker</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CompositeDisposable tasks;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CachedWorkerPool pool;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ThreadWorker threadWorker;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> AtomicBoolean once = <span class="keyword">new</span> AtomicBoolean();</span><br><span class="line"></span><br><span class="line">        EventLoopWorker(CachedWorkerPool pool) &#123;</span><br><span class="line">            <span class="keyword">this</span>.pool = pool;</span><br><span class="line">            <span class="keyword">this</span>.tasks = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line">            <span class="keyword">this</span>.threadWorker = pool.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@NonNull</span></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Disposable <span class="title">schedule</span><span class="params">(@NonNull Runnable action, <span class="keyword">long</span> delayTime, @NonNull TimeUnit unit)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (tasks.isDisposed()) &#123;</span><br><span class="line">                <span class="comment">// don't schedule, we are unsubscribed</span></span><br><span class="line">                <span class="keyword">return</span> EmptyDisposable.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> threadWorker.scheduleActual(action, delayTime, unit, tasks);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadWorker</span> <span class="keyword">extends</span> <span class="title">NewThreadWorker</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// æ­¤å¤„ç²˜è´´äº†äº†çˆ¶ç±»ä¸­çš„å®ç°</span></span><br><span class="line">        <span class="annotation">@NonNull</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ScheduledRunnable <span class="title">scheduleActual</span><span class="params">(<span class="keyword">final</span> Runnable run, <span class="keyword">long</span> delayTime, @NonNull TimeUnit unit, @Nullable DisposableContainer parent)</span> </span>&#123;</span><br><span class="line">            Runnable decoratedRun = RxJavaPlugins.onSchedule(run);</span><br><span class="line"></span><br><span class="line">            ScheduledRunnable sr = <span class="keyword">new</span> ScheduledRunnable(decoratedRun, parent);</span><br><span class="line"></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            Future&lt;?&gt; f;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                <span class="keyword">if</span> (delayTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                     f = executor.submit((Callable&lt;Object&gt;)sr);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     f = executor.schedule((Callable&lt;Object&gt;)sr, delayTime, unit);</span><br><span class="line">                &#125;</span><br><span class="line">                sr.setFuture(f);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RejectedExecutionException ex) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> sr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼åˆä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®  <code>ObservableSubscribeOn</code> æœ¬èº«å°±æ˜¯åœ¨ <code>subscribeActual</code> ä¸­å°†ä¸Šå±‚æ•°æ®æºåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œè®¢é˜…ï¼Œè¿™æ ·å°±å®Œæˆäº†çº¿ç¨‹çš„åˆ‡æ¢ï¼Œåç»­çš„æµç¨‹éƒ½ä¼šåœ¨è¿™ä¸ªåˆ‡æ¢åçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡åˆ‡æ¢çº¿ç¨‹ã€‚å› ä¸º RxJava æœ¬èº«æ˜¯é€†å‘è®¢é˜…çš„æµç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå°±è§£é‡Šäº†ä¸¤ä¸ªé—®é¢˜ï¼š1ã€ä¸ºä»€ä¹ˆ subscribeOn() å¯¹ä¸Šé¢çš„ä»£ç ç”Ÿæ•ˆï¼Ÿ2ã€ä¸ºä»€ä¹ˆ subscribeOn() åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼Ÿå½’æ ¹ç»“åº•éƒ½æ˜¯å› ä¸ºé€†å‘è®¢é˜…çš„æµç¨‹å†³å®šäº† subscribeOn æ˜¯åœ¨è®¢é˜…æµç¨‹ä¸­èµ·ä½œç”¨ï¼Œæ­¤æ—¶æ•°æ®è¿˜æœªäº§ç”Ÿï¼Œè€Œåœ¨ä»£ç ä¸Šç¬¬ä¸€ä¸ª subscribeOn å…¶å®æ˜¯é€†å‘è®¢é˜…æµç¨‹çš„æœ€åä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢çš„åœ°æ–¹ ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹è¦æä¸€ä¸‹ï¼Œ<code>ObservableSubscribeOn</code> åœ¨æ‰§è¡Œ <code>subscribeActual</code> æ—¶ï¼Œå›è°ƒäº†ä¸‹å±‚äº§ç”Ÿçš„ <code>Observer</code> çš„ <code>onSubscribe</code>ï¼Œå¦‚å›¾ä¸­çš„â‘£â‘¤â‘¥æµç¨‹ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨è§‚å¯Ÿè€…ä¸€è®¢é˜…åå°±ä¼šåœ¨å½“å‰è®¢é˜…çš„çº¿ç¨‹æ”¶åˆ° <code>onSubscribe</code> çš„å›è°ƒçš„åŸå› ã€‚</p>
<h4 id="2-2-æ­£å‘æ•°æ®æµè§¦å‘-observerOn-çš„çº¿ç¨‹åˆ‡æ¢"><a href="#2-2-æ­£å‘æ•°æ®æµè§¦å‘-observerOn-çš„çº¿ç¨‹åˆ‡æ¢" class="headerlink" title="2.2 æ­£å‘æ•°æ®æµè§¦å‘ observerOn çš„çº¿ç¨‹åˆ‡æ¢"></a>2.2 æ­£å‘æ•°æ®æµè§¦å‘ observerOn çš„çº¿ç¨‹åˆ‡æ¢</h4><p>åŒç¬¬ä¸€éƒ¨åˆ†ä¸€æ ·çš„ï¼Œè®¢é˜…åˆ°æœ€ä¸Šå±‚æ—¶ï¼Œè§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œä»è€Œåˆæ­£å‘çš„æµè½¬æ•°æ®ï¼Œæ­¤è¿‡ç¨‹æˆ‘ä»¬ä¸åœ¨è¯¦ç»†åˆ†æï¼Œå‚ç…§1.3ï¼Œæˆ‘ä»¬ç€é‡çœ‹ä¸€ä¸‹ <code>ObserveOnObserver</code> çš„ onNext å¤„ç†çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­æ­¥éª¤â‘®â‘¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableObserveOn</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractObservableWithUpstream</span>&lt;<span class="title">T</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Scheduler scheduler;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (scheduler <span class="keyword">instanceof</span> TrampolineScheduler) &#123;</span><br><span class="line">            source.subscribe(observer);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Scheduler.Worker w = scheduler.createWorker();</span><br><span class="line"></span><br><span class="line">            source.subscribe(<span class="keyword">new</span> ObserveOnObserver&lt;T&gt;(observer, w, delayError, bufferSize));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserveOnObserver</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BasicIntQueueDisposable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title">Observer</span>&lt;<span class="title">T</span>&gt;, <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">final</span> Observer&lt;? <span class="keyword">super</span> T&gt; actual;</span><br><span class="line">        <span class="keyword">final</span> Scheduler.Worker worker;</span><br><span class="line">        ...</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (done) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sourceMode != QueueDisposable.ASYNC) &#123;</span><br><span class="line">                queue.offer(t);</span><br><span class="line">            &#125;</span><br><span class="line">            schedule(); <span class="comment">//ç±»ä¼¼ ObservableSubscribeOn.subscribeActual() å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">schedule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (getAndIncrement() == <span class="number">0</span>) &#123;</span><br><span class="line">                worker.schedule(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (outputFused) &#123;</span><br><span class="line">                drainFused();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                drainNormal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä¸­æˆ‘ä»¬æ­¤æ—¶åˆ‡æ¢åˆ°äº† <code>Main</code> çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹å¯¹åº”çš„ <code>HandlerScheduler</code> å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerScheduler</span> <span class="keyword">extends</span> <span class="title">Scheduler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Handler handler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> async;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Disposable <span class="title">scheduleDirect</span><span class="params">(Runnable run, <span class="keyword">long</span> delay, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (run == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"run == null"</span>);</span><br><span class="line">        <span class="keyword">if</span> (unit == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"unit == null"</span>);</span><br><span class="line"></span><br><span class="line">        run = RxJavaPlugins.onSchedule(run);</span><br><span class="line">        ScheduledRunnable scheduled = <span class="keyword">new</span> ScheduledRunnable(handler, run);</span><br><span class="line">        handler.postDelayed(scheduled, unit.toMillis(delay));</span><br><span class="line">        <span class="keyword">return</span> scheduled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Worker <span class="title">createWorker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HandlerWorker(handler, async);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerWorker</span> <span class="keyword">extends</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="annotation">@SuppressLint</span>(<span class="string">"NewApi"</span>) <span class="comment">// Async will only be true when the API is available to call.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Disposable <span class="title">schedule</span><span class="params">(Runnable run, <span class="keyword">long</span> delay, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            run = RxJavaPlugins.onSchedule(run);</span><br><span class="line"></span><br><span class="line">            ScheduledRunnable scheduled = <span class="keyword">new</span> ScheduledRunnable(handler, run);</span><br><span class="line"></span><br><span class="line">            Message message = Message.obtain(handler, scheduled);</span><br><span class="line">            message.obj = <span class="keyword">this</span>; <span class="comment">// Used as token for batch disposal of this worker's runnables.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (async) &#123;</span><br><span class="line">                message.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            handler.sendMessageDelayed(message, unit.toMillis(delay));</span><br><span class="line"></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> scheduled;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å°† <code>Runnable</code> é€šè¿‡ Handler å‘åˆ°äº†ä½çº¿ç¨‹å»æ‰§è¡Œï¼Œæ‰€ä»¥ç»è¿‡æ­¤æ­¥éª¤åï¼Œåç»­çš„ onNext çš„å¤„ç†å·²ç»åˆ‡æ¢ä¸ºä¸»çº¿ç¨‹ã€‚åŒæ ·çš„ï¼Œè¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸€å¼€å§‹æˆ‘ä»¬æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆ observerOn() å¯¹ä¸‹é¢ä»£ç ç”Ÿæ•ˆï¼Ÿæ­£æ˜¯å› ä¸ºï¼Œæ•°æ®çš„æµå‘å†³å®šäº† observerOn() å¯¹åç»­çš„ onNext äº§ç”Ÿå½±å“ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>è‡³æ­¤ RxJava è¿è½¬æœºåˆ¶æˆ‘ä»¬å·²ç»åˆ†æå®Œæ¯•ï¼Œå¤§å®¶å¯ä»¥æ¯”ç…§å›¾ä¸­æµç¨‹ï¼Œè·Ÿè¸ªä»£ç è°ƒç”¨å…³ç³»ï¼Œç›¸ä¿¡ä¼šæœ‰å¾ˆå¤§æ”¶è·ã€‚ RxJava æœ¬èº«æ˜¯ä¸€ä¸ªå˜ç§çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ­£æ˜¯å› ä¸ºæ¡†æ¶æœ¬èº«è¦å®ç°<code>å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹</code>ï¼Œæ‰€ä»¥äº§ç”Ÿäº†é€†å‘è®¢é˜…çš„è¿‡ç¨‹ï¼ŒåŒæ—¶æ•°æ®åˆæ˜¯æ­£å‘æµè½¬çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¤§å®¶è¿˜éœ€è¦ç†è§£ä¸¤ä¸ªåŒ…è£¹å°è£…ï¼ˆè¢«è§‚å¯Ÿè€…ã€è§‚å¯Ÿè€…ï¼‰çš„è¿‡ç¨‹ï¼Œä¸ç®¡æ“ä½œç¬¦æ€ä¹ˆå˜æ¢ï¼Œéƒ½ä¸ä¼šè„±ç¦»è¿™æ ·çš„è¿ä½œæ ¸å¿ƒã€‚</p>
<p>å¦å¤–æ ¹æ®ä¸åŒçš„æ“ä½œç¬¦çš„å®ç°ï¼Œæˆ‘ä»¬ä¾ç…§åŒæ ·çš„æ¨¡å¼ï¼Œå¯å®ç°è‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œåªè¦èƒ½åœ¨è®¢é˜…æ—¶å’Œæ•°æ®å›æµæ—¶åšå¥½ä¸Šä¸‹å±‚çš„è¡”æ¥å°±å¥½ï¼Œè¿™ä¸ªå¤§å®¶å¯ä»¥è‡ªå·±å®è·µã€‚</p>
</div></article></div></section><footer><div class="paginator"><a href="/2018/07/07/gradle-migrate-3.0.0+/" class="next">ä¸‹ä¸€ç¯‡</a></div><div style="padding:0; margin: 30px auto; width: 100%; text-align: center;"><div style="font-size: 1em; margin: 10px auto;color:#f44336;font-weight: bold"> å¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨è¯·ä½œè€…å–ç“¶å…»ä¹å¤š<div style="padding: 0; margin: 10px auto; width: 100%; text-align: center; color:#f44336;"></div></div><button style="cursor: pointer; border: 0; outline: 0; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0; text-shadow: none; background-color: transparent; text-align: center; cursor: pointer;" id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"><span style="display: inline-block; width: 70px; height: 70px; color: #fff; font-weight: bold; font-style: normal; font-variant: normal; font-stretch: normal; font-size: 2.5em; text-align: center; line-height: 70px; background: #f44336; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;">èµ</span></button><div id="QR" style="display: none;"><div id="wechat" style="width: auto; max-width: 50%; float: left; margin: 20px; display: inline-block;"><img id="wechat_qr" src="/images/wechat.png" alt="WechatPay"></div><div id="alipay" style="width: auto; max-width: 50%; float: right; margin: 20px; display: inline-block;"><img id="alipay_qr" src="/images/alipay.png" alt="Alipay"></div></div></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var cloudTieConfig = {
    url: document.location.href,
    sourceId: "",
    productKey: "8b0c22fa1d324f8e9c45b4f8e5d5c325",
    target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
</script><div class="copyright"><p>Â© 2015 - 2020 <a href="http://solart.cc">solart</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-51018462-1",'auto');ga('send','pageview');</script></body></html>