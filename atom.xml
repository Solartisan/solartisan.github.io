<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Solartisan</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://solart.cc/"/>
  <updated>2020-06-16T16:07:15.329Z</updated>
  <id>http://solart.cc/</id>
  
  <author>
    <name>solart</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸¤å¼ å›¾å½»åº•ç†è§£ RxJava2 çš„æ ¸å¿ƒåŸç†</title>
    <link href="http://solart.cc/2020/06/16/understand_rxjava2/"/>
    <id>http://solart.cc/2020/06/16/understand_rxjava2/</id>
    <published>2020-06-16T09:36:08.000Z</published>
    <updated>2020-06-16T16:07:15.329Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç›¸ä¿¡ &lt;code&gt;RxJava&lt;/code&gt; æ˜¯å¤§å®¶ä¸šåŠ¡ä¸­ç”¨åˆ°æ¯”è¾ƒå¤šçš„ä¸€ä¸ªä¾èµ–åº“ï¼Œå¯¹äº RxJava ç§ç±»ç¹å¤šçš„æ“ä½œç¬¦ï¼Œå¤§å¤šæ•°åŒå­¦éƒ½è¡¨ç¤ºå¾ˆæ˜¯å¤´ç–¼ï¼Œä¹Ÿæœ‰ä¸å°‘åŒå­¦é™·å…¥äº†å­¦ä¹ æ“ä½œç¬¦ä¸èƒ½åœçš„æ€ªåœˆã€‚æ–‡ç« ä¼¼ä¹æœ‰äº›æ ‡é¢˜å…šçš„å«Œç–‘ï¼Œæ ¹æ®æˆ‘çš„ç†è§£ç”»å‡ºä¸¤å¹…å›¾ç›¸ä¿¡å¯ä»¥è®©å¤§å®¶ç†è§£å…¶æ ¸å¿ƒåŸç†ï¼Œç¨åä¸è¦åå•¬ï¼Œè¯·å«æˆ‘çµé­‚ç”»æ‰‹ğŸ˜„ï¼&lt;/p&gt;
&lt;p&gt;æ“ä½œç¬¦è¦ä¸è¦å­¦ï¼Œå½“ç„¶è¦ï¼Œä½†æ˜¯å¦‚æœèƒ½ç†è§£ RxJava çš„æ ¸å¿ƒï¼Œæ“ä½œç¬¦çš„ä½¿ç”¨å°±åƒæ˜¯å­¦ä¼šä¹é˜³ç¥åŠŸçš„å¼ æ— å¿Œå­¦æ‹›æ•°ï¼Œå¿…å®šæ˜¯æ‰‹åˆ°æ“’æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;RxJava2 åŸºæœ¬çš„è¿è¡Œæµç¨‹&lt;/li&gt;
&lt;li&gt;RxJava2 çº¿ç¨‹åˆ‡æ¢çš„åŸç†ï¼ˆæ¶‰åŠåˆ°ä¸ºä»€ä¹ˆ subscribeOn() åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼‰&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä¸€è®¢é˜…å°±å›è°ƒäº† onSubscribe&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ subscribeOn() å¯¹ä¸Šé¢çš„ä»£ç ç”Ÿæ•ˆï¼ŒobserverOn() å¯¹ä¸‹é¢ä»£ç ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹å†…å®¹å¦‚æœæ¶‰åŠåˆ°è‡ªå·±å†™çš„ä»£ç æˆ‘ä¼šé‡‡ç”¨ Kotlin è¿›è¡Œç¤ºä¾‹å±•ç¤ºï¼Œæ¶‰åŠåˆ° RxJava2 ä¼šå±•ç¤ºéƒ¨åˆ†æºç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;a href=&quot;#1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;/a&gt;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&lt;/h2&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å…ˆæ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Observable.create(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : ObservableOnSubscribe&lt;span class=&quot;type&quot;&gt;&amp;lt;String&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(emitter: &lt;span class=&quot;typename&quot;&gt;ObservableEmitter&amp;lt;String&amp;gt;&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;subscribe &amp;gt; $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                emitter.onNext(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                emitter.onComplete()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;).flatMap(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : Function&lt;span class=&quot;type&quot;&gt;&amp;lt;String, Observable&amp;lt;String&amp;gt;&lt;/span&gt;&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t: &lt;span class=&quot;typename&quot;&gt;String&lt;/span&gt;)&lt;/span&gt;: Observable&lt;span class=&quot;type&quot;&gt;&amp;lt;String&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Observable.just(t)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;).map(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : Function&lt;span class=&quot;type&quot;&gt;&amp;lt;String, Int&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t: &lt;span class=&quot;typename&quot;&gt;String&lt;/span&gt;)&lt;/span&gt;: Int &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;).subscribe(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : Observer&lt;span class=&quot;type&quot;&gt;&amp;lt;Int&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onSubscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(d: &lt;span class=&quot;typename&quot;&gt;Disposable&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onSubscribe &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t: &lt;span class=&quot;typename&quot;&gt;Int&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onNext &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onComplete &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(e: &lt;span class=&quot;typename&quot;&gt;Throwable&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onError &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ç®€å•ç”¨äº† &lt;code&gt;create&lt;/code&gt;ã€&lt;code&gt;flatMap&lt;/code&gt;ã€&lt;code&gt;map&lt;/code&gt;ç­‰æ“ä½œç¬¦ï¼Œè¿›è¡Œäº†æµå¼çš„æ•°æ®è½¬æ¢ï¼Œæœ€åæˆ‘ä»¬é€šè¿‡ &lt;code&gt;subscribe&lt;/code&gt; è®¢é˜…äº†æ•°æ®æµï¼Œå…¶å®é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ RxJava æœ¬èº«æ˜¯ä¸ªé€†å‘è®¢é˜…çš„è¿‡ç¨‹ï¼Œè¯ä¸å¤šè¯´å…ˆçœ‹å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/rxjava2.png&quot; alt=&quot;rxjava2&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;1-1-æ•°æ®æºçš„åŒ…è£¹&quot;&gt;&lt;a href=&quot;#1-1-æ•°æ®æºçš„åŒ…è£¹&quot; class=&quot;headerlink&quot; title=&quot;1.1 æ•°æ®æºçš„åŒ…è£¹&quot;&gt;&lt;/a&gt;1.1 æ•°æ®æºçš„åŒ…è£¹&lt;/h4&gt;&lt;p&gt;æ¯”ç…§ç€è¿™å¼ å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œé¦–å…ˆ&lt;code&gt;è“è‰²è™šçº¿&lt;/code&gt;éƒ¨åˆ†æ˜¯æˆ‘ä»¬ä»£ç ä¸­å®é™…è°ƒç”¨çš„é¡ºåºï¼ŒæŸ¥çœ‹ &lt;code&gt;Observable.create&lt;/code&gt; æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œæ­¤å¤„å°±æ˜¯äº§ç”Ÿäº†ä¸€ä¸ª &lt;code&gt;ObservableCreate&lt;/code&gt; å®ä¾‹ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Observable&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ObservableOnSubscribe&amp;lt;T&amp;gt; source)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ObjectHelper.requireNonNull(source, &lt;span class=&quot;string&quot;&gt;&quot;source is null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; RxJavaPlugins.onAssembly(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ObservableCreate&amp;lt;T&amp;gt;(source));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚æˆ‘ä»¬å›¾ä¸­æ‰€ç¤ºï¼Œ &lt;code&gt;ObservableCreate&lt;/code&gt; å†…éƒ¨åŒ…å«ä¸€ä¸ªç±»å‹ä¸º &lt;code&gt;ObservableOnSubscribe&amp;lt;T&amp;gt;&lt;/code&gt; çš„ &lt;code&gt;source&lt;/code&gt; å˜é‡ï¼Œæ ¹æ®æˆ‘ä»¬ä»£ç ä¸­çš„è°ƒç”¨ï¼Œè¿™ä¸ª &lt;code&gt;source&lt;/code&gt; å°±æ˜¯æˆ‘ä»¬ Kotlin ä»£ç ä¸­çš„åŒ¿åå¯¹è±¡ &lt;code&gt;object : ObservableOnSubscribe&amp;lt;String&amp;gt;&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableCreate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Observable&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ObservableOnSubscribe&amp;lt;T&amp;gt; source;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ObservableOnSubscribe&amp;lt;T&amp;gt; source)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.source = source;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribeActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬é¡ºç€ä»£ç çš„è°ƒç”¨é¡ºåºï¼Œç»§ç»­çœ‹ä¸€ä¸‹ &lt;code&gt;flatMap&lt;/code&gt; çš„æ–¹æ³•ä¸­åˆåšäº†ä»€ä¹ˆï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &amp;lt;R&amp;gt; &lt;span class=&quot;function&quot;&gt;Observable&amp;lt;R&amp;gt; &lt;span class=&quot;title&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Function&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T, ? extends ObservableSource&amp;lt;? extends R&amp;gt;&amp;gt; mapper,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; delayErrors, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxConcurrency, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; bufferSize)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; RxJavaPlugins.onAssembly(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ObservableFlatMap&amp;lt;T, R&amp;gt;(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, mapper, delayErrors, maxConcurrency, bufferSize));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç±»ä¼¼çš„äº§ç”Ÿäº†ä¸€ä¸ª &lt;code&gt;ObservableFlatMap&lt;/code&gt; å®ä¾‹ï¼Œè€Œå…¶å†…éƒ¨æŒæœ‰ä¸€ä¸ªç±»å‹ä¸º &lt;code&gt;ObservableSource&amp;lt;T&amp;gt;&lt;/code&gt;çš„ &lt;code&gt;source&lt;/code&gt; å˜é‡ï¼Œè€Œè¯¥ source åˆ™æ˜¯ä¸Šä¸€æ­¥ä¸­çš„ &lt;code&gt;ObservableCreate&lt;/code&gt; å®ä¾‹ï¼Œä¾æ¬¡æˆ‘ä»¬çœ‹ &lt;code&gt;map&lt;/code&gt; ä¾ç„¶æ˜¯ç±»ä¼¼çš„ä»£ç ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œæ‰€ä»¥åˆ°æ­¤æˆ‘ä»¬å¾—åˆ°äº†å›¾ä¸­è“è‰²è™šçº¿éƒ¨åˆ†çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-é€†å‘è®¢é˜…æ•°æ®æº&quot;&gt;&lt;a href=&quot;#1-2-é€†å‘è®¢é˜…æ•°æ®æº&quot; class=&quot;headerlink&quot; title=&quot;1.2 é€†å‘è®¢é˜…æ•°æ®æº&quot;&gt;&lt;/a&gt;1.2 é€†å‘è®¢é˜…æ•°æ®æº&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“ä»¥ä¸Šçš„ä»£ç è°ƒç”¨å¹¶æ²¡æœ‰å‡ºå‘æ•°æ®çš„æµè½¬ï¼Œåªæœ‰å½“æˆ‘ä»¬è°ƒç”¨ &lt;code&gt;subscribe&lt;/code&gt; æ—¶ï¼ˆå›¾ä¸­çº¢è‰²å®çº¿éƒ¨åˆ†ï¼‰æ‰çœŸæ­£è§¦å‘äº† RxJava çš„æ•°æ®æµï¼Œæˆ‘ä»¬æ¥çœ‹ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ObjectHelper.requireNonNull(observer, &lt;span class=&quot;string&quot;&gt;&quot;observer is null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            observer = RxJavaPlugins.onSubscribe(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, observer);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ObjectHelper.requireNonNull(observer, &lt;span class=&quot;string&quot;&gt;&quot;Plugin returned null Observer&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// é‡ç‚¹ï¼ï¼ï¼ å‘ç”Ÿè®¢é˜…çš„æ ¸å¿ƒæ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            subscribeActual(observer);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (NullPointerException e) &amp;#123; &lt;span class=&quot;comment&quot;&gt;// NOPMD&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; npe;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æï¼Œæ‰§è¡Œ &lt;code&gt;subscribeActual&lt;/code&gt; çš„å¯¹è±¡å…¶å®æ˜¯ &lt;code&gt;ObservableMap&lt;/code&gt; ï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒçš„ &lt;code&gt;subscribeActual&lt;/code&gt; çš„å®ç°&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableMap&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;U&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AbstractObservableWithUpstream&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;U&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribeActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; U&amp;gt; t)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        source.subscribe(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MapObserver&amp;lt;T, U&amp;gt;(t, function));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ï¼Œæ­¤æ—¶äº§ç”Ÿäº†ä¸€ä¸ª &lt;code&gt;MapObserver&lt;/code&gt; å¯¹è±¡ï¼Œ&lt;code&gt;MapObserver&lt;/code&gt; ä¸­é€šè¿‡ &lt;code&gt;actual&lt;/code&gt; æŒæœ‰äº†æˆ‘ä»¬è‡ªå·±çš„åŒ¿åå¯¹è±¡ &lt;code&gt;object : Observer&amp;lt;Int&amp;gt;&lt;/code&gt; ï¼ŒåŒæ ·çš„ï¼Œ&lt;code&gt;ObservableMap&lt;/code&gt; æ‰§è¡Œ subscribeActual åˆè°ƒç”¨äº†ä¸Šå±‚çš„ &lt;code&gt;source.subscribe&lt;/code&gt; ï¼Œä¾æ¬¡é€†å‘è°ƒç”¨ï¼Œå°±å¾—åˆ°äº†æˆ‘ä»¬å›¾ä¸­ä¸ŠåŠéƒ¨åˆ†çš„çº¢çº¿å†…å®¹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-3-è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬&quot;&gt;&lt;a href=&quot;#1-3-è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬&quot; class=&quot;headerlink&quot; title=&quot;1.3 è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬&quot;&gt;&lt;/a&gt;1.3 è§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œæ•°æ®æµè½¬&lt;/h4&gt;&lt;p&gt;å½“è®¢é˜…å‘ç”Ÿåœ¨æœ€é¡¶å±‚æ—¶ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;ObservableCreate&lt;/code&gt; ä¸­çš„ &lt;code&gt;subscribeActual&lt;/code&gt; ï¼Œæ­¤æ—¶è§¦å‘äº†æ•°æ®æºçš„äº§ç”Ÿï¼Œé€šè¿‡ &lt;code&gt;emitter&lt;/code&gt; å‘å°„æ•°æ®&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableCreate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Observable&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribeActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CreateEmitter&amp;lt;T&amp;gt; parent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CreateEmitter&amp;lt;T&amp;gt;(observer);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        observer.onSubscribe(parent); &lt;span class=&quot;comment&quot;&gt;//æ­¤æ—¶è§¦å‘äº† onSubscribe å›è°ƒï¼Œè¿™é‡Œå…ˆæä¸€ä¸‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            source.subscribe(parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Exceptions.throwIfFatal(ex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            parent.onError(ex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è€Œæˆ‘ä»¬ä»£ç ä¸­æ­¤æ—¶äº§ç”Ÿäº†çœŸæ­£çš„æ•°æ®&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(emitter: &lt;span class=&quot;typename&quot;&gt;ObservableEmitter&amp;lt;String&amp;gt;&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;subscribe &amp;gt; $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                emitter.onNext(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                emitter.onComplete()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹ &lt;code&gt;CreateEmitter&lt;/code&gt; çš„å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CreateEmitter&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AtomicReference&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Disposable&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableEmitter&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt;, &lt;span class=&quot;title&quot;&gt;Disposable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CreateEmitter(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.observer = observer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(T t)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!isDisposed()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                observer.onNext(t);  &lt;span class=&quot;comment&quot;&gt;//å‘ä¸‹å±‚åˆ†å‘æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„åˆ†æ &lt;code&gt;CreateEmitter&lt;/code&gt; ä¸­æŒæœ‰çš„ &lt;code&gt;observer&lt;/code&gt; å³æ˜¯ &lt;code&gt;FlatMapObserver&lt;/code&gt; çš„å®ä¾‹ï¼Œè€Œ &lt;code&gt;FlatMapObserver&lt;/code&gt; è°ƒç”¨ onNext æ—¶ï¼Œåˆä¼šè°ƒç”¨ &lt;code&gt;MapObserver&lt;/code&gt; çš„ onNext ï¼Œä¾æ¬¡è°ƒç”¨è‡³æˆ‘ä»¬è‡ªå·±å®ç°çš„è§‚å¯Ÿè€…çš„ onNext å¤„ç†æ•°æ®ï¼Œæ­¤æ—¶æ•°æ®æµè½¬å®Œæ¯•ã€‚&lt;/p&gt;
&lt;p&gt;è§‚å¯Ÿæˆ‘ä»¬è¿™ä¸ªå›¾ï¼Œä½ ä¼šå‘ç°ï¼Œ&lt;code&gt;æ“ä½œç¬¦&lt;/code&gt; å¯¹åº”äº§ç”Ÿçš„è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…å‘½åè§„åˆ™å¾ˆæœ‰è§„å¾‹ï¼Œæ¯”å¦‚è¯´è¢«è§‚å¯Ÿè€…çš„å‘½å &lt;code&gt;Observable + æ“ä½œç¬¦&lt;/code&gt; ï¼Œä¾‹å¦‚ &lt;code&gt;ObservableMap&lt;/code&gt; = Observable + mapï¼Œè§‚å¯Ÿè€…å‘½åå¤§å¤šéµå¾ª &lt;code&gt;æ“ä½œç¬¦ + Observer&lt;/code&gt; ï¼Œä¾‹å¦‚ &lt;code&gt;FlatMapObserver&lt;/code&gt; = flatMap + Observerã€‚é™¤äº†å‘½åè§„åˆ™å¤–ï¼Œæˆ‘ä»¬è§‚å¯Ÿæ•´ä¸ªæµç¨‹ï¼Œä½ ä¹Ÿä¼šå‘ç°æœ‰ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§ä»£ç é¡ºåºçš„æ“ä½œç¬¦äº§ç”Ÿäº†ä¸€ä¸ªä¸€å±‚å±‚çš„æ•°æ®æºåŒ…è£¹ï¼ˆè“è‰²è™šçº¿çš„æµç¨‹éƒ¨åˆ†ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨é€†å‘è®¢é˜…æ—¶ï¼Œå°†è§‚å¯Ÿè€…æŒ‰ç…§è®¢é˜…é¡ºåºæ‰“åŒ…æˆä¸€ä¸ªä¸€å±‚å±‚çš„è§‚å¯Ÿè€…åŒ…è£¹ï¼ˆä¸Šéƒ¨åˆ†çš„çº¢è‰²æµç¨‹éƒ¨åˆ†ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;a href=&quot;#2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;/a&gt;2ã€å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰&lt;/h2&gt;&lt;p&gt;ç›¸ä¿¡æœ‰äº†ä¸Šé¢çš„åˆ†æï¼Œå¤§å®¶å¯¹ RxJava çš„é€†å‘è®¢é˜…ä»¥åŠæ•°æ®æµè½¬æœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œä½†æ˜¯ RxJava çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹æ–¹å¼ï¼Œéšå¿ƒæ‰€æ¬²çš„åˆ‡æ¢å·¥ä½œçº¿ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æå®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯å…ˆç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Observable.create(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : ObservableOnSubscribe&lt;span class=&quot;type&quot;&gt;&amp;lt;String&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(emitter: &lt;span class=&quot;typename&quot;&gt;ObservableEmitter&amp;lt;String&amp;gt;&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;subscribe &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    emitter.onNext(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    emitter.onComplete()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).subscribeOn(Schedulers.io())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .map(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : Function&lt;span class=&quot;type&quot;&gt;&amp;lt;String, Int&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t: &lt;span class=&quot;typename&quot;&gt;String&lt;/span&gt;)&lt;/span&gt;: Int &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).observeOn(AndroidSchedulers.mainThread())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .subscribe(&lt;span class=&quot;keyword&quot;&gt;object&lt;/span&gt; : Observer&lt;span class=&quot;type&quot;&gt;&amp;lt;Int&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onSubscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(d: &lt;span class=&quot;typename&quot;&gt;Disposable&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onSubscribe &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t: &lt;span class=&quot;typename&quot;&gt;Int&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onNext &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onComplete &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(e: &lt;span class=&quot;typename&quot;&gt;Throwable&lt;/span&gt;)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Log.d(&lt;span class=&quot;string&quot;&gt;&quot;solart&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onError &amp;gt;  $&amp;#123;Thread.currentThread().name&amp;#125;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œç®€åŒ–äº†æ“ä½œç¬¦çš„è°ƒç”¨ï¼Œä»¥åˆ‡æ¢çº¿ç¨‹ä¸ºç¤ºä¾‹ï¼Œæ ¹æ®è¿™æ®µä»£ç ï¼Œæˆ‘ç”»å‡ºäº†è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾ï¼ˆçµé­‚ç”»æ‰‹æœ‰æ²¡æœ‰ï¼Ÿï¼‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/rxjava2_with_scheduler.png&quot; alt=&quot;rxjava2_with_scheduler&quot;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ä¸åŒé¢œè‰²ï¼ˆçº¢ã€ç»¿ã€ç´«ï¼‰çš„å®çº¿è¡¨ç¤ºæµç¨‹æ‰€å±ä¸åŒçº¿ç¨‹ï¼Œä½“ç°åœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è¿‡ç¨‹ï¼Œä¸”æ ‡ä¸Šäº†å¯¹åº”çš„åºå·ï¼Œæ–¹ä¾¿å¤§å®¶è§‚çœ‹ï¼Œè¿™ä¸ªå›¾å·²ç»èƒ½å¤Ÿæ­ç¤º RxJava è¿è½¬çš„æ ¸å¿ƒåŸç†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-é€†å‘è®¢é˜…æ—¶è§¦å‘-subscribeOn-çš„çº¿ç¨‹åˆ‡æ¢&quot;&gt;&lt;a href=&quot;#2-1-é€†å‘è®¢é˜…æ—¶è§¦å‘-subscribeOn-çš„çº¿ç¨‹åˆ‡æ¢&quot; class=&quot;headerlink&quot; title=&quot;2.1 é€†å‘è®¢é˜…æ—¶è§¦å‘ subscribeOn çš„çº¿ç¨‹åˆ‡æ¢&quot;&gt;&lt;/a&gt;2.1 é€†å‘è®¢é˜…æ—¶è§¦å‘ subscribeOn çš„çº¿ç¨‹åˆ‡æ¢&lt;/h4&gt;&lt;p&gt;æ ¹æ®æˆ‘ä»¬ç¬¬ä¸€éƒ¨åˆ†çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ RxJava æœ‰ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§ä»£ç é¡ºåºçš„æ“ä½œç¬¦äº§ç”Ÿäº†ä¸€ä¸ªä¸€å±‚å±‚çš„æ•°æ®æºåŒ…è£¹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨é€†å‘è®¢é˜…æ—¶ï¼Œå°†è§‚å¯Ÿè€…æŒ‰ç…§è®¢é˜…é¡ºåºæ‰“åŒ…æˆä¸€ä¸ªä¸€å±‚å±‚çš„è§‚å¯Ÿè€…åŒ…è£¹ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨ä»£ç è°ƒç”¨è¿‡ç¨‹ä¸­ä½¿ç”¨äº†çº¿ç¨‹åˆ‡æ¢ï¼ˆsubscribeOn å’Œ observerOnï¼‰è¿™ä¸¤ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­ä¾ç„¶éµå¾ªäº†è¿™ä¸¤ä¸ªåŒ…è£¹å°è£…çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡å®ƒçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå¤„ç†æ—¶å®Œæˆäº†æµç¨‹ä¸Šçš„çº¿ç¨‹åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹è®¢é˜…æ—¶ï¼ˆå›¾ä¸­â‘¦çš„æµç¨‹ï¼‰åˆ‡æ¢çº¿ç¨‹çš„ &lt;code&gt;ObservableSubscribeOn&lt;/code&gt; çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableSubscribeOn&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AbstractObservableWithUpstream&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Scheduler scheduler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableSubscribeOn&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ObservableSource&amp;lt;T&amp;gt; source, Scheduler scheduler)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(source);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.scheduler = scheduler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribeActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; s)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; SubscribeOnObserver&amp;lt;T&amp;gt; parent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SubscribeOnObserver&amp;lt;T&amp;gt;(s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        s.onSubscribe(parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        parent.setDisposable(scheduler.scheduleDirect(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SubscribeTask(parent)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨é€†å‘è®¢é˜…çš„æµç¨‹ä¸­ï¼Œé€šè¿‡æŒ‡å®š &lt;code&gt;Scheduler&lt;/code&gt; å°† &lt;code&gt;SubscribeTask&lt;/code&gt; ä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ &lt;code&gt;SubscribeTask&lt;/code&gt; çš„ä»£ç ï¼Œå°±æ˜¯æ‰§è¡Œäº†è®¢é˜…ï¼š&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SubscribeTask&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Runnable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; SubscribeOnObserver&amp;lt;T&amp;gt; parent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SubscribeTask(SubscribeOnObserver&amp;lt;T&amp;gt; parent) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.parent = parent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            source.subscribe(parent); &lt;span class=&quot;comment&quot;&gt;// ä»…ä»…è®¢é˜…äº†ä¸€ä¸‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å†æ¥çœ‹ &lt;code&gt;scheduler.scheduleDirect()&lt;/code&gt; ä¸­æ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹åˆ‡æ¢çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Scheduler&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; Worker &lt;span class=&quot;title&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// å®ç°ç±»ä¸­å®ç°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Disposable &lt;span class=&quot;title&quot;&gt;scheduleDirect&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(@NonNull Runnable run, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delay, @NonNull TimeUnit unit)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Worker w = createWorker(); &lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ª worker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Runnable decoratedRun = RxJavaPlugins.onSchedule(run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DisposeTask task = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DisposeTask(decoratedRun, w);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        w.schedule(task, delay, unit); &lt;span class=&quot;comment&quot;&gt;//æ‰§è¡Œä»»åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; task;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬ç¤ºä¾‹ä¸­æ˜¯åˆ‡æ¢åˆ°äº† &lt;code&gt;io&lt;/code&gt; çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹åº”çš„çœ‹ä¸€ä¸‹ &lt;code&gt;IoScheduler&lt;/code&gt; çš„éƒ¨åˆ†ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IoScheduler&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Scheduler&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Worker &lt;span class=&quot;title&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EventLoopWorker(pool.get());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;EventLoopWorker&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Scheduler&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Worker&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; CompositeDisposable tasks;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; CachedWorkerPool pool;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ThreadWorker threadWorker;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; AtomicBoolean once = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AtomicBoolean();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        EventLoopWorker(CachedWorkerPool pool) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.pool = pool;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.tasks = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CompositeDisposable();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.threadWorker = pool.get();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Disposable &lt;span class=&quot;title&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(@NonNull Runnable action, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delayTime, @NonNull TimeUnit unit)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tasks.isDisposed()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// don&#39;t schedule, we are unsubscribed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; EmptyDisposable.INSTANCE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; threadWorker.scheduleActual(action, delayTime, unit, tasks);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ThreadWorker&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NewThreadWorker&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// æ­¤å¤„ç²˜è´´äº†äº†çˆ¶ç±»ä¸­çš„å®ç°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; ScheduledRunnable &lt;span class=&quot;title&quot;&gt;scheduleActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Runnable run, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delayTime, @NonNull TimeUnit unit, @Nullable DisposableContainer parent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Runnable decoratedRun = RxJavaPlugins.onSchedule(run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ScheduledRunnable sr = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ScheduledRunnable(decoratedRun, parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Future&amp;lt;?&amp;gt; f;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (delayTime &amp;lt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                     f = executor.submit((Callable&amp;lt;Object&amp;gt;)sr);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                     f = executor.schedule((Callable&amp;lt;Object&amp;gt;)sr, delayTime, unit);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sr.setFuture(f);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RejectedExecutionException ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»¼åˆä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®  &lt;code&gt;ObservableSubscribeOn&lt;/code&gt; æœ¬èº«å°±æ˜¯åœ¨ &lt;code&gt;subscribeActual&lt;/code&gt; ä¸­å°†ä¸Šå±‚æ•°æ®æºåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œè®¢é˜…ï¼Œè¿™æ ·å°±å®Œæˆäº†çº¿ç¨‹çš„åˆ‡æ¢ï¼Œåç»­çš„æµç¨‹éƒ½ä¼šåœ¨è¿™ä¸ªåˆ‡æ¢åçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡åˆ‡æ¢çº¿ç¨‹ã€‚å› ä¸º RxJava æœ¬èº«æ˜¯é€†å‘è®¢é˜…çš„æµç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå°±è§£é‡Šäº†ä¸¤ä¸ªé—®é¢˜ï¼š1ã€ä¸ºä»€ä¹ˆ subscribeOn() å¯¹ä¸Šé¢çš„ä»£ç ç”Ÿæ•ˆï¼Ÿ2ã€ä¸ºä»€ä¹ˆ subscribeOn() åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼Ÿå½’æ ¹ç»“åº•éƒ½æ˜¯å› ä¸ºé€†å‘è®¢é˜…çš„æµç¨‹å†³å®šäº† subscribeOn æ˜¯åœ¨è®¢é˜…æµç¨‹ä¸­èµ·ä½œç”¨ï¼Œæ­¤æ—¶æ•°æ®è¿˜æœªäº§ç”Ÿã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹è¦æä¸€ä¸‹ï¼Œ&lt;code&gt;ObservableSubscribeOn&lt;/code&gt; åœ¨æ‰§è¡Œ &lt;code&gt;subscribeActual&lt;/code&gt; æ—¶ï¼Œå›è°ƒäº†ä¸‹å±‚äº§ç”Ÿçš„ &lt;code&gt;Observer&lt;/code&gt; çš„ &lt;code&gt;onSubscribe&lt;/code&gt;ï¼Œå¦‚å›¾ä¸­çš„â‘£â‘¤â‘¥æµç¨‹ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨è§‚å¯Ÿè€…ä¸€è®¢é˜…åå°±ä¼šæ”¶åˆ° &lt;code&gt;onSubscribe&lt;/code&gt; çš„å›è°ƒï¼Œä¸”åœ¨å½“å‰è®¢é˜…æ—¶çš„çº¿ç¨‹ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-2-æ­£å‘æ•°æ®æµè§¦å‘-observerOn-çš„çº¿ç¨‹åˆ‡æ¢&quot;&gt;&lt;a href=&quot;#2-2-æ­£å‘æ•°æ®æµè§¦å‘-observerOn-çš„çº¿ç¨‹åˆ‡æ¢&quot; class=&quot;headerlink&quot; title=&quot;2.2 æ­£å‘æ•°æ®æµè§¦å‘ observerOn çš„çº¿ç¨‹åˆ‡æ¢&quot;&gt;&lt;/a&gt;2.2 æ­£å‘æ•°æ®æµè§¦å‘ observerOn çš„çº¿ç¨‹åˆ‡æ¢&lt;/h4&gt;&lt;p&gt;åŒç¬¬ä¸€éƒ¨åˆ†ä¸€æ ·çš„ï¼Œè®¢é˜…åˆ°æœ€ä¸Šå±‚æ—¶ï¼Œè§¦å‘æ•°æ®æºäº§ç”ŸåŸå§‹æ•°æ®ï¼Œä»è€Œåˆæ­£å‘çš„æµè½¬æ•°æ®ï¼Œæ­¤è¿‡ç¨‹æˆ‘ä»¬ä¸åœ¨è¯¦ç»†åˆ†æï¼Œå‚ç…§1.3ï¼Œæˆ‘ä»¬ç€é‡çœ‹ä¸€ä¸‹ &lt;code&gt;ObserveOnObserver&lt;/code&gt; çš„ onNext å¤„ç†çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­æ­¥éª¤â‘¬â‘­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObservableObserveOn&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AbstractObservableWithUpstream&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Scheduler scheduler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;subscribeActual&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; observer)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (scheduler &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; TrampolineScheduler) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            source.subscribe(observer);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Scheduler.Worker w = scheduler.createWorker();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            source.subscribe(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ObserveOnObserver&amp;lt;T&amp;gt;(observer, w, delayError, bufferSize));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ObserveOnObserver&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BasicIntQueueDisposable&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Observer&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt;, &lt;span class=&quot;title&quot;&gt;Runnable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Observer&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; actual;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Scheduler.Worker worker;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(T t)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (done) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sourceMode != QueueDisposable.ASYNC) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                queue.offer(t);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedule(); &lt;span class=&quot;comment&quot;&gt;//ç±»ä¼¼ ObservableSubscribeOn.subscribeActual() å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (getAndIncrement() == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                worker.schedule(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (outputFused) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                drainFused();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                drainNormal();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¤ºä¾‹ä¸­æˆ‘ä»¬æ­¤æ—¶åˆ‡æ¢åˆ°äº† &lt;code&gt;Main&lt;/code&gt; çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹å¯¹åº”çš„ &lt;code&gt;HandlerScheduler&lt;/code&gt; å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HandlerScheduler&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Scheduler&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Handler handler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; async;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Disposable &lt;span class=&quot;title&quot;&gt;scheduleDirect&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Runnable run, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delay, TimeUnit unit)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (run == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NullPointerException(&lt;span class=&quot;string&quot;&gt;&quot;run == null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (unit == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NullPointerException(&lt;span class=&quot;string&quot;&gt;&quot;unit == null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        run = RxJavaPlugins.onSchedule(run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ScheduledRunnable scheduled = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ScheduledRunnable(handler, run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        handler.postDelayed(scheduled, unit.toMillis(delay));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; scheduled;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Worker &lt;span class=&quot;title&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HandlerWorker(handler, async);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HandlerWorker&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Worker&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@SuppressLint&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;NewApi&quot;&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// Async will only be true when the API is available to call.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Disposable &lt;span class=&quot;title&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Runnable run, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delay, TimeUnit unit)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            run = RxJavaPlugins.onSchedule(run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ScheduledRunnable scheduled = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ScheduledRunnable(handler, run);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Message message = Message.obtain(handler, scheduled);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            message.obj = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// Used as token for batch disposal of this worker&#39;s runnables.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (async) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                message.setAsynchronous(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            handler.sendMessageDelayed(message, unit.toMillis(delay));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; scheduled;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å°† &lt;code&gt;Runnable&lt;/code&gt; é€šè¿‡ Handler å‘åˆ°äº†ä½çº¿ç¨‹å»æ‰§è¡Œï¼Œæ‰€ä»¥ç»è¿‡æ­¤æ­¥éª¤åï¼Œåç»­çš„ onNext çš„å¤„ç†å·²ç»åˆ‡æ¢ä¸ºä¸»çº¿ç¨‹ã€‚åŒæ ·çš„ï¼Œè¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸Šé¢æˆ‘ä»¬æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆ observerOn() å¯¹ä¸‹é¢ä»£ç ç”Ÿæ•ˆï¼Ÿæ­£æ˜¯å› ä¸ºï¼Œæ•°æ®çš„æµå‘å†³å®šäº† observerOn() å¯¹åç»­çš„ onNext äº§ç”Ÿå½±å“ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h4&gt;&lt;p&gt;è‡³æ­¤ RxJava è¿è½¬æœºåˆ¶æˆ‘ä»¬å·²ç»åˆ†æå®Œæ¯•ï¼Œå¤§å®¶å¯ä»¥æ¯”ç…§å›¾ä¸­æµç¨‹ï¼Œè·Ÿè¸ªä»£ç æµè½¬ï¼Œç›¸ä¿¡ä¼šæœ‰å¾ˆå¤§æ”¶è·ã€‚ RxJava æœ¬èº«æ˜¯ä¸€ä¸ªå˜ç§çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ­£æ˜¯å› ä¸ºæ¡†æ¶æœ¬èº«è¦å®ç°&lt;code&gt;å¼‚æ­¥äº‹ä»¶æµç¼–ç¨‹&lt;/code&gt;ï¼Œæ‰€ä»¥äº§ç”Ÿäº†é€†å‘è®¢é˜…çš„è¿‡ç¨‹ï¼ŒåŒæ—¶æ•°æ®åˆæ˜¯æ­£å‘æµè½¬çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¤§å®¶è¿˜éœ€è¦ç†è§£ä¸¤ä¸ªåŒ…è£¹å°è£…ï¼ˆè¢«è§‚å¯Ÿè€…ã€è§‚å¯Ÿè€…ï¼‰çš„è¿‡ç¨‹ï¼Œä¸ç®¡æ“ä½œç¬¦æ€ä¹ˆå˜æ¢ï¼Œéƒ½ä¸ä¼šè„±ç¦»è¿™æ ·çš„è¿ä½œæ ¸å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æ ¹æ®ä¸åŒçš„æ“ä½œç¬¦çš„å®ç°ï¼Œæˆ‘ä»¬ä¾ç…§åŒæ ·çš„æ¨¡å¼ï¼Œå¯å®ç°è‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œåªè¦èƒ½åœ¨è®¢é˜…æ—¶å’Œæ•°æ®å›æµæ—¶åšå¥½ä¸Šä¸‹å±‚çš„è¡”æ¥å°±å¥½ï¼Œè¿™ä¸ªå¤§å®¶å¯ä»¥è‡ªå·±å®è·µã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç›¸ä¿¡ &lt;code&gt;RxJava&lt;/code&gt; æ˜¯å¤§å®¶ä¸šåŠ¡ä¸­ç”¨åˆ°æ¯”è¾ƒå¤šçš„ä¸€ä¸ªä¾èµ–åº“ï¼Œå¯¹äº RxJava ç§ç±»ç¹å¤šçš„æ“ä½œç¬¦ï¼Œå¤§å¤šæ•°åŒå­¦éƒ½è¡¨ç¤ºå¾ˆæ˜¯å¤´ç–¼ï¼Œä¹Ÿæœ‰ä¸å°‘åŒå­¦é™·å…¥äº†å­¦ä¹ æ“ä½œç¬¦ä¸èƒ½åœçš„æ€ªåœˆã€‚æ–‡ç« ä¼¼ä¹æœ‰äº›æ ‡é¢˜å…šçš„å«Œç–‘ï¼Œæ ¹æ®æˆ‘çš„ç†è§£ç”»å‡ºä¸¤å¹…å›¾ç›¸ä¿¡å¯ä»¥è®©å¤§å®¶ç†è§£å…¶æ ¸å¿ƒåŸç†ï¼Œç¨åä¸è¦åå•¬ï¼Œè¯·å«æˆ‘çµé­‚ç”»æ‰‹ğŸ˜„ï¼&lt;/p&gt;
&lt;p&gt;æ“ä½œç¬¦è¦ä¸è¦å­¦ï¼Œå½“ç„¶è¦ï¼Œä½†æ˜¯å¦‚æœèƒ½ç†è§£ RxJava çš„æ ¸å¿ƒï¼Œæ“ä½œç¬¦çš„ä½¿ç”¨å°±åƒæ˜¯å­¦ä¼šä¹é˜³ç¥åŠŸçš„å¼ æ— å¿Œå­¦æ‹›æ•°ï¼Œå¿…å®šæ˜¯æ‰‹åˆ°æ“’æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè®²äº›ä»€ä¹ˆ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;RxJava2 åŸºæœ¬çš„è¿è¡Œæµç¨‹&lt;/li&gt;
&lt;li&gt;RxJava2 çº¿ç¨‹åˆ‡æ¢çš„åŸç†ï¼ˆæ¶‰åŠåˆ°ä¸ºä»€ä¹ˆ subscribeOn() åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼‰&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä¸€è®¢é˜…å°±å›è°ƒäº† onSubscribe&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ subscribeOn() å¯¹ä¸Šé¢çš„ä»£ç ç”Ÿæ•ˆï¼ŒobserverOn() å¯¹ä¸‹é¢ä»£ç ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹å†…å®¹å¦‚æœæ¶‰åŠåˆ°è‡ªå·±å†™çš„ä»£ç æˆ‘ä¼šé‡‡ç”¨ Kotlin è¿›è¡Œç¤ºä¾‹å±•ç¤ºï¼Œæ¶‰åŠåˆ° RxJava2 ä¼šå±•ç¤ºéƒ¨åˆ†æºç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;a href=&quot;#1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&quot;&gt;&lt;/a&gt;1ã€ç®€å•çš„é“¾å¼è°ƒç”¨ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢ï¼‰&lt;/h2&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Gradle Plugin å‡çº§è¿ç§»åŠæ„å»ºä¼˜åŒ–</title>
    <link href="http://solart.cc/2018/07/07/gradle-migrate-3.0.0+/"/>
    <id>http://solart.cc/2018/07/07/gradle-migrate-3.0.0+/</id>
    <published>2018-07-07T09:26:50.000Z</published>
    <updated>2018-07-07T05:33:45.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ç›´ä»¥æ¥ï¼ŒAndroid é¡¹ç›®åœ¨æ„å»ºé€Ÿåº¦æ˜¯ä¸€å¤§æ§½ç‚¹ï¼Œéšç€Android Studio 3.0 çš„å¤§ç‰ˆæœ¬çš„å‡çº§ä½¿å¾—å¤šModuleå·¥ç¨‹çš„æ„å»ºé€Ÿåº¦åŠ å¿«å¾ˆå¤šã€‚è¿™ä¸»è¦ä¾èµ–äº Android Plugin for Gradle æ’ä»¶ç‰ˆæœ¬çš„å‡çº§ï¼Œå› æ­¤éƒ¨åˆ† API å‘ç”Ÿäº†è¾ƒå¤§å˜åŒ–ã€‚æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä»¥åŠèŠä¸€äº›å¸¸ç”¨çš„ä¼˜åŒ–æ„å»ºé€Ÿåº¦çš„å»ºè®®ï¼Œä»¥ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;android studio 3.1.3; gradle-4.4; gradle plugin 3.1.3 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€Android-SDK-æ„å»ºç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#1ã€Android-SDK-æ„å»ºç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1ã€Android SDK æ„å»ºç³»ç»Ÿ&quot;&gt;&lt;/a&gt;1ã€Android SDK æ„å»ºç³»ç»Ÿ&lt;/h2&gt;&lt;p&gt;åœ¨æ­£å¼è®²è¿°å‡çº§è¿ç§»ä¹‹å‰ï¼Œå¤§å®¶åº”è¯¥ç†Ÿæ‚‰ä¸€ä¸‹ Android SDK çš„æ„å»ºç³»ç»Ÿï¼ŒAndroid æ„å»ºç³»ç»Ÿç¼–è¯‘åº”ç”¨èµ„æºå’Œæºä»£ç ï¼Œç„¶åå°†å®ƒä»¬æ‰“åŒ…æˆå¯ä¾›å¼€å‘äººå‘˜æµ‹è¯•ã€éƒ¨ç½²ã€ç­¾ç½²å’Œåˆ†å‘çš„ APKã€‚Android Studio ä½¿ç”¨ &lt;a href=&quot;http://www.gradle.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Gradle&lt;/a&gt; è¿™ä¸€é«˜çº§æ„å»ºå·¥å…·åŒ…æ¥è‡ªåŠ¨åŒ–æ‰§è¡Œå’Œç®¡ç†æ„å»ºæµç¨‹ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å¼€å‘äººå‘˜å®šä¹‰çµæ´»çš„è‡ªå®šä¹‰æ„å»ºé…ç½®ã€‚æ¯ä¸ªæ„å»ºé…ç½®å‡å¯è‡ªè¡Œå®šä¹‰ä¸€ç»„ä»£ç å’Œèµ„æºï¼ŒåŒæ—¶å¯¹æ‰€æœ‰åº”ç”¨ç‰ˆæœ¬å…±æœ‰çš„éƒ¨åˆ†åŠ ä»¥é‡å¤åˆ©ç”¨ã€‚Android Plugin for Gradle ä¸è¿™ä¸ªæ„å»ºå·¥å…·åŒ…åä½œï¼Œå…±åŒæä¾›ä¸“ç”¨äºæ„å»ºå’Œæµ‹è¯• Android åº”ç”¨çš„æµç¨‹å’Œå¯é…ç½®è®¾ç½®ã€‚ &lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;1-1-æ„å»ºæµç¨‹&quot;&gt;&lt;a href=&quot;#1-1-æ„å»ºæµç¨‹&quot; class=&quot;headerlink&quot; title=&quot;1.1 æ„å»ºæµç¨‹&quot;&gt;&lt;/a&gt;1.1 æ„å»ºæµç¨‹&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/build_process_2x.png&quot; alt=&quot;rn_js_element_comp_render_seq&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¸å‹ Android åº”ç”¨æ¨¡å—çš„æ„å»ºæµç¨‹é€šå¸¸ä¾å¾ªä¸‹åˆ—æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç¼–è¯‘å™¨å°†æˆ‘ä»¬çš„æºä»£ç è½¬æ¢æˆ DEXï¼ˆDalvik Executable) æ–‡ä»¶ï¼ˆå…¶ä¸­åŒ…æ‹¬è¿è¡Œåœ¨ Android è®¾å¤‡ä¸Šçš„å­—èŠ‚ç ï¼‰ï¼Œå°†æ‰€æœ‰å…¶ä»–å†…å®¹è½¬æ¢æˆå·²ç¼–è¯‘èµ„æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;APK æ‰“åŒ…å™¨å°† DEX æ–‡ä»¶å’Œå·²ç¼–è¯‘èµ„æºåˆå¹¶æˆå•ä¸ª APKã€‚ä¸è¿‡ï¼Œå¿…é¡»å…ˆç­¾ç½² APKï¼Œæ‰èƒ½å°†åº”ç”¨å®‰è£…å¹¶éƒ¨ç½²åˆ° Android è®¾å¤‡ä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;APK æ‰“åŒ…å™¨ä½¿ç”¨è°ƒè¯•æˆ–å‘å¸ƒå¯†é’¥åº“ç­¾ç½²æˆ‘ä»¬çš„ APKï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬æ„å»ºçš„æ˜¯è°ƒè¯•ç‰ˆæœ¬çš„åº”ç”¨ï¼ˆå³ä¸“ç”¨äºæµ‹è¯•å’Œåˆ†æçš„åº”ç”¨ï¼‰ï¼Œæ‰“åŒ…å™¨ä¼šä½¿ç”¨è°ƒè¯•å¯†é’¥åº“ç­¾ç½²æˆ‘ä»¬çš„åº”ç”¨ã€‚Android Studio è‡ªåŠ¨ä½¿ç”¨è°ƒè¯•å¯†é’¥åº“é…ç½®æ–°é¡¹ç›®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬æ„å»ºçš„æ˜¯æ‰“ç®—å‘å¤–å‘å¸ƒçš„å‘å¸ƒç‰ˆæœ¬åº”ç”¨ï¼Œæ‰“åŒ…å™¨ä¼šä½¿ç”¨å‘å¸ƒå¯†é’¥åº“ç­¾ç½²æˆ‘ä»¬çš„åº”ç”¨ã€‚è¦åˆ›å»ºå‘å¸ƒå¯†é’¥åº“ï¼Œè¯·é˜…è¯»&lt;a href=&quot;https://developer.android.com/studio/publish/app-signing.html#studio&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åœ¨ Android Studio ä¸­ç­¾ç½²æˆ‘ä»¬çš„åº”ç”¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;åœ¨ç”Ÿæˆæœ€ç»ˆ APK ä¹‹å‰ï¼Œæ‰“åŒ…å™¨ä¼šä½¿ç”¨ &lt;a href=&quot;https://developer.android.com/studio/command-line/zipalign.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;zipalign&lt;/a&gt; å·¥å…·å¯¹åº”ç”¨è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘å…¶åœ¨è®¾å¤‡ä¸Šè¿è¡Œæ—¶çš„å†…å­˜å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºæµç¨‹ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¯ç”¨æ¥è¿›è¡Œéƒ¨ç½²ã€æµ‹è¯•çš„è°ƒè¯• APKï¼Œæˆ–è€…å¯ç”¨æ¥å‘å¸ƒç»™å¤–éƒ¨ç”¨æˆ·çš„å‘å¸ƒ APKã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;1-2-åˆ†ææ„å»ºè€—æ—¶&quot;&gt;&lt;a href=&quot;#1-2-åˆ†ææ„å»ºè€—æ—¶&quot; class=&quot;headerlink&quot; title=&quot;1.2 åˆ†ææ„å»ºè€—æ—¶&quot;&gt;&lt;/a&gt;1.2 åˆ†ææ„å»ºè€—æ—¶&lt;/h4&gt;&lt;p&gt;åœ¨æ„å»ºé¡¹ç›®æ—¶ï¼Œåˆ†ææ„å»ºæµç¨‹çš„è€—æ—¶æœ‰åŠ©äºæˆ‘ä»¬å®šå‘çš„ä¼˜åŒ–æ„å»ºè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æŸ¥çœ‹æ„å»ºè€—æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¸…ç©ºæ„å»ºï¼Œç›¸å½“äºåˆå§‹åŒ–ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿èƒ½åˆ†æåˆ°å®Œæ•´çš„é¡¹ç›®æ„å»ºè¿‡ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew clean&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ‰§è¡Œæ„å»ºï¼Œå¹¶ä¸”ç”Ÿæˆæ„å»ºè¿‡ç¨‹è€—æ—¶æŠ¥å‘Š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew --profile --recompile-scripts --offline --rerun-tasks assembleDebug&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--profile&lt;/code&gt;ï¼šå¯ç”¨åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--recompile-scripts&lt;/code&gt;ï¼šåœ¨ç»•è¿‡ç¼“å­˜æ—¶å¼ºåˆ¶é‡æ–°ç¼–è¯‘è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--offline&lt;/code&gt;ï¼šç¦æ­¢ Gradle æå–åœ¨çº¿ä¾èµ–é¡¹ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ Gradle åœ¨å°è¯•æ›´æ–°ä¾èµ–é¡¹æ—¶å¼•èµ·çš„ä»»ä½•å»¶è¿Ÿéƒ½ä¸ä¼šå¹²æ‰°æˆ‘ä»¬çš„åˆ†ææ•°æ®ã€‚æˆ‘ä»¬åº”å½“å·²å°†é¡¹ç›®æ„å»ºä¸€æ¬¡ï¼Œä»¥ä¾¿ç¡®ä¿ Gradle å·²ç»ä¸‹è½½å’Œç¼“å­˜æˆ‘ä»¬çš„ä¾èµ–é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--rerun-tasks&lt;/code&gt;ï¼šå¼ºåˆ¶ Gradle é‡æ–°è¿è¡Œæ‰€æœ‰ä»»åŠ¡å¹¶å¿½ç•¥ä»»ä½•ä»»åŠ¡ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‰§è¡Œå®Œæˆååœ¨é¡¹ç›® &lt;code&gt;/build/reports/profile/&lt;/code&gt; ç›®å½•ä¸‹æŸ¥çœ‹åˆ†ææŠ¥å‘Šï¼ŒæŠ¥å‘Šæ˜¯ç½‘é¡µå½¢å¼ï¼Œæ¨èä½¿ç”¨chromeæµè§ˆå™¨æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/build_report.png&quot; alt=&quot;build_report&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;2ã€è¿ç§»åˆ°Android-Plugin-for-Gradle-3-0-0&quot;&gt;&lt;a href=&quot;#2ã€è¿ç§»åˆ°Android-Plugin-for-Gradle-3-0-0&quot; class=&quot;headerlink&quot; title=&quot;2ã€è¿ç§»åˆ°Android Plugin for Gradle 3.0.0+&quot;&gt;&lt;/a&gt;2ã€è¿ç§»åˆ°Android Plugin for Gradle 3.0.0+&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨ 2.x ç‰ˆæœ¬çš„ Android Plugin for Gradle å‡çº§æ˜¯å¿…é¡»è¦ç»å† çš„é˜µç—›ï¼Œç›¸æ¯”å‡çº§åçš„æ„å»ºæ•ˆç‡è¿™ç‚¹ä»£ä»·è¿˜æ˜¯éå¸¸å€¼å¾—çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-æ›´æ–°-Gradle-ç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#2-1-æ›´æ–°-Gradle-ç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;2.1 æ›´æ–° Gradle ç‰ˆæœ¬&quot;&gt;&lt;/a&gt;2.1 æ›´æ–° Gradle ç‰ˆæœ¬&lt;/h4&gt;&lt;p&gt;æ–° Android æ’ä»¶è¦æ±‚ Gradle ç‰ˆæœ¬ &lt;code&gt;4.1-rc-1&lt;/code&gt; æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œ å¦‚æœæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Android Studio 3.0 Beta 1 æˆ–æ›´é«˜ç‰ˆæœ¬æ‰“å¼€ç°æœ‰é¡¹ç›®ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œï¼Œå°†ç°æœ‰é¡¹ç›®è‡ªåŠ¨æ›´æ–°åˆ°å…¼å®¹ç‰ˆæœ¬çš„ Gradleã€‚&lt;/p&gt;
&lt;p&gt;è¦æ‰‹åŠ¨æ›´æ–° Gradleï¼Œè¯·æ›´æ–° &lt;code&gt;gradle-wrapper.properties&lt;/code&gt; ä¸­çš„ç½‘å€ï¼Œæœ¬æ–‡ä»¥ 4.4 çš„ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;distributionUrl=https\://services.gradle.org/distributions/gradle-4.4-all.zip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-2-åº”ç”¨æ’ä»¶&quot;&gt;&lt;a href=&quot;#2-2-åº”ç”¨æ’ä»¶&quot; class=&quot;headerlink&quot; title=&quot;2.2 åº”ç”¨æ’ä»¶&quot;&gt;&lt;/a&gt;2.2 åº”ç”¨æ’ä»¶&lt;/h4&gt;&lt;p&gt;è¦æ‰‹åŠ¨æ›´æ–°çš„é¡¹ç›®ï¼Œè¯·åŒ…å« Maven å­˜å‚¨åŒºå¹¶åœ¨é¡¹ç›®çº§ &lt;code&gt;build.gradle&lt;/code&gt; æ–‡ä»¶ä¸­æ›´æ”¹æ’ä»¶ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;buildscript &amp;#123;&amp;#10;    repositories &amp;#123;&amp;#10;        ...&amp;#10;        // You need to add the following repository to download the&amp;#10;        // new plugin.&amp;#10;        google()&amp;#10;    &amp;#125;&amp;#10;&amp;#10;    dependencies &amp;#123;&amp;#10;        classpath &amp;#39;com.android.tools.build:gradle:3.1.3&amp;#39;&amp;#10;        ...&amp;#10;    &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-3-ä½¿ç”¨-FlavorDimensions-è¿›è¡Œå˜ä½“æ„ŸçŸ¥ä¾èµ–é¡¹ç®¡ç†&quot;&gt;&lt;a href=&quot;#2-3-ä½¿ç”¨-FlavorDimensions-è¿›è¡Œå˜ä½“æ„ŸçŸ¥ä¾èµ–é¡¹ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;2.3 ä½¿ç”¨ FlavorDimensions è¿›è¡Œå˜ä½“æ„ŸçŸ¥ä¾èµ–é¡¹ç®¡ç†&quot;&gt;&lt;/a&gt;2.3 ä½¿ç”¨ FlavorDimensions è¿›è¡Œå˜ä½“æ„ŸçŸ¥ä¾èµ–é¡¹ç®¡ç†&lt;/h4&gt;&lt;p&gt;æ’ä»¶ 3.0.0+ åŒ…å«ä¸€é¡¹æ–°çš„ä¾èµ–æœºåˆ¶ï¼Œè¿™é¡¹æ–°çš„ä¾èµ–æœºåˆ¶å®˜æ–¹ä¸­æ–‡ç‰ˆç¿»è¯‘ä¸ºï¼šå˜ä½“æ„ŸçŸ¥ä¾èµ–é¡¹ç®¡ç†ï¼Œå¯¹åº”åŸæ–‡ä¸­  &lt;code&gt;variant-aware dependency resolution&lt;/code&gt; è¿™ä¸ªæ¦‚å¿µï¼Œå®˜æ–¹å¯¹ &lt;code&gt;FlavorDimensions&lt;/code&gt; çš„ç¿»è¯‘ä¸º&lt;code&gt;é£å‘³ç»´åº¦&lt;/code&gt;ï¼Œä¸ªäººæ„Ÿè§‰æ˜¯èœœæ±å¾®ç¬‘ï¼Œå¯èƒ½ç¿»è¯‘ä¸º&lt;code&gt;ç‰¹å¾ç»´åº¦&lt;/code&gt;æ›´å¥½ç†è§£ä¸€äº›ï¼Œé£å‘³æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä½“ä¼šä¸€ä¸‹è‹±æ–‡åŸæ–‡å¯èƒ½ä¼šæ›´å‡†ç¡®çš„ç†è§£è¿™ä¸ªæ‹—å£çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Android plugin 3.0.0 and higher use &lt;code&gt;variant-aware dependency resolution&lt;/code&gt; to automatically match the variant of the producer to that of the consumer. That is, when publishing a module to another local module, the plugin no longer respects this property when determining which version Of the module to publish to the consumer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŠ›å¼€è¿™äº›æ¦‚å¿µä¸è¯´ï¼Œå‡çº§åæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;All flavors must now belong to a named flavor dimension. Learn more at &lt;a href=&quot;https://d.android.com/r/tools/flavorDimensions-missing-error-message.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://d.android.com/r/tools/flavorDimensions-missing-error-message.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€æœ‰çš„ç‰¹ç‚¹ç°åœ¨å¿…é¡»å±äºä¸€ä¸ªå·²å‘½åçš„ç‰¹å¾ç»´åº¦ã€‚å®˜ç½‘æä¾›çš„è§£å†³æ–¹å¼æ˜¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// Specifies a flavor dimension.&amp;#10;flavorDimensions &amp;#34;color&amp;#34;&amp;#10;&amp;#10;productFlavors &amp;#123;&amp;#10;     red &amp;#123;&amp;#10;      // Assigns this product flavor to the &amp;#39;color&amp;#39; flavor dimension.&amp;#10;      // This step is optional if you are using only one dimension.&amp;#10;      dimension &amp;#34;color&amp;#34;&amp;#10;      ...&amp;#10;    &amp;#125;&amp;#10;&amp;#10;    blue &amp;#123;&amp;#10;      dimension &amp;#34;color&amp;#34;&amp;#10;      ...&amp;#10;    &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨defaultConfigé‡Œé¢åŠ å…¥flavorDimensionsï¼Œå®šä¹‰ç‰¹å¾ç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯å‘½åç‰¹å¾ç»´åº¦ï¼‰ã€‚ ç„¶ååœ¨äº§å“é£å‘³ä¸­æŒ‡å®šæ‰€å±çš„ç‰¹å¾ç»´åº¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¦å¤šè¯´ä¸€ç‚¹çš„æ˜¯å®šä¹‰ä¸€ä¸ªç‰¹å¾ç»´åº¦æ˜¯å‘æŒ¥ä¸å‡ºåŠŸåŠ›çš„ï¼Œå¦‚æœå®šä¹‰ä¸¤ä¸ªä»¥ä¸Šçš„ç‰¹å¾ç»´åº¦ï¼Œè¿™ä¸ªæ¦‚å¿µå¾ˆç„å¦™çš„åŠŸåŠ›æ‰èƒ½ä½“ç°å¾—å‡ºæ¥ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-4-ä½¿ç”¨æ–°ä¾èµ–é¡¹é…ç½®&quot;&gt;&lt;a href=&quot;#2-4-ä½¿ç”¨æ–°ä¾èµ–é¡¹é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;2.4 ä½¿ç”¨æ–°ä¾èµ–é¡¹é…ç½®&quot;&gt;&lt;/a&gt;2.4 ä½¿ç”¨æ–°ä¾èµ–é¡¹é…ç½®&lt;/h4&gt;&lt;p&gt;Android æ’ä»¶ 3.0.0 æ­£åœ¨è¿ç§»åˆ°è¿™äº›æ–°ä¾èµ–é¡¹é…ç½®ã€‚ è¦è¿ç§»æˆ‘ä»¬çš„é¡¹ç›®ï¼Œåªéœ€æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–é¡¹ä»¥ä½¿ç”¨æ–°é…ç½®ï¼Œè€Œéå·²å¼ƒç”¨é…ç½®ï¼Œå¦‚ä¸‹è¡¨ä¸­æ‰€åˆ—ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–°é…ç½®&lt;/th&gt;
&lt;th&gt;å·²å¼ƒç”¨é…ç½®&lt;/th&gt;
&lt;th&gt;è¡Œä¸º&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;implementation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;compile&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é¡¹åœ¨ç¼–è¯‘æ—¶å¯¹æ¨¡å—å¯ç”¨ï¼Œå¹¶ä¸”ä»…åœ¨è¿è¡Œæ—¶å¯¹æ¨¡å—çš„æ¶ˆè´¹è€…å¯ç”¨ã€‚ å¯¹äºå¤§å‹å¤šé¡¹ç›®æ„å»ºï¼Œä½¿ç”¨ &lt;code&gt;implementation&lt;/code&gt; è€Œä¸æ˜¯ &lt;code&gt;api&lt;/code&gt;/&lt;code&gt;compile&lt;/code&gt; å¯ä»¥&lt;strong&gt;æ˜¾è‘—ç¼©çŸ­æ„å»ºæ—¶é—´&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘æ„å»ºç³»ç»Ÿéœ€è¦é‡æ–°ç¼–è¯‘çš„é¡¹ç›®é‡ã€‚ å¤§å¤šæ•°åº”ç”¨å’Œæµ‹è¯•æ¨¡å—éƒ½åº”ä½¿ç”¨æ­¤é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;api&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;compile&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é¡¹åœ¨ç¼–è¯‘æ—¶å¯¹æ¨¡å—å¯ç”¨ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶è¿˜å¯¹æ¨¡å—çš„æ¶ˆè´¹è€…å¯ç”¨ã€‚ æ­¤é…ç½®çš„è¡Œä¸ºç±»ä¼¼äº &lt;code&gt;compile&lt;/code&gt;ï¼ˆç°åœ¨å·²å¼ƒç”¨ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“ä»…åœ¨åº“æ¨¡å—ä¸­ä½¿ç”¨å®ƒã€‚ åº”ç”¨æ¨¡å—åº”ä½¿ç”¨ &lt;code&gt;implementation&lt;/code&gt;ï¼Œé™¤éæˆ‘ä»¬æƒ³è¦å°†å…¶ API å…¬å¼€ç»™å•ç‹¬çš„æµ‹è¯•æ¨¡å—ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;compileOnly&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;provided&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é¡¹ä»…åœ¨ç¼–è¯‘æ—¶å¯¹æ¨¡å—å¯ç”¨ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æˆ–è¿è¡Œæ—¶å¯¹å…¶æ¶ˆè´¹è€…ä¸å¯ç”¨ã€‚ æ­¤é…ç½®çš„è¡Œä¸ºç±»ä¼¼äº &lt;code&gt;provided&lt;/code&gt;ï¼ˆç°åœ¨å·²å¼ƒç”¨ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;runtimeOnly&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;apk&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é¡¹ä»…åœ¨è¿è¡Œæ—¶å¯¹æ¨¡å—åŠå…¶æ¶ˆè´¹è€…å¯ç”¨ã€‚ æ­¤é…ç½®çš„è¡Œä¸ºç±»ä¼¼äº &lt;code&gt;apk&lt;/code&gt;ï¼ˆç°åœ¨å·²å¼ƒç”¨ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å°±åƒå½“å‰ç¨³å®šç‰ˆæœ¬çš„ Android æ’ä»¶ä¸€æ ·ï¼Œä¸Šé¢çš„é…ç½®å¯¹é£å‘³æˆ–æ„å»ºç±»å‹ç‰¹å®šçš„ä¾èµ–é¡¹å¯ç”¨ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;api&lt;/code&gt; è®©ä¾èµ–é¡¹å¯¹æ‰€æœ‰å˜ä½“å¯ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;redApi&lt;/code&gt; è®©å…¶ä»…å¯¹æ¨¡å—çš„ &lt;code&gt;red&lt;/code&gt; å˜ä½“å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Gradle Plugin 2.x ç‰ˆæœ¬çš„æ—¶æœŸï¼Œä¸€ç‚¹ä»£ç çš„æ”¹åŠ¨å¯èƒ½ä¼šå¼•èµ·æ•´ä¸ªå·¥ç¨‹çš„é‡æ–°ç¼–è¯‘ï¼Œè¿™å°†æ˜¯å¤šä¹ˆæ‚²å‚¬ï¼Œæ ¹æœ¬åŸå› å°±æ˜¯ gradle å‹æ ¹ä¸çŸ¥é“æš´éœ²çš„æ¥å£å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„ä¾èµ–ä¼ é€’å½±å“æ•´ä¸ªå·¥ç¨‹ã€‚ä¹‹å‰ä½¿ç”¨å¤§å®¶éƒ½æ˜¯é€šè¿‡ &lt;code&gt;compile&lt;/code&gt; æ¥ç®¡ç†ä¾èµ–é¡¹ï¼Œå‡çº§å build.gradle éœ€è¦å°†åºŸå¼ƒçš„ compile çš„æ›¿æ¢ä¸º &lt;code&gt;implementation&lt;/code&gt; æˆ– &lt;code&gt;api&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Android Gradle plugin 3.0 ä¾èµ–é¡¹ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;br&gt;æœ€æ–°ç‰ˆçš„Gradle pluginéœ€è¦æˆ‘ä»¬æŒ‡å‡ºä¸€ä¸ªmoduleçš„æ¥å£æ˜¯å¦å¯¹å¤–æš´éœ²å…¶ä¾èµ–libçš„æ¥å£ã€‚åŸºäºæ­¤ï¼Œå¯ä»¥è®©é¡¹ç›®æ„å»ºæ—¶ï¼Œgradleå¯ä»¥åˆ¤æ–­å“ªä¸ªéœ€è¦é‡æ–°ç¼–è¯‘ã€‚å› æ­¤ï¼Œè€ç‰ˆæœ¬çš„æ„å»ºå…³é”®å­—compileè¢«åºŸå¼ƒäº†ï¼Œè€Œæ˜¯æ”¹æˆäº†è¿™ä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;apiï¼šåŒcompileä½œç”¨ä¸€æ ·ï¼Œå³è®¤ä¸ºæœ¬moduleå°†ä¼šæ³„éœ²å…¶ä¾èµ–çš„moduleçš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;implementationï¼šæœ¬moduleä¸ä¼šé€šè¿‡è‡ªèº«çš„æ¥å£å‘å¤–éƒ¨æš´éœ²å…¶ä¾èµ–moduleçš„å†…å®¹ã€‚&lt;br&gt;ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®çš„å‘Šè¯‰gradleå»é‡æ–°ç¼–è¯‘ä¸€ä¸ªmoduleï¼Œè‹¥æ˜¯è¿™ä¸ªä½¿ç”¨çš„moduleçš„æ¥å£å‘ç”Ÿå˜åŒ–çš„è¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&amp;#10;    // &amp;#24403; foo &amp;#25509;&amp;#21475;&amp;#21457;&amp;#29983;&amp;#21464;&amp;#21270;&amp;#26102;&amp;#65292;&amp;#38656;&amp;#35201;&amp;#37325;&amp;#26032;&amp;#32534;&amp;#35793;&amp;#26412; module &amp;#20197;&amp;#21450;&amp;#25152;&amp;#26377;&amp;#20351;&amp;#29992;&amp;#26412; module &amp;#30340; module&amp;#10;    api project(&amp;#39;:foo&amp;#39;)&amp;#10;    // &amp;#20165;&amp;#24403; camera &amp;#21457;&amp;#29983;&amp;#21464;&amp;#21270;&amp;#26102;&amp;#65292;&amp;#37325;&amp;#26032;&amp;#32534;&amp;#35793;&amp;#26412;module&amp;#10;    implementation project(&amp;#39;:camera&amp;#39;)&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;è¿ç§»æŒ‡å—&lt;/strong&gt;&lt;br&gt;ç†è®ºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸæ¥å·¥ç¨‹ä¸­çš„compileå®Œå…¨æ›¿æ¢ä¸ºç°åœ¨çš„apiï¼Œä½†æ˜¯ä¸€æ—¦ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œå°†ä¼šä½¿æ‰€æœ‰çš„moduleé‡æ–°ç¼–è¯‘ï¼Œé€ æˆç¼–è¯‘è¿‡é•¿ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ›´å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨implementationæ¥è¿›è¡Œä¾èµ–ï¼Œè¿™ä¼šå¤§å¤§æ”¹å–„å·¥ç¨‹çš„æ„å»ºæ—¶é—´ã€‚åªæœ‰æˆ‘ä»¬æ˜ç¡®è¦å‘å¤–éƒ¨æš´éœ²æ‰€ä¾èµ–libçš„æ¥å£æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨apiä¾èµ–ï¼Œæ•´ä½“æ¥è¯´ï¼Œä¼šå‡å°‘å¾ˆå¤šé‡æ–°ç¼–è¯‘ã€‚è¿™ä¸€ç‚¹ï¼Œåœ¨å®˜æ–¹æŒ‡å—ä¸­è¯´çš„æ¯”è¾ƒæ˜ç¡®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3ã€ä¼˜åŒ–æ„å»ºé€Ÿåº¦&quot;&gt;&lt;a href=&quot;#3ã€ä¼˜åŒ–æ„å»ºé€Ÿåº¦&quot; class=&quot;headerlink&quot; title=&quot;3ã€ä¼˜åŒ–æ„å»ºé€Ÿåº¦&quot;&gt;&lt;/a&gt;3ã€ä¼˜åŒ–æ„å»ºé€Ÿåº¦&lt;/h2&gt;&lt;p&gt;é•¿æ„å»ºæ—¶é—´ä¼šé™ä½å¼€å‘æ•ˆç‡ï¼Œè¿™å°±éœ€è¦é€šè¿‡ä¸€äº›è¾…åŠ©æ‰‹æ®µä»¥åŠå¯¹é¡¹ç›®ä¾èµ–çš„æ¢³ç†æ¥æ”¹å–„è¿™ä¸ªé—®é¢˜ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ç»è¿‡ä»¥ä¸Šçš„å‡çº§ï¼Œå–„ç”¨ &lt;code&gt;implementation&lt;/code&gt; å·²ç»å¯ä»¥æ˜æ˜¾æé«˜ç¼–è¯‘é€Ÿåº¦ï¼Œä½†ä»ç„¶å¯èƒ½é€šè¿‡ä»¥ä¸‹çš„æ‰‹æ®µè¿›ä¸€æ­¥æå‡ç¼–è¯‘é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-ä¿æŒå·¥å…·å¤„äºæœ€æ–°çŠ¶æ€&quot;&gt;&lt;a href=&quot;#3-1-ä¿æŒå·¥å…·å¤„äºæœ€æ–°çŠ¶æ€&quot; class=&quot;headerlink&quot; title=&quot;3.1 ä¿æŒå·¥å…·å¤„äºæœ€æ–°çŠ¶æ€&quot;&gt;&lt;/a&gt;3.1 ä¿æŒå·¥å…·å¤„äºæœ€æ–°çŠ¶æ€&lt;/h4&gt;&lt;p&gt;Android å·¥å…·å‡ ä¹åœ¨æ¯ä¸€æ¬¡æ›´æ–°ä¸­éƒ½ä¼šè·å¾—æ„å»ºä¼˜åŒ–å’Œæ–°åŠŸèƒ½ï¼Œè¦å……åˆ†åˆ©ç”¨æœ€æ–°ä¼˜åŒ–ï¼Œè¯·ä¿æŒä»¥ä¸‹å·¥å…·å¤„äºæœ€æ–°çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/studio/intro/update.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio å’Œ SDK å·¥å…·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/studio/releases/gradle-plugin.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Plugin for Gradle&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;####3.2 é¿å…ç¼–è¯‘ä¸å¿…è¦çš„èµ„æº &lt;/p&gt;
&lt;p&gt;é¿å…ç¼–è¯‘å’Œæ‰“åŒ…æˆ‘ä»¬æ²¡æœ‰æµ‹è¯•çš„èµ„æºï¼ˆä¾‹å¦‚å…¶ä»–è¯­è¨€æœ¬å’Œå±å¹•å¯†åº¦èµ„æºï¼‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä¸º&lt;code&gt;å¼€å‘ç‰ˆ&lt;/code&gt;æŒ‡å®šä¸€ä¸ªè¯­è¨€èµ„æºå’Œå±å¹•å¯†åº¦ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&amp;#10;  ...&amp;#10;  productFlavors &amp;#123;&amp;#10;    dev &amp;#123;&amp;#10;      ...&amp;#10;      // The following configuration limits the &amp;#34;dev&amp;#34; flavor to using&amp;#10;      // English stringresources and xxhdpi screen-density resources.&amp;#10;      resConfigs &amp;#34;en&amp;#34;, &amp;#34;xxhdpi&amp;#34;&amp;#10;    &amp;#125;&amp;#10;    ...&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-3-å°†é™æ€æ„å»ºé…ç½®å€¼ä¸è°ƒè¯•æ„å»ºç»“åˆä½¿ç”¨&quot;&gt;&lt;a href=&quot;#3-3-å°†é™æ€æ„å»ºé…ç½®å€¼ä¸è°ƒè¯•æ„å»ºç»“åˆä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;3.3 å°†é™æ€æ„å»ºé…ç½®å€¼ä¸è°ƒè¯•æ„å»ºç»“åˆä½¿ç”¨&quot;&gt;&lt;/a&gt;3.3 å°†é™æ€æ„å»ºé…ç½®å€¼ä¸è°ƒè¯•æ„å»ºç»“åˆä½¿ç”¨&lt;/h4&gt;&lt;p&gt;å§‹ç»ˆä¸ºè¿›å…¥ &lt;code&gt;manifest æ–‡ä»¶&lt;/code&gt;çš„å±æ€§ä½¿ç”¨é™æ€/ç¡¬ç¼–ç å€¼ï¼Œæˆ–è€…ä¸ºæˆ‘ä»¬çš„è°ƒè¯•æ„å»ºç±»å‹ä½¿ç”¨èµ„æºæ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬çš„ &lt;code&gt;manifest æ–‡ä»¶&lt;/code&gt;æˆ–åº”ç”¨èµ„æºä¸­çš„å€¼éœ€è¦éšç€æ¯ä¸€ä¸ªæ„å»ºæ›´æ–°ï¼ŒInstant Run å°†æ— æ³•æ‰§è¡Œä»£ç äº¤æ¢ï¼Œå®ƒå¿…é¡»æ„å»ºå’Œå®‰è£…æ–°çš„ APKã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬æ¯æ¬¡æƒ³è¦è¿è¡Œæ›´æ”¹æ—¶ï¼Œä½¿ç”¨åŠ¨æ€ç‰ˆæœ¬ä»£ç ã€ç‰ˆæœ¬åç§°ã€èµ„æºæˆ–ä»»ä½•å…¶ä»–å¯ä»¥æ›´æ”¹ manifest æ–‡ä»¶çš„æ„å»ºé€»è¾‘éƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ APK æ„å»º - å³ä½¿å®é™…æ›´æ”¹ä»…éœ€è¦ä¸€ä¸ªçƒ­äº¤æ¢ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚æœæˆ‘ä»¬çš„æ„å»ºé…ç½®éœ€è¦æ­¤ç±»åŠ¨æ€å±æ€§ï¼Œé‚£ä¹ˆå°†å…¶éš”ç¦»åˆ°æˆ‘ä»¬çš„å‘å¸ƒæ„å»ºå˜ä½“ä¸­å¹¶è®©å€¼å¯¹æˆ‘ä»¬çš„è°ƒè¯•æ„å»ºä¿æŒé™æ€ï¼Œå¦‚ä¸‹é¢çš„ &lt;code&gt;build.gradle&lt;/code&gt; æ–‡ä»¶æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int MILLIS_IN_MINUTE = 1000 * 60&amp;#10;int minutesSinceEpoch = System.currentTimeMillis() / MILLIS_IN_MINUTE&amp;#10;&amp;#10;android &amp;#123;&amp;#10;    ...&amp;#10;    defaultConfig &amp;#123;&amp;#10;        // Making either of these two values dynamic in the defaultConfig will&amp;#10;        // require a full APK build and reinstallation because the AndroidManifest.xml&amp;#10;        // must be updated (which is not supported by Instant Run).&amp;#10;        versionCode 1&amp;#10;        versionName &amp;#34;1.0&amp;#34;&amp;#10;        ...&amp;#10;    &amp;#125;&amp;#10;&amp;#10;    // The defaultConfig values above are fixed, so your incremental builds don&amp;#39;t&amp;#10;    // need to rebuild the manifest (and therefore the whole APK, slowing build times).&amp;#10;    // But for release builds, it&amp;#39;s okay. So the following script iterates through&amp;#10;    // all the known variants, finds those that are &amp;#34;release&amp;#34; build types, and&amp;#10;    // changes those properties to something dynamic.&amp;#10;    applicationVariants.all &amp;#123; variant -&amp;#62;&amp;#10;        if (variant.buildType.name == &amp;#34;release&amp;#34;) &amp;#123;&amp;#10;            variant.mergedFlavor.versionCode = minutesSinceEpoch;&amp;#10;            variant.mergedFlavor.versionName = minutesSinceEpoch + &amp;#34;-&amp;#34; + variant.flavorName;&amp;#10;        &amp;#125;&amp;#10;    &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-4-ä½¿ç”¨é™æ€ä¾èµ–é¡¹ç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#3-4-ä½¿ç”¨é™æ€ä¾èµ–é¡¹ç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;3.4 ä½¿ç”¨é™æ€ä¾èµ–é¡¹ç‰ˆæœ¬&quot;&gt;&lt;/a&gt;3.4 ä½¿ç”¨é™æ€ä¾èµ–é¡¹ç‰ˆæœ¬&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;build.gradle&lt;/code&gt; æ–‡ä»¶ä¸­å£°æ˜ä¾èµ–é¡¹æ—¶ï¼Œæˆ‘ä»¬åº”å½“é¿å…åœ¨ç»“å°¾å°†ç‰ˆæœ¬å·ä¸åŠ å·ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ &lt;code&gt;&amp;#39;com.android.tools.build:gradle:2.+&amp;#39;&lt;/code&gt;ã€‚ä½¿ç”¨åŠ¨æ€ç‰ˆæœ¬å·å¯èƒ½å¯¼è‡´æ„å¤–ç‰ˆæœ¬æ›´æ–°å’Œéš¾ä»¥è§£æç‰ˆæœ¬å·®å¼‚ï¼Œå¹¶å›  Gradle æ£€æŸ¥æœ‰æ— æ›´æ–°è€Œå‡æ…¢æ„å»ºé€Ÿåº¦ã€‚æˆ‘ä»¬åº”æ”¹ä¸ºä½¿ç”¨é™æ€/ç¡¬ç¼–ç ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-5-é…ç½®-dexOptions-å’Œå¯ç”¨åº“é¢„-dexing&quot;&gt;&lt;a href=&quot;#3-5-é…ç½®-dexOptions-å’Œå¯ç”¨åº“é¢„-dexing&quot; class=&quot;headerlink&quot; title=&quot;3.5 é…ç½® dexOptions å’Œå¯ç”¨åº“é¢„ dexing&quot;&gt;&lt;/a&gt;3.5 é…ç½® dexOptions å’Œå¯ç”¨åº“é¢„ dexing&lt;/h4&gt;&lt;p&gt;Android æ’ä»¶æä¾›äº† &lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.DexOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;dexOptions&lt;/code&gt;&lt;/a&gt; ä»£ç å—ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®ä»¥ä¸‹ DEX æ„å»ºå±æ€§ï¼Œè¿™æ ·å¯èƒ½ä¼šåŠ å¿«æ„å»ºé€Ÿåº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;preDexLibraries&lt;/code&gt;ï¼šå£°æ˜æ˜¯å¦é¢„ dex åº“ä¾èµ–é¡¹ä»¥åŠ å¿«æˆ‘ä»¬çš„å¢é‡æ„å»ºé€Ÿåº¦ã€‚ç”±äºæ­¤åŠŸèƒ½å¯èƒ½å‡æ…¢æˆ‘ä»¬çš„æ„å»ºçš„é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ºæŒç»­æ€§é›†æˆæœåŠ¡å™¨åœç”¨æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maxProcessCount&lt;/code&gt;ï¼šè®¾ç½®è¿è¡Œ dex-in-process æ—¶è¦ä½¿ç”¨çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é»˜è®¤å€¼ä¸º 4ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;javaMaxHeapSize&lt;/code&gt;ï¼šè®¾ç½® DEX ç¼–è¯‘å™¨çš„æœ€å¤§å †å¤§å°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åº”å½“å¢åŠ  Gradle çš„å †å¤§å°ï¼ˆå¯ç”¨ dex-in-process æ—¶ï¼Œå°†ä¸ DEX ç¼–è¯‘å™¨å…±äº«ï¼‰ï¼Œè€Œä¸æ˜¯è®¾ç½®æ­¤å±æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&amp;#10;  ...&amp;#10;  dexOptions &amp;#123;&amp;#10;    preDexLibraries true&amp;#10;    maxProcessCount 8&amp;#10;    // Instead of setting the heap size for the DEX process, increase Gradle&amp;#39;s&amp;#10;    // heap size to enable dex-in-process. To learm more, read the next section.&amp;#10;    // javaMaxHeapSize &amp;#34;2048m&amp;#34;&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬åº”å½“é€’å¢è¿™äº›è®¾ç½®çš„å€¼æ¥è¯•éªŒå®ƒä»¬å¹¶é€šè¿‡&lt;a href=&quot;https://developer.android.com/studio/build/optimize-your-build#profile&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åˆ†ææˆ‘ä»¬çš„æ„å»º&lt;/a&gt;è§‚å¯Ÿæ•ˆæœã€‚å¦‚æœæˆ‘ä»¬å‘è¿›ç¨‹åˆ†é…è¿‡å¤šçš„èµ„æºï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šå¦‚æœ Gradle åå°è¿›ç¨‹å·²åœ¨è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœæ­¢æ­¤è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨æ–°è®¾ç½®è¿›è¡Œåˆå§‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹© &lt;strong&gt;View &amp;gt; Tool Windows &amp;gt; Terminal&lt;/strong&gt; å¹¶è¾“å…¥ &lt;code&gt;gradlew --stop&lt;/code&gt; å‘½ä»¤æ¥ç»ˆæ­¢ Gradle åå°ç¨‹åº&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;3-6-å°†å›¾åƒè½¬æ¢æˆ-WebP&quot;&gt;&lt;a href=&quot;#3-6-å°†å›¾åƒè½¬æ¢æˆ-WebP&quot; class=&quot;headerlink&quot; title=&quot;3.6 å°†å›¾åƒè½¬æ¢æˆ WebP&quot;&gt;&lt;/a&gt;3.6 å°†å›¾åƒè½¬æ¢æˆ WebP&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://developers.google.com/speed/webp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WebP&lt;/a&gt; æ˜¯ä¸€ç§æ—¢å¯ä»¥æä¾›æœ‰æŸå‹ç¼©ï¼ˆåƒ JPEG ä¸€æ ·ï¼‰ä¹Ÿå¯ä»¥æä¾›é€æ˜åº¦ï¼ˆåƒ PNG ä¸€æ ·ï¼‰çš„å›¾ç‰‡æ–‡ä»¶æ ¼å¼ï¼Œä¸è¿‡ä¸ JPEG æˆ– PNG ç›¸æ¯”ï¼Œè¿™ç§æ ¼å¼å¯ä»¥æä¾›æ›´å¥½çš„å‹ç¼©ã€‚é™ä½å›¾ç‰‡æ–‡ä»¶å¤§å°å¯ä»¥åŠ å¿«æ„å»ºçš„é€Ÿåº¦ï¼ˆæ— éœ€æ‰§è¡Œæ„å»ºæ—¶å‹ç¼©ï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘ä»¬çš„åº”ç”¨ä½¿ç”¨å¤§é‡å›¾åƒèµ„æºæ—¶ï¼Œæ›´æ˜¯å¦‚æ­¤ã€‚ä¸è¿‡ï¼Œåœ¨å¯¹ WebP å›¾åƒè¿›è¡Œè§£å‹ç¼©æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°è®¾å¤‡çš„ CPU ä½¿ç”¨ç‡æœ‰å°å¹…ä¸Šå‡ã€‚ä½¿ç”¨ Android Studio æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°&lt;a href=&quot;https://developer.android.com/studio/write/convert-webp.html#convert_images_to_webp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å°†å›¾åƒè½¬æ¢æˆ WebP&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-7-åœç”¨-PNG-å¤„ç†&quot;&gt;&lt;a href=&quot;#3-7-åœç”¨-PNG-å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;3.7 åœç”¨ PNG å¤„ç†&quot;&gt;&lt;/a&gt;3.7 åœç”¨ PNG å¤„ç†&lt;/h4&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬æ— æ³•ï¼ˆæˆ–è€…ä¸æƒ³ï¼‰&lt;a href=&quot;https://developer.android.com/studio/write/convert-webp.html#convert_images_to_webp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å°† PNG å›¾åƒè½¬æ¢æˆ WebP&lt;/a&gt;ï¼Œä»å¯ä»¥é€šè¿‡åœ¨æ¯æ¬¡æ„å»ºåº”ç”¨æ—¶åœç”¨è‡ªåŠ¨å›¾åƒå‹ç¼©çš„æ–¹å¼åŠ å¿«æ„å»ºé€Ÿåº¦ã€‚è¦åœç”¨æ­¤ä¼˜åŒ–ï¼Œè¯·å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æˆ‘ä»¬çš„ build.gradle æ–‡ä»¶ä¸­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&amp;#10;  ...&amp;#10;  aaptOptions &amp;#123;&amp;#10;    cruncherEnabled false&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æ„å»ºå‘å¸ƒç‰ˆæœ¬çš„åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤å±æ€§æ‰‹åŠ¨è®¾ç½®ä¸º &lt;code&gt;true&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›ä»¥ä¸Šçš„å†…å®¹å¯¹ä½ èƒ½æœ‰äº›å¸®åŠ©ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ç›´ä»¥æ¥ï¼ŒAndroid é¡¹ç›®åœ¨æ„å»ºé€Ÿåº¦æ˜¯ä¸€å¤§æ§½ç‚¹ï¼Œéšç€Android Studio 3.0 çš„å¤§ç‰ˆæœ¬çš„å‡çº§ä½¿å¾—å¤šModuleå·¥ç¨‹çš„æ„å»ºé€Ÿåº¦åŠ å¿«å¾ˆå¤šã€‚è¿™ä¸»è¦ä¾èµ–äº Android Plugin for Gradle æ’ä»¶ç‰ˆæœ¬çš„å‡çº§ï¼Œå› æ­¤éƒ¨åˆ† API å‘ç”Ÿäº†è¾ƒå¤§å˜åŒ–ã€‚æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä»¥åŠèŠä¸€äº›å¸¸ç”¨çš„ä¼˜åŒ–æ„å»ºé€Ÿåº¦çš„å»ºè®®ï¼Œä»¥ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;android studio 3.1.3; gradle-4.4; gradle plugin 3.1.3 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€Android-SDK-æ„å»ºç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#1ã€Android-SDK-æ„å»ºç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1ã€Android SDK æ„å»ºç³»ç»Ÿ&quot;&gt;&lt;/a&gt;1ã€Android SDK æ„å»ºç³»ç»Ÿ&lt;/h2&gt;&lt;p&gt;åœ¨æ­£å¼è®²è¿°å‡çº§è¿ç§»ä¹‹å‰ï¼Œå¤§å®¶åº”è¯¥ç†Ÿæ‚‰ä¸€ä¸‹ Android SDK çš„æ„å»ºç³»ç»Ÿï¼ŒAndroid æ„å»ºç³»ç»Ÿç¼–è¯‘åº”ç”¨èµ„æºå’Œæºä»£ç ï¼Œç„¶åå°†å®ƒä»¬æ‰“åŒ…æˆå¯ä¾›å¼€å‘äººå‘˜æµ‹è¯•ã€éƒ¨ç½²ã€ç­¾ç½²å’Œåˆ†å‘çš„ APKã€‚Android Studio ä½¿ç”¨ &lt;a href=&quot;http://www.gradle.org/&quot;&gt;Gradle&lt;/a&gt; è¿™ä¸€é«˜çº§æ„å»ºå·¥å…·åŒ…æ¥è‡ªåŠ¨åŒ–æ‰§è¡Œå’Œç®¡ç†æ„å»ºæµç¨‹ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å¼€å‘äººå‘˜å®šä¹‰çµæ´»çš„è‡ªå®šä¹‰æ„å»ºé…ç½®ã€‚æ¯ä¸ªæ„å»ºé…ç½®å‡å¯è‡ªè¡Œå®šä¹‰ä¸€ç»„ä»£ç å’Œèµ„æºï¼ŒåŒæ—¶å¯¹æ‰€æœ‰åº”ç”¨ç‰ˆæœ¬å…±æœ‰çš„éƒ¨åˆ†åŠ ä»¥é‡å¤åˆ©ç”¨ã€‚Android Plugin for Gradle ä¸è¿™ä¸ªæ„å»ºå·¥å…·åŒ…åä½œï¼Œå…±åŒæä¾›ä¸“ç”¨äºæ„å»ºå’Œæµ‹è¯• Android åº”ç”¨çš„æµç¨‹å’Œå¯é…ç½®è®¾ç½®ã€‚ &lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>React Nativeæ¸²æŸ“æµç¨‹æµ…æ</title>
    <link href="http://solart.cc/2017/08/20/react-native-render-seq/"/>
    <id>http://solart.cc/2017/08/20/react-native-render-seq/</id>
    <published>2017-08-20T07:30:55.000Z</published>
    <updated>2017-10-14T01:20:51.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€è·¨å¹³å°æŠ€æœ¯çš„å‘å±•æ¼”è¿›ï¼Œ&lt;code&gt;React Native&lt;/code&gt; è¢«è¶Šæ¥è¶Šå¤šçš„å…¬å¸æ‰€æ¥å—ï¼Œå› æ­¤åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹ &lt;code&gt;React Native&lt;/code&gt; æ¸²æŸ“æµç¨‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶å¯¹ &lt;code&gt;React Native&lt;/code&gt; è¿›è¡Œæ›´æ·±å…¥çš„ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;a href=&quot;#1ã€è·¨å¹³å°æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;1ã€è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;/a&gt;1ã€è·¨å¹³å°æ¡†æ¶&lt;/h2&gt;&lt;p&gt;è·¨å¹³å°ä¸€ç›´ä»¥æ¥æ˜¯ä¸€ä¸ªå·¥ç¨‹å®è·µä¸Šçš„çœŸå®éœ€æ±‚ï¼Œç”¨æ¥èŠ‚çº¦é¡¹ç›®å¼€å‘çš„äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ç­‰ï¼Œå°¤å…¶æ˜¯åœ¨å½“ä¸‹ç§»åŠ¨äº’è”ç½‘çš„æ—¶ä»£ã€‚åœ¨ &lt;code&gt;React Native&lt;/code&gt; è¯ç”Ÿä¹‹å‰ï¼Œå·²ç»å­˜åœ¨äº†å¾ˆå¤šè·¨å¹³å°çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼š&lt;code&gt;Phone Gap&lt;/code&gt; ã€&lt;code&gt;Xamarin&lt;/code&gt; ã€&lt;code&gt;Corona&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-1-è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-1-è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.1 è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot;&gt;&lt;/a&gt;1.1 è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://phonegap.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PhoneGap&lt;/a&gt; åˆ©ç”¨ open-web æŠ€æœ¯ï¼Œå³ HTML 5ã€CSS3 ä»¥åŠ JavaScript æ„å»ºç§»åŠ¨ Web åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.xamarin.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xamarin&lt;/a&gt; åˆ©ç”¨ C# è¯­è¨€å¼€å‘åŸç”Ÿç§»åŠ¨åº”ç”¨ï¼Œæ‰“åŒ…æ—¶å°† C# è½¬åŒ–ä¸ºå¯¹åº”å¹³å°çš„åŸç”Ÿä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://coronalabs.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Corona&lt;/a&gt; 2D æ¸¸æˆä¸åº”ç”¨å¼€å‘å¹³å°ï¼Œåˆ©ç”¨ lua è¿›è¡Œå¼€å‘ï¼Œä¸»è¦é¢å‘æ¸¸æˆå¼€å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä»¥ä¸Šæˆ‘ä»¬æåˆ°è¿™ä¸ªå‡ ä¸ªè·¨å¹³å°æ¡†æ¶ï¼Œç›¸å¯¹æ¥è¯´æ˜¯è¢«é‡‡ç”¨è¾ƒå¤šæˆ–æ¯”è¾ƒçŸ¥åçš„ï¼Œä½†ä¹Ÿç¼ºç‚¹ååˆ†æ˜æ˜¾ã€‚å…¶å®åœ¨æ¥è§¦ &lt;code&gt;React Native&lt;/code&gt; ä¹‹å‰æˆ‘ä¸€ç›´éƒ½è®¤ä¸ºæ‰€è°“è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Œä½†æ˜¯åœ¨æ¥è§¦ä¹‹åï¼Œç¡®å®æ”¹å˜äº†æˆ‘çš„è®¤è¯†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-åŸºäº-JS-çš„è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;a href=&quot;#1-2-åŸºäº-JS-çš„è·¨å¹³å°æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;1.2 åŸºäº JS çš„è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;/a&gt;1.2 åŸºäº JS çš„è·¨å¹³å°æ¡†æ¶&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Facebook&lt;/code&gt;åœ¨ &lt;code&gt;React.js Conf 2015&lt;/code&gt; å¤§ä¼šä¸Šæ¨å‡ºäº†åŸºäº &lt;code&gt;JavaScript&lt;/code&gt; çš„å¼€æºæ¡†æ¶ &lt;code&gt;React Native&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;React Native&lt;/code&gt; ç»“åˆäº† &lt;code&gt;Web&lt;/code&gt; åº”ç”¨å’Œ &lt;code&gt;Native&lt;/code&gt; åº”ç”¨çš„ä¼˜åŠ¿ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;JavaScript&lt;/code&gt; æ¥å¼€å‘ &lt;code&gt;iOS&lt;/code&gt; å’Œ &lt;code&gt;Android&lt;/code&gt; åŸç”Ÿåº”ç”¨ã€‚åœ¨ &lt;code&gt;JavaScript&lt;/code&gt; ä¸­ç”¨ &lt;code&gt;React&lt;/code&gt; æŠ½è±¡æ“ä½œç³»ç»ŸåŸç”Ÿçš„ UI ç»„ä»¶ï¼Œä»£æ›¿ DOM å…ƒç´ æ¥æ¸²æŸ“ã€‚è¿™ç§æ–¹æ¡ˆä¸ç±»ä¼¼ &lt;code&gt;PhoneGap&lt;/code&gt; è¿™ç§ä¾èµ– open-web æŠ€æœ¯æ–¹æ¡ˆæœ€å¤§çš„ä¸åŒå°±æ˜¯ &lt;code&gt;React Native&lt;/code&gt; ä¼šå°†æ ‡ç­¾å…ƒç´ æ¸²æŸ“æˆåŸç”Ÿ UI ç»„ä»¶ï¼Œä»è€Œæå‡æ€§èƒ½åŠäº¤äº’ä½“éªŒï¼Œä½¿å¾—åº”ç”¨æœ¬èº«æ›´åŠ æ¥è¿‘åŸç”Ÿåº”ç”¨çš„ä½“éªŒï¼Œä¹Ÿå› æ­¤æœ‰è¶Šæ¥è¶Šå¤šçš„å…¬å¸å¼€å§‹è€ƒè™‘ &lt;code&gt;React Native&lt;/code&gt; çš„è·¨å¹³å°æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;2ã€å¯åŠ¨æµç¨‹ç®€ä»‹&quot;&gt;&lt;a href=&quot;#2ã€å¯åŠ¨æµç¨‹ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;2ã€å¯åŠ¨æµç¨‹ç®€ä»‹&quot;&gt;&lt;/a&gt;2ã€å¯åŠ¨æµç¨‹ç®€ä»‹&lt;/h2&gt;&lt;p&gt;è¿™ä¸€èŠ‚å¹¶éæ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œæ˜¯ä¸ºäº†ä¸‹é¢åˆ†ææ¸²æŸ“æµç¨‹è¿›è¡Œä¸€äº›é“ºå«ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-JS-æ˜¯å¦‚ä½•åœ¨-Android-ä¸Šè·‘èµ·æ¥çš„ï¼Ÿ&quot;&gt;&lt;a href=&quot;#2-1-JS-æ˜¯å¦‚ä½•åœ¨-Android-ä¸Šè·‘èµ·æ¥çš„ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;2.1  JS æ˜¯å¦‚ä½•åœ¨ Android ä¸Šè·‘èµ·æ¥çš„ï¼Ÿ&quot;&gt;&lt;/a&gt;2.1  JS æ˜¯å¦‚ä½•åœ¨ Android ä¸Šè·‘èµ·æ¥çš„ï¼Ÿ&lt;/h4&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡ Native å‘èµ·åˆ›å»º JS è¿è¡Œç¯å¢ƒï¼ŒåŠ è½½ &lt;code&gt;JS bundle&lt;/code&gt; åä¼šæ‰§è¡Œ &lt;code&gt;AppRegistry::runApplication&lt;/code&gt;ï¼Œå¼•å¯¼æŒ‚è½½æ ¹ç»„ä»¶ä»è€Œæ¸²æŸ“å‡ºæ•´ä¸ª UI ï¼Œå…·ä½“æµç¨‹å¯ä»¥å‚è§ä¸‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/rn_star_up_seq.png&quot; alt=&quot;rn_star_up_seq&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;3ã€JS-ç«¯æ¸²æŸ“åˆ†æ&quot;&gt;&lt;a href=&quot;#3ã€JS-ç«¯æ¸²æŸ“åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;3ã€JS ç«¯æ¸²æŸ“åˆ†æ&quot;&gt;&lt;/a&gt;3ã€JS ç«¯æ¸²æŸ“åˆ†æ&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæ˜¯æœ¬æ–‡çš„é‡ç‚¹éƒ¨åˆ†äº†ï¼Œä»é—¨å°†å…ˆæ¥åˆ†æ JS ç«¯çš„æ¸²æŸ“æµç¨‹æ˜¯æ€æ ·çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-JSX-çš„è½¬ç &quot;&gt;&lt;a href=&quot;#3-1-JSX-çš„è½¬ç &quot; class=&quot;headerlink&quot; title=&quot;3.1 JSX çš„è½¬ç &quot;&gt;&lt;/a&gt;3.1 JSX çš„è½¬ç &lt;/h4&gt;&lt;p&gt;JSX è¯­æ³•æ˜¯å¯¹ JSè¯­æ³•çš„ä¸€ç§æ‰©å±•ï¼Œä¸ºäº†æ–¹ä¾¿å¼€å‘è€…åœ¨ JS ä¸­ç¼–å†™ UIï¼Œåœ¨è¿è¡ŒæœŸé—´ä¼šé€šè¿‡ BABEL è½¬ç ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ç¤ºä¾‹æ¥åšè½¬ç ï¼ŒåŸå§‹çš„ &lt;code&gt;React&lt;/code&gt; ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;export default class App extends Component &amp;#123;&amp;#10;  render() &amp;#123;&amp;#10;    return (&amp;#10;      &amp;#60;View style=&amp;#123;styles.container&amp;#125;&amp;#62;&amp;#10;        &amp;#60;Text style=&amp;#123;styles.welcome&amp;#125;&amp;#62;&amp;#10;          Welcome to React Native!&amp;#10;        &amp;#60;/Text&amp;#62;&amp;#10;      &amp;#60;/View&amp;#62;&amp;#10;    );&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&amp;#10;&amp;#10;AppRegistry.registerComponent(&amp;#39;App&amp;#39;, () =&amp;#62; App);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è½¬ç åï¼šï¼ˆç»è¿‡éƒ¨åˆ†ç²¾ç®€ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥é€šè¿‡ &lt;a href=&quot;http://babeljs.io/repl/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BABEL&lt;/a&gt; åœ¨çº¿è½¬ç ä»¥ä¸Šç¤ºä¾‹ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; _react = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; _react2 = _interopRequireDefault(_react);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; _reactNative = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;_interopRequireDefault&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;obj&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; obj &amp;amp;&amp;amp; obj.__esModule ? obj : &amp;#123;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;: obj&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;App = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;_Component&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _createClass(App, [&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    key: &lt;span class=&quot;string&quot;&gt;&#39;render&#39;&lt;/span&gt;, value: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;render&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _react2.default.createElement(_reactNative.View, &amp;#123;style: styles.container&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          _react2.default.createElement(_reactNative.Text, &amp;#123;style: styles.welcome&amp;#125;, &lt;span class=&quot;string&quot;&gt;&#39;Welcome to React Native!&#39;&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; App;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;(_react.Component);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;_reactNative.AppRegistry.registerComponent(&lt;span class=&quot;string&quot;&gt;&#39;App&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; App;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸå…ˆ JSX çš„å…ƒç´ éƒ½è¢« &lt;a href=&quot;https://facebook.github.io/react/docs/react-api.html#createelement&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;React.createElement&lt;/a&gt; è½¬åŒ–ä¸º &lt;code&gt;ReactElement&lt;/code&gt;ã€‚åœ¨ &lt;code&gt;ReactElement&lt;/code&gt; ä¸­ä½¿ç”¨ typeå­—æ®µå­˜æ”¾åŸå§‹å¯¹è±¡ï¼ˆåœ¨æ­¤å¤„å°±æ˜¯&lt;code&gt;ReactNative.View&lt;/code&gt;/&lt;code&gt;ReactNative.Text&lt;/code&gt;ï¼‰ï¼Œä½¿ç”¨ props å­˜æ”¾ childrensã€å…¶ä»–ä¼ å…¥å±æ€§ç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-å¦‚ä½•ç”Ÿæˆ-React-ç»„ä»¶&quot;&gt;&lt;a href=&quot;#3-2-å¦‚ä½•ç”Ÿæˆ-React-ç»„ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3.2 å¦‚ä½•ç”Ÿæˆ React ç»„ä»¶&quot;&gt;&lt;/a&gt;3.2 å¦‚ä½•ç”Ÿæˆ React ç»„ä»¶&lt;/h4&gt;&lt;p&gt;ä»ä¸€å®šè§’åº¦ä¸Šæ¥è¯´ï¼Œ&lt;code&gt;React&lt;/code&gt; çš„ç»„ä»¶å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…ƒç»„ä»¶&lt;/strong&gt; æ¡†æ¶å†…ç½®çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨çš„ç»„ä»¶ï¼Œä¸åŒå¹³å°æœ‰&lt;strong&gt;ä¸åŒçš„å…ƒç»„ä»¶å®ç°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤åˆç»„ä»¶&lt;/strong&gt; å¼€å‘è€…å°è£…ä¹‹åçš„ç»„ä»¶ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ React.createClass æ¥æ„å»ºï¼Œæä¾› render() å‡½æ•°è¿”å›æ¸²æŸ“å…ƒç´ èŠ‚ç‚¹ï¼ˆ ES6 ä¸­å¯ä»¥ç»§æ‰¿ React.Component/PureComponent )ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆï¼Œ&lt;code&gt;ReactNative&lt;/code&gt; çš„ &lt;code&gt;js&lt;/code&gt;ä»£ç éƒ½éœ€è¦é€šè¿‡ &lt;code&gt;AppRegistry.registerComponent&lt;/code&gt; æ³¨å†Œå¯¹åº” appkey çš„ Component æ‰èƒ½è¢«å¯åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ &lt;code&gt;AppRegistry.js&lt;/code&gt; ä¸­çœ‹åˆ°å®ƒæ³¨å†Œäº†ä¸€ä¸ªå¯¹åº”çš„å›è°ƒï¼Œåœ¨ Native å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šé€šè¿‡ &lt;code&gt;jsbridge&lt;/code&gt; è°ƒç”¨ &lt;code&gt;AppRegistry.runApplication&lt;/code&gt; å¯åŠ¨ &lt;code&gt;js&lt;/code&gt; æ¸²æŸ“æµç¨‹ï¼Œåœ¨ &lt;code&gt;js&lt;/code&gt; ä¸­ä¼šè°ƒç”¨å¯¹åº” &lt;code&gt;runnable&lt;/code&gt; ï¼Œå³åé¢çš„&lt;code&gt;renderApplication&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;renderApplication&lt;/code&gt; æ—¶ä¼šå°†ä¼ å…¥çš„ Component å˜æˆ &lt;code&gt;ReactElement&lt;/code&gt;ï¼ŒåŒ…è£¹åœ¨ &lt;code&gt;AppContainer&lt;/code&gt; ä¸­ï¼Œè¿™ä¸ª &lt;code&gt;AppContainer&lt;/code&gt; ä¸»è¦ç”¨äºå¤–é¢åŒ…å›´ä¸€äº› Debug ç”¨çš„å·¥å…·ï¼ˆå¦‚çº¢ç›’ï¼‰ã€‚åœ¨è¿™ä¹‹åå¦‚ä¸Šè¿°æµç¨‹å›¾ä¸­ä¸€æ­¥æ­¥èµ°äº†ä¸‹å»ï¼Œæ²¡ä»€ä¹ˆå…¶ä»–åˆ†æ”¯ï¼Œèµ°åˆ° &lt;code&gt;ReactNativeMount&lt;/code&gt; ä¸­å°±ä¼šæœ‰æ–™å‡ºç°äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;renderComponent: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    nextElement: ReactElement&amp;lt;*&amp;gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    containerTag: number,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    callback?: ?((&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;title&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ): ?&lt;span class=&quot;title&quot;&gt;ReactComponent&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;any&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;any&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;any&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å°†Elementä½¿ç”¨ç›¸åŒé¡¶å±‚WrapperåŒ…è£¹ï¼Œrenderæ–¹æ³•è¿”å›childï¼ˆå³nextElement)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; nextWrappedElement = React.createElement(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      TopLevelWrapper,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#123; child: nextElement &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReactNativeTagHandles.assertRootTag(containerTag);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// åˆå§‹åŒ–è¦åŠ è½½çš„å…ƒç´ å®ä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; instance = instantiateReactComponent(nextWrappedElement, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReactNativeMount._instancesByContainerID[containerTag] = instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// The initial render is synchronous but any updates that happen during&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// rendering, in componentWillMount or componentDidMount, will be batched&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// according to the current batching strategy.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReactUpdates.batchedUpdates(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      batchedMountComponentIntoNode,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      instance,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      containerTag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; component = instance.getPublicInstance();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; component;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œå°†ä¼ å…¥çš„ Element éƒ½ç”¨ &lt;code&gt;TopLevelWrapper&lt;/code&gt; è¿›è¡Œå°è£…ï¼Œä½†æ˜¯å®ƒç›´æ¥é€ä¼ ç›®æ ‡ç»™ &lt;code&gt;render&lt;/code&gt; å‡½æ•°ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥è¿™å±‚ã€‚è¿™é‡Œé€šè¿‡ &lt;code&gt;instantiateReactComponent&lt;/code&gt; ç”Ÿæˆäº†ä¸€ä¸ªæ¸²æŸ“å¯¹è±¡å®ä¾‹ï¼Œå°† &lt;code&gt;batchedMountComponentIntoNode()&lt;/code&gt; å‡½æ•°æäº¤å…¥å›è°ƒ Queueï¼Œå®ƒé‡Œé¢æœ€ç»ˆä¼šèµ°åˆ° &lt;code&gt;ReactReconciler.mountComponent&lt;/code&gt; é‡Œé¢ï¼Œç›´æ¥è°ƒç”¨ &lt;code&gt;instance.mountComponent&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æœ‰ä¸¤å¤„å…³é”®åœ°æ–¹è¦ç†è§£äº†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;instantiateReactComponent&lt;/code&gt;åˆ©ç”¨è¾“å…¥çš„ &lt;code&gt;ReactElement&lt;/code&gt; ç”Ÿæˆäº†ä»€ä¹ˆä¸œè¥¿ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ &lt;code&gt;instance.mountComponent&lt;/code&gt; æ€ä¹ˆè¿›è¡Œæ¸²æŸ“ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ &lt;code&gt;React&lt;/code&gt; æ ¸å¿ƒåº“ä¸­æä¾›äº† &lt;code&gt;instantiateReactComponent.js&lt;/code&gt;ï¼Œä¾›æ¸²æŸ“å¹³å°è°ƒç”¨ã€‚å®ƒåœ¨ç¢°è§ &lt;code&gt;ReactElement&lt;/code&gt; æ—¶ä¼šæ ¹æ®å…¶ä¸­çš„ type ç”Ÿæˆ&lt;strong&gt;å…ƒç»„ä»¶&lt;/strong&gt;æˆ–è€…&lt;strong&gt;å¤åˆç»„ä»¶&lt;/strong&gt;ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;instantiateReactComponent&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;node, shouldHaveDebugID&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (node === &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; || node === &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    instance = ReactEmptyComponent.create(instantiateReactComponent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; node === &lt;span class=&quot;string&quot;&gt;&#39;object&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; element = node;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Special case string values&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; element.type === &lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      instance = ReactHostComponent.createInternalComponent(element);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isInternalComponentType(element.type)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      instance = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; element.type(element);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// We renamed this. Allow the old name for compat. :(&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!instance.getHostNode) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        instance.getHostNode = instance.getNativeNode;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      instance = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReactCompositeComponentWrapper(element);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; node === &lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt; || &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; node === &lt;span class=&quot;string&quot;&gt;&#39;number&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    instance = ReactHostComponent.createInstanceForText(node);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    invariant(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&#39;Encountered invalid React node of type %s&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; node&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ•´ä¸ªä»£ç é€»è¾‘æ€»ç»“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/instantiateReactComponent.png&quot; alt=&quot;instantiateReactComponent&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;3-3-å¤åˆç»„ä»¶æ¸²æŸ“&quot;&gt;&lt;a href=&quot;#3-3-å¤åˆç»„ä»¶æ¸²æŸ“&quot; class=&quot;headerlink&quot; title=&quot;3.3 å¤åˆç»„ä»¶æ¸²æŸ“&quot;&gt;&lt;/a&gt;3.3 å¤åˆç»„ä»¶æ¸²æŸ“&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/js_render_seq.png&quot; alt=&quot;js_render_seq&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æŒ‚è½½æ ¹ç»„ä»¶çš„æ—¶å€™ï¼Œç”±äºæ ¹ç»„ä»¶æ˜¯å¤åˆç»„ä»¶ï¼Œå®ƒä¼šè·å– &lt;code&gt;render()&lt;/code&gt; å‡½æ•°è¿”å›çš„æ¸²æŸ“èŠ‚ç‚¹ï¼Œå¹¶å¯¹å®ƒç»§ç»­èµ° &lt;code&gt;instantiate&lt;/code&gt;/&lt;code&gt;mountComponent&lt;/code&gt; çš„æµç¨‹ã€‚å¦‚æœ &lt;code&gt;render()&lt;/code&gt; è¿”å›çš„èŠ‚ç‚¹è¿˜æ˜¯è‡ªå®šä¹‰çš„å¤åˆç»„ä»¶ï¼Œé‚£è¿™ä¸ªæµç¨‹è¿˜ä¼šå‘ä¸‹èµ°ï¼Œå³ï¼š&lt;strong&gt;mountæµç¨‹ä¼šé€’å½’å‘ä¸‹è°ƒç”¨ç›´åˆ°æœ€åä¸€ä¸ªå…ƒç»„ä»¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-4-å…ƒç»„ä»¶æ¸²æŸ“&quot;&gt;&lt;a href=&quot;#3-4-å…ƒç»„ä»¶æ¸²æŸ“&quot; class=&quot;headerlink&quot; title=&quot;3.4 å…ƒç»„ä»¶æ¸²æŸ“&quot;&gt;&lt;/a&gt;3.4 å…ƒç»„ä»¶æ¸²æŸ“&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/rn_js_element_comp_render_seq.png&quot; alt=&quot;rn_js_element_comp_render_seq&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªå…ƒç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªé€’å½’æ¸²æŸ“çš„æµç¨‹ï¼Œè¿™å…¶ä¸­è·Ÿå¤åˆç»„ä»¶äº¤å·®æŒ‚è½½ï¼Œä½†æœ€ç»ˆéƒ½ä¼šè½¬åŒ–ä¸ºå…ƒç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;React Native&lt;/code&gt; å°†ä»£ç ç”±&lt;code&gt;JSX&lt;/code&gt; è½¬åŒ–ä¸º &lt;code&gt;JS&lt;/code&gt; ç»„ä»¶ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­åˆ©ç”¨ &lt;code&gt;instantiateReactComponent&lt;/code&gt; å°† &lt;code&gt;ReactElement&lt;/code&gt; è½¬åŒ–ä¸ºå¤åˆç»„ä»¶ &lt;code&gt;ReactCompositeComponent&lt;/code&gt; ä¸å…ƒç»„ä»¶ &lt;code&gt;ReactNativeBaseComponent&lt;/code&gt; ï¼Œåˆ©ç”¨ &lt;code&gt;ReactReconciler&lt;/code&gt; å¯¹ä»–ä»¬è¿›è¡Œæ¸²æŸ“ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4ã€Android-ç«¯æ¸²æŸ“åˆ†æ&quot;&gt;&lt;a href=&quot;#4ã€Android-ç«¯æ¸²æŸ“åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;4ã€Android ç«¯æ¸²æŸ“åˆ†æ&quot;&gt;&lt;/a&gt;4ã€Android ç«¯æ¸²æŸ“åˆ†æ&lt;/h2&gt;&lt;p&gt;ä» js ç«¯ä¹Ÿå°±æ˜¯ &lt;code&gt;UIManager&lt;/code&gt; è°ƒç”¨åˆ° Android ç«¯çš„ &lt;code&gt;UIManagerMoudule&lt;/code&gt; ååˆ™è¿›å…¥äº† Native ç«¯çš„æ¸²æŸ“æµç¨‹ï¼Œæ•´ä¸ªæµç¨‹ç»†èŠ‚æ¯”è¾ƒå¤æ‚ï¼Œä½†æ•´ä½“å¯¹ UI æ“ä½œçš„æµç¨‹æ¯”è¾ƒè§„å¾‹ï¼Œè§ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/react_native_ui_manager.png&quot; alt=&quot;react_native_ui_manager&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å¯¹æ•´ä¸ªæ¸²æŸ“æµç¨‹çš„ä¸€ä¸ªç®€è¦åˆ†æï¼Œå¸Œæœ›èƒ½å¯¹æ­£åœ¨ç ”ç©¶è¿™å—å†…å®¹çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€è·¨å¹³å°æŠ€æœ¯çš„å‘å±•æ¼”è¿›ï¼Œ&lt;code&gt;React Native&lt;/code&gt; è¢«è¶Šæ¥è¶Šå¤šçš„å…¬å¸æ‰€æ¥å—ï¼Œå› æ­¤åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹ &lt;code&gt;React Native&lt;/code&gt; æ¸²æŸ“æµç¨‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶å¯¹ &lt;code&gt;React Native&lt;/code&gt; è¿›è¡Œæ›´æ·±å…¥çš„ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;a href=&quot;#1ã€è·¨å¹³å°æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;1ã€è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;/a&gt;1ã€è·¨å¹³å°æ¡†æ¶&lt;/h2&gt;&lt;p&gt;è·¨å¹³å°ä¸€ç›´ä»¥æ¥æ˜¯ä¸€ä¸ªå·¥ç¨‹å®è·µä¸Šçš„çœŸå®éœ€æ±‚ï¼Œç”¨æ¥èŠ‚çº¦é¡¹ç›®å¼€å‘çš„äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ç­‰ï¼Œå°¤å…¶æ˜¯åœ¨å½“ä¸‹ç§»åŠ¨äº’è”ç½‘çš„æ—¶ä»£ã€‚åœ¨ &lt;code&gt;React Native&lt;/code&gt; è¯ç”Ÿä¹‹å‰ï¼Œå·²ç»å­˜åœ¨äº†å¾ˆå¤šè·¨å¹³å°çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼š&lt;code&gt;Phone Gap&lt;/code&gt; ã€&lt;code&gt;Xamarin&lt;/code&gt; ã€&lt;code&gt;Corona&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-1-è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-1-è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.1 è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&quot;&gt;&lt;/a&gt;1.1 è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Ÿ&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://phonegap.com/&quot;&gt;PhoneGap&lt;/a&gt; åˆ©ç”¨ open-web æŠ€æœ¯ï¼Œå³ HTML 5ã€CSS3 ä»¥åŠ JavaScript æ„å»ºç§»åŠ¨ Web åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.xamarin.com/&quot;&gt;Xamarin&lt;/a&gt; åˆ©ç”¨ C# è¯­è¨€å¼€å‘åŸç”Ÿç§»åŠ¨åº”ç”¨ï¼Œæ‰“åŒ…æ—¶å°† C# è½¬åŒ–ä¸ºå¯¹åº”å¹³å°çš„åŸç”Ÿä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://coronalabs.com/&quot;&gt;Corona&lt;/a&gt; 2D æ¸¸æˆä¸åº”ç”¨å¼€å‘å¹³å°ï¼Œåˆ©ç”¨ lua è¿›è¡Œå¼€å‘ï¼Œä¸»è¦é¢å‘æ¸¸æˆå¼€å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä»¥ä¸Šæˆ‘ä»¬æåˆ°è¿™ä¸ªå‡ ä¸ªè·¨å¹³å°æ¡†æ¶ï¼Œç›¸å¯¹æ¥è¯´æ˜¯è¢«é‡‡ç”¨è¾ƒå¤šæˆ–æ¯”è¾ƒçŸ¥åçš„ï¼Œä½†ä¹Ÿç¼ºç‚¹ååˆ†æ˜æ˜¾ã€‚å…¶å®åœ¨æ¥è§¦ &lt;code&gt;React Native&lt;/code&gt; ä¹‹å‰æˆ‘ä¸€ç›´éƒ½è®¤ä¸ºæ‰€è°“è·¨å¹³å°æ¡†æ¶éƒ½æ˜¯ä¼ªå‘½é¢˜ï¼Œä½†æ˜¯åœ¨æ¥è§¦ä¹‹åï¼Œç¡®å®æ”¹å˜äº†æˆ‘çš„è®¤è¯†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-åŸºäº-JS-çš„è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;a href=&quot;#1-2-åŸºäº-JS-çš„è·¨å¹³å°æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;1.2 åŸºäº JS çš„è·¨å¹³å°æ¡†æ¶&quot;&gt;&lt;/a&gt;1.2 åŸºäº JS çš„è·¨å¹³å°æ¡†æ¶&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Facebook&lt;/code&gt;åœ¨ &lt;code&gt;React.js Conf 2015&lt;/code&gt; å¤§ä¼šä¸Šæ¨å‡ºäº†åŸºäº &lt;code&gt;JavaScript&lt;/code&gt; çš„å¼€æºæ¡†æ¶ &lt;code&gt;React Native&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;React Native&lt;/code&gt; ç»“åˆäº† &lt;code&gt;Web&lt;/code&gt; åº”ç”¨å’Œ &lt;code&gt;Native&lt;/code&gt; åº”ç”¨çš„ä¼˜åŠ¿ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;JavaScript&lt;/code&gt; æ¥å¼€å‘ &lt;code&gt;iOS&lt;/code&gt; å’Œ &lt;code&gt;Android&lt;/code&gt; åŸç”Ÿåº”ç”¨ã€‚åœ¨ &lt;code&gt;JavaScript&lt;/code&gt; ä¸­ç”¨ &lt;code&gt;React&lt;/code&gt; æŠ½è±¡æ“ä½œç³»ç»ŸåŸç”Ÿçš„ UI ç»„ä»¶ï¼Œä»£æ›¿ DOM å…ƒç´ æ¥æ¸²æŸ“ã€‚è¿™ç§æ–¹æ¡ˆä¸ç±»ä¼¼ &lt;code&gt;PhoneGap&lt;/code&gt; è¿™ç§ä¾èµ– open-web æŠ€æœ¯æ–¹æ¡ˆæœ€å¤§çš„ä¸åŒå°±æ˜¯ &lt;code&gt;React Native&lt;/code&gt; ä¼šå°†æ ‡ç­¾å…ƒç´ æ¸²æŸ“æˆåŸç”Ÿ UI ç»„ä»¶ï¼Œä»è€Œæå‡æ€§èƒ½åŠäº¤äº’ä½“éªŒï¼Œä½¿å¾—åº”ç”¨æœ¬èº«æ›´åŠ æ¥è¿‘åŸç”Ÿåº”ç”¨çš„ä½“éªŒï¼Œä¹Ÿå› æ­¤æœ‰è¶Šæ¥è¶Šå¤šçš„å…¬å¸å¼€å§‹è€ƒè™‘ &lt;code&gt;React Native&lt;/code&gt; çš„è·¨å¹³å°æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="React-Native" scheme="http://solart.cc/categories/React-Native/"/>
    
    
  </entry>
  
  <entry>
    <title>æˆ‘çœ¼ä¸­çš„ React Native</title>
    <link href="http://solart.cc/2017/05/12/understanding_react_native/"/>
    <id>http://solart.cc/2017/05/12/understanding_react_native/</id>
    <published>2017-05-12T14:08:55.000Z</published>
    <updated>2017-05-14T14:14:19.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹ &lt;code&gt;React Native&lt;/code&gt; çš„å­¦ä¹ å’Œå¼€å‘æœ‰åŠå¹´å¤šçš„æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ä¸Šæˆ‘è§‰å¾—å¯ä»¥ç²—æµ…çš„é˜è¿°ä¸‹æˆ‘ç†è§£çš„ &lt;code&gt;React Native&lt;/code&gt; æ˜¯æ€æ ·çš„ä¸€ç§æŠ€æœ¯æ ˆä»¥åŠæˆ‘å¯¹å®ƒçš„ä¸€äº›çœ‹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€DOM-ä¸-JavaScript&quot;&gt;&lt;a href=&quot;#1ã€DOM-ä¸-JavaScript&quot; class=&quot;headerlink&quot; title=&quot;1ã€DOM ä¸ JavaScript&quot;&gt;&lt;/a&gt;1ã€DOM ä¸ JavaScript&lt;/h2&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ &lt;code&gt;DOM (Document Object Model)&lt;/code&gt; æ˜¯æ“ä½œHTML/XMLæ–‡æ¡£çš„ä¸€ç»„æ¥å£ï¼Œå¤§å®¶ç†ŸçŸ¥çš„ Web äº¤äº’ï¼Œå°±æ˜¯ç”± JavaScript æ“ä½œ DOM å®Œæˆçš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;Title&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;This is a paragraph&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;1-1-DOM-çš„ç¼ºé™·&quot;&gt;&lt;a href=&quot;#1-1-DOM-çš„ç¼ºé™·&quot; class=&quot;headerlink&quot; title=&quot;1.1 DOM çš„ç¼ºé™·&quot;&gt;&lt;/a&gt;1.1 DOM çš„ç¼ºé™·&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç›´æ¥æ“ä½œ DOM çš„æ¥å£ä¸æ–¹ä¾¿&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤§é‡çš„å…¼å®¹æ€§ä»£ç ï¼ˆé’ˆå¯¹ä¸åŒçš„æµè§ˆå™¨å¹³å°æˆ–ç‰ˆæœ¬ï¼‰&lt;/li&gt;
&lt;li&gt;æ€§èƒ½è¾ƒå·®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ—©æœŸçš„ Web é¡µé¢ç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ï¼Œè¿™ä¸ DOM æœ¬èº«çš„ç¼ºé™·æœ‰ç€ä¸€å®šçš„å…³ç³»ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ€»éœ€è¦å°†å˜åŒ–çš„æ•°æ®å®æ—¶ååº”åˆ° UI ä¸Šï¼Œè¿™æ—¶å°±éœ€è¦å¯¹ DOM è¿›è¡Œæ“ä½œï¼Œé™¤äº†æ“ä½œä¸ä¾¿å’Œéœ€è¦å¤§é‡çš„å…¼å®¹ä»£ç å¤–ï¼Œé¢‘ç¹æˆ–å¤æ‚çš„ DOM æ“ä½œé€šå¸¸ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆäº§ç”Ÿçš„åŸå› ï¼Œç›´åˆ°ä»¥ &lt;code&gt;JQuery&lt;/code&gt; ä¸ºä»£è¡¨çš„ç¬¬ä¸‰æ–¹æ¡†è¯ç”Ÿæ‰è§£å†³äº†å¤§å¤šæ•°çš„å¼€å‘ç—›ç‚¹ï¼Œä½†ä¾ç„¶è¾¾ä¸åˆ°æ¡Œé¢çº§çš„å¼€å‘ä½“éªŒã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-JavaScript-çš„æˆé•¿&quot;&gt;&lt;a href=&quot;#1-2-JavaScript-çš„æˆé•¿&quot; class=&quot;headerlink&quot; title=&quot;1.2 JavaScript çš„æˆé•¿&quot;&gt;&lt;/a&gt;1.2 JavaScript çš„æˆé•¿&lt;/h4&gt;&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œç”±äº JavaScript è®¾è®¡é˜¶æ®µè¿‡äºä»“ä¿ƒï¼ˆæ®è¯´è®¾è®¡è€… &lt;a href=&quot;https://en.wikipedia.org/wiki/Brendan_Eich&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Brendan Eich&lt;/a&gt; ä»…ä»…ç”¨äº†åå¤©ï¼‰ï¼Œè®¾è®¡å¹¶ä¸å®Œå–„ï¼Œç”šè‡³æœ‰äººæ€»ç»“äº† JavaScript çš„ 10 ä¸ªè®¾è®¡ç¼ºé™·ï¼Œè€Œè¿™äº›ç¼ºé™·æœ¬èº«å¹¶æ²¡æœ‰æ‰¼ä½å®ƒçš„å‘å±•ï¼Œéšç€ &lt;code&gt;ES 5&lt;/code&gt;ã€&lt;code&gt;ES 6&lt;/code&gt; çš„ç›¸ç»§å‘å¸ƒ JavaScript è¢«è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…è®¤å¯ã€‚é™¤äº†ä½œä¸º Web ç«¯å¼€å‘çš„ä¸äºŒé€‰æ‹©ï¼Œè¿˜è¢«æ‹“å±•åˆ°åç«¯å¼€å‘ &lt;a href=&quot;https://nodejs.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;Node.js&lt;/code&gt;&lt;/a&gt;ï¼Œ2016 å¹´ç”šè‡³è¢«ç§°ä¸ºå¤§å‰ç«¯å…ƒå¹´ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€å‰ç«¯æ¡†æ¶-React&quot;&gt;&lt;a href=&quot;#2ã€å‰ç«¯æ¡†æ¶-React&quot; class=&quot;headerlink&quot; title=&quot;2ã€å‰ç«¯æ¡†æ¶ React&quot;&gt;&lt;/a&gt;2ã€å‰ç«¯æ¡†æ¶ React&lt;/h2&gt;&lt;p&gt;éšç€åŸºäº HTML çš„å‰ç«¯ç•Œé¢å¼€å‘å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒFacebook æ¨å‡ºçš„ React æ¡†æ¶åº”è¿è€Œç”Ÿã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;2-1-React-ç‰¹ç‚¹&quot;&gt;&lt;a href=&quot;#2-1-React-ç‰¹ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;2.1 React ç‰¹ç‚¹&quot;&gt;&lt;/a&gt;2.1 React ç‰¹ç‚¹&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è™šæ‹Ÿ DOM â€”â€” å‡å°‘çœŸå® DOM æ“ä½œ ï¼ˆæå‡æ€§èƒ½ï¼‰&lt;/li&gt;
&lt;li&gt;ç»„ä»¶åŒ– â€”â€” å°è£… HTML ç‰‡æ®µå’Œäº‹ä»¶å¤„ç† ï¼ˆæ˜“äºé‡ç”¨ï¼Œå¯ç»´æŠ¤æ€§å¼ºï¼‰&lt;/li&gt;
&lt;li&gt;å°è£…äº‹ä»¶ â€”â€” å°†åŸå§‹æµè§ˆå™¨äº‹ä»¶è½¬æ¢ä¸º React äº‹ä»¶ ï¼ˆå¤„ç†å…¼å®¹æ€§ï¼‰&lt;/li&gt;
&lt;li&gt;æ•°æ®ç»‘å®š â€”â€” ç›‘å¬å±æ€§å’ŒçŠ¶æ€è‡ªåŠ¨æ›´æ–°é¡µé¢ ï¼ˆæå‡å¼€å‘ä½“éªŒï¼‰&lt;/li&gt;
&lt;li&gt;å…¨å±æ›´æ–° â€”â€” æ¸²æŸ“æ•´ä¸ªé¡µé¢ï¼Œä½†åªæ›´æ–°éœ€è¦å˜åŒ–çš„éƒ¨åˆ† ï¼ˆæå‡æ€§èƒ½åŠå¼€å‘ä½“éªŒï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šè¿™äº›ç‰¹ç‚¹æ˜¯ React å¸å¼•å‰ç«¯å¼€å‘äººå‘˜çš„ä¸»è¦å› ç´ ï¼Œä¹Ÿæ˜¯å®ƒçš„è®¾è®¡ç†å¿µï¼Œç°åœ¨ä½ å¯ä»¥çœ‹åˆ° React çš„ç¤¾åŒºæ˜¯å¤šä¹ˆæ´»è·ƒã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-2-React-ç»„ä»¶å’Œè™šæ‹Ÿ-DOM&quot;&gt;&lt;a href=&quot;#2-2-React-ç»„ä»¶å’Œè™šæ‹Ÿ-DOM&quot; class=&quot;headerlink&quot; title=&quot;2.2 React ç»„ä»¶å’Œè™šæ‹Ÿ DOM&quot;&gt;&lt;/a&gt;2.2 React ç»„ä»¶å’Œè™šæ‹Ÿ DOM&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/jsx2html.png&quot; alt=&quot;jsx2html&quot;&gt;&lt;/p&gt;
&lt;p&gt;é©±åŠ¨ React é«˜æ•ˆæ€§èƒ½çš„è™šæ‹Ÿ DOM æŠ€æœ¯ä½œç”¨çš„æœ€åŸºç¡€å•å…ƒæ˜¯ React ä¸­è¢«ç§°ä¸ºç»„ä»¶ï¼ˆComponentï¼‰çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3ã€React-Native&quot;&gt;&lt;a href=&quot;#3ã€React-Native&quot; class=&quot;headerlink&quot; title=&quot;3ã€React Native&quot;&gt;&lt;/a&gt;3ã€React Native&lt;/h2&gt;&lt;p&gt;React è·¨å¹³å°çš„æ½œåŠ›é€æ¸è¢«å‘æ˜ï¼Œäºæ˜¯è¯ç”Ÿäº† React Nativeã€‚å…¶å®ä» React æ‹“å±•å‡ºæ¥çš„æ¡†æ¶è¿˜æœ‰åƒ &lt;a href=&quot;https://github.com/necolas/react-native-web&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;react-native-web&lt;/a&gt; ï¼ˆåŸºäº React Native çš„ç»„ä»¶åŠ API æ‹“å±•åˆ°äº† Web ç«¯ï¼‰ä»¥åŠé€‚é… Windows ä¸€äº›é¡¹ç›®ç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-React-Native-ä¸-React&quot;&gt;&lt;a href=&quot;#3-1-React-Native-ä¸-React&quot; class=&quot;headerlink&quot; title=&quot;3.1 React Native ä¸ React&quot;&gt;&lt;/a&gt;3.1 React Native ä¸ React&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/react_native_born.png&quot; alt=&quot;react_native_born&quot;&gt;&lt;/p&gt;
&lt;p&gt;React Native åŸºäº React ç”Ÿæ€ï¼Œå¯¹ Native å¹³å°è¿›è¡ŒæŠ½è±¡ï¼Œæ„å»ºå…¨æ–°çš„è·¨å¹³å°å¼€å‘ä½“éªŒã€‚ç”±äºæ˜¯åŸºäº React ï¼Œæ‰€ä»¥åœ¨æ­¤å®ƒä»¬å­˜åœ¨ä¸€äº›å…±æ€§çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…±æ€§&lt;ul&gt;
&lt;li&gt;ç»„ä»¶æ¨¡å‹&lt;/li&gt;
&lt;li&gt;ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿ DOM åŠç›¸å…³ç®—æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ï¼Œå®ƒä»¬åˆ†åˆ«é’ˆå¯¹ Native å’Œ Web æ‰€ä»¥å­˜åœ¨ä¸€äº›æœ¬è´¨ä¸Šçš„å·®å¼‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·®å¼‚&lt;ul&gt;
&lt;li&gt;é¡µé¢æ¸²æŸ“&lt;/li&gt;
&lt;li&gt;äº‹ä»¶å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;3-2-Componet-çš„å“²å­¦&quot;&gt;&lt;a href=&quot;#3-2-Componet-çš„å“²å­¦&quot; class=&quot;headerlink&quot; title=&quot;3.2 Componet çš„å“²å­¦&quot;&gt;&lt;/a&gt;3.2 Componet çš„å“²å­¦&lt;/h4&gt;&lt;p&gt;åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†ç»„ä»¶ ï¼Œç»„ä»¶çš„åŠŸèƒ½ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¸ƒå±€ç•Œé¢ï¼Œå“åº”äº¤äº’ã€‚çˆ¶ç»„ä»¶å•å‘ä¼ é€’ &lt;code&gt;props&lt;/code&gt; ç»™å­ç»„ä»¶ï¼Œæ§åˆ¶å­ç»„ä»¶çš„æ˜¾ç¤ºï¼Œç»„ä»¶ä¸èƒ½ä¿®æ”¹è‡ªèº«çš„ &lt;code&gt;props&lt;/code&gt; ã€‚çˆ¶ç»„ä»¶å¯ä»¥è®¿é—®å­ç»„ä»¶ï¼Œå­ç»„ä»¶ä¸èƒ½è®¿é—®çˆ¶ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/react_components.png&quot; alt=&quot;react_componets&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç»„ä»¶æ¥å°è£…ç•Œé¢æ¨¡å—ï¼Œæ•´ä¸ªç•Œé¢å°±æ˜¯ä¸€ä¸ªå¤§ç»„ä»¶ï¼Œå¼€å‘è¿‡ç¨‹å°±æ˜¯ä¸æ–­ä¼˜åŒ–å’Œæ‹†åˆ†ç•Œé¢ç»„ä»¶ã€æ„é€ æ•´ä¸ªç»„ä»¶æ ‘çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-Redux&quot;&gt;&lt;a href=&quot;#3-2-Redux&quot; class=&quot;headerlink&quot; title=&quot;3.2 Redux&quot;&gt;&lt;/a&gt;3.2 Redux&lt;/h4&gt;&lt;p&gt;æœ‰ä¸€ç§è§‚ç‚¹è¯´å¾ˆå¯èƒ½ä½ å¹¶ä¸éœ€è¦ Reduxï¼Œä½†å®é™…çš„çº¿ä¸Šé¡¹ç›®å¤§éƒ½éœ€è¦ Redux å¸®åŠ©å¤„ç†çŠ¶æ€ç®¡ç†ã€‚äº‹å®ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µï¼Œä½ éå¸¸éœ€è¦å®ƒã€‚&lt;/p&gt;
&lt;p&gt;Redux æ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª Storeï¼Œéå¸¸æ–¹ä¾¿æ•°æ®è·¨å±‚ä¼ é€’ï¼Œå•å‘æ•°æ®æµæ¶æ„è®¾è®¡ï¼Œéå¸¸æ–¹ä¾¿çŠ¶æ€å›æœ”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/redux.png&quot; alt=&quot;redux&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¢«åæ§½æœ€å¤šçš„å°±æ˜¯éšç€åº”ç”¨è¶Šæ¥è¶Šå¤§ï¼Œä½¿ç”¨ Redux ä½ éœ€è¦å†™éå¸¸å¤šçš„ Action å’Œ Reducerï¼Œè¿™éƒ¨åˆ†å…¶å®å¯ä»¥é€šè¿‡çº¦å®šæ•°æ®æ ¼å¼é¿å…æ‰å»å†™è¿™äº›é¸¡è‚‹çš„å‡½æ•°ï¼Œäº‹å®ä¸Šä½ å¯ä»¥ç”¨é€šç”¨å‡½æ•°æ¥ä»£æ›¿ä»–ä»¬ã€‚é¢å¯¹é€šå¸¸çš„å•é¡µé¢åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡è®¾è®¡å”¯ä¸€çš„ SceneKey éš”ç¦»æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;Redux å’Œ React æ˜¯æ²¡æœ‰å¿…ç„¶å…³ç³»çš„ï¼ŒRedux ç”¨äºç®¡ç† stateï¼Œä¸å…·ä½“çš„ View æ¡†æ¶æ— å…³ã€‚ä½¿ç”¨ React / React Native å¯ä»¥ä½¿ç”¨ &lt;a href=&quot;https://github.com/rackt/react-redux/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;react-redux&lt;/a&gt; æ¥ç»‘å®š Reactã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-3-JSX-å’Œæ ·å¼&quot;&gt;&lt;a href=&quot;#3-3-JSX-å’Œæ ·å¼&quot; class=&quot;headerlink&quot; title=&quot;3.3 JSX å’Œæ ·å¼&quot;&gt;&lt;/a&gt;3.3 JSX å’Œæ ·å¼&lt;/h4&gt;&lt;p&gt;JSX è¯­æ³•ï¼Œåƒæ˜¯åœ¨ JavaScript ä»£ç é‡Œç›´æ¥å†™ XML çš„è¯­æ³•ï¼Œå®è´¨ä¸Šè¿™åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚ä¸”ç›®å‰ WebStorm ç­‰ IDE å¯¹ JSX æ”¯æŒéå¸¸å®Œå–„ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ JSX å’Œ css æ¥å®ç°åŸç”Ÿ UI çš„å¸ƒå±€æ ·å¼ï¼Œç®€ç›´æ˜¯ä¸€ä¸ªå¤©æ‰çš„æƒ³æ³•ï¼Œæå¤§çš„ç®€åŒ–äº†åŸç”Ÿå¼€å‘çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;render () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &amp;#123; text &amp;#125; = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Text&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;text&amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;Text&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;&amp;gt;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-4-åŒåˆƒå‰‘&quot;&gt;&lt;a href=&quot;#3-4-åŒåˆƒå‰‘&quot; class=&quot;headerlink&quot; title=&quot;3.4 åŒåˆƒå‰‘&quot;&gt;&lt;/a&gt;3.4 åŒåˆƒå‰‘&lt;/h4&gt;&lt;p&gt;è¯´èµ·æ¥ React Native ç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼æ˜“äºå¤ç”¨ï¼Œæœ‰ç€éå¸¸å¿«é€Ÿçš„å¼€å‘ä½“éªŒï¼ŒReact ç¤¾åŒºä¹Ÿéå¸¸æˆç†Ÿç­‰ã€‚ä¸å¯å¦è®¤ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç›®å‰ç‰ˆæœ¬ä¸å¤Ÿç¨³å®šï¼Œç›®å‰çœ‹è·ç¦»ç¨³å®šç‰ˆè¿˜æœ‰å¾ˆè¿œçš„è·¯è¦èµ°ï¼Œå°¤å…¶åœ¨ Android ç«¯ï¼›å¦å¤–æ€§èƒ½ç›¸å¯¹åŸç”Ÿè¾ƒå·®ç­‰ã€‚æˆ‘ç›®å‰å¯¹å®ƒçš„è¯„ä»·æ˜¯ï¼šä¸ä¼šæˆä¸ºå¼€å‘ä¸»æµï¼Œä½†äº¦ä¼šåœ¨ç¤¾åŒºåŠ›é‡ä¸‹å¿«é€Ÿæˆé•¿ï¼Œå‰é€”å‘¢ï¼Œæœªåœã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœä½ ä½œä¸ºåŸç”Ÿå¼€å‘äººå‘˜è¦ä» React Native å…¥é—¨å‰ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªååˆ†ä¸é”™çš„é€‰æ‹©ï¼Œç”±äºç›¸åŒçš„æŠ€æœ¯æ ˆï¼Œå­¦ä¼šReact Native åŸºæœ¬å…è´¹èµ é€ Reactã€‚Learn once, write anywhere. &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹ &lt;code&gt;React Native&lt;/code&gt; çš„å­¦ä¹ å’Œå¼€å‘æœ‰åŠå¹´å¤šçš„æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ä¸Šæˆ‘è§‰å¾—å¯ä»¥ç²—æµ…çš„é˜è¿°ä¸‹æˆ‘ç†è§£çš„ &lt;code&gt;React Native&lt;/code&gt; æ˜¯æ€æ ·çš„ä¸€ç§æŠ€æœ¯æ ˆä»¥åŠæˆ‘å¯¹å®ƒçš„ä¸€äº›çœ‹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€DOM-ä¸-JavaScript&quot;&gt;&lt;a href=&quot;#1ã€DOM-ä¸-JavaScript&quot; class=&quot;headerlink&quot; title=&quot;1ã€DOM ä¸ JavaScript&quot;&gt;&lt;/a&gt;1ã€DOM ä¸ JavaScript&lt;/h2&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ &lt;code&gt;DOM (Document Object Model)&lt;/code&gt; æ˜¯æ“ä½œHTML/XMLæ–‡æ¡£çš„ä¸€ç»„æ¥å£ï¼Œå¤§å®¶ç†ŸçŸ¥çš„ Web äº¤äº’ï¼Œå°±æ˜¯ç”± JavaScript æ“ä½œ DOM å®Œæˆçš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;Title&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;This is a paragraph&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;1-1-DOM-çš„ç¼ºé™·&quot;&gt;&lt;a href=&quot;#1-1-DOM-çš„ç¼ºé™·&quot; class=&quot;headerlink&quot; title=&quot;1.1 DOM çš„ç¼ºé™·&quot;&gt;&lt;/a&gt;1.1 DOM çš„ç¼ºé™·&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç›´æ¥æ“ä½œ DOM çš„æ¥å£ä¸æ–¹ä¾¿&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤§é‡çš„å…¼å®¹æ€§ä»£ç ï¼ˆé’ˆå¯¹ä¸åŒçš„æµè§ˆå™¨å¹³å°æˆ–ç‰ˆæœ¬ï¼‰&lt;/li&gt;
&lt;li&gt;æ€§èƒ½è¾ƒå·®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ—©æœŸçš„ Web é¡µé¢ç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ï¼Œè¿™ä¸ DOM æœ¬èº«çš„ç¼ºé™·æœ‰ç€ä¸€å®šçš„å…³ç³»ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ€»éœ€è¦å°†å˜åŒ–çš„æ•°æ®å®æ—¶ååº”åˆ° UI ä¸Šï¼Œè¿™æ—¶å°±éœ€è¦å¯¹ DOM è¿›è¡Œæ“ä½œï¼Œé™¤äº†æ“ä½œä¸ä¾¿å’Œéœ€è¦å¤§é‡çš„å…¼å®¹ä»£ç å¤–ï¼Œé¢‘ç¹æˆ–å¤æ‚çš„ DOM æ“ä½œé€šå¸¸ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆäº§ç”Ÿçš„åŸå› ï¼Œç›´åˆ°ä»¥ &lt;code&gt;JQuery&lt;/code&gt; ä¸ºä»£è¡¨çš„ç¬¬ä¸‰æ–¹æ¡†è¯ç”Ÿæ‰è§£å†³äº†å¤§å¤šæ•°çš„å¼€å‘ç—›ç‚¹ï¼Œä½†ä¾ç„¶è¾¾ä¸åˆ°æ¡Œé¢çº§çš„å¼€å‘ä½“éªŒã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-2-JavaScript-çš„æˆé•¿&quot;&gt;&lt;a href=&quot;#1-2-JavaScript-çš„æˆé•¿&quot; class=&quot;headerlink&quot; title=&quot;1.2 JavaScript çš„æˆé•¿&quot;&gt;&lt;/a&gt;1.2 JavaScript çš„æˆé•¿&lt;/h4&gt;&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œç”±äº JavaScript è®¾è®¡é˜¶æ®µè¿‡äºä»“ä¿ƒï¼ˆæ®è¯´è®¾è®¡è€… &lt;a href=&quot;https://en.wikipedia.org/wiki/Brendan_Eich&quot;&gt;Brendan Eich&lt;/a&gt; ä»…ä»…ç”¨äº†åå¤©ï¼‰ï¼Œè®¾è®¡å¹¶ä¸å®Œå–„ï¼Œç”šè‡³æœ‰äººæ€»ç»“äº† JavaScript çš„ 10 ä¸ªè®¾è®¡ç¼ºé™·ï¼Œè€Œè¿™äº›ç¼ºé™·æœ¬èº«å¹¶æ²¡æœ‰æ‰¼ä½å®ƒçš„å‘å±•ï¼Œéšç€ &lt;code&gt;ES 5&lt;/code&gt;ã€&lt;code&gt;ES 6&lt;/code&gt; çš„ç›¸ç»§å‘å¸ƒ JavaScript è¢«è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…è®¤å¯ã€‚é™¤äº†ä½œä¸º Web ç«¯å¼€å‘çš„ä¸äºŒé€‰æ‹©ï¼Œè¿˜è¢«æ‹“å±•åˆ°åç«¯å¼€å‘ &lt;a href=&quot;https://nodejs.org/&quot;&gt;&lt;code&gt;Node.js&lt;/code&gt;&lt;/a&gt;ï¼Œ2016 å¹´ç”šè‡³è¢«ç§°ä¸ºå¤§å‰ç«¯å…ƒå¹´ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€å‰ç«¯æ¡†æ¶-React&quot;&gt;&lt;a href=&quot;#2ã€å‰ç«¯æ¡†æ¶-React&quot; class=&quot;headerlink&quot; title=&quot;2ã€å‰ç«¯æ¡†æ¶ React&quot;&gt;&lt;/a&gt;2ã€å‰ç«¯æ¡†æ¶ React&lt;/h2&gt;&lt;p&gt;éšç€åŸºäº HTML çš„å‰ç«¯ç•Œé¢å¼€å‘å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒFacebook æ¨å‡ºçš„ React æ¡†æ¶åº”è¿è€Œç”Ÿã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://solart.cc/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>stardard JS ä»£ç è§„èŒƒåŠ pre-commit hook</title>
    <link href="http://solart.cc/2017/03/18/stardard_js/"/>
    <id>http://solart.cc/2017/03/18/stardard_js/</id>
    <published>2017-03-18T14:08:55.000Z</published>
    <updated>2017-03-23T06:09:57.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»Šå¤©ä¸»è¦å®‰åˆ©ä¸€ä¸ª JavaScript ä»£ç è§„èŒƒ &lt;a href=&quot;http://standardjs.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;standard js&lt;/a&gt; ï¼Œä¸è®ºä½ ä¸€å¼€å§‹å–œä¸å–œæ¬¢è¿™ä¸ªæ ‡å‡†ï¼Œç›¸ä¿¡æˆ‘å¼€ä½¿ç”¨å®ƒï¼Œä½ ä¼šçˆ±ä¸Šè¿™ä¸ªæ ‡å‡†ï¼&lt;/p&gt;
&lt;h2 id=&quot;1ã€åºè¨€&quot;&gt;&lt;a href=&quot;#1ã€åºè¨€&quot; class=&quot;headerlink&quot; title=&quot;1ã€åºè¨€&quot;&gt;&lt;/a&gt;1ã€åºè¨€&lt;/h2&gt;&lt;p&gt;æ˜¯çš„æœ€è¿‘å›¢é˜Ÿä¸€ç›´åœ¨ &lt;code&gt;React Native&lt;/code&gt; ä¸Šè¿›è¡Œæ¢ç´¢æ€§ä¸šåŠ¡å¼€å‘ï¼Œåœ¨å›¢é˜Ÿé¡¹ç›®çš„åˆä½œä¸­ä»£ç è§„èŒƒå¯¹äºæˆ‘ä»¬æ˜¯ä¸€ä¸ªç›¸å½“é‡è¦çš„ç´ è´¨è¦æ±‚ï¼Œå¯¹äºæ³¨é‡ä»£ç è´¨é‡æ³¨é‡ä»£ç å¯è¯»æ€§çš„å›¢é˜Ÿå°¤å…¶é‡è¦ã€‚ç”±äºç¼ºä¹ä»£ç è§„èŒƒï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„åå¥½ï¼Œä»£ç å¯è¯»æ€§ä¼šéšç€å›¢é˜Ÿæˆå‘˜çš„æ›´è¿­é€æ¸é™ä½ï¼Œä¹Ÿå› ä¸ºè¿™æ ·æœ‰å¯èƒ½å¸¦æ¥çº¿ä¸Š bugï¼Œè€Œè¿™äº›å®Œå…¨æ˜¯å¯ä»¥é€šè¿‡ä»£ç æ£€æŸ¥é¿å…çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot;&gt;&lt;a href=&quot;#2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot; class=&quot;headerlink&quot; title=&quot;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot;&gt;&lt;/a&gt;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&lt;/h2&gt;&lt;p&gt; &lt;code&gt;å¼ºåˆ¶&lt;/code&gt;ä¸¤ä¸ªå­—æ˜¯å¥½è¯´ä¸å¥½å¬ï¼Œè°ä¹Ÿä¸æ„¿æ„è¢«å¼ºåˆ¶è¦æ±‚è¿™æ ·é‚£æ ·ï¼Œä½†è¿™ä¸ªäº‹æƒ…æˆ‘è§‰å¾—æ‡‚çš„äººè‡ªç„¶æ‡‚ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå›¢é˜Ÿåˆä½œå°±åº”è¯¥é‡‡ç”¨ç›¸åŒçš„è§„èŒƒï¼Œä¸åŒçš„äººå†™çš„ä»£ç åº”è¯¥çœ‹èµ·æ¥æ˜¯å‡ºè‡ªåŒä¸€ä¸ªäººä¹‹æ‰‹ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;2-1-ä¸ºä»€ä¹ˆé€‰æ‹©-stardard-ä½œä¸º-js-ä»£ç è§„èŒƒ&quot;&gt;&lt;a href=&quot;#2-1-ä¸ºä»€ä¹ˆé€‰æ‹©-stardard-ä½œä¸º-js-ä»£ç è§„èŒƒ&quot; class=&quot;headerlink&quot; title=&quot;2.1 ä¸ºä»€ä¹ˆé€‰æ‹© stardard ä½œä¸º js ä»£ç è§„èŒƒ&quot;&gt;&lt;/a&gt;2.1 ä¸ºä»€ä¹ˆé€‰æ‹© stardard ä½œä¸º js ä»£ç è§„èŒƒ&lt;/h4&gt;&lt;p&gt;é¢å¯¹å„ç§å„æ ·çš„ &lt;code&gt;js&lt;/code&gt; ä»£ç è§„èŒƒæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿåœ¨æ¯”è¾ƒäº† &lt;a href=&quot;https://github.com/feross/standard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;standard&lt;/a&gt;ã€&lt;a href=&quot;https://github.com/airbnb/javascript&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;airbnb&lt;/a&gt;ã€&lt;a href=&quot;https://github.com/rwaldron/idiomatic.js/tree/master/translations/zh_CN&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Idiomatic.js&lt;/a&gt;ã€&lt;a href=&quot;https://contribute.jquery.org/style-guide/js/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;jQuery&lt;/a&gt; &lt;a href=&quot;http://noeticforce.com/best-javascript-style-guide-for-maintainable-code&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç­‰ js ä»£ç è§„èŒƒå&lt;/a&gt; ï¼ŒæåŠ›æ¨èæŠŠ &lt;a href=&quot;https://github.com/feross/standard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;standard&lt;/a&gt; ä½œä¸ºå›¢é˜Ÿçš„ &lt;code&gt;js&lt;/code&gt; ä»£ç æ ‡å‡†ï¼Œä¸»è¦å› ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®€å•ï¼Œæ— éœ€é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ç¬¦åˆè§„åˆ™çš„ä»£ç ç›¸å¯¹æ¯”è¾ƒç®€æ´ï¼ˆæ¯”å¦‚è¯­å¥ä¸éœ€è¦åˆ†å·ï¼‰&lt;/li&gt;
&lt;li&gt;å¯ä»¥è‡ªåŠ¨ä¿®æ­£ä»£ç æ ·å¼ï¼ˆé€šè¿‡ &lt;code&gt;--fix&lt;/code&gt; å‚æ•°ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“ç„¶è¿˜æœ‰ä¸€ç‚¹ï¼Œstardard çš„é‡ç‚¹å°±æ˜¯åœ¨äºé¿å…é‚£äº›å¯¹äºç¼–ç é£æ ¼æ°¸è¿œä¸ä¼šæœ‰ç­”æ¡ˆçš„äº‰è®®ä¸Šã€‚å®ƒä¸å…è®¸ä½ è‡ªå·±ä¿®æ”¹æŸäº›è§„åˆ™ï¼Œå°±æ˜¯è¿™ä¹ˆç²—æš´ï¼Œæ‰€ä»¥æŠŠæ—¶é—´èŠ±åœ¨é‚£äº›çœŸæ­£è¯¥è§£å†³çš„é—®é¢˜ä¸Šå§ï¼&lt;/p&gt;
&lt;h4 id=&quot;2-2-ä¸€äº›ä¸»è¦çš„è§„åˆ™&quot;&gt;&lt;a href=&quot;#2-2-ä¸€äº›ä¸»è¦çš„è§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;2.2 ä¸€äº›ä¸»è¦çš„è§„åˆ™&quot;&gt;&lt;/a&gt;2.2 ä¸€äº›ä¸»è¦çš„è§„åˆ™&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç”¨2ä¸ªç©ºæ ¼ç¼©è¿›&lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²ç”¨å•å¼•å·ï¼Œé™¤éå­—ç¬¦ä¸²é‡Œæœ‰å•å¼•å·&lt;/li&gt;
&lt;li&gt;ä¸èƒ½æœ‰æœªä½¿ç”¨çš„å˜é‡ï¼Œè¿™æ˜¯å¾ˆå¤š bug çš„æ¥æº&lt;/li&gt;
&lt;li&gt;è¯­å¥ç»“æŸä¸éœ€è¦åˆ†å·ï¼Œå¯ä»¥å°‘äº›ä¸å°‘å­—ç¬¦ &lt;a href=&quot;http://blog.izs.me/post/2353458699/an-open-letter-to-javascript-leaders-regarding&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Itâ€™s&lt;/a&gt; &lt;a href=&quot;http://inimino.org/~inimino/blog/javascript_semicolons&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;fine.&lt;/a&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=gsfbh17Ax9I&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Really!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸è¦ä»¥ &lt;code&gt;(&lt;/code&gt;, &lt;code&gt;[&lt;/code&gt;, or ``` å¼€å¤´ï¼Œè¿™æ˜¯ä»…æœ‰çš„ç¼ºå°‘åˆ†å·å¯èƒ½å¸¦æ¥é—®é¢˜çš„åœ°æ–¹ï¼Œstandard js ä¼šå¸®ä½ è‡ªåŠ¨æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;å…³é”®å­—åé¢åŠ ç©ºæ ¼ &lt;code&gt;if (condition) { ... }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å‡½æ•°ååé¢åŠ ç©ºæ ¼ &lt;code&gt;function name (arg) { ... }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ°¸è¿œä½¿ç”¨ &lt;code&gt;===&lt;/code&gt; ä»£æ›¿ &lt;code&gt;==&lt;/code&gt;ï¼Œä½† &lt;code&gt;obj == null&lt;/code&gt; æ˜¯å…è®¸çš„ï¼Œç”¨æ¥æ£€æŸ¥ &lt;code&gt;null || undefined&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;æ°¸è¿œå¤„ç†é”™è¯¯ nodejs ç±»å‹çš„é”™è¯¯ &lt;code&gt;function(err) {}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æµè§ˆå™¨å…¨å±€å˜é‡æ°¸è¿œåŠ ä¸Š &lt;code&gt;window&lt;/code&gt;ï¼Œ&lt;code&gt;document&lt;/code&gt; å’Œ &lt;code&gt;navigator&lt;/code&gt; é™¤å¤–&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹&lt;a href=&quot;https://github.com/feross/standard/blob/master/RULES.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ›´å¤šè§„åˆ™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;3ã€pre-commit-hook&quot;&gt;&lt;a href=&quot;#3ã€pre-commit-hook&quot; class=&quot;headerlink&quot; title=&quot;3ã€pre-commit hook&quot;&gt;&lt;/a&gt;3ã€pre-commit hook&lt;/h2&gt;&lt;p&gt;ä¸ç®¡æ˜¯ä»€ä¹ˆè§„èŒƒå¾—ä¸åˆ°æœ‰æ•ˆçš„æ‰§è¡Œé‚£éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰ï¼Œåªé è‹¦å£å©†å¿ƒçš„å¼ºè°ƒå¾ˆéš¾ç¡®ä¿æ‰€æœ‰äººéƒ½èƒ½å®Œå…¨æŒ‰ç…§è§„èŒƒæ‰§è¡Œï¼Œæˆ‘ä»¬æ˜¯ä»€ä¹ˆäººï¼ŒæŠ€æœ¯å·¥ç§è€¶ï¼Œèƒ½ç”¨æŠ€æœ¯æ‰‹æ®µçš„è§£å†³çš„é—®é¢˜æˆ‘ä»¬ä»æ¥ä¸æµªè´¹å˜´çš®å­ã€‚åˆ©ç”¨ Git æä¾›çš„ pre-commit hook å¯ä»¥å¾ˆå¥½çš„ç¡®ä¿åœ¨æäº¤ä»£ç æ—¶è¿›è¡Œè§„èŒƒæ€§æ£€æŸ¥ï¼Œä»è€Œä¼˜é›…çš„ä¿è¯äº†è‡ªå·±çš„ä½“é¢ï¼ˆéª„å‚²è„¸ï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/sh&amp;#10;# Ensure all javascript files staged for commit pass standard code style&amp;#10;git diff --name-only --cached --relative | grep &amp;#34;\.jsx\?$&amp;#34; | xargs standard --verbose | snazzy&amp;#10;if [ $? -ne 0 ]; then exit 1; fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶ä½äº&lt;code&gt;.git/hooks/pre-commit&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;standard&lt;/code&gt; å’Œ &lt;code&gt;snazzy&lt;/code&gt; éœ€è¦é€šè¿‡ npm å…¨å±€å®‰è£… &lt;code&gt;npm install -g standard snazzy&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;pre-commit æ–‡ä»¶å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹è„šæœ¬è‡ªåŠ¨åˆ›å»ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/sh&amp;#10;if [ &amp;#34;`which standard`&amp;#34; = &amp;#34;&amp;#34; ]; then&amp;#10;    npm install standard -g&amp;#10;fi&amp;#10;&amp;#10;if [ &amp;#34;`which snazzy`&amp;#34; = &amp;#34;&amp;#34; ]; then&amp;#10;    npm install snazzy -g&amp;#10;fi&amp;#10;&amp;#10;hookDir=./.git/hooks&amp;#10;if [ ! -d $hookDir ]; then&amp;#10;    mkdir -p $hookDir&amp;#10;fi&amp;#10;&amp;#10;echo &amp;#39;#!/usr/bin/env bash&amp;#10;&amp;#10;# Ensure all javascript files staged for commit pass standard code style&amp;#10;if [ &amp;#34;$CHECK&amp;#34; = &amp;#34;0&amp;#34; ]; then&amp;#10;&amp;#9;echo &amp;#34;ignore pre commit check&amp;#34;&amp;#10;&amp;#9;exit&amp;#10;fi&amp;#10;&amp;#10;git diff --name-only --cached --relative | grep &amp;#34;\.jsx\?$&amp;#34; | xargs standard --verbose | snazzy&amp;#10;&amp;#10;if [ $? -ne 0 ]; then exit 1; fi&amp;#10;&amp;#39; &amp;#62; .git/hooks/pre-commit&amp;#10;&amp;#10;chmod +x .git/hooks/pre-commit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;4ã€å…¶ä»–&quot;&gt;&lt;a href=&quot;#4ã€å…¶ä»–&quot; class=&quot;headerlink&quot; title=&quot;4ã€å…¶ä»–&quot;&gt;&lt;/a&gt;4ã€å…¶ä»–&lt;/h2&gt;&lt;p&gt;å¦‚æœä½ éœ€è¦å¿½ç•¥æŸäº›æ–‡ä»¶çš„ä»£ç æ£€æŸ¥ï¼Œä½ å¯ä»¥åœ¨ &lt;code&gt;package.json&lt;/code&gt; ä¸­è¿›è¡Œç®€å•çš„é…ç½®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&quot;standard&quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;ignore&quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &quot;/node_modules&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;globals&quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &quot;__DEV__&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &quot;fetch&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚æœä½ åœ¨ä½¿ç”¨ &lt;code&gt;WebStorm&lt;/code&gt; çš„è¯æ¨èä½ é€šè¿‡ &lt;code&gt;Eslint&lt;/code&gt; è¿›è¡Œé™æ€ä»£ç æ£€æŸ¥ï¼Œé…ç½®éå¸¸ç®€å•ï¼ŒåŒæ ·å¯ä»¥åœ¨ &lt;code&gt;package.json&lt;/code&gt; ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&quot;devDependencies&quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint&quot;: &quot;^3.15.0&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint-config-standard&quot;: &quot;^6.2.1&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint-plugin-promise&quot;: &quot;^3.4.1&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint-plugin-standard&quot;: &quot;^2.0.1&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint-config-standard-jsx&quot;: &quot;^3.3.0&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;eslint-plugin-react&quot;:&quot;^6.10.0&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œ &lt;code&gt;npm install&lt;/code&gt; å®‰è£…è¿™äº›ä¾èµ–ï¼Œç„¶ååœ¨è®¾ç½®ä¸­å¼€å¯ &lt;code&gt;Eslint&lt;/code&gt; å³å¯ï¼ˆ&lt;code&gt;Languages &amp;amp; Frameworks &amp;gt; JavaScript &amp;gt; Code Quality Tools &amp;gt; Eslint&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„å›¢é˜Ÿä¸­è¿˜æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„ä»£ç è§„èŒƒï¼Œäº¦æˆ–æƒ³æ›¿æ¢ä¸€ä¸ªæ›´é€‚åˆçš„ä»£ç è§„èŒƒï¼Œ &lt;a href=&quot;http://standardjs.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;standard js&lt;/a&gt; ç»å¯¹æ˜¯ä¸äºŒä¹‹é€‰ï¼Œç”¨èµ·æ¥å§ï¼&lt;/p&gt;
&lt;p&gt;â†“â†“â†“ update 2017.03.23&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æŠŠ &lt;code&gt;WebStorm&lt;/code&gt; ç‰ˆæœ¬å‡çº§åˆ°äº† &lt;code&gt;2017.1&lt;/code&gt; ï¼Œå‘ç° &lt;code&gt;WebStorm&lt;/code&gt; å®˜æ–¹å·²ç»åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­åŠ å…¥äº† &lt;code&gt;stardard code style&lt;/code&gt; ï¼Œç”¨èµ·æ¥æ›´åŠ ç®€å•æ–¹ä¾¿äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆç†ç”±ä¸ç”¨èµ·æ¥å‘¢ï¼Ÿ&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»Šå¤©ä¸»è¦å®‰åˆ©ä¸€ä¸ª JavaScript ä»£ç è§„èŒƒ &lt;a href=&quot;http://standardjs.com/&quot;&gt;standard js&lt;/a&gt; ï¼Œä¸è®ºä½ ä¸€å¼€å§‹å–œä¸å–œæ¬¢è¿™ä¸ªæ ‡å‡†ï¼Œç›¸ä¿¡æˆ‘å¼€ä½¿ç”¨å®ƒï¼Œä½ ä¼šçˆ±ä¸Šè¿™ä¸ªæ ‡å‡†ï¼&lt;/p&gt;
&lt;h2 id=&quot;1ã€åºè¨€&quot;&gt;&lt;a href=&quot;#1ã€åºè¨€&quot; class=&quot;headerlink&quot; title=&quot;1ã€åºè¨€&quot;&gt;&lt;/a&gt;1ã€åºè¨€&lt;/h2&gt;&lt;p&gt;æ˜¯çš„æœ€è¿‘å›¢é˜Ÿä¸€ç›´åœ¨ &lt;code&gt;React Native&lt;/code&gt; ä¸Šè¿›è¡Œæ¢ç´¢æ€§ä¸šåŠ¡å¼€å‘ï¼Œåœ¨å›¢é˜Ÿé¡¹ç›®çš„åˆä½œä¸­ä»£ç è§„èŒƒå¯¹äºæˆ‘ä»¬æ˜¯ä¸€ä¸ªç›¸å½“é‡è¦çš„ç´ è´¨è¦æ±‚ï¼Œå¯¹äºæ³¨é‡ä»£ç è´¨é‡æ³¨é‡ä»£ç å¯è¯»æ€§çš„å›¢é˜Ÿå°¤å…¶é‡è¦ã€‚ç”±äºç¼ºä¹ä»£ç è§„èŒƒï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„åå¥½ï¼Œä»£ç å¯è¯»æ€§ä¼šéšç€å›¢é˜Ÿæˆå‘˜çš„æ›´è¿­é€æ¸é™ä½ï¼Œä¹Ÿå› ä¸ºè¿™æ ·æœ‰å¯èƒ½å¸¦æ¥çº¿ä¸Š bugï¼Œè€Œè¿™äº›å®Œå…¨æ˜¯å¯ä»¥é€šè¿‡ä»£ç æ£€æŸ¥é¿å…çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot;&gt;&lt;a href=&quot;#2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot; class=&quot;headerlink&quot; title=&quot;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&quot;&gt;&lt;/a&gt;2ã€æ˜¯æ—¶å€™å¼ºåˆ¶è¦æ±‚ä»£ç è§„èŒƒäº†&lt;/h2&gt;&lt;p&gt; &lt;code&gt;å¼ºåˆ¶&lt;/code&gt;ä¸¤ä¸ªå­—æ˜¯å¥½è¯´ä¸å¥½å¬ï¼Œè°ä¹Ÿä¸æ„¿æ„è¢«å¼ºåˆ¶è¦æ±‚è¿™æ ·é‚£æ ·ï¼Œä½†è¿™ä¸ªäº‹æƒ…æˆ‘è§‰å¾—æ‡‚çš„äººè‡ªç„¶æ‡‚ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå›¢é˜Ÿåˆä½œå°±åº”è¯¥é‡‡ç”¨ç›¸åŒçš„è§„èŒƒï¼Œä¸åŒçš„äººå†™çš„ä»£ç åº”è¯¥çœ‹èµ·æ¥æ˜¯å‡ºè‡ªåŒä¸€ä¸ªäººä¹‹æ‰‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://solart.cc/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>React Nativeæ‹†åŒ…åŠçƒ­æ›´æ–°æ–¹æ¡ˆ</title>
    <link href="http://solart.cc/2017/02/22/react-native-jsbundle-patch/"/>
    <id>http://solart.cc/2017/02/22/react-native-jsbundle-patch/</id>
    <published>2017-02-22T06:25:55.000Z</published>
    <updated>2017-03-11T03:20:53.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€ &lt;code&gt;React Native&lt;/code&gt; çš„ä¸æ–­å‘å±•å®Œå–„ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸é€‰æ‹©ä½¿ç”¨ &lt;code&gt;React Native&lt;/code&gt; æ›¿ä»£ &lt;code&gt;iOS/Android&lt;/code&gt; è¿›è¡Œéƒ¨åˆ†ä¸šåŠ¡çº¿çš„å¼€å‘ï¼Œä¹Ÿæœ‰ä¸å°‘ä½¿ç”¨ &lt;code&gt;Hybrid&lt;/code&gt; æŠ€æœ¯çš„å…¬å¸è½¬å‘äº† &lt;code&gt;React Native&lt;/code&gt; ã€‚è¦è¯´ &lt;code&gt;React Native&lt;/code&gt; æœ€èƒ½å¸å¼•å¼€å‘è€…çš„åœ°æ–¹é‚£å°±æ˜¯å…¶æ‹¥æœ‰å‰ç«¯çš„å¼€å‘é€Ÿåº¦ä»¥åŠåŸç”Ÿçš„ä½“éªŒã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€åºè¨€&quot;&gt;&lt;a href=&quot;#1ã€åºè¨€&quot; class=&quot;headerlink&quot; title=&quot;1ã€åºè¨€&quot;&gt;&lt;/a&gt;1ã€åºè¨€&lt;/h2&gt;&lt;p&gt;ä»Šå¤©è¦è·Ÿå¤§å®¶æ¢è®¨çš„æ˜¯ &lt;code&gt;React Native&lt;/code&gt; çš„æ‹†åŒ…åŠçƒ­æ›´æ–°æ–¹æ¡ˆï¼Œå®˜æ–¹å¹¶æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒè¿™ä¸€ä¼ä¸šååˆ†çœ‹ä¸­çš„çƒ­æ›´æ–°èƒ½åŠ›ï¼Œå› æ­¤ä¹Ÿå‚¬ç”Ÿäº†ç¬¬ä¸‰æ–¹çš„çƒ­æ›´æ–°æ–¹æ¡ˆï¼Œå¦‚ &lt;a href=&quot;https://microsoft.github.io/code-push/docs/react-native.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CodePush&lt;/a&gt; ã€ &lt;a href=&quot;https://github.com/reactnativecn/react-native-pushy&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;react-native-pushy&lt;/a&gt; ã€‚ç”±äºå…¬å¸å†…éƒ¨æœ‰ä¸åŒçš„ä¸šåŠ¡çº¿ï¼Œæ‰€ä»¥åœ¨é‡‡ç”¨ç¬¬ä¸‰æ–¹çš„çƒ­æ›´æ–°æ–¹æ¡ˆçµæ´»åº¦ä¸å¤Ÿï¼Œåœ¨è°ƒç ”çš„åˆæœŸï¼Œæˆ‘ä»¬å‚è€ƒäº†æºç¨‹çš„æåˆ°çš„ &lt;code&gt;jsbundle&lt;/code&gt; &lt;a href=&quot;https://zhuanlan.zhihu.com/p/23715716&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ‹†åˆ†å’ŒåŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ&lt;/a&gt;ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ”¹å˜ &lt;code&gt;React Native&lt;/code&gt; çš„æ‰“åŒ…ä»£ç åŠ &lt;code&gt;Runtime&lt;/code&gt; ä»£ç ï¼Œå®æ–½éš¾åº¦ä¸Šéå¸¸å¤§ï¼Œæš‚æ— ç²¾åŠ›æ·±å…¥ç ”ç©¶ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆå¯¹åŠ è½½é€Ÿåº¦æå‡ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚æˆ‘ä»¬æš‚æ—¶æ”¾å¼ƒäº†æºç¨‹çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å‰æœŸéœ€è¦ä¸€å¥—ç›¸å¯¹ç®€å•ç¨³å®šä¸”å¯è¡Œåº¦é«˜çš„æ–¹æ¡ˆï¼Œåœ¨ç»è¿‡è°ƒç ”åŠè®¨è®ºåå®šä¸‹äº†è¿™æ ·ä¸€å¥—çƒ­æ›´æ–¹æ¡ˆï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™ä¸ªæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;2ã€æµç¨‹æ¢³ç†&quot;&gt;&lt;a href=&quot;#2ã€æµç¨‹æ¢³ç†&quot; class=&quot;headerlink&quot; title=&quot;2ã€æµç¨‹æ¢³ç†&quot;&gt;&lt;/a&gt;2ã€æµç¨‹æ¢³ç†&lt;/h2&gt;&lt;p&gt;ç”±äºå­˜åœ¨å¤šæ¡ä¸šåŠ¡çº¿å¼€å‘ï¼Œåˆå¸Œæœ›ä¸šåŠ¡çº¿ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œä½†æ˜¯å…¨é‡çš„ bundle æ–‡ä»¶åˆè¿‡äºåºå¤§ï¼ŒåŸºäºè¿™æ ·çš„è€ƒé‡ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨ä¸šåŠ¡ä»£ç ç‹¬ç«‹çƒ­æ›´çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“æµç¨‹å…¶å®éå¸¸ç®€å•ï¼Œä¸è¿‡å†…éƒ¨ä¸€äº›ç»†èŠ‚è§„åˆ™éœ€è¦ä»”ç»†æ¨æ•²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/rn_update_process.png&quot; alt=&quot;rn-update-process&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;3ã€çƒ­æ›´æ–°æ¨¡å—çš„å®ç°æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#3ã€çƒ­æ›´æ–°æ¨¡å—çš„å®ç°æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;3ã€çƒ­æ›´æ–°æ¨¡å—çš„å®ç°æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;3ã€çƒ­æ›´æ–°æ¨¡å—çš„å®ç°æ–¹æ¡ˆ&lt;/h2&gt;&lt;p&gt;å½“ä¸‹é€‰æ‹©ä½¿ç”¨ &lt;code&gt;React Native&lt;/code&gt; çš„é¡¹ç›®å¤§éƒ½æ˜¯åŸºäºåŸæœ‰é¡¹ç›®çš„åŸºç¡€ä¸Šè¿›è¡Œæ¥å…¥ï¼Œæ‰€ä»¥è¦è¾¾åˆ°ä¸Šçº¿çš„é¡¹ç›®çš„çŠ¶æ€è‡ªç„¶è¦å„æ–¹é¢éƒ½å‡†å¤‡å°±ç»ªï¼Œçƒ­æ›´æ–°å°±ä½œä¸ºåŸºå»ºå·¥ç¨‹ä¹‹ä¸€ã€‚ä»¥ä¸‹ä¸»è¦ä»¥ Android ç«¯ä¸ºä¾‹è¿›è¡Œé˜è¿°ï¼ŒiOS ç«¯æ–¹æ¡ˆåŸºæœ¬ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-jsbundle-çš„æ‹†åˆ†&quot;&gt;&lt;a href=&quot;#3-1-jsbundle-çš„æ‹†åˆ†&quot; class=&quot;headerlink&quot; title=&quot;3.1 jsbundle çš„æ‹†åˆ†&quot;&gt;&lt;/a&gt;3.1 jsbundle çš„æ‹†åˆ†&lt;/h4&gt;&lt;p&gt;å¯¹ &lt;code&gt;React Native&lt;/code&gt; çš„ä»£ç æ‰“åŒ…ç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶ï¼Œè¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œ&lt;code&gt;jsbundle&lt;/code&gt; çš„æ‹†åˆ†æ˜¯åŸºäºç”Ÿæˆçš„ &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶å¯ä»¥çœ‹æˆä¸¤éƒ¨åˆ†æ„æˆï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼šä¸€æ˜¯ &lt;code&gt;React Native&lt;/code&gt; åŒ…å«çš„çš„åŸºç¡€ç±»åº“ï¼Œä¸€æ˜¯å¼€å‘çš„ä¸šåŠ¡ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/jsbundle.png&quot; alt=&quot;jsbundle&quot;&gt;&lt;/p&gt;
&lt;p&gt;åŸºäº bundle æ–‡ä»¶çš„è¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®Œæ•´çš„ &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯ç”Ÿæˆ &lt;code&gt;common.bundle&lt;/code&gt; ï¼Œæ–°å»ºä¸€ä¸ª &lt;code&gt;blank.js&lt;/code&gt; æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­ä»…å¼•å…¥ &lt;code&gt;react&lt;/code&gt; åŠ &lt;code&gt;react native&lt;/code&gt; :&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡æ‰“åŒ…å‘½ä»¤ç¼–è¯‘æˆ &lt;code&gt;common.bundle&lt;/code&gt;  :&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;react-native bundle --entry-file blank.js --bundle-output ~/Desktop/common.bundle --platform android --dev false&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œæ‰“åŒ…å®Œæ•´çš„ &lt;code&gt;jsbundle&lt;/code&gt; ï¼Œè¿™å°†ä¼šåŒ…å«æ‰€æœ‰çš„åŸºç¡€ç±»åº“åŠä¸šåŠ¡ä»£ç ã€‚æé†’ä¸€å¥ä¿æŒ import çš„å…¬å…±æ¨¡å—ä¸€è‡´ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123; AppRegistry &amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//å…¶ä»–å¯¼å…¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ€åæ ¹æ® diff ç®—æ³•å°†ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œ diff æ‹†åˆ†ï¼Œç”±æ­¤ä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;*.diff&lt;/code&gt; çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚ &lt;code&gt;index.diff&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/indexdiff.png&quot; alt=&quot;diff&quot;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¼šå¾—åˆ°ä¸€ä¸ª &lt;code&gt;common.bundle&lt;/code&gt; çš„æ–‡ä»¶ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª &lt;code&gt;*.diff&lt;/code&gt; æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…³äº diff ç®—æ³•çš„ä½¿ç”¨ï¼Œè®°å¾—æœ‰å‡ ç¯‡æ–‡ç« ä¸­æ¨è &lt;a href=&quot;https://code.google.com/p/google-diff-match-patch/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;google-diff-match-patch&lt;/a&gt; ï¼Œè™½ç„¶ Google è¿™ä¸ªå¼€æºç‰ˆæœ¬åŒ…å«å¤šç§è¯­è¨€çš„å®ç°ï¼Œä½†ç”±äºæ˜¯åŸºäºçº¯æ–‡æœ¬çš„ diff æ‰€ä»¥åœ¨å½“ä¸‹è¿™ä¸ªåœºæ™¯ä¸‹å¹¶ä¸ååˆ†åˆé€‚ï¼Œæˆ‘è¿˜æ˜¯æ¨èå¤§å®¶ä½¿ç”¨åŸºäºäºŒè¿›åˆ¶çš„ diff ï¼Œåœ¨æ­¤ä¹Ÿæ¨èå¦ä¸€ç§ java ç‰ˆæœ¬çš„ bsdiff çš„å®ç°ï¼š&lt;a href=&quot;https://github.com/jdesbonnet/jbdiff&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;jbdiff&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;3-2-bundle-æ–‡ä»¶çš„æ‹·è´åŠåˆæˆ&quot;&gt;&lt;a href=&quot;#3-2-bundle-æ–‡ä»¶çš„æ‹·è´åŠåˆæˆ&quot; class=&quot;headerlink&quot; title=&quot;3.2 bundle æ–‡ä»¶çš„æ‹·è´åŠåˆæˆ&quot;&gt;&lt;/a&gt;3.2 bundle æ–‡ä»¶çš„æ‹·è´åŠåˆæˆ&lt;/h4&gt;&lt;p&gt;åœ¨å®Œæˆæ‹†åˆ†ä»¥åï¼Œæˆ‘ä»¬éœ€è¦å°† &lt;code&gt;common.bundle&lt;/code&gt; åŠæ‹†åˆ†çš„ &lt;code&gt;*.diff&lt;/code&gt; æ–‡ä»¶è¿›è¡Œ &lt;code&gt;zip&lt;/code&gt; å‹ç¼©ï¼Œæ”¾å…¥ &lt;code&gt;assets&lt;/code&gt; ç›®å½•ä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†ï¼Œæˆ‘ä»¬å°†å…¶æ–‡ä»¶åä¸­å†™å…¥ç‰ˆæœ¬å· &lt;code&gt;jsbundle_&amp;lt;ç‰ˆæœ¬å·&amp;gt;.zip&lt;/code&gt; ï¼Œä¾‹å¦‚ï¼š&lt;code&gt;jsbundle_1.zip&lt;/code&gt; ï¼Œæ¯æ¬¡æ”¹ zip æ–‡ä»¶åŒ…è·Ÿéšå‘ç‰ˆæ—¶æ›´æ–°ï¼Œå¹¶è‡ªåŠ¨å‡çº§ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†å†…ç½®äº &lt;code&gt;assets&lt;/code&gt; ç›®å½•ä¸‹çš„ &lt;code&gt;jsbundle_*.zip&lt;/code&gt; æ‹·è´è‡³å†…éƒ¨å­˜å‚¨ï¼Œè¿™é‡Œä¸æ¨èä½¿ç”¨å¤–éƒ¨å­˜å‚¨ï¼Œå°½é‡é¿å…ç”¨æˆ·åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‹·è´è¿‡ç¨‹ä¸­æ ¹æ®å†å²è®°å½•çš„ç‰ˆæœ¬å·ï¼Œè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œæ‹·è´ï¼Œæ‹·è´å®Œæˆåå°† &lt;code&gt;common.bundle&lt;/code&gt; åŠ&lt;code&gt;*.diff&lt;/code&gt; æ–‡ä»¶è¿›è¡Œ &lt;code&gt;patch&lt;/code&gt; åˆå¹¶ï¼Œåˆå¹¶åçš„æ–‡ä»¶å³ä¸ºä¸€ä¸ªå®Œæ•´çš„ bundle æ–‡ä»¶ï¼Œæ–‡ä»¶åè§„å®šä¸º &lt;code&gt;*.diff.bundle&lt;/code&gt; ï¼Œä¾‹å¦‚ï¼š&lt;code&gt;index.diff.bundle&lt;/code&gt; ï¼Œåœ¨åŠ è½½æ—¶æ ¹æ®æ¨¡å—åè¿›è¡ŒåŠ è½½å³å¯ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-3-diff-æ–‡ä»¶çš„æ›´æ–°&quot;&gt;&lt;a href=&quot;#3-3-diff-æ–‡ä»¶çš„æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;3.3 diff æ–‡ä»¶çš„æ›´æ–°&quot;&gt;&lt;/a&gt;3.3 diff æ–‡ä»¶çš„æ›´æ–°&lt;/h4&gt;&lt;p&gt;è¯´åˆ°çƒ­æ›´æ–°ï¼Œåè€Œåœ¨å…³äº &lt;code&gt;*.diff&lt;/code&gt; æ–‡ä»¶çš„æ›´æ–°æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚åº¦ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸‹è½½æ›¿æ¢ &lt;code&gt;*.diff&lt;/code&gt; æ–‡ä»¶ï¼Œå¹¶åˆæˆæ–°çš„å®Œæ•´ &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶ï¼Œå…¶ä»–éœ€è¦æ³¨æ„çš„åˆ™æ˜¯å…³äº &lt;code&gt;diff&lt;/code&gt; æ–‡ä»¶ç‰ˆæœ¬çš„æ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–ä¸»è¦å·¥ä½œé‡åœ¨äº diff æ–‡ä»¶çš„ç”ŸæˆåŠä¸Šä¼ ï¼Œè¿™éƒ¨åˆ†å·¥ä½œé‡æœ€å¥½æ˜¯ä¸ä¾èµ–äºäººå·¥ï¼Œå¯ä»¥è€ƒè™‘ç¼–å†™ shell è„šæœ¬è‡ªåŠ¨å®Œæˆï¼Œä»¥ä¸‹æ‘˜å½•éƒ¨åˆ† packer.sh çš„æ‰“åŒ…ä»£ç ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if [ $platform == &amp;#34;android&amp;#34; ]; then&amp;#10;&amp;#9;react-native bundle \&amp;#10;        --entry-file $commonFile.js \&amp;#10;        --bundle-output $androidModuleDir/common.bundle \&amp;#10;        --platform android \&amp;#10;        --dev false&amp;#10;&amp;#10;    echo &amp;#34;common.bundle packed!!!&amp;#34;&amp;#10;&amp;#10;    react-native bundle \&amp;#10;        --entry-file $module.js \&amp;#10;        --bundle-output $androidModuleDir/$module.android.bundle \&amp;#10;        --platform android \&amp;#10;        --dev false&amp;#10;&amp;#10;    echo &amp;#34;$module.android.bundle packed!!!&amp;#34;&amp;#10;&amp;#10;    # &amp;#23545; jbdiff &amp;#25171;&amp;#25104;&amp;#30340; jar &amp;#25191;&amp;#34892;&amp;#25991;&amp;#20214;&amp;#10;    chmod +x dmp.jar &amp;#10;&amp;#10;    echo &amp;#34;diff start =========&amp;#62;&amp;#62;&amp;#62;&amp;#34;&amp;#10;    java -jar ./dmp.jar $androidModuleDir/common.bundle \&amp;#10;        $androidModuleDir/$module.android.bundle $androidModuleDir/$module.diff&amp;#10;    # &amp;#36827;&amp;#34892;&amp;#20108;&amp;#27425; zip &amp;#21387;&amp;#32553;&amp;#10;    zip -j $androidModuleDir/$module.diff.zip $androidModuleDir/$module.diff&amp;#10;elfi ...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-4-å¯¹äºå®¹å™¨-Activity-çš„æ”¹é€ &quot;&gt;&lt;a href=&quot;#3-4-å¯¹äºå®¹å™¨-Activity-çš„æ”¹é€ &quot; class=&quot;headerlink&quot; title=&quot;3.4 å¯¹äºå®¹å™¨ Activity çš„æ”¹é€ &quot;&gt;&lt;/a&gt;3.4 å¯¹äºå®¹å™¨ Activity çš„æ”¹é€ &lt;/h4&gt;&lt;p&gt;ç”±äºå¯¹äº &lt;code&gt;React Native&lt;/code&gt; çš„ bundle æ–‡ä»¶åŠ è½½åšäº†æ›´æ”¹ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨ sdk æä¾›çš„ &lt;code&gt;ReactActivity&lt;/code&gt; äº†ï¼Œå¯¹æ­¤æˆ‘ä»¬éœ€è¦å¯¹å®¹å™¨ Activity è¿›è¡Œæ”¹é€ ã€‚&lt;/p&gt;
&lt;p&gt;è€Œæ”¹é€ çš„æœ€ç»ˆè½è„šç‚¹å…¶å®æ˜¯ &lt;code&gt;ReactInstanceManager&lt;/code&gt; çš„æ„å»ºï¼Œç”±äºæˆ‘ä»¬éœ€è¦æŒ‰ä¸šåŠ¡æ¨¡å—åŠ è½½ï¼Œæ‰€ä»¥æœ€ç»ˆå°†å…¶è¿›è¡Œäº†éƒ¨åˆ†æ”¹é€ ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyReactNativeHost&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReactNativeHost&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyReactNativeHost&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Application application, String moduleName)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(application);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mApplication = application;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mModuleName = moduleName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; ReactInstanceManager &lt;span class=&quot;title&quot;&gt;createReactInstanceManager&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(getUseDeveloperSupport())&amp;#123; &lt;span class=&quot;comment&quot;&gt;//ä¸ºäº†ä¿ç•™ debug çš„èƒ½åŠ›&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.createReactInstanceManager();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String path = JSBundleManager.getJSBundleDirPath(mApplication)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .concat(mModuleName).concat(&lt;span class=&quot;string&quot;&gt;&quot;.diff.bundle&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ReactInstanceManager.Builder builder = ReactInstanceManager.builder()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setApplication(mApplication)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setJSBundleLoader(JSBundleLoader.createFileLoader(path))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; builder.build();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å°†æ”¹é€ åçš„ Activity å®¹å™¨ä¹Ÿè¦æ¥å…¥åŸæœ‰é¡¹ç›®çš„è·¯ç”±æ¡†æ¶ï¼ˆå¦‚æœé¡¹ç›®æœ¬èº«æœ‰çš„è¯ï¼‰ï¼Œè‡³æ­¤ï¼Œæ•´ä¸ªæ›´æ–°åŠ è½½å°±å¯ä»¥ä¸²èµ·æ¥äº†ã€‚ç”±äº &lt;code&gt;React Native&lt;/code&gt; æœ¬èº«æ²¡æœ‰æä¾› &lt;code&gt;reload&lt;/code&gt; æœºåˆ¶ï¼Œå¦‚æœéœ€è¦åœ¨æ›´æ–° bundle æ–‡ä»¶åå¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼Œéœ€è¦é€šè¿‡åå°„å¤„ç† &lt;code&gt;ReactInstanceManagerImpl::recreateReactContextInBackgroundFromBundleLoader&lt;/code&gt; è¾¾åˆ°é‡æ–°åŠ è½½åˆ·æ–°é¡µé¢çš„æ•ˆæœï¼Œæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4ã€çƒ­æ›´æ–°æ”¹é€ çš„åé—ç—‡&quot;&gt;&lt;a href=&quot;#4ã€çƒ­æ›´æ–°æ”¹é€ çš„åé—ç—‡&quot; class=&quot;headerlink&quot; title=&quot;4ã€çƒ­æ›´æ–°æ”¹é€ çš„åé—ç—‡&quot;&gt;&lt;/a&gt;4ã€çƒ­æ›´æ–°æ”¹é€ çš„åé—ç—‡&lt;/h2&gt;&lt;p&gt;ç”±äºé‡‡ç”¨åŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶çš„å½¢å¼ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°é€šè¿‡æ­¤å½¢å¼åŠ è½½çš„ &lt;code&gt;bundle&lt;/code&gt; æ–‡ä»¶ï¼Œå›¾ç‰‡åŠ è½½æ—¶ä¸èƒ½è¯»å–åˆ° &lt;code&gt;res&lt;/code&gt; ç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶ï¼Œå¸¦ç€è¿™ä¸ªé—®é¢˜çœ‹äº†ç›¸å…³çš„ js æºç ï¼Œå‘ç°äº†ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AssetSourceResolver&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  isLoadedFromFileSystem(): boolean &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; !!&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.bundlePath;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  defaultAsset(): ResolvedAssetSource &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.isLoadedFromServer()) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//å¦‚æœæ˜¯ä»æœåŠ¡å™¨ä¸‹å‘çš„bundleï¼Œèµ„æºä»æœåŠ¡å™¨è¯»å–ï¼Œå¯¹åº”debugæ¨¡å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.assetServerURL();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;android&#39;&lt;/span&gt;) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//åœ¨androidå¹³å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.isLoadedFromFileSystem() ?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.drawableFolderInBundle() :&lt;span class=&quot;comment&quot;&gt;//å¦‚æœæ˜¯ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–çš„bundleåˆ™ä»æ–‡ä»¶ç³»ç»Ÿå–èµ„æº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.resourceIdentifierWithoutScale();&lt;span class=&quot;comment&quot;&gt;//å¦åˆ™ä»resè¯»å–èµ„æº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.scaledAssetPathInBundle();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  resourceIdentifierWithoutScale(): ResolvedAssetSource &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    invariant(Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;android&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;resource identifiers work on Android&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.fromSource(assetPathUtils.getAndroidResourceIdentifier(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.asset));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  drawableFolderInBundle(): ResolvedAssetSource &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; path = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.bundlePath || &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.fromSource(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&#39;file://&#39;&lt;/span&gt; + path + getAssetPathInDrawableFolder(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.asset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡Œå°±æ˜ç™½äº†ï¼Œæºç ä¸­å¯¹èµ„æºçš„åŠ è½½ä¿æŒäº†è·Ÿ bundle æ–‡ä»¶åŒæºã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š1ã€å°† js æºç ä¸­çš„é€»è¾‘è¿›è¡Œä¿®æ”¹ï¼Œéƒ½ä» res ä¸­è¯»å–èµ„æºï¼›2ã€å°† &lt;code&gt;React Native&lt;/code&gt; ä½¿ç”¨åˆ°çš„èµ„æºæ‰“åŒ…åˆ°æœ¬åœ°ï¼Œè·Ÿéš jsbundle_*.zip å‘å¸ƒã€‚æˆ‘ä¸ªäººæ¯”è¾ƒå€¾å‘äºç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä¸»è¦è€ƒè™‘ä¸¤ç‚¹ï¼šä¸€æ˜¯åç»­ &lt;code&gt;React Native&lt;/code&gt; ç‰ˆæœ¬å‡çº§çš„æˆæœ¬ï¼Œä¸€æ˜¯å¯ä»¥å¯¹äº &lt;code&gt;React Native&lt;/code&gt; çš„èµ„æºå•ç‹¬ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿæ„å¤–çš„è·å¾—äº†ä¸€ä¸ª &lt;code&gt;React Native&lt;/code&gt; èµ„æºçƒ­æ›´çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªæ›´æ–°æ–¹æ¡ˆåˆ°è¿™é‡ŒåŸºæœ¬é˜è¿°å®Œæ¯•ï¼Œæ–¹æ¡ˆç®€å•ä¸”å¯è¡Œåº¦é«˜ï¼Œå”¯ä¸€çš„é—æ†¾æ˜¯åœ¨åŠ è½½é€Ÿåº¦ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆæå‡ã€‚æˆ‘ä¸ªäººæ„Ÿè§‰ &lt;code&gt;React Native&lt;/code&gt; åœ¨ Android ç«¯çš„åŠ è½½é€Ÿåº¦è¿˜æ˜¯ä¸ªç¡¬ä¼¤ï¼Œæœºå‹ä¼—å¤šï¼Œæ€§èƒ½å·®å¼‚æå¤§ï¼Œåœ¨ &lt;code&gt;iOS&lt;/code&gt; ç«¯çš„è¡¨ç°å°±å¥½ä¸Šå¾ˆå¤š ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œåæ§½ä¸‹ &lt;code&gt;React Native&lt;/code&gt; çš„ä¸€ä¸ªå‘ï¼Œç›®å‰æœ€æ–°çš„ &lt;code&gt;0.41.0&lt;/code&gt; ç‰ˆçš„ &lt;code&gt;Android&lt;/code&gt;  ç«¯é€šè¿‡&lt;code&gt;&amp;lt;Image /&amp;gt;&lt;/code&gt; çš„ &lt;code&gt;loadingIndicatorSource&lt;/code&gt; å±æ€§æ¥æŒ‡å®šå ä½å›¾ä¾ç„¶æ— æ•ˆï¼Œ15 å¹´çš„ä¸€ä¸ª issues &lt;a href=&quot;https://github.com/facebook/react-native/issues/5017&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;#5017&lt;/a&gt; åˆ°ç°åœ¨æ²¡æœ‰è¢«ä¿®å¤ï¼Œå®åœ¨åŒªå¤·æ‰€æ€ï¼Œæ„Ÿè§‰æˆ‘æ˜¯ç”¨äº†å‡çš„ RN !!&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€ &lt;code&gt;React Native&lt;/code&gt; çš„ä¸æ–­å‘å±•å®Œå–„ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸é€‰æ‹©ä½¿ç”¨ &lt;code&gt;React Native&lt;/code&gt; æ›¿ä»£ &lt;code&gt;iOS/Android&lt;/code&gt; è¿›è¡Œéƒ¨åˆ†ä¸šåŠ¡çº¿çš„å¼€å‘ï¼Œä¹Ÿæœ‰ä¸å°‘ä½¿ç”¨ &lt;code&gt;Hybrid&lt;/code&gt; æŠ€æœ¯çš„å…¬å¸è½¬å‘äº† &lt;code&gt;React Native&lt;/code&gt; ã€‚è¦è¯´ &lt;code&gt;React Native&lt;/code&gt; æœ€èƒ½å¸å¼•å¼€å‘è€…çš„åœ°æ–¹é‚£å°±æ˜¯å…¶æ‹¥æœ‰å‰ç«¯çš„å¼€å‘é€Ÿåº¦ä»¥åŠåŸç”Ÿçš„ä½“éªŒã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€åºè¨€&quot;&gt;&lt;a href=&quot;#1ã€åºè¨€&quot; class=&quot;headerlink&quot; title=&quot;1ã€åºè¨€&quot;&gt;&lt;/a&gt;1ã€åºè¨€&lt;/h2&gt;&lt;p&gt;ä»Šå¤©è¦è·Ÿå¤§å®¶æ¢è®¨çš„æ˜¯ &lt;code&gt;React Native&lt;/code&gt; çš„æ‹†åŒ…åŠçƒ­æ›´æ–°æ–¹æ¡ˆï¼Œå®˜æ–¹å¹¶æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒè¿™ä¸€ä¼ä¸šååˆ†çœ‹ä¸­çš„çƒ­æ›´æ–°èƒ½åŠ›ï¼Œå› æ­¤ä¹Ÿå‚¬ç”Ÿäº†ç¬¬ä¸‰æ–¹çš„çƒ­æ›´æ–°æ–¹æ¡ˆï¼Œå¦‚ &lt;a href=&quot;https://microsoft.github.io/code-push/docs/react-native.html&quot;&gt;CodePush&lt;/a&gt; ã€ &lt;a href=&quot;https://github.com/reactnativecn/react-native-pushy&quot;&gt;react-native-pushy&lt;/a&gt; ã€‚ç”±äºå…¬å¸å†…éƒ¨æœ‰ä¸åŒçš„ä¸šåŠ¡çº¿ï¼Œæ‰€ä»¥åœ¨é‡‡ç”¨ç¬¬ä¸‰æ–¹çš„çƒ­æ›´æ–°æ–¹æ¡ˆçµæ´»åº¦ä¸å¤Ÿï¼Œåœ¨è°ƒç ”çš„åˆæœŸï¼Œæˆ‘ä»¬å‚è€ƒäº†æºç¨‹çš„æåˆ°çš„ &lt;code&gt;jsbundle&lt;/code&gt; &lt;a href=&quot;https://zhuanlan.zhihu.com/p/23715716&quot;&gt;æ‹†åˆ†å’ŒåŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ&lt;/a&gt;ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ”¹å˜ &lt;code&gt;React Native&lt;/code&gt; çš„æ‰“åŒ…ä»£ç åŠ &lt;code&gt;Runtime&lt;/code&gt; ä»£ç ï¼Œå®æ–½éš¾åº¦ä¸Šéå¸¸å¤§ï¼Œæš‚æ— ç²¾åŠ›æ·±å…¥ç ”ç©¶ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆå¯¹åŠ è½½é€Ÿåº¦æå‡ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚æˆ‘ä»¬æš‚æ—¶æ”¾å¼ƒäº†æºç¨‹çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å‰æœŸéœ€è¦ä¸€å¥—ç›¸å¯¹ç®€å•ç¨³å®šä¸”å¯è¡Œåº¦é«˜çš„æ–¹æ¡ˆï¼Œåœ¨ç»è¿‡è°ƒç ”åŠè®¨è®ºåå®šä¸‹äº†è¿™æ ·ä¸€å¥—çƒ­æ›´æ–¹æ¡ˆï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™ä¸ªæ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="React-Native" scheme="http://solart.cc/categories/React-Native/"/>
    
    
  </entry>
  
  <entry>
    <title>å¯èƒ½æ˜¯æœ€inçš„React Nativeä½¿ç”¨åŸç”Ÿè‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶æ•™ç¨‹</title>
    <link href="http://solart.cc/2017/01/23/react-native-custom-view/"/>
    <id>http://solart.cc/2017/01/23/react-native-custom-view/</id>
    <published>2017-01-23T07:06:06.000Z</published>
    <updated>2017-02-07T03:37:09.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ 2016 å¹´ç§»åŠ¨ç«¯è·¨å¹³å°å¼€å‘æ˜¯å‡ ä¸ªæœ€çƒ­çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œç›¸ä¿¡åœ¨ 2017 å¹´è¿™è‚¡çƒ­æ½®å°†æŒç»­å‘é…µã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºéšç€ä¸šåŠ¡çš„çˆ†å‘å¼å¢é•¿ï¼Œä¼ ç»Ÿçš„åŸç”Ÿå¼€å‘æ¨¡å¼æœ‰ç‚¹æ˜¾å¾—è·Ÿä¸ä¸ŠèŠ‚å¥äº†ï¼Œè¿™ä¹Ÿä¿ƒä½¿å„ä¸ªå…¬å¸å¸Œæœ›å¯»æ‰¾åˆ°ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„å¼€å‘æ–¹æ¡ˆï¼Œå½“ä¸‹å¯ä»¥è¢«é€‰æ‹©çš„æ–¹æ¡ˆä¸­ï¼Œ&lt;code&gt;React Native&lt;/code&gt; åŠ &lt;code&gt;Weex&lt;/code&gt; éƒ½æ˜¯ä¸é”™çš„æŠ€æœ¯æ–¹æ¡ˆã€‚åœ¨å¹´å‰å›¢é˜Ÿå†…éƒ¨çš„ä¸€åœº &lt;code&gt;React Native vs Weex&lt;/code&gt; çš„æŠ€æœ¯å¯¹å’ä¸­æœ¬æ¥æˆ‘é€‰æ‹©çš„æ˜¯ &lt;code&gt;Weex&lt;/code&gt; çš„é˜µè¥ï¼Œä½†å½“æ—¶åœ¨å¤šç»´çš„æŠ€æœ¯æŒ‡æ ‡ä¸­æ–°ç”Ÿçš„ &lt;code&gt;Weex&lt;/code&gt; è¿˜æ˜¯ä¸æ•Œ &lt;code&gt;React Native&lt;/code&gt; ï¼Œå›¢é˜Ÿå†…éƒ¨æœ€ç»ˆæ•²å®šäº†é‡‡ç”¨ &lt;code&gt;React Native&lt;/code&gt; è·¨å¹³å°æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;é—²è¯ä¸å¤šè¯´ï¼Œè¿™é‡Œçš„ä¸»è¦ç›®çš„æ˜¯è·Ÿå¤§å®¶èŠèŠ &lt;code&gt;React Native&lt;/code&gt; åœ¨ &lt;code&gt;Android&lt;/code&gt; å¹³å°ä½¿ç”¨åŸç”Ÿè‡ªå®šä¹‰ &lt;code&gt;View&lt;/code&gt; ï¼Œè¿™é‡Œé»˜è®¤å¤§å®¶å¯¹ &lt;code&gt;React Native&lt;/code&gt; å·²ç»æœ‰ä¸€å®šçš„äº†è§£ï¼Œ&lt;code&gt;React Native&lt;/code&gt; ä¸­çš„ç»„ä»¶éƒ½æ˜¯åŸºäº &lt;code&gt;iOS/Android&lt;/code&gt; çš„å®˜æ–¹ç»„ä»¶è¿›è¡Œå°è£…ï¼Œæ‰€ä»¥åœ¨ä¸€äº›ç‰¹åˆ«çš„åœºæ™¯ä¸‹å¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³éœ€æ±‚ã€‚æ­£å¦‚æ ‡é¢˜ä¸­çš„ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶ï¼Œ&lt;code&gt;React Native&lt;/code&gt; åœ¨ &lt;code&gt;Android&lt;/code&gt; å¹³å°é‡‡ç”¨çš„æ˜¯ &lt;code&gt;android.support.v4.widget.SwipeRefreshLayout&lt;/code&gt; ï¼Œä¸€äº› &lt;code&gt;iOS&lt;/code&gt; è®¾è®¡ä¼˜å…ˆçš„å›¢é˜Ÿ(è­¬å¦‚æˆ‘å¸)è€Œè¨€å¯¹äº &lt;code&gt;Android&lt;/code&gt; å¼€å‘äººå‘˜ç®€ç›´å°±æ˜¯ç¾éš¾ã€‚åœ¨ä¼—å¤šå¼€æºçš„ &lt;code&gt;React Native&lt;/code&gt; é¡¹ç›®ä¸­å¤§å®¶ä¹Ÿä¸ä¼šå†è¿™äº›ç»†èŠ‚ä¸Šè¾ƒçœŸï¼Œä½†æ˜¯å…¬å¸çš„ &lt;code&gt;UED&lt;/code&gt; è¿™å…³å¯ä¸å¥½è¿‡ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å¬è¯´æµè¡Œæœ‰å›¾æœ‰çœŸç›¸ï¼Œé‚£å…ˆæ¥ä¸ªåœ¨ &lt;code&gt;iOS&lt;/code&gt; ç«¯ç»å…¸çš„èŠèŠ±å›¾çš„ &lt;code&gt;Android&lt;/code&gt;  &lt;code&gt;reac-native&lt;/code&gt; ç‰ˆï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/react-native-ptr.gif&quot; alt=&quot;react-native-ptr&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;2ã€Android-ç«¯çš„æ”¯æŒå®ç°&quot;&gt;&lt;a href=&quot;#2ã€Android-ç«¯çš„æ”¯æŒå®ç°&quot; class=&quot;headerlink&quot; title=&quot;2ã€Android ç«¯çš„æ”¯æŒå®ç°&quot;&gt;&lt;/a&gt;2ã€Android ç«¯çš„æ”¯æŒå®ç°&lt;/h2&gt;&lt;p&gt;é€‚é… &lt;code&gt;Android&lt;/code&gt; å¹³å°çš„åŸç”Ÿç»„ä»¶å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ &lt;a href=&quot;http://facebook.github.io/react-native/docs/native-components-android.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Native UI Components&lt;/a&gt;ï¼Œå¦‚æœç½‘ç»œä¸æ–¹ä¾¿çš„è¯ä¹Ÿå¯ä»¥å‚çœ‹ç¿»è¯‘ç‰ˆ&lt;a href=&quot;http://reactnative.cn/docs/0.39/native-component-android.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åŸç”ŸUIç»„ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&quot;&gt;&lt;a href=&quot;#2-1-è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&quot; class=&quot;headerlink&quot; title=&quot;2.1 è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&quot;&gt;&lt;/a&gt;2.1 è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&lt;/h4&gt;&lt;p&gt;è¿™é‡Œå°±ä¸è®²å¦‚ä½•è‡ªå®šä¹‰ &lt;code&gt;Android&lt;/code&gt; æ§ä»¶ï¼Œå‡è®¾ä½ æ˜¯ä¸€ä½æœ‰ä¸€å®šç»éªŒçš„å¼€å‘äººå‘˜ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//è‡ªå®šä¹‰çš„ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PullToRefreshView&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ViewGroup&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PullToRefreshView&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setRefreshing&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; refreshing)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setOnRefreshListener&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(OnRefreshListener listener)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-2-åˆ›å»º-ViewManager-çš„å®ç°ç±»&quot;&gt;&lt;a href=&quot;#2-2-åˆ›å»º-ViewManager-çš„å®ç°ç±»&quot; class=&quot;headerlink&quot; title=&quot;2.2 åˆ›å»º ViewManager çš„å®ç°ç±»&quot;&gt;&lt;/a&gt;2.2 åˆ›å»º ViewManager çš„å®ç°ç±»&lt;/h4&gt;&lt;p&gt;å®˜æ–¹æ–‡æ¡£ä¸­ç»™æˆ‘ä»¬çš„ç¤ºä¾‹æ˜¯åˆ›å»º &lt;code&gt;SimpleViewManager&lt;/code&gt; çš„å®ç°ç±»ï¼Œä½†æ­¤å¤„çš„ä¸‹æ‹‰åˆ·æ–°æ§ä»¶æ˜¯ä¸ª &lt;code&gt;ViewGroup&lt;/code&gt; ï¼Œæ‰€ä»¥æ­¤å¤„å®ç°ç±»åº”ç»§æ‰¿ &lt;code&gt;ViewManager&lt;/code&gt; çš„å¦ä¸€ä¸ªå­ç±» &lt;code&gt;ViewGroupManager&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SwipeRefreshViewManager&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ViewGroupManager&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;PullToRefreshView&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;PtrLayout&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; PullToRefreshView &lt;span class=&quot;title&quot;&gt;createViewInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ThemedReactContext reactContext)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PullToRefreshView(reactContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åˆ°è¿™é‡Œä¸€ä¸ªç®€å•çš„ &lt;code&gt;ViewGroupManager&lt;/code&gt; å°±å®ç°äº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-3-ç»™-ViewManager-æ·»åŠ äº‹ä»¶ç›‘å¬&quot;&gt;&lt;a href=&quot;#2-3-ç»™-ViewManager-æ·»åŠ äº‹ä»¶ç›‘å¬&quot; class=&quot;headerlink&quot; title=&quot;2.3 ç»™ ViewManager æ·»åŠ äº‹ä»¶ç›‘å¬&quot;&gt;&lt;/a&gt;2.3 ç»™ ViewManager æ·»åŠ äº‹ä»¶ç›‘å¬&lt;/h4&gt;&lt;p&gt;ä½†æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬å¦‚ä½•å°†ä¸‹æ‹‰åˆ·æ–°çš„ç›‘å¬äº‹ä»¶ä¼ é€’ç»™ &lt;code&gt;JavaScript&lt;/code&gt; å‘¢ï¼Ÿå®˜æ–¹æ–‡æ¡£ä¸­å†™çš„å¹¶ä¸æ¸…æ™°ï¼Œè¿˜æ˜¯ç¿»é˜…æºç å§ï¼Œæœä¸å…¶ç„¶åœ¨æºç ä¸­å¯»æ‰¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;è¦†å†™ &lt;code&gt;addEventEmitters&lt;/code&gt; å‡½æ•°å°†äº‹ä»¶ç›‘å¬ä¼ é€’ç»™ &lt;code&gt;JavaScript&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SwipeRefreshViewManager&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ViewGroupManager&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;PullToRefreshView&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addEventEmitters&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ThemedReactContext reactContext, PullToRefreshView view)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        view.setOnRefreshListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PullToRefreshView.OnRefreshListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onRefresh&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                reactContext.getNativeModule(UIManagerModule.class).getEventDispatcher()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .dispatchEvent(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PtrRefreshEvent(view.getId()));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Nullable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;String, Object&amp;gt; getExportedCustomDirectEventTypeConstants() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; MapBuilder.&amp;lt;String, Object&amp;gt;builder()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .put(&lt;span class=&quot;string&quot;&gt;&quot;topRefresh&quot;&lt;/span&gt;, MapBuilder.of(&lt;span class=&quot;string&quot;&gt;&quot;registrationName&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;onRefresh&quot;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .build();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å°†äº‹ä»¶å°è£…ä¸º &lt;code&gt;PtrRefreshEvent&lt;/code&gt; :&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PtrRefreshEvent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Event&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;PtrRefreshEvent&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PtrRefreshEvent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; viewTag)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(viewTag);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getEventName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;topRefresh&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(RCTEventEmitter rctEventEmitter)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        rctEventEmitter.receiveEvent(getViewTag(),getEventName(),&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»†å¿ƒåœ°ä½ è‚¯å®šå‘ç°äº† &lt;code&gt;getExportedCustomDirectEventTypeConstants&lt;/code&gt; è¿™ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå…ˆè¯´æ˜ä¸€ä¸‹ï¼Œè¦†å†™è¯¥å‡½æ•°ï¼Œå°† &lt;code&gt;topRefresh&lt;/code&gt; è¿™ä¸ªäº‹ä»¶ååœ¨ JavaScript ç«¯æ˜ å°„åˆ° &lt;code&gt;onRefresh&lt;/code&gt; å›è°ƒå±æ€§ä¸Šï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬åé¢ä¼šåœ¨ç»“åˆ JavaScript å†è§£é‡Šä¸‹ç”¨æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºç»„ä»¶è¿™éƒ¨åˆ†å¤§å®¶å¯ä»¥å‚çœ‹ &lt;code&gt;React Native&lt;/code&gt; çš„ &lt;code&gt;Android&lt;/code&gt; éƒ¨åˆ†çš„ä»£ç ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-4-ä½¿ç”¨-ReactProp-æ³¨è§£å¯¼å‡ºå±æ€§çš„è®¾ç½®æ–¹æ³•&quot;&gt;&lt;a href=&quot;#2-4-ä½¿ç”¨-ReactProp-æ³¨è§£å¯¼å‡ºå±æ€§çš„è®¾ç½®æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;2.4 ä½¿ç”¨@ReactProp æ³¨è§£å¯¼å‡ºå±æ€§çš„è®¾ç½®æ–¹æ³•&quot;&gt;&lt;/a&gt;2.4 ä½¿ç”¨@ReactProp æ³¨è§£å¯¼å‡ºå±æ€§çš„è®¾ç½®æ–¹æ³•&lt;/h4&gt;&lt;p&gt;è¿™éƒ¨åˆ†å†…å®¹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»è¶³å¤Ÿä½¿ç”¨äº†ï¼Œè¿™é‡Œä¸å†ç»†è¯´ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SwipeRefreshViewManager&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ViewGroupManager&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;PullToRefreshView&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@ReactProp&lt;/span&gt;(name = &lt;span class=&quot;string&quot;&gt;&quot;refreshing&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setRefreshing&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(PullToRefreshView view, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; refreshing)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        view.setRefreshing(refreshing);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-5-å°†-ViewManager-æ³¨å†Œåˆ°åº”ç”¨&quot;&gt;&lt;a href=&quot;#2-5-å°†-ViewManager-æ³¨å†Œåˆ°åº”ç”¨&quot; class=&quot;headerlink&quot; title=&quot;2.5 å°† ViewManager æ³¨å†Œåˆ°åº”ç”¨&quot;&gt;&lt;/a&gt;2.5 å°† ViewManager æ³¨å†Œåˆ°åº”ç”¨&lt;/h4&gt;&lt;p&gt;å¦‚æœä½ ç†Ÿæ‚‰ &lt;code&gt;Android&lt;/code&gt; çš„ &lt;code&gt;React Native&lt;/code&gt; é›†æˆçš„è¯ï¼Œä½ åªéœ€è¦å°† &lt;code&gt;SwipeRefreshViewManager&lt;/code&gt; æ·»åŠ åˆ° &lt;code&gt;ReactPackage&lt;/code&gt; ä¸­å³å¯:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MainPackage&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReactPackage&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;ViewManager&amp;gt; &lt;span class=&quot;title&quot;&gt;createViewManagers&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ReactApplicationContext reactApplicationContext)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Arrays.asList(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SwipeRefreshViewManager());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åˆ°è¿™é‡Œ &lt;code&gt;Android&lt;/code&gt; ç«¯çš„å®ç°å·²ç»å…¨éƒ¨å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3ã€React-JS-ç«¯çš„ç»„ä»¶å®ç°åŠä½¿ç”¨&quot;&gt;&lt;a href=&quot;#3ã€React-JS-ç«¯çš„ç»„ä»¶å®ç°åŠä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;3ã€React/JS ç«¯çš„ç»„ä»¶å®ç°åŠä½¿ç”¨&quot;&gt;&lt;/a&gt;3ã€React/JS ç«¯çš„ç»„ä»¶å®ç°åŠä½¿ç”¨&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬æ¥èŠä¸€èŠä½¿ç”¨ &lt;code&gt;React&lt;/code&gt; å®ç°ä¸‹æ‹‰åˆ·æ–°çš„ç»„ä»¶ï¼Œå½“ç„¶åœ¨è¿™ä¹‹å‰æœŸæœ›ä½ å¯¹ &lt;code&gt;jsx/es6&lt;/code&gt; çš„è¯­æ³•åŠ &lt;code&gt;react/react-native&lt;/code&gt; çš„ API æœ‰ä¸€å®šçš„äº†è§£ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-å®ç°ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶&quot;&gt;&lt;a href=&quot;#3-1-å®ç°ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3.1 å®ç°ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶&quot;&gt;&lt;/a&gt;3.1 å®ç°ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶&lt;/h4&gt;&lt;p&gt;è¿˜è®°å¾—å—ï¼Œåœ¨ &lt;code&gt;Android&lt;/code&gt; æˆ‘ä»¬é€šè¿‡ &lt;code&gt;SwipeRefreshViewManager&lt;/code&gt; ä¸­ &lt;code&gt;getName&lt;/code&gt; è¿”å›çš„æ§ä»¶åç§°ï¼Œå°†ä¼šåœ¨è¿™é‡Œç”¨äºå¼•ç”¨è¿™ä¸ªåŸç”Ÿæ§ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;pi&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; React, &amp;#123;Component, PropTypes&amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123;View, requireNativeComponent&amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; NativeMethodsMixin &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react/lib/NativeMethodsMixin&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; mixin &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;react-mixin&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//å¼•ç”¨åŸç”Ÿä¸‹æ‹‰åˆ·æ–°æ§ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; NativePtrView = requireNativeComponent(&lt;span class=&quot;string&quot;&gt;&#39;PtrLayout&#39;&lt;/span&gt;, PtrView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//å°è£…ä¸€ä¸ªreactç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¸­å¼•ç”¨äº†åŸç”Ÿæ§ä»¶çš„å®ç°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PtrView&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Component&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static propTypes = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...View.propTypes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        onRefresh: PropTypes.func,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        refreshing: PropTypes.bool.isRequired&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _nativeRef = (&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;: ?PtrView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _lastNativeRefreshing = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    constructor(props) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(props);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    componentDidMount() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._lastNativeRefreshing = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    componentDidUpdate(prevProps = &amp;#123;refreshing: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&amp;#125;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing !== prevProps.refreshing) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._lastNativeRefreshing = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing !== &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._lastNativeRefreshing) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._nativeRef.setNativeProps(&amp;#123;refreshing: &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._lastNativeRefreshing = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshing;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//æ¸²æŸ“åŸç”Ÿä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œè¿™é‡ŒonRefreshå°±æ˜¯åœ¨ViewManager::getExportedCustomDirectEventTypeConstants &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//è¿™ä¸ªå‡½æ•°ä¸­ topRefresh çš„æ˜ å°„å±æ€§ã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    render() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;NativePtrView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;span class=&quot;attribute&quot;&gt;...this.props&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attribute&quot;&gt;ref&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;ref&lt;/span&gt; =&amp;gt;&lt;/span&gt; this._nativeRef = ref&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                onRefresh=&amp;#123;this._onRefresh.bind(this)&amp;#125;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _onRefresh() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._lastNativeRefreshing = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.onRefresh &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.onRefresh();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.forceUpdate();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mixin.onClass(PtrView, NativeMethodsMixin);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &amp;#123;PtrView&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-2-ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#3-2-ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;3.2 ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„ä½¿ç”¨&quot;&gt;&lt;/a&gt;3.2 ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„ä½¿ç”¨&lt;/h4&gt;&lt;p&gt;è¯´åˆ°ä½¿ç”¨å°±å¤ªç®€å•äº†ï¼Œè™½ç„¶ç®€å•ä½†ä»ç„¶è¦è¯´ï¼Œæˆ‘ä»¬çŸ¥é“å®˜æ–¹æä¾›çš„ç»„ä»¶ä¾‹å¦‚ &lt;code&gt;ListView&lt;/code&gt; ä¸­é€šè¿‡ &lt;code&gt;refreshControl&lt;/code&gt; æ¥æŒ‡å®šåˆ·æ–°æ§åˆ¶å™¨ï¼Œç”¨æ³•æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Demo1&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Component&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    render() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;style&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;&amp;#123;flex:&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;ListView&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;attribute&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;attribute&quot;&gt;refreshControl&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;lt;&lt;span class=&quot;attribute&quot;&gt;RefreshControl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;attribute&quot;&gt;refreshing&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this.state.refreshing&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;attribute&quot;&gt;onRefresh&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this._refresh.bind(this)&amp;#125;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘å°±åœ¨æƒ³æ—¢ç„¶å¯ä»¥é€šè¿‡ &lt;code&gt;refreshControl&lt;/code&gt; æ¥æŒ‡å®šåˆ·æ–°æ§åˆ¶å™¨ï¼Œé‚£æˆ‘è‡ªå®šä¹‰çš„ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡&lt;code&gt;refreshControl&lt;/code&gt; æ¥æŒ‡å®šå‘¢ï¼Ÿå¸¦ç€è¿™æ ·çš„ç–‘é—®ï¼Œæˆ‘ä»”ç»†è¯»äº†è¯» &lt;code&gt;ListView/ScrollView&lt;/code&gt; çš„æºç ï¼Œå‘ç°è¿™ä¸ªçŒœæƒ³è¿˜æ˜¯è›®é è°±çš„ï¼Œä¹Ÿèµå¹ Facebook çš„å·¥ç¨‹å¸ˆä»¬çš„å¦™ç¬”ç”ŸèŠ±ï¼ŒçœŸæ˜¯åº”äº†é‚£å¥è¯å«â€œä¸è¦å†™æ­»â€ï¼Facebook çš„å·¥ç¨‹å¸ˆåšåˆ°äº†â€¦&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; ScrollView = React.createClass(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ScrollViewClass;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;ios&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ScrollViewClass = RCTScrollView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;android&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.horizontal) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ScrollViewClass = AndroidHorizontalScrollView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ScrollViewClass = AndroidScrollView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; refreshControl = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.refreshControl;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (refreshControl) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;ios&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Platform.OS === &lt;span class=&quot;string&quot;&gt;&#39;android&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// On Android wrap the ScrollView with a AndroidSwipeRefreshLayout.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Since the ScrollView is wrapped add the style props to the&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// AndroidSwipeRefreshLayout and use flex: 1 for the ScrollView.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// æ­¤å¤„å°±æ˜¯é‡ç‚¹ï¼Œé€šè¿‡ cloneElement åˆ›å»ºä¸€ä¸ªæ–°çš„ ReactElementï¼Œè€Œ refreshControl æ˜¯é€šè¿‡ props æŒ‡å®šè€Œæ¥å¹¶æ²¡æœ‰å†™æ­»ï¼ŒGood!&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; React.cloneElement(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          refreshControl,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#123;style: props.style&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;ScrollViewClass&lt;/span&gt; &amp;#123;&lt;span class=&quot;attribute&quot;&gt;...props&lt;/span&gt;&amp;#125; &lt;span class=&quot;attribute&quot;&gt;ref&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this._setScrollViewRef&amp;#125;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;contentContainer&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;ScrollViewClass&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åŸºäºä»¥ä¸Šçš„åˆ†æä»¥åŠæˆ‘ä»¬å¯¹äºå±æ€§çš„å°è£…ï¼Œæˆ‘ä»¬çš„å†™æ³•ä¹Ÿç›¸å½“çš„åŸå‘³ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Demo2&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Component&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    render() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;style&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;&amp;#123;flex:&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;1&lt;/span&gt;&amp;#125;&amp;#125;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;ListView&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;attribute&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;attribute&quot;&gt;refreshControl&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         //è¿™é‡Œä¸ºäº†ä¿è¯åªåœ¨&lt;span class=&quot;attribute&quot;&gt;Android&lt;/span&gt;å¹³å°ä¸Šä½¿ç”¨è¯¥ç»„ä»¶ï¼Œå¦‚æœ&lt;span class=&quot;attribute&quot;&gt;iOS&lt;/span&gt;ç«¯ä¹Ÿæœ‰åŸç”Ÿæ§ä»¶çš„å®ç°ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         //é‚£å°±ä¸å¿…è€ƒè™‘å¹³å°äº†ã€‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         &lt;span class=&quot;attribute&quot;&gt;Platform.OS&lt;/span&gt; =&lt;span class=&quot;value&quot;&gt;==&lt;/span&gt; &#39;&lt;span class=&quot;attribute&quot;&gt;android&lt;/span&gt;&#39; ? &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         &amp;lt;&lt;span class=&quot;attribute&quot;&gt;PtrView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              &lt;span class=&quot;attribute&quot;&gt;refreshing&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this.state.refreshing&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              &lt;span class=&quot;attribute&quot;&gt;onRefresh&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this._refresh.bind(this)&amp;#125;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;RefreshControl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              &lt;span class=&quot;attribute&quot;&gt;refreshing&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this.state.refreshing&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              &lt;span class=&quot;attribute&quot;&gt;onRefresh&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&amp;#123;this._refresh.bind(this)&amp;#125;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¸Œæœ›ä½ èƒ½æœ‰æ‰€æ”¶è·ï¼Œæœ¬æ–‡å®Œï¼&lt;/p&gt;
&lt;p&gt;æœ€åç¥å¤§å®¶é¸¡å¹´å¤§å‰å§ï¼&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ 2016 å¹´ç§»åŠ¨ç«¯è·¨å¹³å°å¼€å‘æ˜¯å‡ ä¸ªæœ€çƒ­çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œç›¸ä¿¡åœ¨ 2017 å¹´è¿™è‚¡çƒ­æ½®å°†æŒç»­å‘é…µã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºéšç€ä¸šåŠ¡çš„çˆ†å‘å¼å¢é•¿ï¼Œä¼ ç»Ÿçš„åŸç”Ÿå¼€å‘æ¨¡å¼æœ‰ç‚¹æ˜¾å¾—è·Ÿä¸ä¸ŠèŠ‚å¥äº†ï¼Œè¿™ä¹Ÿä¿ƒä½¿å„ä¸ªå…¬å¸å¸Œæœ›å¯»æ‰¾åˆ°ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„å¼€å‘æ–¹æ¡ˆï¼Œå½“ä¸‹å¯ä»¥è¢«é€‰æ‹©çš„æ–¹æ¡ˆä¸­ï¼Œ&lt;code&gt;React Native&lt;/code&gt; åŠ &lt;code&gt;Weex&lt;/code&gt; éƒ½æ˜¯ä¸é”™çš„æŠ€æœ¯æ–¹æ¡ˆã€‚åœ¨å¹´å‰å›¢é˜Ÿå†…éƒ¨çš„ä¸€åœº &lt;code&gt;React Native vs Weex&lt;/code&gt; çš„æŠ€æœ¯å¯¹å’ä¸­æœ¬æ¥æˆ‘é€‰æ‹©çš„æ˜¯ &lt;code&gt;Weex&lt;/code&gt; çš„é˜µè¥ï¼Œä½†å½“æ—¶åœ¨å¤šç»´çš„æŠ€æœ¯æŒ‡æ ‡ä¸­æ–°ç”Ÿçš„ &lt;code&gt;Weex&lt;/code&gt; è¿˜æ˜¯ä¸æ•Œ &lt;code&gt;React Native&lt;/code&gt; ï¼Œå›¢é˜Ÿå†…éƒ¨æœ€ç»ˆæ•²å®šäº†é‡‡ç”¨ &lt;code&gt;React Native&lt;/code&gt; è·¨å¹³å°æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;é—²è¯ä¸å¤šè¯´ï¼Œè¿™é‡Œçš„ä¸»è¦ç›®çš„æ˜¯è·Ÿå¤§å®¶èŠèŠ &lt;code&gt;React Native&lt;/code&gt; åœ¨ &lt;code&gt;Android&lt;/code&gt; å¹³å°ä½¿ç”¨åŸç”Ÿè‡ªå®šä¹‰ &lt;code&gt;View&lt;/code&gt; ï¼Œè¿™é‡Œé»˜è®¤å¤§å®¶å¯¹ &lt;code&gt;React Native&lt;/code&gt; å·²ç»æœ‰ä¸€å®šçš„äº†è§£ï¼Œ&lt;code&gt;React Native&lt;/code&gt; ä¸­çš„ç»„ä»¶éƒ½æ˜¯åŸºäº &lt;code&gt;iOS/Android&lt;/code&gt; çš„å®˜æ–¹ç»„ä»¶è¿›è¡Œå°è£…ï¼Œæ‰€ä»¥åœ¨ä¸€äº›ç‰¹åˆ«çš„åœºæ™¯ä¸‹å¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³éœ€æ±‚ã€‚æ­£å¦‚æ ‡é¢˜ä¸­çš„ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶ï¼Œ&lt;code&gt;React Native&lt;/code&gt; åœ¨ &lt;code&gt;Android&lt;/code&gt; å¹³å°é‡‡ç”¨çš„æ˜¯ &lt;code&gt;android.support.v4.widget.SwipeRefreshLayout&lt;/code&gt; ï¼Œä¸€äº› &lt;code&gt;iOS&lt;/code&gt; è®¾è®¡ä¼˜å…ˆçš„å›¢é˜Ÿ(è­¬å¦‚æˆ‘å¸)è€Œè¨€å¯¹äº &lt;code&gt;Android&lt;/code&gt; å¼€å‘äººå‘˜ç®€ç›´å°±æ˜¯ç¾éš¾ã€‚åœ¨ä¼—å¤šå¼€æºçš„ &lt;code&gt;React Native&lt;/code&gt; é¡¹ç›®ä¸­å¤§å®¶ä¹Ÿä¸ä¼šå†è¿™äº›ç»†èŠ‚ä¸Šè¾ƒçœŸï¼Œä½†æ˜¯å…¬å¸çš„ &lt;code&gt;UED&lt;/code&gt; è¿™å…³å¯ä¸å¥½è¿‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="React-Native" scheme="http://solart.cc/categories/React-Native/"/>
    
    
  </entry>
  
  <entry>
    <title>éƒ½æ˜¯ Push æƒ¹çš„ç¥¸</title>
    <link href="http://solart.cc/2016/12/06/keep_alive_push/"/>
    <id>http://solart.cc/2016/12/06/keep_alive_push/</id>
    <published>2016-12-06T06:50:06.000Z</published>
    <updated>2017-02-06T07:54:18.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ KPI è€ƒæ ¸èƒŒæ™¯ä¸‹äº§å‡ºçš„æ–‡ç« ï¼Œè¿™ä¸€åˆ‡éƒ½èµ·æºäºæˆ‘å¸è¦æ±‚æå‡ App æ¨é€é€è¾¾ç‡ï¼Œä»¥èŠ‚çœåœ¨çŸ­ä¿¡æ¨å¹¿ä¸ŠèŠ±è´¹çš„å¼€é”€ã€‚è¿™é‡Œè®°å½•äº†åœ¨æ•´ä¸ªæŠ€æœ¯è°ƒç ”çš„å…³é”®ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;&lt;code&gt;iOS&lt;/code&gt; å’Œ &lt;code&gt;Android&lt;/code&gt; å‡åœ¨ç³»ç»Ÿçº§é›†æˆäº†æ¨é€æœåŠ¡ï¼Œæ¥è¯´è¯´&lt;code&gt;åŸç”Ÿ Android&lt;/code&gt; çš„æ¨é€æœåŠ¡ï¼Œæœ€åœ¨ Android 2.2 æ—¶ï¼Œ&lt;code&gt;C2DM&lt;/code&gt; ä½œä¸ºç³»ç»Ÿçº§æœåŠ¡é›†æˆè¿›äº† &lt;code&gt;Android&lt;/code&gt; ç³»ç»Ÿï¼Œè€Œ &lt;code&gt;GCMï¼ˆGoogle Clould Messagingï¼‰&lt;/code&gt; åœ¨ 2013 Google IO å¤§ä¼šå‘å¸ƒåå°±æ­£å¼å–ä»£äº† &lt;code&gt;C2DM&lt;/code&gt; ï¼Œç„¶å Google å¹¶æ²¡æœ‰æ­¢æ­¥ï¼Œåœ¨ 2014 å¹´æ”¶è´­äº† &lt;a href=&quot;https://en.wikipedia.org/wiki/Firebase&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;Firebase&lt;/code&gt;&lt;/a&gt; ï¼Œç»è¿‡è¿‘ä¸¤å¹´çš„æ•´åˆï¼Œåœ¨ 2016 å¹´ Google IO å¤§ä¼šä¸Šéš†é‡å‘å¸ƒäº† Firebase æœåŠ¡ï¼Œä¸€ä¸ªå…¨æ–°çš„ç§»åŠ¨å’Œ Web å¼€å‘çš„å®Œæ•´åç«¯è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†&lt;code&gt;FCMï¼ˆFirebase Cloud Messagingï¼‰&lt;/code&gt;ã€‚å¦‚æœå°±è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Android å¹³å°ä¸Šåƒ iOS å¹³å°ä¸€æ ·ä½¿ç”¨ç³»ç»Ÿçº§å…±äº«çš„æ¨é€æœåŠ¡äº†ï¼Œç„¶è€Œä¸€è‚¡ç¥ç§˜çš„ä¸œæ–¹åŠ›é‡æ‰“ç ´äº†åŸæœ¬ç®€å•çš„äº‹æƒ…â€¦&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ Google é€€å‡ºä¸­å›½å¸‚åœºåï¼Œå„å®¶å‚å•†åœ¨ &lt;code&gt;Android&lt;/code&gt; åº•å±‚çš„å®šåˆ¶ä¿®æ”¹ï¼Œä½¿å¾—å›½å†… &lt;code&gt;Android&lt;/code&gt; å¹³å°æ›´åŠ åˆ†åŒ–ã€‚å…¶ä¸­å°ç±³æ¨å‡ºäº†è‡ªå®¶çš„ MiPush ï¼Œåä¸ºä¹Ÿæ¨å‡ºäº†è‡ªå®¶çš„ Push ï¼ŒBAT çš„æ¨é€ã€æå…‰ã€ä¸ªæ¨ç­‰ç­‰æ¨é€å¹³å°ï¼Œè¿™ä¹Ÿä½¿å¾—å¼€å‘è€…é€‰æ‹©æ—¶ä¸çŸ¥æ‰€æªã€‚æ®æˆ‘æ‰€çŸ¥ç°åœ¨å¾ˆå¤š App éƒ½æ¥å…¥äº†å¤šå®¶æ¨é€ä»¥ä¿è¯æ¨é€çš„é€è¾¾ç‡ã€‚ä¸åŒçš„æ¨é€å¹³å°ä¹Ÿä¼šé’ˆå¯¹æ¥å…¥è‡ªå®¶æ¨é€ SDK çš„ App äº’ç›¸å”¤èµ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯è‡ªå®¶æ¨é€é€è¾¾ç‡ï¼Œå¦åˆ™é€è¾¾ä½äº†è°è¿˜ç”¨å‘¢ï¼Œæ¯•ç«Ÿä¼ä¸šä¹Ÿæ˜¯è¦ç”Ÿå­˜çš„ã€‚å…¶å®è¿™æ­£æ˜¯å›½å†… &lt;code&gt;Android&lt;/code&gt; çš„ä¹±è±¡ä¹‹ä¸€ï¼Œè¿™ä¹Ÿä½¿å¾— &lt;code&gt;Android&lt;/code&gt; çš„ç”¨æˆ·æŠ±æ€¨ä¸æ–­ï¼Œå®åœ¨æ˜¯è¿›å…¥äº†ä¸€ä¸ªæ€ªåœˆä¹‹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šè¯´äº†è¿™ä¹ˆå¤šï¼Œå¹¶ä¸èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œæ—¢ç„¶å­˜åœ¨äºè¿™ä¸ªå¤§ç¯å¢ƒä¹‹ä¸­ï¼Œæˆ‘ä»¬å°±åªèƒ½æƒ³äº›åŠæ³•å»é€‚åº”å®ƒã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€æ¨é€åŠä¿æ´»&quot;&gt;&lt;a href=&quot;#2ã€æ¨é€åŠä¿æ´»&quot; class=&quot;headerlink&quot; title=&quot;2ã€æ¨é€åŠä¿æ´»&quot;&gt;&lt;/a&gt;2ã€æ¨é€åŠä¿æ´»&lt;/h2&gt;&lt;p&gt;ä¸‹é¢å°±ç®€å•å…ˆè¯´è¯´æ¨é€æœåŠ¡çš„å®ç°æœºåˆ¶ï¼Œç®€å•ç‚¹ï¼Œçœ‹å›¾è¯´è¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/push_model.png&quot; alt=&quot;push_model&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¨é€æ¨¡å‹ï¼ŒæœåŠ¡å™¨å‘ Push æœåŠ¡å™¨å‘å¸ƒæ¨é€æ¶ˆæ¯ï¼Œæ¨é€æœåŠ¡å™¨ç»è¿‡å¤„ç†æŒ‰ç…§è¦æ±‚å°†æ¨é€æ¶ˆæ¯é€šè¿‡é•¿é“¾æ¥é€šé“å°†æ¶ˆæ¯æ¨é€è‡³ App ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-çš®ä¹‹ä¸å­˜ï¼Œæ¯›å°†ç„‰é™„&quot;&gt;&lt;a href=&quot;#2-1-çš®ä¹‹ä¸å­˜ï¼Œæ¯›å°†ç„‰é™„&quot; class=&quot;headerlink&quot; title=&quot;2.1 çš®ä¹‹ä¸å­˜ï¼Œæ¯›å°†ç„‰é™„&quot;&gt;&lt;/a&gt;2.1 çš®ä¹‹ä¸å­˜ï¼Œæ¯›å°†ç„‰é™„&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“ Push æœåŠ¡å™¨æƒ³è¦æˆåŠŸçš„å°†æ¶ˆæ¯æ¨é€è‡³å®¢æˆ·ç«¯çœŸæ­£çš„å…³é”®å°±æ˜¯è¿™ä¸ªé•¿é“¾æ¥çš„ç¨³å®šæ€§ï¼Œå„å®¶æ¨é€æœåŠ¡ä¹Ÿéƒ½å¯¹è¿™ä¸ªé•¿é“¾æ¥åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ¯”å¦‚é€šé“å…±äº«ã€é€ä¼ ç­‰ã€‚å¯¹äº &lt;code&gt;Android&lt;/code&gt; æ¥è¯´é€šå¸¸çš„åšæ³•æ˜¯é€šè¿‡ &lt;code&gt;Service&lt;/code&gt; ç»´æŒä¸€ä¸ªé•¿é“¾æ¥ï¼Œå®šæ—¶å‘é€å¿ƒè·³åŒ…ä»¥ä¿è¯å®æ—¶åœ¨çº¿ã€‚&lt;/p&gt;
&lt;p&gt;æ¨é€ &lt;code&gt;Service&lt;/code&gt; ä¾èµ–äºåº”ç”¨è¿›ç¨‹çš„çŠ¶æ€ï¼Œè¿›ç¨‹ä½œä¸ºè½½ä½“ï¼Œè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ&lt;code&gt;Service&lt;/code&gt; æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œä¸€ä½†è¿›ç¨‹è¢«æ€æ­»ï¼Œæ¨é€ &lt;code&gt;Service&lt;/code&gt; è‡ªç„¶ä¹Ÿæ— æ³•è¿è¡Œï¼Œè¿›è€Œä¹Ÿå°±æ— æ³•æ”¶åˆ°æ¨é€æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè§£å†³è¿›ç¨‹å­˜æ´»çš„é—®é¢˜ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œç®€å•çš„è¯´æ˜ä¸€ä¸‹è¿›ç¨‹åŠèµ„æºçš„å†²çªé—®é¢˜ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“ï¼Œæ¯ä¸ªè¿›ç¨‹çš„å¯åŠ¨éƒ½æ„å‘³ç€æ¶ˆè€—æ‰ä¸€éƒ¨åˆ†æ‰‹æœºèµ„æºï¼Œæ¯”å¦‚ CPU ï¼Œå†…å­˜ç­‰ã€‚è€Œåƒå†…å­˜è¿™æ ·çš„èµ„æºåœ¨æ‰‹æœºä¸­å…¶å®æ˜¯ç›¸å½“å®è´µçš„ï¼Œç³»ç»Ÿä¸ºäº†ä¿è¯è‡ªèº«è¿è¡Œçš„ç¨³å®šæ€§ä»¥åŠå‰å° App çš„æ€§èƒ½ï¼Œåœ¨å¿…è¦æ—¶ä¼šè§¦å‘èµ„æºå›æ”¶çš„æœºåˆ¶ï¼Œåœ¨ Android ä¸­è¿™ç§æœºåˆ¶è¢«ç§°ä¹‹ä¸º &lt;code&gt;LowMemoryKiller&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-2-è¿›ç¨‹æ€æ‰‹-LMK&quot;&gt;&lt;a href=&quot;#2-2-è¿›ç¨‹æ€æ‰‹-LMK&quot; class=&quot;headerlink&quot; title=&quot;2.2 è¿›ç¨‹æ€æ‰‹ LMK&quot;&gt;&lt;/a&gt;2.2 è¿›ç¨‹æ€æ‰‹ LMK&lt;/h4&gt;&lt;p&gt;&lt;code&gt;LowMemoryKiller&lt;/code&gt; æ˜¯ä¸€ç§æ ¹æ® &lt;code&gt;OOM_ADJ&lt;/code&gt; é˜ˆå€¼çº§åˆ«è§¦å‘ç›¸åº”åŠ›åº¦çš„å†…å­˜å›æ”¶çš„æœºåˆ¶ã€‚ä»€ä¹ˆæ˜¯ &lt;code&gt;OOM_ADJ&lt;/code&gt; å‘¢ï¼Ÿ OOM æƒ³å¿…å¤§å®¶éƒ½çŸ¥é“å°±ä¸åœ¨è§£é‡Šäº†ï¼Œ&lt;code&gt;ADJ&lt;/code&gt; ä½•è§£ï¼Ÿ &lt;code&gt;Adjustment&lt;/code&gt;ï¼Œè°ƒæ•´ï¼Œå³å†…å­˜æº¢å‡ºè°ƒæ•´çš„é˜ˆå€¼ã€‚&lt;code&gt;LMK&lt;/code&gt; å›æ”¶å†…å­˜æ—¶ä¼šæ ¹æ®è¿›ç¨‹çš„çº§åˆ«ä¼˜å…ˆæ€æ­» &lt;code&gt;OOM_ADJ&lt;/code&gt; æ¯”è¾ƒå¤§çš„è¿›ç¨‹ï¼Œå¯¹äºä¼˜å…ˆçº§ç›¸åŒçš„è¿›ç¨‹åˆ™è¿›ä¸€æ­¥å—åˆ°è¿›ç¨‹æ‰€å å†…å­˜å’Œè¿›ç¨‹å­˜æ´»æ—¶é—´çš„å½±å“ã€‚å…³äºè¿™éƒ¨åˆ†å†…å®¹å¤§å®¶å¯ä»¥å‚çœ‹ &lt;a href=&quot;http://gityuan.com/2016/09/17/android-lowmemorykiller/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android LowMemoryKiller åŸç†åˆ†æ&lt;/a&gt;è¿™ç¯‡æ–‡ç« ï¼Œä»Šå¤©å¹¶ä¸ä¸»è¦åˆ†ææºç ï¼Œæˆ‘ä»¬å¼€çœ‹ä¸€ä¸ªå…³äº OOM_ADJ çš„å¯¹åº”è¡¨ï¼ˆå‚ç…§æºç   &lt;code&gt;com.android.server.am.ProcessList&lt;/code&gt; ä¸­å®šä¹‰çš„å–å€¼æ•´ç†ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/oom_adj.png&quot; alt=&quot;oom_adj&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­çº¢è‰²éƒ¨åˆ†ä»£è¡¨æ¯”è¾ƒå®¹æ˜“è¢«æ€æ­»çš„ Android è¿›ç¨‹ï¼ˆ OOM_ADJ &amp;gt;= 4 ï¼‰,ç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºä¸å®¹æ˜“è¢«æ€æ­»çš„ Android è¿›ç¨‹ï¼Œå…¶ä»–è¡¨ç¤ºé Android è¿›ç¨‹ï¼ˆçº¯ Linux è¿›ç¨‹ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-3-è¿›ç¨‹ä¿æ´»&quot;&gt;&lt;a href=&quot;#2-3-è¿›ç¨‹ä¿æ´»&quot; class=&quot;headerlink&quot; title=&quot;2.3 è¿›ç¨‹ä¿æ´»&quot;&gt;&lt;/a&gt;2.3 è¿›ç¨‹ä¿æ´»&lt;/h4&gt;&lt;p&gt;æ ¹æ®ä»¥ä¸Šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±è¦æƒ³æ–¹è®¾æ³•é™ä½æˆ‘ä»¬åº”ç”¨çš„ OOM_ADJ çš„å€¼ï¼Œé‚£ä¹ˆæ€ä¹ˆé™ä½å‘¢ï¼Ÿè¿™æ—¶å€™å°±ä¾èµ–ç¿»çœ‹ä¸€äº›æºç äº†ï¼Œåœ¨ &lt;code&gt;ActivityManagerService&lt;/code&gt; ä¸­æœ‰ä¸€ä¸ª &lt;code&gt;updateOomAdjLocked&lt;/code&gt; å‡½æ•°ï¼Œåœ¨è®¸å¤šåœ°æ–¹è¢«è°ƒç”¨å»æ›´æ–°åº”ç”¨çš„ OOM_ADJ å€¼ï¼Œåœ¨è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨é“¾ä¸­æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ª &lt;code&gt;computeOomAdjLocked&lt;/code&gt; å‡½æ•°ç”¨äºè®¡ç®— App çš„ OOM_ADJ çš„å€¼ï¼Œä»¥ä¸‹æˆ‘ä»¬æˆªå–éƒ¨åˆ†ä»£ç åšç®€å•åˆ†æï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityManagerNative&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Watchdog&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Monitor&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;BatteryStatsImpl&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;BatteryCallback&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;computeOomAdjLocked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ProcessRecord app, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; cachedAdj, ProcessRecord TOP_APP,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; doingAll, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; now)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        app.systemNoUi = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Determine the importance of the process, starting with most&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// important to least, and assign an appropriate OOM adjustment.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; adj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; schedGroup;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; procState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; foregroundActivities = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BroadcastQueue queue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (app == TOP_APP) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// The last app on the list is the foreground app.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯å‰å°åº”ç”¨ç¨‹åº,è¿™å–å†³äºç”¨æˆ·çš„æ“ä½œï¼Œæˆ‘ä»¬æ— æ³•å¹²é¢„ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            adj = ProcessList.FOREGROUND_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedGroup = Process.THREAD_GROUP_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;top-activity&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            foregroundActivities = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            procState = ActivityManager.PROCESS_STATE_TOP;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (app.instrumentationClass != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Don&#39;t want to kill running instrumentation.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// è¿™ä¸ªcaseå¯ä»¥å°è¯•ï¼Œå¯å°† app adj å€¼é™ä½è‡³ 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            adj = ProcessList.FOREGROUND_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedGroup = Process.THREAD_GROUP_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;instrumentation&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            procState = ActivityManager.PROCESS_STATE_IMPORTANT_FOREGROUND;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((queue = isReceivingBroadcast(app)) != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// An app that is currently receiving a broadcast also&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// counts as being in the foreground for OOM killer purposes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// It&#39;s placed in a sched group based on the nature of the&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// broadcast as reflected by which queue it&#39;s active in.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// è¿™ä¸ª case è¦æ±‚ app æ­£åœ¨æˆ–å°†è¦æ¥æ”¶å¹¿æ’­,å¯ä»¥å°è¯•ä½†æ“ä½œéš¾åº¦è¾ƒé«˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            adj = ProcessList.FOREGROUND_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedGroup = (queue == mFgBroadcastQueue)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ? Process.THREAD_GROUP_DEFAULT : Process.THREAD_GROUP_BG_NONINTERACTIVE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;broadcast&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            procState = ActivityManager.PROCESS_STATE_RECEIVER;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (app.executingServices.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// An app that is currently executing a service callback also&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// counts as being in the foreground.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œä»£ç çš„ Service å¯å°† adj çš„å€¼è°ƒæ•´è‡³ 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            adj = ProcessList.FOREGROUND_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedGroup = app.execServicesFg ?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Process.THREAD_GROUP_DEFAULT : Process.THREAD_GROUP_BG_NONINTERACTIVE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;exec-service&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            procState = ActivityManager.PROCESS_STATE_SERVICE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//Slog.i(TAG, &quot;EXEC &quot; + (app.execServicesFg ? &quot;FG&quot; : &quot;BG&quot;) + &quot;: &quot; + app);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// As far as we know the process is empty.  We may change our mind later.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedGroup = Process.THREAD_GROUP_BG_NONINTERACTIVE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// At this point we don&#39;t actually know the adjustment.  Use the cached adj&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// value that the caller wants us to.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            adj = cachedAdj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            procState = ActivityManager.PROCESS_STATE_CACHED_EMPTY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.cached = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.empty = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;cch-empty&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Examine all activities if not already foreground.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!foregroundActivities &amp;amp;&amp;amp; activitiesSize &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt; activitiesSize; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ActivityRecord r = app.activities.get(j);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r.app != app) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Slog.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Wtf, activity &quot;&lt;/span&gt; + r + &lt;span class=&quot;string&quot;&gt;&quot; in proc activity list not using proc &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            + app + &lt;span class=&quot;string&quot;&gt;&quot;?!?&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r.visible) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// App has a visible activity; only upgrade adjustment.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// ç»´æŠ¤ä¸€ä¸ªç”¨æˆ·ä¸å¯è§çš„ Activity å¯ä»¥å°†åº”ç”¨çš„ adj é™ä½è‡³ 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (adj &amp;gt; ProcessList.VISIBLE_APP_ADJ) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        adj = ProcessList.VISIBLE_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;visible&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (procState &amp;gt; ActivityManager.PROCESS_STATE_TOP) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        procState = ActivityManager.PROCESS_STATE_TOP;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    schedGroup = Process.THREAD_GROUP_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    app.cached = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    app.empty = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    foregroundActivities = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (adj &amp;gt; ProcessList.PERCEPTIBLE_APP_ADJ) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// ç»´æŠ¤ä¸€ä¸ªå‰å° Service å¯å°† app adjå€¼é™ä½è‡³ 2.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (app.foregroundServices) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// The user is aware of this app, so make it visible.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                adj = ProcessList.PERCEPTIBLE_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                procState = ActivityManager.PROCESS_STATE_IMPORTANT_FOREGROUND;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                app.cached = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;fg-service&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                schedGroup = Process.THREAD_GROUP_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (app.forcingToForeground != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// The user is aware of this app, so make it visible.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                adj = ProcessList.PERCEPTIBLE_APP_ADJ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                procState = ActivityManager.PROCESS_STATE_IMPORTANT_FOREGROUND;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                app.cached = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                app.adjType = &lt;span class=&quot;string&quot;&gt;&quot;force-fg&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                app.adjSource = app.forcingToForeground;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                schedGroup = Process.THREAD_GROUP_DEFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç»è¿‡æˆ‘ä»¬çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å°è¯•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°è¯•åœ¨ Manifest ä¸­æ³¨å†Œä¸€ä¸ª Instrumentation&lt;/li&gt;
&lt;li&gt;å°è¯•ç»´æŠ¤ä¸€ä¸ªç”¨æˆ·æ— æ³•æ„ŸçŸ¥çš„ Activity&lt;/li&gt;
&lt;li&gt;å°è¯•ç»´æŒä¸€ä¸ªå‰å° Service&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–è¿˜å¯ä»¥è€ƒè™‘æ°¸åŠ¨æœºå¼çš„ Service åŠä¸åœçš„æ”¶å‘å¹¿æ’­è¿™ä¸¤ç§å˜æ€çš„æ–¹æ¡ˆï¼Œåœ¨å®è·µä¸­è€ƒè™‘åˆ°å¯¹æ€§èƒ½åŠçš„è€—ç”µé‡çš„å½±å“ï¼Œè¿™ä¸¤æ¡å¹¶æ²¡æœ‰å°è¯•ã€‚åŸºäºä»¥ä¸Šçš„åˆ†æå¯å°† App çš„ OOM_ADJ çš„é™ä½è‡³ 2ï¼Œæœ€ä½å¯ä»¥é™ä½è‡³ 0ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆåœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ App æ²¡æœ‰ç»è¿‡ä»¥ä¸Šæ–¹æ¡ˆçš„å¤„ç†ï¼Œå®ƒçš„ OOM_ADJ çš„å€¼å¦‚ä½•ï¼Œæœ€ä¸ºå¯¹æ¯”å‚è€ƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯åŠ¨ App é€šè¿‡ &lt;code&gt;ps&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹å¯¹åº”çš„ &lt;code&gt;pid&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#10140;  ~ ps | grep solart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;u0_a250   3855  162   931684 43932 ffffffff 00000000 S cc.solart.nuts&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; æˆ‘ä»¬å†é€šè¿‡ &lt;code&gt;cat&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹ oom_adj çš„å€¼ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#10140;  ~ cat /proc/3855/oom_adj&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡æŒ‰ Home é”®ï¼Œåœ¨æŸ¥çœ‹ oom_adj çš„å€¼ï¼Œè¾“å‡ºä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡æŒ‰ Back é”®ç›˜é€€å‡ºé¡µé¢ï¼Œoom_adj çš„å€¼è¾“å‡ºä¸º&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡åšçš„æ—¶å€™ï¼ŒApp è¿›å…¥åå°å’Œé¡µé¢é€€å‡ºå OOM_ADJ çš„å€¼å…¶å®å·²ç»éå¸¸é«˜äº†ï¼Œå¦‚æœæ­¤æ—¶ç³»ç»Ÿå†…å­˜ç´§å¼ ï¼Œåˆ™æœ‰æ¯”è¾ƒå¤§çš„æ¦‚ç‡ä¼šè¢«å¹²æ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å°è¯•ä¿æ´»æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°è¯•åœ¨ Manifest ä¸­æ³¨å†Œä¸€ä¸ª Instrumentation&lt;/strong&gt;ï¼šè¿™ä¸ªæ–¹æ¡ˆåœ¨æ‰§è¡Œæ—¶éªŒè¯æ— æ•ˆï¼Œå¹¶æ²¡æœ‰æœ‰æ•ˆçš„é™ä½ adj å€¼ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸èƒ½ç”Ÿæ•ˆï¼Œè¿˜æ²¡æœ‰æå¾—å¤ªæ˜ç™½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°è¯•ç»´æŠ¤ä¸€ä¸ªç”¨æˆ·æ— æ³•æ„ŸçŸ¥çš„ Activity&lt;/strong&gt;ï¼šè¿™ä¸ªæ–¹æ¡ˆç¡®å®æœ‰æ•ˆçš„é™ä½äº†adjçš„å€¼ï¼Œä½†åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œåœ¨æŸäº›æœºå™¨ä¸Šå› ä¸ºå¹¿æ’­å»¶è¿Ÿçš„åŸå›  Activity æ— æ³•åŠæ—¶é”€æ¯ï¼Œå¯¼è‡´äº®å±å¹•åæœ‰ä¸€ç¬é—´ç”¨æˆ·æ˜¯æ— æ³•æ“ä½œçš„ï¼Œè¿™ä¸ªæ–¹æ¡ˆè¢« Passã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°è¯•ç»´æŒä¸€ä¸ªå‰å° Service&lt;/strong&gt;ï¼š è¿™æ˜¯ä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­å‘ç°å‘é€ç©º Notification åœ¨æŸäº›æœºå‹ä¸Šä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œååˆæ”¹ä¸ºæœ‰å†…å®¹çš„é€šçŸ¥ï¼Œä½†è¿™ä¼šåœ¨é€šçŸ¥æ ä¸Šé—ªä¸€ä¸‹ï¼Œä½†é€šè¿‡æµ‹è¯•å‘ç°ç¡®å®èƒ½å¤Ÿæœ‰æ•ˆè®© App çš„ adj å€¼ç»´æŒåœ¨ 2 çš„æ°´å¹³ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;KeepAliveService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Service&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; NOTIFICATION_ID = &lt;span class=&quot;number&quot;&gt;1001&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Nullable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IBinder &lt;span class=&quot;title&quot;&gt;onBind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStartCommand&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; startId)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Log.d(&lt;span class=&quot;string&quot;&gt;&quot;nuts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;KeepAliveService onStartCommand invoke&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            startForeground(NOTIFICATION_ID, getNotification(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Intent innerIntent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, InnerService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            startService(innerIntent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//nothing to do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// åˆ©ç”¨ç³»ç»Ÿè‡ªå¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; START_STICKY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InnerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Service&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Nullable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IBinder &lt;span class=&quot;title&quot;&gt;onBind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStartCommand&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; startId)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Log.d(&lt;span class=&quot;string&quot;&gt;&quot;nuts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;InnerService onStartCommand invoke&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                startForeground(NOTIFICATION_ID, getNotification(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                stopSelf();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;//nothing to do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onStartCommand(intent, flags, startId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Notification &lt;span class=&quot;title&quot;&gt;getNotification&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context ctx)&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Notification notify = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NotificationCompat.Builder(ctx)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setSmallIcon(R.drawable.ic_launcher)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setContentTitle(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setContentText(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setAutoCancel(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .build();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; notify;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¹¶åœ¨ Manifest ä¸­ç”Ÿå‘½è¿™ä¸¤ä¸ª Service ç»„ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#60;service android:name=&amp;#34;.push.KeepAliveService&amp;#34; /&amp;#62;&amp;#10;&amp;#10;&amp;#60;service android:name=&amp;#34;.push.KeepAliveService$InnerService&amp;#34;/&amp;#62;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡æŒ‰å‹ Home/Back é”®ï¼Œå†æ¬¡é€šè¿‡ cat å‘½ä»¤æŸ¥çœ‹ oom_adj çš„å€¼ï¼Œè¾“å‡ºä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¤§å®¶å¯¹æ¯”æˆ‘ä»¬ä¸åšå¤„ç†æ—¶çš„ oom_adj å€¼ï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°å·®åˆ«ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3ã€è¿›ç¨‹å”¤é†’&quot;&gt;&lt;a href=&quot;#3ã€è¿›ç¨‹å”¤é†’&quot; class=&quot;headerlink&quot; title=&quot;3ã€è¿›ç¨‹å”¤é†’&quot;&gt;&lt;/a&gt;3ã€è¿›ç¨‹å”¤é†’&lt;/h2&gt;&lt;p&gt;é€šè¿‡ä»¥ä¸Šä¿æ´»çš„ç­–ç•¥ç¡®å®è®© App é¿å…è¿‡å¿«çš„è¢«ç³»ç»Ÿå¹²æ‰ï¼Œä½†ç”¨æˆ·ç»å¸¸æ‰‹åŠ¨æ¸…ç†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œé‚£å¦‚ä½•èƒ½å¤Ÿåœ¨ App è¢«æ€æ­»åå°†å…¶å”¤èµ·ï¼Œåˆ™æˆä¸ºäº†ç¬¬äºŒé˜¶æ®µçš„ç›®æ ‡ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-å¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰&quot;&gt;&lt;a href=&quot;#3-1-å¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰&quot; class=&quot;headerlink&quot; title=&quot;3.1 å¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰&quot;&gt;&lt;/a&gt;3.1 å¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰&lt;/h4&gt;&lt;p&gt;å¸‚é¢ä¸Šæ¨é€ SDK é€‰æ‹©éå¸¸å¤šï¼Œæˆ‘ä»¬åœ¨é›†æˆæ¨é€ SDK æ—¶åˆä¸æƒ³æ¯ä¸ªéƒ½é›†æˆä¸€éï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è€äº›èŠ±æ‹›äº†ï¼Œå¤§å®¶çŸ¥é“ï¼Œç”¨æˆ·æ´»è·ƒåº¦é«˜çš„ App å¤§å¤šæ˜¯ BAT ç³»çš„ï¼Œæˆ‘ä»¬ä¸å¦¨å°±ä»è¿™é‡Œå…¥æ‰‹ï¼Œè‡ªå·±ä½“ç³»çš„ App å¤§éƒ½ä¼šé›†æˆè‡ªå®¶çš„æ¨é€æœåŠ¡ï¼ˆä½ å¯ä»¥åç¼–è¯‘å‡ ä¸ªçœ‹çœ‹ï¼Œåç¼–è¯‘å¾®ä¿¡å¹¶æ²¡æœ‰å‘ç°å…¶ç”¨åˆ°ä»€ä¹ˆæ¨é€ï¼Œæƒ³æƒ³æœ¬èº«å¾®ä¿¡ä¹Ÿæ˜¯å³æ—¶é€šè®¯ç±»çš„ App ä¹Ÿå°±æ˜ç™½äº†ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬å°±æ‹¿ç™¾åº¦æ¨é€ SDK å¼€åˆ€äº†ï¼Œé¦–å…ˆå®˜ç½‘ä¸‹è½½ SDK åŒ…ï¼Œå…¶ä¸­æ‰¾åˆ°å¼€å‘æ–‡æ¡£ï¼Œé˜…è¯» SDK é›†æˆæ–¹æ³•ï¼Œä»ä¸­æ‰¾åˆ°è››ä¸é©¬è¿¹ï¼Œå…·ä½“è¿‡ç¨‹å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œå¤§å®¶è‡ªå·±å»çœ‹ä¸€ä¸‹ï¼Œå°±èƒ½å¤Ÿæ˜ç™½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç™¾åº¦æ¨é€ SDK ä¸­ï¼Œæˆ‘ä»¬å‘ç°åœ¨ &lt;code&gt;CommandService&lt;/code&gt; ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¢«æ··æ·†çš„ä»£ç ï¼Œä½†ä»ç„¶ä¸å¦¨ç¢æˆ‘ä»¬å»å¤§è‡´çŒœæµ‹å…¶å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CommandService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Service&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent var1)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String var2 = t.c(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getPackageName(), var1.getAction());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        t.b(&lt;span class=&quot;string&quot;&gt;&quot;CommandService#onStartCommand#reflectReceiver#recevier = &quot;&lt;/span&gt; + var2, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(TextUtils.isEmpty(var2)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            a.b(&lt;span class=&quot;string&quot;&gt;&quot;CommandService&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot; reflectReceiver error: receiver for: &quot;&lt;/span&gt; + var1.getAction() + &lt;span class=&quot;string&quot;&gt;&quot; not found, package: &quot;&lt;/span&gt; + &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getPackageName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            var1.setPackage(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getPackageName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.sendBroadcast(var1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Class var3 = Class.forName(var2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Constructor var4 = var3.getConstructor(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Class[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Object var5 = var4.newInstance(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Object[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                String[] var10000 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; String[]&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;android.content.Context&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;android.content.Intent&quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Class[] var7 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Class[]&amp;#123;Context.class, Intent.class&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Method var8 = var3.getMethod(&lt;span class=&quot;string&quot;&gt;&quot;onReceive&quot;&lt;/span&gt;, var7);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                var1.setClassName(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getPackageName(), var2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Object[] var9 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Object[]&amp;#123;&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getApplicationContext(), var1&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                var8.invoke(var5, var9);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception var11) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                a.a(&lt;span class=&quot;string&quot;&gt;&quot;CommandService&quot;&lt;/span&gt;, var11);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶å®æˆ‘ä»¬å‘ç°ç™¾åº¦é€šè¿‡åå°„ &lt;code&gt;BroadcastReceiver&lt;/code&gt; ä¸­ &lt;code&gt;onReceive&lt;/code&gt; å‡½æ•°è°ƒç”¨æ¥å”¤é†’é›†æˆäº†ç™¾åº¦æ¨é€çš„ App ï¼Œé‚£æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬å¹²è„†æµ‹è¯•ä¸€ä¸‹ï¼Œå°†ç™¾åº¦çš„ &lt;code&gt;RegistrationReceiver&lt;/code&gt; åšå£³ï¼Œåœ¨å…¶ä¸­å¯åŠ¨è‡ªå·±çš„æ¨é€æœåŠ¡ï¼Œæ¥ä¸‹æ¥å°±ç®€å•çš„åšå£³åŠåœ¨ Manifest ä¸­æ³¨å†Œã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RegistrationReceiver&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BroadcastReceiver&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(&lt;span class=&quot;string&quot;&gt;&quot;nuts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;baidu onReceiver invoke&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Intent daemonIntent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(context, KeepAliveService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        context.startService(daemonIntent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰‹åŠ¨æ€æ­»è‡ªå·±çš„ App æ¨¡æ‹Ÿè¢«ç³»ç»Ÿæ€æ­»ï¼Œé€šè¿‡ logcat è¿‡æ»¤ log å¹¶å¯åŠ¨ç™¾åº¦åœ°å›¾æˆ–å…¶ä»–ç™¾åº¦ç³» App è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;âœ  ~ adb logcat -s nuts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--------- beginning of /dev/log/system&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--------- beginning of /dev/log/main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D/nuts    (&lt;span class=&quot;number&quot;&gt;12804&lt;/span&gt;): baidu onReceiver invoke&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D/nuts    (&lt;span class=&quot;number&quot;&gt;20650&lt;/span&gt;): KeepAliveService onStartCommand invoke&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D/nuts    (&lt;span class=&quot;number&quot;&gt;20650&lt;/span&gt;): InnerService onStartCommand invoke&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Š log æˆ‘ä»¬å°±çœ‹å‡ºé€šè¿‡å…¶ä»– App æˆåŠŸå°†æˆ‘ä»¬è‡ªå·±çš„ App å”¤é†’äº†ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»å°è¯•å…¶ä»–ç°è±¡çº§ App æˆ–å·ç§°è‡ªå·±å…·æœ‰å”¤é†’åŠŸèƒ½çš„æ¨é€ SDK ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ªå·¥ä½œé‡çš„é—®é¢˜äº†ï¼Œå°±ä¸åœ¨ä»‹ç»ã€‚å½“ç„¶æœ‰äº› App é—´é€šè¿‡æŒ‡å®šåº”ç”¨åŒ…åå”¤é†’ï¼Œé¢å¯¹è¿™æ ·çš„æ–¹å¼æˆ‘ä»¬å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ï¼Œéƒ¨åˆ†æœºå‹ ROM é˜»æ–­äº†åº”ç”¨é—´å”¤é†’ï¼Œè¿™ä¸ªæ‹›å¼å¹¶ä¸èƒ½è¦†ç›–åˆ°å…¨éƒ¨æœºå‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬&quot;&gt;&lt;a href=&quot;#3-2-æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬&quot; class=&quot;headerlink&quot; title=&quot;3.2 æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬&quot;&gt;&lt;/a&gt;3.2 æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬&lt;/h4&gt;&lt;p&gt;ä¿—è¯è¯´æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬ï¼Œæ±‚äººä¸å¦‚é è‡ªå·±ã€‚åœ¨ Android 5.0 ä»¥åç³»ç»Ÿæ”¶ç´§äº†è¿›ç¨‹çš„ç®¡ç†ï¼Œä»¥èŠ‚çº¦ç”¨æˆ·ç”µé‡æ¶ˆè€—ï¼Œä½†ä»ç„¶æä¾›ä»¥ä¸€ä¸ªæ–°çš„ &lt;a href=&quot;https://developer.android.com/reference/android/app/job/JobScheduler.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;JobScheduler&lt;/code&gt;&lt;/a&gt; API ï¼Œå…è®¸åº”ç”¨åœ¨æŸä¸ªæ—¶é—´æˆ–è€…æŒ‡å®šçš„æ¡ä»¶ä¸‹ï¼ˆä¾‹å¦‚ï¼Œè®¾å¤‡å……ç”µæ—¶ï¼‰å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚å®˜æ–¹æ¨å‡ºè¿™ä¸ª API çš„å‡ºå‘ç‚¹æ˜¯å¥½çš„ï¼Œä½†ä¹Ÿè®©æˆ‘ä»¬æœ‰ç©ºå­å¯é’»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥é€šè¿‡ç»§æ‰¿ &lt;code&gt;JobService&lt;/code&gt; æ¥å®ç°ä¸€ä¸ª &lt;code&gt;WakeUpService&lt;/code&gt; :&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@TargetApi&lt;/span&gt;(Build.VERSION_CODES.LOLLIPOP)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WakeUpService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;JobService&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStartJob&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(JobParameters jobParameters)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(&lt;span class=&quot;string&quot;&gt;&quot;nuts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;WakeUpService onStartJob&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// to start push service or something else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Intent daemonIntent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, KeepAliveService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        startService(daemonIntent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStopJob&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(JobParameters jobParameters)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startJobScheduler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context ctx)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; jobId = &lt;span class=&quot;number&quot;&gt;1002&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            JobInfo.Builder builder = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; JobInfo.Builder(jobId, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ComponentName(ctx, WakeUpService.class));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// è°ƒæ•´å¯åŠ¨ service é—´éš”æ—¶é—´ï¼Œè¿™é‡Œä¸ºäº†æµ‹è¯•éšæ„å†™äº† 5 ç§’&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            builder.setPeriodic(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            builder.setPersisted(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            JobScheduler jobScheduler = (JobScheduler) ctx.getSystemService(Context.JOB_SCHEDULER_SERVICE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            jobScheduler.schedule(builder.build());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åŒæ ·çš„åœ¨ Manifest ä¸­æ³¨å†Œè¿™ä¸ªæœåŠ¡:&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;.push.WakeUpService&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;attribute&quot;&gt;android:permission&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;android.permission.BIND_JOB_SERVICE&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å†æ¬¡æ€æ‰è¿›ç¨‹è§‚å¯Ÿ log è¾“å‡ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#10140;  ~ adb logcat -s nuts&amp;#10;- waiting for device -&amp;#10;--------- beginning of /dev/log/system&amp;#10;--------- beginning of /dev/log/main&amp;#10;11-28 16:34:35.821  5675  5675 D nuts    : WakeUpService onStartJob&amp;#10;11-28 16:34:35.821  5675  5675 D nuts    : KeepAliveService onStartCommand invoke&amp;#10;11-28 16:34:35.841  5675  5675 D nuts    : InnerService onStartCommand invoke&amp;#10;11-28 16:34:40.871  5675  5675 D nuts    : WakeUpService onStartJob&amp;#10;11-28 16:34:40.881  5675  5675 D nuts    : KeepAliveService onStartCommand invoke&amp;#10;11-28 16:34:40.901  5675  5675 D nuts    : InnerService onStartCommand invoke&amp;#10;11-28 16:34:45.931  5675  5675 D nuts    : WakeUpService onStartJob&amp;#10;11-28 16:34:45.931  5675  5675 D nuts    : KeepAliveService onStartCommand invoke&amp;#10;11-28 16:34:45.951  5675  5675 D nuts    : InnerService onStartCommand invoke&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° App è¢«æ€æ­»åï¼Œè¿˜æ˜¯è¢«å”¤èµ·äº†ã€‚å³ä½¿é€šè¿‡ä¸€é”®æ¸…ç†ä»ç„¶èƒ½å¤Ÿå”¤é†’ï¼Œç›®å‰ç»è¿‡æµ‹è¯•åœ¨ 5.0 ä¹‹åçš„æœºå‹è¿˜æš‚æ²¡æœ‰é‡åˆ°ä¸èƒ½å”¤é†’çš„ case ã€‚å½“ç„¶å¦‚æœå‚å•†å°†ä½ çš„ App åŠ å…¥äº†é»‘åå•é‚£æ˜¯æ— è®ºå¦‚ä½•ä¹Ÿèµ·ä¸æ¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4ã€æ€»ç»“&quot;&gt;&lt;a href=&quot;#4ã€æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;4ã€æ€»ç»“&quot;&gt;&lt;/a&gt;4ã€æ€»ç»“&lt;/h2&gt;&lt;p&gt;å½“ç„¶é™¤äº†è¿™äº›æ‰‹æ®µï¼Œè¿˜é’ˆå¯¹é€šçŸ¥æƒé™åšäº†ä¸€äº›ç ”ç©¶ï¼Œåœ¨ Android 4.3/4.4 ä¸Šå¯ä»¥å¼ºè¡Œæ‰“å¼€ç”¨æˆ·é€šçŸ¥æƒé™ï¼Œåœ¨ 5.0 åè°·æ­Œçˆ¸çˆ¸ä¿®å¤äº†è¿™ä¸ªæ¼æ´ï¼Œç”±äºè¦†ç›–ç‰ˆæœ¬è¾ƒå°ï¼Œè¿™é‡Œå°±ä¸åœ¨åˆ†äº«ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šæˆ‘ä»¬é€šè¿‡ç§ç§æ‰‹æ®µå°† App åšåˆ°äº†å³ä½¿åœ¨åå°ä¾ç„¶èƒ½å¤Ÿä½¿ OOM_ADJ çš„å€¼ç»´æŒåœ¨ 2 çš„æ°´å¹³ï¼Œä»è€Œæœ‰æ•ˆçš„æå‡äº† Push çš„é€è¾¾ç‡ã€‚è€Œå¤§å®¶åœ¨é€‰æ‹© Push æœåŠ¡æ—¶å¯ä»¥å¤šè€ƒè™‘å°ç±³ã€åä¸ºè¿™æ ·å‚å•†æ”¯æŒçš„æ¨é€ï¼Œæ¯•ç«Ÿåœ¨è‡ªå®¶çš„å¹³å°ä¸Šè¿˜æ˜¯æ¯”ä¸€èˆ¬çš„æ¨é€æœ‰ç³»ç»Ÿçº§è¿›ç¨‹çš„ä¼˜åŠ¿å­˜åœ¨ã€‚åœ¨ Google æœåŠ¡æ— æ³•å›å½’çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯¸å¤šå‚å•†è”åˆèµ·æ¥æ¨å‡ºä¸€ä¸ª Push æœåŠ¡â€¦ç®—äº†ä¸åœ¨ YY äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä»¥ä¸Šæ‰€æœ‰æ‰‹æ®µè¯·æ…é‡ä½¿ç”¨ï¼&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ KPI è€ƒæ ¸èƒŒæ™¯ä¸‹äº§å‡ºçš„æ–‡ç« ï¼Œè¿™ä¸€åˆ‡éƒ½èµ·æºäºæˆ‘å¸è¦æ±‚æå‡ App æ¨é€é€è¾¾ç‡ï¼Œä»¥èŠ‚çœåœ¨çŸ­ä¿¡æ¨å¹¿ä¸ŠèŠ±è´¹çš„å¼€é”€ã€‚è¿™é‡Œè®°å½•äº†åœ¨æ•´ä¸ªæŠ€æœ¯è°ƒç ”çš„å…³é”®ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;&lt;code&gt;iOS&lt;/code&gt; å’Œ &lt;code&gt;Android&lt;/code&gt; å‡åœ¨ç³»ç»Ÿçº§é›†æˆäº†æ¨é€æœåŠ¡ï¼Œæ¥è¯´è¯´&lt;code&gt;åŸç”Ÿ Android&lt;/code&gt; çš„æ¨é€æœåŠ¡ï¼Œæœ€åœ¨ Android 2.2 æ—¶ï¼Œ&lt;code&gt;C2DM&lt;/code&gt; ä½œä¸ºç³»ç»Ÿçº§æœåŠ¡é›†æˆè¿›äº† &lt;code&gt;Android&lt;/code&gt; ç³»ç»Ÿï¼Œè€Œ &lt;code&gt;GCMï¼ˆGoogle Clould Messagingï¼‰&lt;/code&gt; åœ¨ 2013 Google IO å¤§ä¼šå‘å¸ƒåå°±æ­£å¼å–ä»£äº† &lt;code&gt;C2DM&lt;/code&gt; ï¼Œç„¶å Google å¹¶æ²¡æœ‰æ­¢æ­¥ï¼Œåœ¨ 2014 å¹´æ”¶è´­äº† &lt;a href=&quot;https://en.wikipedia.org/wiki/Firebase&quot;&gt;&lt;code&gt;Firebase&lt;/code&gt;&lt;/a&gt; ï¼Œç»è¿‡è¿‘ä¸¤å¹´çš„æ•´åˆï¼Œåœ¨ 2016 å¹´ Google IO å¤§ä¼šä¸Šéš†é‡å‘å¸ƒäº† Firebase æœåŠ¡ï¼Œä¸€ä¸ªå…¨æ–°çš„ç§»åŠ¨å’Œ Web å¼€å‘çš„å®Œæ•´åç«¯è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†&lt;code&gt;FCMï¼ˆFirebase Cloud Messagingï¼‰&lt;/code&gt;ã€‚å¦‚æœå°±è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Android å¹³å°ä¸Šåƒ iOS å¹³å°ä¸€æ ·ä½¿ç”¨ç³»ç»Ÿçº§å…±äº«çš„æ¨é€æœåŠ¡äº†ï¼Œç„¶è€Œä¸€è‚¡ç¥ç§˜çš„ä¸œæ–¹åŠ›é‡æ‰“ç ´äº†åŸæœ¬ç®€å•çš„äº‹æƒ…â€¦&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>VirtualApp Hook æ¡†æ¶åˆ†æ</title>
    <link href="http://solart.cc/2016/11/25/va_hook/"/>
    <id>http://solart.cc/2016/11/25/va_hook/</id>
    <published>2016-11-25T01:30:06.000Z</published>
    <updated>2017-02-06T07:55:23.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;å¯¹äºæ’ä»¶åŒ–æ¡†æ¶ &lt;code&gt;Hook&lt;/code&gt; æœºåˆ¶æ˜¯ä¸€ä¸ªæ ¸å¿ƒï¼Œé‚£åˆ°åº• &lt;code&gt;Hook&lt;/code&gt; æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆå»ç†è§£æ’ä»¶åŒ–ä¸­çš„ &lt;code&gt;Hook&lt;/code&gt; å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥æ’ä»¶åŒ–ä¸­çš„ &lt;code&gt;Hook&lt;/code&gt; æœºåˆ¶å°±æ˜¯é€šè¿‡&lt;code&gt;åå°„æ³¨å…¥&lt;/code&gt;å’Œ&lt;code&gt;åŠ¨æ€ä»£ç†&lt;/code&gt;æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥è¯´è¯´ä½•ä¸º&lt;code&gt;åå°„æ³¨å…¥&lt;/code&gt;ï¼Œå¤§å®¶éƒ½çŸ¥é“ä¾èµ–æ³¨å…¥ï¼Œå…¶å®åå°„æ³¨å…¥ç®—æ˜¯ä¾èµ–æ³¨å…¥çš„ä¸€ç§ï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡åå°„çš„æ–¹å¼å°†ä¾èµ–å¯¹è±¡æ³¨å…¥ç›®æ ‡å¯¹è±¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è¦æ›¿æ¢æ‰ &lt;code&gt;ActivityThread&lt;/code&gt; ä¸­çš„ &lt;code&gt;mInstrumentation&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*android.app.ActivityThread.java*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityThread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Instrumentation mInstrumentation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; ActivityThread &lt;span class=&quot;title&quot;&gt;currentActivityThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sCurrentActivityThread;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//Instrumentationä»£ç†ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstrumentationDelegate&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Instrumentation&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Instrumentation base;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstrumentationDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Instrumentation base)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.base = base;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReflectInject&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;reflectInject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// æ ¹æ®å…¨ç±»åè·å–Class&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Class&amp;lt;?&amp;gt; activityThreadClass = Class.forName(&lt;span class=&quot;string&quot;&gt;&quot;android.app.ActivityThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// è·å–æ— å‚çš„currentActivityThreadå‡½æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Method currentActivityThreadMethod = activityThreadClass.getMethod(&lt;span class=&quot;string&quot;&gt;&quot;currentActivityThread&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// è°ƒç”¨currentActivityThreadå‡½æ•°è·å–å½“å‰ActivityThreadå¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        currentActivityThreadMethod.setAccessible(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Object currentActivityThreadObject = currentActivityThreadMethod.invoke(&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// è·å–mInstrumentationå­—æ®µ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Field instrumentationField = activityThreadClass.getDeclaredField(&lt;span class=&quot;string&quot;&gt;&quot;mInstrumentation&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// ç ´åå°è£…è·å–å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        instrumentationField.setAccessible(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Object instrumentationObject = instrumentationField.get(currentActivityThreadObject);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// æ³¨å…¥Instrumentationä»£ç†å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!(instrumentationObject &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; InstrumentationDelegate)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            instrumentationField.set(activityThreadClass, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InstrumentationDelegate((Instrumentation)instrumentationObject));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å¯¹äº &lt;code&gt;mInstrumentation&lt;/code&gt; çš„åå°„æ³¨å…¥ï¼Œå½“ç„¶å‡­å€Ÿå°è£…å¯ä»¥æœ‰æ›´ä¼˜é›…çš„å®ç°ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºè¿‡ç¨‹ç²—æš´ç›´æ¥ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº&lt;code&gt;åŠ¨æ€ä»£ç†&lt;/code&gt;å¤§å®¶å¯ä»¥å‚è€ƒ&lt;a href=&quot;http://www.cnblogs.com/flyoung2008/archive/2013/08/11/3251148.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å½»åº•ç†è§£ Java åŠ¨æ€ä»£ç†&lt;/a&gt;è¿™ç¯‡æ–‡ç« ï¼Œå†™å¾—ååˆ†æ¸…æ™°ã€‚æ–‡ç« æœ€åä¹Ÿæåˆ°äº†åŠ¨æ€ä»£ç†çš„å±€é™æ€§ï¼ŒåŠ¨æ€ä»£ç†æ— æ³•æ”¯æŒå¯¹äºéæ¥å£çš„ç±»è¿›è¡Œä»£ç†ï¼Œæ‰€ä»¥åœ¨ &lt;code&gt;Hook&lt;/code&gt; æ—¶ä¸€èˆ¬ç»“åˆé™æ€ä»£ç†æ¥ç‰¹æ®Šå¤„ç†éœ€è¦ä»£ç†çš„ç±»ï¼Œæ¯”è¾ƒå…¸å‹çš„ä¾‹å­æ˜¯ &lt;code&gt;android.app.Instrumentation&lt;/code&gt; çš„ä»£ç†ã€‚å¥½åœ¨ Android ç³»ç»ŸæœåŠ¡å¤§éƒ½é€šè¿‡ &lt;code&gt;Binder&lt;/code&gt; æœºåˆ¶æ¥å®ç°çš„ï¼Œè€Œ &lt;code&gt;Binder&lt;/code&gt; æœºåˆ¶çš„ C/S æ¶æ„å¯¹äºæ¥å£çš„æ”¯æŒå¤©ç„¶çš„å¥½ï¼Œè¿™å¯¹äºæ•´ä¸ª &lt;code&gt;Hook&lt;/code&gt; æ¡†æ¶ä¸­ä»£ç†ç±»å®ç°çš„å·¥ä½œé‡æ¥è¯´å°±å¤§å¤§çš„å‡å°‘äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€Hook-æ¡†æ¶&quot;&gt;&lt;a href=&quot;#2ã€Hook-æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;2ã€Hook æ¡†æ¶&quot;&gt;&lt;/a&gt;2ã€Hook æ¡†æ¶&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“ Hook æœ¬èº«ä¾èµ–åå°„æœºåˆ¶ï¼Œä»ä¸Šé¢ç¤ºä¾‹ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œç›´æ¥ä½¿ç”¨å¤§é‡åå°„å¯¼è‡´ä»£ç å¯è¯»æ€§ã€ç»´æŠ¤æ€§å˜å¾—éå¸¸å·®ï¼Œä»ä»£ç ç¾è§‚å¯è¯»æ€§ã€æ˜“ç»´æŠ¤æ€§ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªå¯è¯»æ€§å¼ºæ˜“ç»´æŠ¤çš„ Hook æ¡†æ¶æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œç›®å‰ä¼—å¤šå¼€æºçš„æ’ä»¶åŒ–æ¡†æ¶ä¸­ &lt;a href=&quot;https://github.com/asLody/VirtualApp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;VirtualApp&lt;/a&gt; çš„ Hook æ¡†æ¶æ˜¯æœ€ä¼˜ç§€çš„ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œä½œè€…ä½¿ç”¨äº†åŸºäºæ³¨è§£çš„åå°„æ³¨å…¥æŠ€æœ¯ï¼Œåˆç†çš„æ¡†æ¶è®¾è®¡ä½¿å¾—è™½ç„¶ Hook çš„å¯¹è±¡éå¸¸å¤šï¼Œä»£ç å´äº•äº•æœ‰æ¡ï¼Œä¸å¾—ä¸èµå¹ä½œè€… lody çš„å·§å¦™æ„æ€ï¼Œè®©äººå—ç›Šè‰¯å¤šã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹åˆ†æåŸºäº master åˆ†æ”¯ c493161 ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h4 id=&quot;2-1-è®¾è®¡ç±»å›¾&quot;&gt;&lt;a href=&quot;#2-1-è®¾è®¡ç±»å›¾&quot; class=&quot;headerlink&quot; title=&quot;2.1 è®¾è®¡ç±»å›¾&quot;&gt;&lt;/a&gt;2.1 è®¾è®¡ç±»å›¾&lt;/h4&gt;&lt;p&gt; åˆåˆ°äº†ç¥­å‡ºæ³•å®çš„æ—¶å€™äº†ï¼ŒåºŸè¯ä¸å¤šè¯´å…ˆçœ‹è®¾è®¡ç±»å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/va_hook_diagram.png&quot; alt=&quot;VA Diagram&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/images/va_hook_diagram.png&quot;&gt;ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹é«˜æ¸…æ— ç å¤§å›¾&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;2-2-ç±»å›¾è§£æ&quot;&gt;&lt;a href=&quot;#2-2-ç±»å›¾è§£æ&quot; class=&quot;headerlink&quot; title=&quot;2.2 ç±»å›¾è§£æ&quot;&gt;&lt;/a&gt;2.2 ç±»å›¾è§£æ&lt;/h4&gt;&lt;p&gt;é¦–å…ˆä½œè€…è®¾è®¡äº†ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯ &lt;code&gt;Injectable&lt;/code&gt; ï¼Œè¿™ä¸ªæ¥å£æ¯”è¾ƒç®€å•ï¼Œä½¿å®ç°è¿™ä¸ªæ¥å£çš„ç±»éƒ½å…·å¤‡çš„æ³¨å…¥çš„èƒ½åŠ›ï¼›&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Injectable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;inject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isEnvBad&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦ä¸€ä¸ªæ˜¯ &lt;code&gt;IHookObject&lt;/code&gt; ï¼Œä½¿å®ç°è¿™ä¸ªæ¥å£çš„ç±»å…·å¤‡ç®¡ç†ä»£ç†ç±»çš„ &lt;code&gt;Hook å‡½æ•°&lt;/code&gt;èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IHookObject&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;copyHooks&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IHookObject from)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	Map&amp;lt;String, Hook&amp;gt; getAllHooks();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;Hook &lt;span class=&quot;title&quot;&gt;addHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Hook hook)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;Hook &lt;span class=&quot;title&quot;&gt;removeHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String hookName)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;removeHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Hook hook)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;removeAllHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;H extends Hook&amp;gt; &lt;span class=&quot;function&quot;&gt;H &lt;span class=&quot;title&quot;&gt;getHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;Object &lt;span class=&quot;title&quot;&gt;getProxyInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;Object &lt;span class=&quot;title&quot;&gt;getBaseInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getHookCount&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬æåˆ°äº† &lt;code&gt;Hook å‡½æ•°&lt;/code&gt;è¿™ä¸ªæ¦‚å¿µï¼Œæ€ä¹ˆç†è§£è¿™ä¸ªæ¦‚å¿µå‘¢ï¼Œå› ä¸ºåŠ¨æ€ä»£ç†çš„è°ƒç”¨æ˜¯å‡½æ•°çº§åˆ«çš„ï¼Œæ‰€ä»¥ Hook ç›¸å½“äºæ›¿æ¢å‡½æ•°å®ç°ã€‚å†æ¥çœ‹ &lt;code&gt;Hook&lt;/code&gt; è¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªç±»å®šä¹‰äº† Hook çš„å¤„ç†æ—¶æœºï¼Œä»¥åŠæä¾›ä¸€äº› Hook ç¯å¢ƒçš„ä¾èµ–ï¼Œå®ç°ç±»é€šè¿‡æŒ‡å®šä»£ç†å‡½æ•°åï¼Œå¯ä»¥æ ¹æ®éœ€è¦åœ¨ &lt;code&gt;beforeCall&lt;/code&gt; ã€&lt;code&gt;call&lt;/code&gt; ã€ &lt;code&gt;afterCall&lt;/code&gt; æ‰§è¡Œé€»è¾‘å¤„ç†ã€‚æ‰€ä»¥ï¼Œ &lt;code&gt;Hook&lt;/code&gt; çš„å®ç°ç±»å¯ä»¥ç†è§£ä¸ºä»£ç†å‡½æ•°çš„ç±»è±¡åŒ–ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Hook&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; enable = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;beforeCall&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object who, Method method, Object... args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object who, Method method, Object... args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; method.invoke(who, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;afterCall&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object who, Method method, Object[] args, Object result)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isEnable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; enable;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setEnable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; enable)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.enable = enable;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hook$&amp;#123; &quot;&lt;/span&gt; + getName() + &lt;span class=&quot;string&quot;&gt;&quot; &amp;#125;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥çœ‹çœ‹æŠ½è±¡ç±» &lt;code&gt;HookDelegate&lt;/code&gt;  ï¼Œå®ƒæ˜¯ &lt;code&gt;IHookObject&lt;/code&gt; çš„æ¥å£å®ç°ï¼Œåœ¨æ„é€ ä¸­é€šè¿‡ &lt;code&gt;HookHandler&lt;/code&gt; å®Œæˆäº†åŠ¨æ€ä»£ç†ï¼Œå†…éƒ¨ç»´æŠ¤äº† &lt;code&gt;Hook&lt;/code&gt; é›†åˆï¼Œä»£ç å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookDelegate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IHookObject&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TAG = HookDelegate.class.getSimpleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; T mBaseInterface;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; T mProxyInterface;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * å†…éƒ¨ç»´æŠ¤çš„Hooké›†åˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;String, Hook&amp;gt; internalHookMapping = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;String, Hook&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;String, Hook&amp;gt; getAllHooks() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; internalHookMapping;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;?&amp;gt;... proxyInterfaces)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;// è·å–æ¥å£ï¼Œå®ŒæˆåŠ¨æ€ä»£ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mBaseInterface = createInterface();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mBaseInterface != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (proxyInterfaces == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				proxyInterfaces = HookUtils.getAllInterface(mBaseInterface.getClass());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			mProxyInterface = (T) Proxy.newProxyInstance(mBaseInterface.getClass().getClassLoader(), proxyInterfaces, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HookHandler());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			VLog.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Unable to build HookDelegate: %s.&quot;&lt;/span&gt;, getClass().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;((Class[]) &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;createInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;copyHooks&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IHookObject from)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.internalHookMapping.putAll(from.getAllHooks());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// æ·»åŠ  Hook å‡½æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Hook &lt;span class=&quot;title&quot;&gt;addHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Hook hook)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hook != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !TextUtils.isEmpty(hook.getName())) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (internalHookMapping.containsKey(hook.getName())) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				VLog.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Hook(%s) from class(%s) have been added, can&#39;t add again.&quot;&lt;/span&gt;, hook.getName(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						hook.getClass().getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hook;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			internalHookMapping.put(hook.getName(), hook);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hook;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; åŒ…è£…åçš„ä»£ç†å¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;getProxyInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mProxyInterface;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; åŸå¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;getBaseInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mBaseInterface;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookHandler&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InvocationHandler&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;// åŠ¨æ€ä»£ç†ï¼Œé€šè¿‡å‡½æ•°åæ‰¾åˆ°å¯¹åº”çš„ Hook å‡½æ•°ï¼Œå®Œæˆ beforeCallã€callã€afterCall çš„è°ƒç”¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object proxy, Method method, Object[] args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Hook hook = getHook(method.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hook != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; hook.isEnable()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hook.beforeCall(mBaseInterface, method, args)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						Object res = hook.call(mBaseInterface, method, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						res = hook.afterCall(mBaseInterface, method, args, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; res;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; method.invoke(mBaseInterface, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InvocationTargetException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				Throwable cause = e.getTargetException();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (cause != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; cause;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¹äº &lt;code&gt;HookBinderDelegate&lt;/code&gt; è¿™ä¸ªç±»ï¼Œç»§æ‰¿è‡ª &lt;code&gt;HookDelegate&lt;/code&gt; æ‰©å±•äº† &lt;code&gt;IBinder&lt;/code&gt; æ¥å£ï¼Œå€Ÿæ­¤æ–¹ä¾¿å¤„ç†ç³»ç»Ÿ &lt;code&gt;Binder&lt;/code&gt; æœåŠ¡çš„ä»£ç†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookBinderDelegate&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookDelegate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;IInterface&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IBinder&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; IBinder mBaseBinder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookBinderDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;?&amp;gt;... proxyInterfaces)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(proxyInterfaces);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		init();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HookBinderDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		init();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mBaseBinder = getBaseInterface() != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? getBaseInterface().asBinder() : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		addHook(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AsBinder());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//æ­¤å¤„é€šè¿‡åå°„æ›¿æ¢ç³»ç»ŸæœåŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;replaceService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mBaseBinder != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			ServiceManager.sCache.get().put(name, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//è¿™é‡ŒHook asBinderå‡½æ•°ï¼Œä½¿è¯¥å‡½æ•°è°ƒç”¨åè¿”å›ä»£ç†Binderå¯¹è±¡ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AsBinder&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Hook&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;asBinder&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object who, Method method, Object... args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; HookBinderDelegate.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Context &lt;span class=&quot;title&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; VirtualCore.get().getContext();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IInterface &lt;span class=&quot;title&quot;&gt;queryLocalInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String descriptor)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; getProxyInterface();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IBinder &lt;span class=&quot;title&quot;&gt;getBaseBinder&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mBaseBinder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥åœ¨åœ¨æ¥çœ‹ &lt;code&gt;PatchDelegate&lt;/code&gt; è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯ &lt;code&gt;Injectable&lt;/code&gt; çš„æ¥å£å®ç°ï¼Œä¾èµ– &lt;code&gt;@Patch&lt;/code&gt;åŠ &lt;code&gt;@ApiLimit&lt;/code&gt; æ³¨è§£å°† &lt;code&gt;Hook&lt;/code&gt; ç±»çš„æ·»åŠ è¿› &lt;code&gt;Hook&lt;/code&gt; é›†åˆï¼›å®ƒçš„æ³›å‹ä¸º &lt;code&gt;IHookObject&lt;/code&gt; ï¼Œè¿™å°±æ„å‘³ç€ &lt;code&gt;HookDelegate&lt;/code&gt;  &lt;code&gt;HookBinderDelegate&lt;/code&gt; çš„å®ç°ç±»å¾ˆå®¹æ˜“é€šè¿‡æ³›å‹çº¦æŸï¼Œå¹¶é€šè¿‡ &lt;code&gt;inject&lt;/code&gt; æ¥å£å®Œæˆæ³¨å…¥ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchDelegate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IHookObject&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Injectable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; T hookDelegate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; Object baseObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object baseObject)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		attachInterface(baseObject);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;attachInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object baseObject)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.baseObject = baseObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.hookDelegate = createHookDelegate();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		onBindHooks();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		afterHookApply(hookDelegate);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;createHookDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onBindHooks&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (hookDelegate == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;// é€šè¿‡ @Patchã€@ApiLimit æ³¨è§£å°† Hook å‡½æ•°æ·»åŠ è‡³ä»£ç†ç±»çš„ Hook é›†åˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Class&amp;lt;? extends PatchDelegate&amp;gt; clazz = getClass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Patch patch = clazz.getAnnotation(Patch.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; version = Build.VERSION.SDK_INT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (patch != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Class&amp;lt;?&amp;gt;[] hookTypes = patch.value();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Class&amp;lt;?&amp;gt; hookType : hookTypes) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				ApiLimit apiLimit = hookType.getAnnotation(ApiLimit.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; needToAddHook = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (apiLimit != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; apiStart = apiLimit.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; apiEnd = apiLimit.end();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; highThanStart = apiStart == -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; || version &amp;gt; apiStart;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; lowThanEnd = apiEnd == -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; || version &amp;lt; apiEnd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!highThanStart || !lowThanEnd) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						needToAddHook = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (needToAddHook) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					addHook(hookType);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;?&amp;gt; hookType)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Constructor&amp;lt;?&amp;gt; constructor = hookType.getDeclaredConstructors()[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!constructor.isAccessible()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				constructor.setAccessible(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Hook hook;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (constructor.getParameterTypes().length == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				hook = (Hook) constructor.newInstance();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				hook = (Hook) constructor.newInstance(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			hookDelegate.addHook(hook);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;string&quot;&gt;&quot;Unable to instance Hook : &quot;&lt;/span&gt; + hookType + &lt;span class=&quot;string&quot;&gt;&quot; : &quot;&lt;/span&gt; + e.getMessage());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Hook &lt;span class=&quot;title&quot;&gt;addHook&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Hook hook)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hookDelegate.addHook(hook);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;afterHookApply&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(T delegate)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;inject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Context &lt;span class=&quot;title&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; VirtualCore.get().getContext();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;getHookDelegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; hookDelegate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ€åå†æ¥è¯´è¯´ &lt;code&gt;PatchManager&lt;/code&gt; ï¼Œè¿™ä¸ªç±»é¡¾åæ€ä¹‰å°±çŸ¥é“æ˜¯è¡¥ä¸çš„ç®¡ç†ç±»ï¼Œåœ¨è¿™é‡Œå°†å„ä¸ª &lt;code&gt;Patch&lt;/code&gt; å®Œæˆæ³¨å…¥ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchManager&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TAG = PatchManager.class.getSimpleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;Class&amp;lt;?&amp;gt;, Injectable&amp;gt; injectTable = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchManager&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; PatchManager &lt;span class=&quot;title&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; PatchManagerHolder.sPatchManager;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;injectAll&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Injectable injectable : injectTable.values()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			injectable.inject();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// &lt;span class=&quot;doctag&quot;&gt;XXX:&lt;/span&gt; Lazy inject the Instrumentation,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// It is important in many cases.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		addPatch(AppInstrumentation.getDefault());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isInit&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; PatchManagerHolder.sInit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (PatchManagerHolder.sInit) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;string&quot;&gt;&quot;PatchManager Has been initialized.&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		injectInternal();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		PatchManagerHolder.sInit = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;injectInternal&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (VirtualCore.get().isMainProcess()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (VirtualCore.get().isServerProcess()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			addPatch(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ActivityManagerPatch());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			addPatch(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageManagerPatch());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (VirtualCore.get().isVAppProcess()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			addPatch(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LibCorePatch());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			addPatch(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ActivityManagerPatch());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			addPatch(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageManagerPatch());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             addPatch(HCallbackHook.getDefault());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &lt;span class=&quot;comment&quot;&gt;//ä»¥ä¸‹çœç•¥è¯¸å¤šPath&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addPatch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Injectable injectable)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		injectTable.put(injectable.getClass(), injectable);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T extends Injectable&amp;gt; &lt;span class=&quot;function&quot;&gt;T &lt;span class=&quot;title&quot;&gt;findPatch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; clazz)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// noinspection unchecked&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (T) injectTable.get(clazz);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T extends Injectable&amp;gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;checkEnv&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; clazz)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Injectable injectable = findPatch(clazz);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (injectable != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; injectable.isEnvBad()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				injectable.inject();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T extends Injectable, H extends IHookObject&amp;gt; &lt;span class=&quot;function&quot;&gt;H &lt;span class=&quot;title&quot;&gt;getHookObject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; patchClass)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		T patch = findPatch(patchClass);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (patch != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; patch &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; PatchDelegate) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// noinspection unchecked&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (H) ((PatchDelegate) patch).getHookDelegate();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PatchManagerHolder&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; PatchManager sPatchManager = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PatchManager();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; sInit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-3-è¿‡ç¨‹æ¢³ç†&quot;&gt;&lt;a href=&quot;#2-3-è¿‡ç¨‹æ¢³ç†&quot; class=&quot;headerlink&quot; title=&quot;2.3 è¿‡ç¨‹æ¢³ç†&quot;&gt;&lt;/a&gt;2.3 è¿‡ç¨‹æ¢³ç†&lt;/h4&gt;&lt;p&gt;å¦‚æœæ„Ÿè§‰ä»¥ä¸Šå†…å®¹ä¸å¥½ç†è§£çš„è¯ï¼Œä¸‹é¢çš„è¿™å¹…å›¾ï¼Œå¯èƒ½ä¼šç¼“è§£è¿™ç§ä¸é€‚æ„Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/va_hook_seq.png&quot; alt=&quot;va hook&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ &lt;code&gt;AccountManagerService&lt;/code&gt; Hook ä¸ºä¾‹ï¼Œâ‘ ã€â‘¡ ä¸¤æ­¥å°† &lt;code&gt;AccountBinderDelegate&lt;/code&gt; ç­‰ Binder ä»£ç†æ³¨å…¥è‡³ &lt;code&gt;ServiceManager&lt;/code&gt; ï¼Œå‡è®¾è§¦å‘ â‘¢ getService è·å–  &lt;code&gt;AccountManagerService&lt;/code&gt; åï¼Œè°ƒç”¨ â‘£ getPwd ï¼Œè¿™æ—¶ â‘¤ getPwd å°†é€šè¿‡ &lt;code&gt;HookHandler&lt;/code&gt; åŠ¨æ€ä»£ç†è°ƒç”¨åˆ°ä»£ç†ç±» â‘¥ getHook æŸ¥æ‰¾åˆ°å‡½æ•°ä»£ç†å¯¹è±¡ï¼Œç„¶å â‘¦ invoke å®Œæˆ &lt;code&gt;Hook å‡½æ•°&lt;/code&gt; å³ getPassword ä»£ç†è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œï¼Œæ•´ä¸ª Hook æ¡†æ¶å¤§è‡´ä¸Šå°±è¯´å®Œäº†ã€‚å½“ç„¶è¯¸å¤šç‰ˆæœ¬çš„ Romï¼ˆå®˜æ–¹ã€ç¬¬ä¸‰æ–¹ï¼‰é€‚é…è¿˜æ˜¯ä¸€ä¸ªåºå¤§çš„å·¥ä½œé‡ï¼Œè¿™å°±ä½“ç°äº†ä½œè€…å¯¹æ•´ä¸ª Android Framework æŒæ¡çš„åŠŸåŠ›äº†ï¼Œè¿™é‡Œé¢å¤–æä¸€ä¸‹ï¼Œä½œè€…å¯¹äºFramework é•œåƒçš„å¤„ç†ï¼Œä¹Ÿæ˜¯ç›¸å½“çš„ç²¾å¦™ï¼Œè¿™ä¹Ÿä¸ºæ•´ä¸ª Hook æ¡†æ¶çš„ä»£ç å¯è¯»æ€§è´¡çŒ®äº†ç›¸å½“ä¸€éƒ¨åˆ†çš„åŠ›é‡ï¼Œè¯¦è§é¡¹ç›®çš„ &lt;a href=&quot;https://github.com/asLody/VirtualApp/tree/master/VirtualApp/lib/src/main/java/mirror&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;mirror&lt;/code&gt;&lt;/a&gt; åŒ… ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3ã€æœ€åçš„é—²æ‰¯&quot;&gt;&lt;a href=&quot;#3ã€æœ€åçš„é—²æ‰¯&quot; class=&quot;headerlink&quot; title=&quot;3ã€æœ€åçš„é—²æ‰¯&quot;&gt;&lt;/a&gt;3ã€æœ€åçš„é—²æ‰¯&lt;/h2&gt;&lt;p&gt;åœ¨é˜…è¯»æºç ä»¥åŠä¼˜ç§€å¼€æºé¡¹ç›®çš„æ—¶å€™ï¼Œå¤§å¤šæ•°äººéƒ½ä¼šæ„Ÿåˆ°å¾ˆéš¾è¯»çš„é€šï¼Œæˆ‘çš„ä¸€ä¸ªçœ‹æ³•å’Œåˆ‡èº«ä½“ä¼šæ˜¯ï¼Œå°±åƒä½ ç¬¬ä¸€çœ¼çœ‹åˆ°ä¸€ä¸ªäººï¼Œè‚¯å®šæ„Ÿè§‰ååˆ†é™Œç”Ÿï¼Œè€Œç›¸å¤„è¿‡ä¸€æ®µæ—¶é—´åï¼Œè¿™ç§é™Œç”Ÿæ„Ÿå°±ä¼šæ…¢æ…¢æ¶ˆå¤±ï¼Œè¿›è€Œä½ åè€Œä¼šå¾ˆäº†è§£å¥¹ï¼ŒçŸ¥é“å¥¹çš„çˆ±å¥½ï¼ŒçŸ¥é“å¥¹å–œæ¬¢åƒä»€ä¹ˆã€‚é˜…è¯»æºç ä¹Ÿæ˜¯è¿™æ ·ï¼ŒçŸ­æ—¶é—´å†…å¦‚æœæ— æ³•æ‹¿ä¸‹ï¼Œåˆå¾ˆæƒ³ç†è§£å®ƒï¼Œé‚£ä¹ˆå°±è¦å¤šèŠ±äº›æ—¶é—´ï¼Œå»è¯»ï¼Œä¸æ–­çš„è¯»å’Œç†è§£ï¼Œäº†è§£æºç æ‰€æ¶‰åŠçš„çŸ¥è¯†ï¼Œå°è¯•å»ç”¨è‡ªå·±çš„ç†è§£å»æ£æ‘©ä½œè€…çš„æ€è·¯ï¼Œè¿™ä¸ªæœŸé—´ä½ éœ€è¦ç”¨é€‚åˆè‡ªå·±å­¦ä¹ çš„æ–¹å¼ï¼ˆæ¯”å¦‚ç”»ç±»å›¾ï¼Œæµç¨‹å›¾ã€æ—¶åºå›¾ï¼Œåªè¦è¿™ç§æ–¹å¼å¯¹ä½ æ˜¯æœ‰æ•ˆçš„ä¸å¿…æ‹˜æ³¥äºå½¢å¼ï¼‰å»è®°å½•ä¿®æ­£ä½ çš„ç†è§£ï¼Œä¸æ–­çš„å»é€¼è¿‘ä½œè€…çš„æƒ³æ³•å’Œæ€è·¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå­¦ä¹ æˆé•¿çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é“é˜»ä¸”é•¿ï¼Œè¡Œåˆ™å°†è‡³ã€‚thatâ€™s all.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;1ã€æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;å¯¹äºæ’ä»¶åŒ–æ¡†æ¶ &lt;code&gt;Hook&lt;/code&gt; æœºåˆ¶æ˜¯ä¸€ä¸ªæ ¸å¿ƒï¼Œé‚£åˆ°åº• &lt;code&gt;Hook&lt;/code&gt; æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆå»ç†è§£æ’ä»¶åŒ–ä¸­çš„ &lt;code&gt;Hook&lt;/code&gt; å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥æ’ä»¶åŒ–ä¸­çš„ &lt;code&gt;Hook&lt;/code&gt; æœºåˆ¶å°±æ˜¯é€šè¿‡&lt;code&gt;åå°„æ³¨å…¥&lt;/code&gt;å’Œ&lt;code&gt;åŠ¨æ€ä»£ç†&lt;/code&gt;æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥è¯´è¯´ä½•ä¸º&lt;code&gt;åå°„æ³¨å…¥&lt;/code&gt;ï¼Œå¤§å®¶éƒ½çŸ¥é“ä¾èµ–æ³¨å…¥ï¼Œå…¶å®åå°„æ³¨å…¥ç®—æ˜¯ä¾èµ–æ³¨å…¥çš„ä¸€ç§ï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡åå°„çš„æ–¹å¼å°†ä¾èµ–å¯¹è±¡æ³¨å…¥ç›®æ ‡å¯¹è±¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è¦æ›¿æ¢æ‰ &lt;code&gt;ActivityThread&lt;/code&gt; ä¸­çš„ &lt;code&gt;mInstrumentation&lt;/code&gt;ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>æ’ä»¶åŒ–ä¸­ Classloader çš„åŠ è½½ dex åˆ†æ</title>
    <link href="http://solart.cc/2016/11/16/plugin_classloader/"/>
    <id>http://solart.cc/2016/11/16/plugin_classloader/</id>
    <published>2016-11-16T12:30:06.000Z</published>
    <updated>2017-02-06T07:54:37.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€Java-ç±»åŠ è½½å™¨&quot;&gt;&lt;a href=&quot;#1ã€Java-ç±»åŠ è½½å™¨&quot; class=&quot;headerlink&quot; title=&quot;1ã€Java ç±»åŠ è½½å™¨&quot;&gt;&lt;/a&gt;1ã€Java ç±»åŠ è½½å™¨&lt;/h2&gt;&lt;p&gt;æåˆ° Android æ’ä»¶åŒ–ï¼Œä¸€ä¸ªåŸºç¡€çš„çŸ¥è¯†ç‚¹å°±æ˜¯ Java çš„ç±»åŠ è½½æœºåˆ¶ã€‚è¿™éƒ¨åˆ†çŸ¥è¯†è¯·å‚è€ƒ&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-classloader/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨&lt;/a&gt;ï¼Œä»¥ä¸‹æ‘˜å½•éƒ¨åˆ†å†…å®¹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-1-ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;a href=&quot;#1-1-ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;1.1 ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;/a&gt;1.1 ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&lt;/h4&gt;&lt;p&gt;Java ä¸­çš„ç±»åŠ è½½å™¨å¤§è‡´å¯ä»¥åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç³»ç»Ÿæä¾›çš„ï¼Œå¦å¤–ä¸€ç±»åˆ™æ˜¯ç”± Java åº”ç”¨å¼€å‘äººå‘˜ç¼–å†™çš„ã€‚ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒåº“ï¼Œæ˜¯ç”¨åŸç”Ÿä»£ç æ¥å®ç°çš„ï¼Œå¹¶ä¸ç»§æ‰¿è‡ª &lt;code&gt;java.lang.ClassLoader&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆextensions class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ã€‚Java è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsystem class loaderï¼‰ï¼šå®ƒæ ¹æ® Java åº”ç”¨çš„ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥åŠ è½½ Java ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ &lt;code&gt;ClassLoader.getSystemClassLoader()&lt;/code&gt;æ¥è·å–å®ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;1-2-ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot;&gt;&lt;a href=&quot;#1-2-ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;1.2 ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot;&gt;&lt;/a&gt;1.2 ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ç±»åŠ è½½å™¨&lt;/code&gt;åœ¨å°è¯•è‡ªå·±å»æŸ¥æ‰¾æŸä¸ªç±»çš„å­—èŠ‚ä»£ç å¹¶å®šä¹‰å®ƒæ—¶ï¼Œä¼šå…ˆä»£ç†ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œç”±çˆ¶ç±»åŠ è½½å™¨å…ˆå»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œä¾æ¬¡ç±»æ¨ã€‚åœ¨ä»‹ç»ä»£ç†æ¨¡å¼èƒŒåçš„åŠ¨æœºä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è¯´æ˜ä¸€ä¸‹ Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯ç›¸åŒçš„ã€‚Java è™šæ‹Ÿæœºä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä¾¿æ˜¯åŒæ ·çš„å­—èŠ‚ä»£ç ï¼Œè¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ä¹‹åæ‰€å¾—åˆ°çš„ç±»ï¼Œä¹Ÿæ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-3-åŠ è½½ç±»çš„è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#1-3-åŠ è½½ç±»çš„è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;1.3 åŠ è½½ç±»çš„è¿‡ç¨‹&quot;&gt;&lt;/a&gt;1.3 åŠ è½½ç±»çš„è¿‡ç¨‹&lt;/h4&gt;&lt;p&gt;åœ¨å‰é¢ä»‹ç»ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼çš„æ—¶å€™ï¼Œæåˆ°è¿‡ç±»åŠ è½½å™¨ä¼šé¦–å…ˆä»£ç†ç»™å…¶å®ƒç±»åŠ è½½å™¨æ¥å°è¯•åŠ è½½æŸä¸ªç±»ã€‚è¿™å°±æ„å‘³ç€çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ &lt;code&gt;defineClass&lt;/code&gt;æ¥å®ç°çš„ï¼›è€Œå¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ &lt;code&gt;loadClass&lt;/code&gt;æ¥å®ç°çš„ã€‚å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼šä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨ã€‚æ›´å¤šç»†èŠ‚å¯å‚è€ƒ&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-classloader/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€DexClassLoader-å’Œ-PathClassLoader&quot;&gt;&lt;a href=&quot;#2ã€DexClassLoader-å’Œ-PathClassLoader&quot; class=&quot;headerlink&quot; title=&quot;2ã€DexClassLoader å’Œ PathClassLoader&quot;&gt;&lt;/a&gt;2ã€DexClassLoader å’Œ PathClassLoader&lt;/h2&gt;&lt;p&gt;Javaçš„ç±»åŠ è½½æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„è¿‡ç¨‹ï¼›å®ƒåŒ…æ‹¬åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–äº”ä¸ªé˜¶æ®µï¼›å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¯æ§æ€§æœ€å¼ºçš„æ˜¯&lt;strong&gt;åŠ è½½é˜¶æ®µ&lt;/strong&gt;ï¼›åŠ è½½é˜¶æ®µä¸»è¦å®Œæˆä¸‰ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ®ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ&lt;/li&gt;
&lt;li&gt;å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸º JVM æ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Android Frameworkç®€åŒ–äº†&lt;code&gt;é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåè·å–æè¿°æ¬¡ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ&lt;/code&gt;è¿™ä¸ªè¿‡ç¨‹ï¼›æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰ClassLoader ä¸€ä¸ª dex æ–‡ä»¶æˆ–è€… apk æ–‡ä»¶çš„è·¯å¾„å°±èƒ½å®Œæˆç±»çš„åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Android ä¸­ï¼ŒClassLoader æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä½¿ç”¨å…¶å…·ä½“çš„å­ç±» DexClassLoaderã€PathClassLoade rè¿™äº›ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»çš„ï¼Œå®ƒä»¬çš„ä¸åŒä¹‹å¤„æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;DexClassLoader:&lt;/strong&gt; ä» .jar å’Œ .apk æ–‡ä»¶åŠ è½½åŒ…å« classes.dex æ¡ç›®çš„ç±»ã€‚ è¿™å¯ä»¥ç”¨äºæ‰§è¡Œæœªä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†å®‰è£…çš„ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PathClassLoader:&lt;/strong&gt; å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨è¿›è¡Œæ“ä½œï¼Œä½†ä¸å°è¯•ä»ç½‘ç»œåŠ è½½ç±»ã€‚ Android å°†æ­¤ç±»ç”¨äºå…¶ç³»ç»Ÿç±»åŠ è½½å™¨åŠå…¶åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹ DexClassLoader å’Œ PathClassLoader ç»†èŠ‚ä¸Šçš„åŒºåˆ«:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DexClassLoader&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseDexClassLoader&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DexClassLoader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String dexPath, String optimizedDirectory,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String libraryPath, ClassLoader parent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(dexPath, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(optimizedDirectory), libraryPath, parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PathClassLoader&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseDexClassLoader&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PathClassLoader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String dexPath, ClassLoader parent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(dexPath, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PathClassLoader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String dexPath, String libraryPath,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ClassLoader parent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(dexPath, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, libraryPath, parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»¥ä¸Šå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸¤è€…åªæ˜¯å¯¹&lt;code&gt;BaseDexClassLoader&lt;/code&gt;åšäº†ç®€å•çš„å°è£…ï¼Œä¸åŒçš„æ˜¯&lt;code&gt;PathClassLoader&lt;/code&gt;åœ¨çˆ¶ç±»çš„æ„é€ ä¸­ optimizedDirectory æ˜¯ nullï¼Œå†æ¥çœ‹BaseDexClassLoaderï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseDexClassLoader&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ClassLoader&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; DexPathList pathList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseDexClassLoader&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String dexPath, File optimizedDirectory,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String libraryPath, ClassLoader parent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(parent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.pathList = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DexPathList(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, dexPath, libraryPath, optimizedDirectory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ª&lt;code&gt;DexPathList&lt;/code&gt;å®ä¾‹ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªç±»çš„å®ç°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*package*/&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DexPathList&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DexPathList&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ClassLoader definingContext, String dexPath,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String libraryPath, File optimizedDirectory)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.definingContext = definingContext;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ArrayList&amp;lt;IOException&amp;gt; suppressedExceptions = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;IOException&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.dexElements = makeDexElements(splitDexPath(dexPath), optimizedDirectory,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                           suppressedExceptions);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.nativeLibraryDirectories = splitLibraryPath(libraryPath);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Makes an array of dex/resource path elements, one per element of&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * the given array.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Element[] makeDexElements(ArrayList&amp;lt;File&amp;gt; files, File optimizedDirectory,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                             ArrayList&amp;lt;IOException&amp;gt; suppressedExceptions) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ArrayList&amp;lt;Element&amp;gt; elements = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Element&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * Open all files and load the (direct or contained) dex files&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * up front.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (File file : files) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            File zip = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            DexFile dex = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String name = file.getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (file.isDirectory()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// We support directories for looking up resources.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// This is only useful for running libcore tests.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                elements.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Element(file, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (file.isFile())&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (name.endsWith(DEX_SUFFIX)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// Raw dex file (not inside a zip/jar).&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        dex = loadDexFile(file, optimizedDirectory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        System.logE(&lt;span class=&quot;string&quot;&gt;&quot;Unable to load dex file: &quot;&lt;/span&gt; + file, ex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    zip = file;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        dex = loadDexFile(file, optimizedDirectory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException suppressed) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        suppressedExceptions.add(suppressed);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                System.logW(&lt;span class=&quot;string&quot;&gt;&quot;ClassLoader referenced unknown path: &quot;&lt;/span&gt; + file);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((zip != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) || (dex != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                elements.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Element(file, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;, zip, dex));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; elements.toArray(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Element[elements.size()]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Constructs a &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; DexFile&amp;#125; instance, as appropriate depending&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * on whether &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; optimizedDirectory&amp;#125; is &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; null&amp;#125;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; DexFile &lt;span class=&quot;title&quot;&gt;loadDexFile&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File file, File optimizedDirectory)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (optimizedDirectory == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//å¦‚æœä¸ºç©ºåˆ™ç›´æ¥åˆ›å»ºDexFile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DexFile(file);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String optimizedPath = optimizedPathFor(file, optimizedDirectory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; DexFile.loadDex(file.getPath(), optimizedPath, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Converts a dex/jar file path and an output directory to an&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * output file path for an associated optimized dex file.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;optimizedPathFor&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File path,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            File optimizedDirectory)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * Get the filename component of the path, and replace the&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * suffix with &quot;.dex&quot; if that&#39;s not already the suffix.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * We don&#39;t want to use &quot;.odex&quot;, because the build system uses&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * that for files that are paired with resource-only jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * files. If the VM can assume that there&#39;s no classes.dex in&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * the matching jar, it doesn&#39;t need to open the jar to check&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * for updated dependencies, providing a slight performance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * boost at startup. The use of &quot;.dex&quot; here matches the use on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * files in /data/dalvik-cache.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String fileName = path.getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!fileName.endsWith(DEX_SUFFIX)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; lastDot = fileName.lastIndexOf(&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (lastDot &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                fileName += DEX_SUFFIX;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                StringBuilder sb = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBuilder(lastDot + &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sb.append(fileName, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, lastDot);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sb.append(DEX_SUFFIX);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                fileName = sb.toString();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        File result = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(optimizedDirectory, fileName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result.getPath();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;DexFileList åˆ›å»ºäº†ä¸€ä¸ª dex èµ„æºè·¯å¾„çš„å…ƒç´ æ•°ç»„ï¼Œåœ¨å‘è¿™ä¸ªæ•°ç»„æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šæ ¹æ® optimizedDirectory å‚æ•°æ˜¯å¦ä¸º null æ¥åŒºåˆ†åˆ›å»º DexFile å¯¹è±¡ã€‚æ‰€ä»¥å‘¢ï¼ŒPathClassLoader æœ€åè°ƒç”¨çš„æ˜¯ new DexFile(pathFile)ï¼Œè€ŒDexClassLoader è°ƒç”¨çš„æ˜¯ DexFile.loadDex(dexPathList[i], outputName, 0)ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¿˜éœ€è¦æä¸€ä¸‹çš„æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­ &lt;a href=&quot;https://developer.android.com/reference/dalvik/system/DexClassLoader.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DexClassLoader&lt;/a&gt; ä¸­å†™åˆ°è¿™æ ·ä¸€æ®µè¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Do not cache optimized classes on external storage.&lt;/strong&gt; External storage does not provide access controls necessary to protect your application from code injection attacks.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;3ã€Dex-åŠ è½½&quot;&gt;&lt;a href=&quot;#3ã€Dex-åŠ è½½&quot; class=&quot;headerlink&quot; title=&quot;3ã€Dex åŠ è½½&quot;&gt;&lt;/a&gt;3ã€Dex åŠ è½½&lt;/h2&gt;&lt;p&gt;å‰é¢æˆ‘ä»¬æåˆ°äº† ClassLoader çš„ä»£ç†æ¨¡å¼ï¼Œè¿™ç§åŒäº²å§”æ‰˜çš„æ¨¡å¼ï¼Œå¾ˆå¥½çš„æ»¡è¶³äº† Android Framework çš„ç³»ç»Ÿä»£ç çš„å…±äº«ä»¥åŠåº”ç”¨ä»£ç çš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-æœ‰å‡ ä¸ª-ClassLoader-å®ä¾‹&quot;&gt;&lt;a href=&quot;#3-1-æœ‰å‡ ä¸ª-ClassLoader-å®ä¾‹&quot; class=&quot;headerlink&quot; title=&quot;3.1 æœ‰å‡ ä¸ª ClassLoader å®ä¾‹&quot;&gt;&lt;/a&gt;3.1 æœ‰å‡ ä¸ª ClassLoader å®ä¾‹&lt;/h4&gt;&lt;p&gt;ä¸€èˆ¬ä¸€ä¸ªåº”ç”¨å¯åŠ¨åæœ‰å‡ ä¸ª ClassLoader çš„å®ä¾‹å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥æ‰“å°ä¸€ä¸‹ ClassLoader çš„å®ä¾‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ClassLoader classLoader = getClassLoader();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (classLoader != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Log.i(TAG, &lt;span class=&quot;string&quot;&gt;&quot;[onCreate] classLoader &quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot; : &quot;&lt;/span&gt; + classLoader.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (classLoader.getParent() != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                classLoader = classLoader.getParent();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                i++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Log.i(TAG,&lt;span class=&quot;string&quot;&gt;&quot;[onCreate] classLoader &quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot; : &quot;&lt;/span&gt; + classLoader.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Log è¾“å‡ºä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cc.solart.nuts I/HomeActivity: [onCreate] classLoader &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; : dalvik.system.PathClassLoader[DexPathList[[zip file &lt;span class=&quot;string&quot;&gt;&quot;/data/app/cc.solart.nuts-1.apk&quot;&lt;/span&gt;],nativeLibraryDirectories=[/data/app-lib/cc.solart.nuts-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, /vendor/lib, /data/cust/lib, /data/datalib, /system/lib]]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cc.solart.nuts I/HomeActivity: [onCreate] classLoader &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; : java.lang.BootClassLoader@&lt;span class=&quot;number&quot;&gt;41&lt;/span&gt;a0c360&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ª ClassLoader çš„å®ä¾‹è¾“å‡ºï¼Œä¸€ä¸ª&lt;code&gt;PathClassLoader&lt;/code&gt;ï¼Œåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œç”¨äºåŠ è½½ apk ä¸­çš„ç±»ï¼Œå¦ä¸€ä¸ªæ˜¯&lt;code&gt;BootClassLoader&lt;/code&gt;ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œç”¨äºåŠ è½½ç³»ç»Ÿç›¸å…³çš„ç±»ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä»»ä½•è¿è¡Œçš„Androidåº”ç”¨è‡³å°‘åŒ…å«æœ‰ä¸¤ä¸ª ClassLoaderï¼Œæ¯ä¸ªåº”ç”¨ä¸­çš„&lt;code&gt;PathClassLoader&lt;/code&gt;æ‹¥æœ‰åŒä¸€ä¸ª&lt;code&gt;parent&lt;/code&gt;å³æ˜¯&lt;code&gt;BootClassLoader&lt;/code&gt;ï¼Œè¿™æ ·å°±ä¿è¯äº†&lt;code&gt;ç³»ç»Ÿä»£ç å…±äº«ä»¥åŠåº”ç”¨ä»£ç éš”ç¦»&lt;/code&gt;ï¼Œå¦‚ä¸‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/classloader.png&quot; alt=&quot;classloader&quot;&gt;&lt;/p&gt;
&lt;p&gt;é¢å¤–æä¸€ä¸‹çš„æ˜¯ï¼Œç”±äºç³»ç»Ÿä»£ç æ˜¯å…¨å±€å…±äº«çš„ï¼Œé‚£ä¹ˆè¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ç»™äº†å¼€å‘è€…Hookç³»ç»Ÿä»£ç çš„æœºä¼šï¼Œæ‰€ä»¥ç³»ç»Ÿå®‰å…¨æ€§æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è€ƒéªŒï¼Œä¸çŸ¥é“Googleæ˜¯å¦‚ä½•è€ƒé‡è¿™ä¸ªé—®é¢˜çš„ï¼Œå½“ç„¶æ­£å› ä¸ºè¿™ç§æœºä¼šçš„å­˜åœ¨æ‰ç»™äº†æ’ä»¶åŒ–å‘å±•çš„å¥‘æœºã€‚å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä¸¤ä¸ªåº”ç”¨éƒ½ä½¿ç”¨äº†Hookçš„æœºåˆ¶ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å¯¼è‡´ä¸€æ–¹Hookå¤±æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨ä½¿ç”¨Hookåçš„æœåŠ¡æ—¶ï¼Œä¸€èˆ¬è¦å»åšç¯å¢ƒæ£€æµ‹ï¼Œçœ‹æ˜¯å¦éœ€è¦é‡æ–°æ³¨å…¥ã€‚è¿™å°±å±äºHookæ¡†æ¶çš„åšå¼ˆäº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-æ’ä»¶åŒ–-Dex-åŠ è½½ç­–ç•¥&quot;&gt;&lt;a href=&quot;#3-2-æ’ä»¶åŒ–-Dex-åŠ è½½ç­–ç•¥&quot; class=&quot;headerlink&quot; title=&quot;3.2 æ’ä»¶åŒ– Dex åŠ è½½ç­–ç•¥&quot;&gt;&lt;/a&gt;3.2 æ’ä»¶åŒ– Dex åŠ è½½ç­–ç•¥&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å€Ÿé‰´è¿™ç§æ€è·¯åº”ç”¨åˆ°æ’ä»¶åŒ–çš„æ¡†æ¶ä¸­ï¼Œæ ¹æ®ä¸åŒçš„å‡ºå‘ç‚¹ï¼Œé€šå¸¸æ’ä»¶åŒ–çš„ Dex åŠ è½½ç­–ç•¥æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å¯¹æ¯ä¸€ä¸ªæ’ä»¶åˆ†é…ä¸€ä¸ª&lt;code&gt;ClassLoader&lt;/code&gt;åˆ†åˆ«åŠ è½½&lt;code&gt;.dex&lt;/code&gt;(è¿™æ˜¯ç›®å‰æœ€å¸¸è§çš„æ–¹å¼)&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥åŠ¨æ€å¾—æŠŠæ’ä»¶&lt;code&gt;.dex&lt;/code&gt;åŠ è½½åˆ°å½“å‰è¿è¡Œç¯å¢ƒçš„&lt;code&gt;Classloader&lt;/code&gt;ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬å…ˆæ¥çœ‹å¤š ClassLoader åŠ è½½çš„æ–¹æ¡ˆ&lt;/strong&gt;ï¼Œå¤š ClassLoader çš„æ–¹æ¡ˆï¼Œè¿˜å¯ä»¥ç»†åˆ†ä¸ºä¸¤ç§ï¼šä¸€æ˜¯æ¯ä¸ªè‡ªå®šä¹‰ ClassLoader çš„ parent ä¸ºå½“å‰å®¿ä¸»åº”ç”¨çš„ ClassLoader å³æ˜¯ PathClassLoaderï¼Œè¿™ç§æ–¹æ¡ˆå°†å®¿ä¸»è§†ä¸ºè¿è¡Œç¯å¢ƒï¼Œæ’ä»¶éœ€ä¾èµ–å®¿ä¸»è¿è¡Œï¼Œæ’ä»¶ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œå¦‚ä¸‹å›¾ï¼š &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/pluginclassloader_1.png&quot; alt=&quot;pluginclassloader&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æ˜¯æ¯ä¸ªè‡ªå®šä¹‰ ClassLoader çš„ parent ä¸º BootClassLoaderï¼Œè¿™ç§æ–¹æ¡ˆç±»ä¼¼åŸç”Ÿåº”ç”¨éš”ç¦»çš„æ–¹æ¡ˆï¼Œå®¿ä¸»ä¸æ’ä»¶ã€æ’ä»¶ä¸æ’ä»¶äº’ç›¸ç‹¬ç«‹ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/pluginclassloader_2.png&quot; alt=&quot;pluginclassloader2&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¤š ClassLoader çš„éš¾åº¦åœ¨äº Hook ç³»ç»ŸæœåŠ¡ä»¥åŠå…¼å®¹æ€§é€‚é…ç­‰å·¥ä½œï¼Œæœ¬èº« ClassLoader çš„ä»£ç é‡å¹¶ä¸å¤§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬å†æ¥çœ‹å•ClassLoaderæ–¹æ¡ˆ&lt;/strong&gt;ï¼Œè¿™ç§æ–¹æ¡ˆæ˜¯å§”æ‰˜ç»™åº”ç”¨çš„PathClassLoaderåŠ è½½&lt;code&gt;.dex&lt;/code&gt;ï¼Œå®¿ä¸»ä¸æ’ä»¶å…±äº«åŒä¸€ä¸ª ClassLoaderã€‚&lt;/p&gt;
&lt;p&gt;é‚£æ€ä¹ˆè®© PathClassLoader å¸®å¿™åŠ è½½ dex å‘¢ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢åˆ†æ BaseDexClassLoader æ—¶ï¼ŒBaseDexClassLoader åœ¨æ„é€ æ—¶ç”Ÿåˆ›å»ºä¸€ä¸ª&lt;code&gt;DexPathList&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;DexPathList&lt;/code&gt;å†…éƒ¨æœ‰ä¸€ä¸ªå«åš&lt;code&gt;dexElements&lt;/code&gt;æ•°ç»„ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°† dex æ–‡ä»¶æ’å…¥åˆ°è¿™ä¸ª&lt;code&gt;dexElements&lt;/code&gt;æ•°ç»„ä¸­ï¼Œåœ¨ PathClassLoader ä¸­æŸ¥æ‰¾ç±»æ—¶ï¼Œå°±ä¼šéå†è¿™ä¸ªæ•°ç»„ä¸­ DexFile çš„ä¿¡æ¯ï¼Œå®Œæˆæ’ä»¶ç±»çš„åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;æ¥çœ‹çœ‹ BaseDexClassLoader ä¸­&lt;code&gt;findClass&lt;/code&gt;çš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseDexClassLoader&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ClassLoader&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; DexPathList pathList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; Class&amp;lt;?&amp;gt; findClass(String name) &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; ClassNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;Throwable&amp;gt; suppressedExceptions = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Throwable&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//é€šè¿‡DexPathListæŸ¥æ‰¾ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Class c = pathList.findClass(name, suppressedExceptions);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (c == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ClassNotFoundException cnfe = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ClassNotFoundException(&lt;span class=&quot;string&quot;&gt;&quot;Didn&#39;t find class \&quot;&quot;&lt;/span&gt; + name + &lt;span class=&quot;string&quot;&gt;&quot;\&quot; on path: &quot;&lt;/span&gt; + pathList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Throwable t : suppressedExceptions) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                cnfe.addSuppressed(t);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; cnfe;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ &lt;code&gt;DexPathList&lt;/code&gt; å®ŒæˆæŸ¥æ‰¾Classï¼Œå®ƒçš„ &lt;code&gt;findClass&lt;/code&gt; æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*package*/&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DexPathList&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Element[] dexElements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Class &lt;span class=&quot;title&quot;&gt;findClass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name, List&amp;lt;Throwable&amp;gt; suppressed)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Element element : dexElements) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            DexFile dex = element.dexFile;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dex != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Class clazz = dex.loadClassBinaryName(name, definingContext, suppressed);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (clazz != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; clazz;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dexElementsSuppressedExceptions != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            suppressed.addAll(Arrays.asList(dexElementsSuppressedExceptions));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡Œå°±éªŒè¯äº†æˆ‘ä»¬å°† dex æ–‡ä»¶æ’å…¥åˆ°&lt;code&gt;dexElements&lt;/code&gt;æ•°ç»„ä¸­è¿™ä¸ªç»“è®ºçš„å¯è¡Œæ€§ï¼Œæ¥ä¸‹çš„å·¥ä½œå°±æ˜¯é€šè¿‡åå°„æ³¨å…¥ dex ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸åœ¨ç»†è¯´äº†ã€‚&lt;/p&gt;
&lt;p&gt;å›æƒ³ä¸€ä¸‹å• ClassLoader çš„æ–¹æ¡ˆï¼Œæœ‰æ²¡æœ‰è§‰å¾—ä¼¼æ›¾ç›¸è¯†ï¼Ÿæƒ³å¿…å¤§å®¶å¯¹&lt;code&gt;MultiDex&lt;/code&gt;å¹¶ä¸é™Œç”Ÿå§ï¼Œè€Œè¿™ç§å• ClassLoader çš„æ–¹æ¡ˆä¸&lt;code&gt;MultiDex&lt;/code&gt;æ–¹æ¡ˆå¦‚å‡ºä¸€è¾™ã€‚æ‰€ä»¥è¿™ç§æ–¹æ¡ˆå®ç°èµ·æ¥ä»£ç é‡æ¯”è¾ƒå°(å‚ç…§ MultiDex )ï¼Œéš¾åº¦ç›¸å¯¹ä¸å¤§ã€‚å†æ‰¯è¿œä¸€ç‚¹ï¼Œå¾®ä¿¡ Android å›¢é˜Ÿå¼€æºçš„çƒ­ä¿®å¤æ¡†æ¶ &lt;a href=&quot;https://github.com/tencent/tinker&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tinker&lt;/a&gt; ä¸­ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„æ–¹å¼å»å¤„ç†ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥å»è¯»è¯» &lt;a href=&quot;https://github.com/tencent/tinker/blob/master/tinker-android/tinker-android-loader/src/main/java/com/tencent/tinker/loader/SystemClassLoaderAdder.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SystemClassLoaderAdder&lt;/a&gt; çš„ä»£ç ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-3-Dex-åŠ è½½ç­–ç•¥çš„ä¼˜åŠ£&quot;&gt;&lt;a href=&quot;#3-3-Dex-åŠ è½½ç­–ç•¥çš„ä¼˜åŠ£&quot; class=&quot;headerlink&quot; title=&quot;3.3 Dex åŠ è½½ç­–ç•¥çš„ä¼˜åŠ£&quot;&gt;&lt;/a&gt;3.3 Dex åŠ è½½ç­–ç•¥çš„ä¼˜åŠ£&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;th&gt;åŠ£åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤šClassLoader&lt;/td&gt;
&lt;td&gt;éš”ç¦»æ€§è¾ƒå¥½ï¼Œçƒ­æ›´æ–°ä¸å¿…é‡å¯è¿›ç¨‹&lt;/td&gt;
&lt;td&gt;å­˜åœ¨å¤šä¸ªç›¸åŒçš„ç±»åŒ…ï¼ŒåŠ è½½ dex æ–‡ä»¶å¤§ï¼Œå®ç°äº¤ä¸ºå¤æ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å•ClassLoader&lt;/td&gt;
&lt;td&gt;å®ç°ç›¸å¯¹ç®€å•ï¼Œdex æ–‡ä»¶å¯ä»¥åšåˆ°æ¯”è¾ƒå°ï¼ˆæ¯•ç«Ÿæ²¡æœ‰é‡å¤ç±»åº“ï¼‰&lt;/td&gt;
&lt;td&gt;éš”ç¦»æ€§å¼±ï¼ˆéœ€è¦é¿å…ä¸åŒ dex æ–‡ä»¶å¼•ç”¨ç±»åº“å†²çªï¼‰ï¼Œçƒ­æ›´æ–°éœ€é‡å¯è¿›ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨ä¸åŒçš„å‡ºå‘ç‚¹ä¸Šï¼Œä¼˜åŠ¿åŠ£åŠ¿å„æœ‰ä¸åŒï¼Œå¯¹äº Android ç³»ç»Ÿæ¥è¯´ï¼Œç¨‹åºé—´çš„éš”ç¦»æ€§æ˜¾ç„¶è¦æ¯”å…¶ä»–å› ç´ é‡è¦çš„å¤šï¼Œç³»ç»Ÿé‡‡ç”¨è¿™ç§åº”ç”¨å±‚éš”ç¦»çš„æ–¹æ¡ˆæ˜¯é¸¡è›‹è½åœ¨é¸¡çªé‡Œâ€”åˆšåˆšå¥½ã€‚åœ¨æ’ä»¶åŒ–æ¡†æ¶ä¸­ï¼Œå¤š ClassLoader ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤š ClassLoader çš„æ–¹æ¡ˆè¦ä¼˜äºå•ä¸€ ClassLoaderã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1ã€Java-ç±»åŠ è½½å™¨&quot;&gt;&lt;a href=&quot;#1ã€Java-ç±»åŠ è½½å™¨&quot; class=&quot;headerlink&quot; title=&quot;1ã€Java ç±»åŠ è½½å™¨&quot;&gt;&lt;/a&gt;1ã€Java ç±»åŠ è½½å™¨&lt;/h2&gt;&lt;p&gt;æåˆ° Android æ’ä»¶åŒ–ï¼Œä¸€ä¸ªåŸºç¡€çš„çŸ¥è¯†ç‚¹å°±æ˜¯ Java çš„ç±»åŠ è½½æœºåˆ¶ã€‚è¿™éƒ¨åˆ†çŸ¥è¯†è¯·å‚è€ƒ&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-classloader/&quot;&gt;æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨&lt;/a&gt;ï¼Œä»¥ä¸‹æ‘˜å½•éƒ¨åˆ†å†…å®¹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-1-ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;a href=&quot;#1-1-ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;1.1 ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;/a&gt;1.1 ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&lt;/h4&gt;&lt;p&gt;Java ä¸­çš„ç±»åŠ è½½å™¨å¤§è‡´å¯ä»¥åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç³»ç»Ÿæä¾›çš„ï¼Œå¦å¤–ä¸€ç±»åˆ™æ˜¯ç”± Java åº”ç”¨å¼€å‘äººå‘˜ç¼–å†™çš„ã€‚ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒåº“ï¼Œæ˜¯ç”¨åŸç”Ÿä»£ç æ¥å®ç°çš„ï¼Œå¹¶ä¸ç»§æ‰¿è‡ª &lt;code&gt;java.lang.ClassLoader&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆextensions class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ã€‚Java è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsystem class loaderï¼‰ï¼šå®ƒæ ¹æ® Java åº”ç”¨çš„ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥åŠ è½½ Java ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ &lt;code&gt;ClassLoader.getSystemClassLoader()&lt;/code&gt;æ¥è·å–å®ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Androidåº”ç”¨å®‰è£…æµç¨‹åˆ†æ</title>
    <link href="http://solart.cc/2016/10/30/install_apk/"/>
    <id>http://solart.cc/2016/10/30/install_apk/</id>
    <published>2016-10-30T11:08:08.000Z</published>
    <updated>2017-02-06T07:54:51.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ®µæ—¶é—´åœ¨ç ”ç©¶æ’ä»¶åŒ–ç›¸å…³çš„æŠ€æœ¯ï¼Œè¿½æ ¹æº¯æºï¼Œæ‰€ä»¥å¹²è„†æŠŠApkçš„å®‰è£…æµç¨‹æ¢³ç†äº†ä¸€éï¼Œä¸å¤§å®¶å…±äº«ï¼Œæœ›æŒ‡æ­£ï¼&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºAndroid 5.1çš„æºç ï¼Œåˆ†æApkå®‰è£…æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Apkæ˜¯Android Pakageçš„ç¼©å†™ï¼Œå³Androidå®‰è£…åŒ…ï¼ŒApkæ–‡ä»¶å…¶å®æ˜¯zipæ ¼å¼ï¼Œä¸€èˆ¬åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªdexæ–‡ä»¶ã€resources.arscã€AndroidManifest.xmlã€resç›®å½•ã€META-INFç›®å½•åŠåŒ…å«soåº“çš„libç›®å½•ï¼Œè¿™é‡Œå°±ä¸åœ¨å•°å—¦ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt; &lt;img src=&quot;/images/apk_content.png&quot; alt=&quot;apk_content&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1ã€å®‰è£…æµç¨‹å›¾&quot;&gt;&lt;a href=&quot;#1ã€å®‰è£…æµç¨‹å›¾&quot; class=&quot;headerlink&quot; title=&quot;1ã€å®‰è£…æµç¨‹å›¾&quot;&gt;&lt;/a&gt;1ã€å®‰è£…æµç¨‹å›¾&lt;/h2&gt;&lt;p&gt;å…ˆæ¥çœ‹ä¸€å¼ æ•´ä½“çš„æµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/Install_apk.png&quot; alt=&quot;install_apk&quot;&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…è¿‡ç¨‹ï¼šå¤åˆ¶apkå®‰è£…åŒ…åˆ°/data/appç›®å½•ä¸‹ï¼Œè§£å‹å¹¶æ‰«æå®‰è£…åŒ…ï¼Œå‘èµ„æºç®¡ç†å™¨æ³¨å…¥apkèµ„æºï¼Œè§£æAndroidManifestæ–‡ä»¶ï¼Œå¹¶åœ¨/data/dataç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„åº”ç”¨æ•°æ®ç›®å½•ï¼Œç„¶åé’ˆå¯¹dalvik/artç¯å¢ƒä¼˜åŒ–dexæ–‡ä»¶ï¼Œä¿å­˜åˆ°dalvik-cacheç›®å½•ï¼Œå°†AndroidManifestæ–‡ä»¶è§£æå‡ºçš„ç»„ä»¶ã€æƒé™æ³¨å†Œåˆ°PackageManagerServiceï¼Œå®Œæˆåå‘é€å¹¿æ’­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€å®‰è£…æ—¶åºå›¾&quot;&gt;&lt;a href=&quot;#2ã€å®‰è£…æ—¶åºå›¾&quot; class=&quot;headerlink&quot; title=&quot;2ã€å®‰è£…æ—¶åºå›¾&quot;&gt;&lt;/a&gt;2ã€å®‰è£…æ—¶åºå›¾&lt;/h2&gt;&lt;p&gt;ä¸Šå›¾å¤ªè¿‡ç¬¼ç»Ÿï¼Œä¸åˆ©äºäº†è§£ç»†èŠ‚ï¼Œè¿™é‡Œæ•´ç†å‡ºä¸€å¼ æ—¶åºå›¾ï¼Œä»¥ä¾¿äºåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/install_apk_seq.png&quot; alt=&quot;install_apk_seq&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/images/install_apk_seq.png&quot;&gt;ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹é«˜æ¸…æ— ç å¤§å›¾&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯´æ˜ï¼šæ—¶åºå›¾ä¸­åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šPackageInstallerè¿›ç¨‹ã€Systemè¿›ç¨‹ã€DefaultContainerServiceè¿›ç¨‹ï¼Œé‡ç‚¹å…³æ³¨Systemè¿›ç¨‹ä¸­çš„PackageManagerServiceã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PackageManagerService&lt;/strong&gt;ï¼šPMSæ˜¯Androidä¸­æœ€æ ¸å¿ƒçš„æœåŠ¡ä¹‹ä¸€ï¼Œä¸»è¦è´Ÿè´£å¯¹ç³»ç»Ÿçš„apkè¿›è¡Œç®¡ç†ï¼Œä»¥åŠå¯¹å››å¤§ç»„ä»¶çš„ç®¡ç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;3ã€æµç¨‹åˆ†æ&quot;&gt;&lt;a href=&quot;#3ã€æµç¨‹åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;3ã€æµç¨‹åˆ†æ&quot;&gt;&lt;/a&gt;3ã€æµç¨‹åˆ†æ&lt;/h2&gt;&lt;p&gt;ç”¨æˆ·å®‰è£…Apkæ—¶ï¼Œå¦‚ä»å‚å•†å®˜æ–¹åº”ç”¨å¸‚åœºä¸‹è½½ï¼Œä¸€èˆ¬æ— å®‰è£…é¡µé¢ï¼Œè¿™é‡Œä»¥ç”¨æˆ·å®‰è£…ç¬¬ä¸‰æ–¹å®‰è£…åŒ…ä¸ºä¾‹è¿›è¡Œåˆ†æï¼ŒPackageInstalleråº”ç”¨è´Ÿè´£å®‰è£…åŠå¸è½½è¿‡ç¨‹ä¸ç”¨æˆ·äº¤äº’ï¼ˆè§æ—¶åºå›¾PackageInstallerè¿›ç¨‹ï¼‰ã€‚è¿™é‡Œç€é‡ä»‹ç»Systemè¿›ç¨‹PMSå®‰è£…æµç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-1-å°†apkæ–‡ä»¶å¤åˆ¶è‡³-data-appç›®å½•&quot;&gt;&lt;a href=&quot;#3-1-å°†apkæ–‡ä»¶å¤åˆ¶è‡³-data-appç›®å½•&quot; class=&quot;headerlink&quot; title=&quot;3.1 å°†apkæ–‡ä»¶å¤åˆ¶è‡³/data/appç›®å½•&quot;&gt;&lt;/a&gt;3.1 å°†apkæ–‡ä»¶å¤åˆ¶è‡³/data/appç›®å½•&lt;/h4&gt;&lt;p&gt;æ­¤æµç¨‹åœ¨æ—¶åºå›¾ä¸­è¿‡ç¨‹è¿˜æ˜¯æŒºç¹å¤çš„ï¼Œä¸­é—´æ¶‰åŠåˆ°æ¯”è¾ƒå¤šçš„è·³è½¬ï¼Œæˆ‘ä»¬æŒ‘é‡ç‚¹çœ‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IPackageManager&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Stub&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;installPackageAsUser&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String originPath, IPackageInstallObserver2 observer,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; installFlags, String installerPackageName, VerificationParams verificationParams,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String packageAbiOverride, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; userId)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Message msg = mHandler.obtainMessage(INIT_COPY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        msg.obj = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InstallParams(origin, observer, installFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                installerPackageName, verificationParams, user, packageAbiOverride);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mHandler.sendMessage(msg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤å¤„ï¼Œé€šè¿‡PackageHandlerå‘é€INIT_COPYæ¶ˆæ¯å‡†å¤‡å¤åˆ¶apkï¼Œæˆ‘ä»¬å†æ¥æ¥ç€çœ‹ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageHandler&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Handler&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;doHandleMessage&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Message msg)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (msg.what) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; INIT_COPY: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    HandlerParams params = (HandlerParams) msg.obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; idx = mPendingInstalls.size();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_INSTALL) Slog.i(TAG, &lt;span class=&quot;string&quot;&gt;&quot;init_copy idx=&quot;&lt;/span&gt; + idx + &lt;span class=&quot;string&quot;&gt;&quot;: &quot;&lt;/span&gt; + params);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// If a bind was already initiated we dont really&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// need to do anything. The pending install&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// will be processed later on.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!mBound) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// If this is the only one pending we might&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// have to bind to the service again.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!connectToService()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            Slog.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Failed to bind to media container service&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            params.serviceError();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;comment&quot;&gt;// Once we bind to the service, the first&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;comment&quot;&gt;// pending request will be processed.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            mPendingInstalls.add(idx, params);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        mPendingInstalls.add(idx, params);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// Already bound to the service. Just make&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// sure we trigger off processing the first request.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (idx == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            mHandler.sendEmptyMessage(MCS_BOUND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; MCS_BOUND: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_INSTALL) Slog.i(TAG, &lt;span class=&quot;string&quot;&gt;&quot;mcs_bound&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (msg.obj != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        mContainerService = (IMediaContainerService) msg.obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mContainerService == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mPendingInstalls.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        HandlerParams params = mPendingInstalls.get(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (params != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (params.startCopy()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;comment&quot;&gt;// We are done...  look for more work or to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;comment&quot;&gt;// go idle.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;comment&quot;&gt;// Delete pending install&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mPendingInstalls.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    mPendingInstalls.remove(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mPendingInstalls.size() == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mBound) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_SD_INSTALL) Log.i(TAG,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                &lt;span class=&quot;string&quot;&gt;&quot;Posting delayed MCS_UNBIND&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        removeMessages(MCS_UNBIND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        Message ubmsg = obtainMessage(MCS_UNBIND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &lt;span class=&quot;comment&quot;&gt;// Unbind after a little delay, to avoid&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &lt;span class=&quot;comment&quot;&gt;// continual thrashing.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        sendMessageDelayed(ubmsg, &lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;comment&quot;&gt;// There are more pending requests in queue.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;comment&quot;&gt;// Just post MCS_BOUND message to trigger processing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;comment&quot;&gt;// of next pending install.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_SD_INSTALL) Log.i(TAG,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                            &lt;span class=&quot;string&quot;&gt;&quot;Posting MCS_BOUND for next work&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    mHandler.sendEmptyMessage(MCS_BOUND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// Should never happen ideally.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Slog.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Empty queue&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;INIT_COPYè¿™æ¡caseä¸»è¦æ˜¯ç¡®ä¿&lt;code&gt;DefaultContainerService&lt;/code&gt;å·²ç»ç»‘å®šï¼ŒDefaultContainerServiceæ˜¯ä¸€ä¸ªå•ç‹¬çš„apkè¿›ç¨‹ï¼Œä¸»è¦æä¾›æ£€æŸ¥å’Œå¤åˆ¶è®¾å¤‡ä¸Šçš„æ–‡ä»¶çš„æœåŠ¡ã€‚MCS_BOUNDè¿™æ¡caseä¸­æœ€å…³é”®çš„æ˜¯æ‰§è¡Œ&lt;code&gt;params.startCopy()&lt;/code&gt;å¼€å§‹æ‹·è´å·¥ä½œã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstallParams&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HandlerParams&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handleStartCopy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemoteException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (onInt &amp;amp;&amp;amp; onSd) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pkgLite = mContainerService.getMinimalPackageInfo(origin.resolvedPath, installFlags, packageAbiOverride);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; InstallArgs args = createInstallArgs(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mArgs = args;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ret == PackageManager.INSTALL_SUCCEEDED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!origin.existing &amp;amp;&amp;amp; requiredUid != -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;amp;&amp;amp; isVerificationEnabled(userIdentifier, installFlags)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ret == PackageManager.INSTALL_SUCCEEDED&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;amp;&amp;amp; mRequiredVerifierPackage != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         * Send the intent to the required verification agent,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         * but only start the verification timeout after the&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         * target BroadcastReceivers have run.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        verification.setComponent(requiredVerifierComponent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        mContext.sendOrderedBroadcastAsUser(verification, getUser(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                android.Manifest.permission.PACKAGE_VERIFICATION_AGENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BroadcastReceiver() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Message msg = mHandler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                .obtainMessage(CHECK_PENDING_VERIFICATION);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        msg.arg1 = verificationId;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        mHandler.sendMessageDelayed(msg, getVerificationTimeout());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &amp;#125;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         * We don&#39;t want the copy to proceed until verification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         * succeeds, so null out this field.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        mArgs = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 * No package verification is enabled, so immediately start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 * the remote call to initiate copy using temporary file.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ret = args.copyApk(mContainerService, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™éƒ¨åˆ†ä¸»è¦æ˜¯æ£€æŸ¥å­˜å‚¨ç©ºé—´ï¼Œæƒé™ç­‰ï¼Œè‹¥å·²æœ‰è½¯ä»¶åŒ…éªŒè¯ç¨‹åºï¼Œåˆ™éœ€è¦ç­‰å¾…éªŒè¯ç¨‹åºæ£€éªŒå®‰è£…åŒ…ï¼Œå¦åˆ™å¯ç›´æ¥å®‰è£…ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹&lt;code&gt;args.copyApk&lt;/code&gt;ã€‚è¿™é‡Œéœ€è¦æåˆ°çš„æ˜¯&lt;code&gt;createInstallArgs(this)&lt;/code&gt;ä¼šæ ¹æ®InstallParamsæ¥åˆ¤æ–­å®‰è£…ä½ç½®ï¼Œè¿™é‡Œä»¥å†…éƒ¨å­˜å‚¨å®‰è£…ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FileInstallArgs&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InstallArgs&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;copyApk&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IMediaContainerService imcs, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; temp)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemoteException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; File tempDir = mInstallerService.allocateInternalStageDirLegacy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                codeFile = tempDir;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                resourceFile = tempDir;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Slog.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Failed to create copy file: &quot;&lt;/span&gt; + e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; IParcelFileDescriptorFactory target = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IParcelFileDescriptorFactory.Stub() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; ParcelFileDescriptor &lt;span class=&quot;title&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; mode)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemoteException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ret = PackageManager.INSTALL_SUCCEEDED;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ret = imcs.copyPackage(origin.file.getAbsolutePath(), target);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ret != PackageManager.INSTALL_SUCCEEDED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Slog.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Failed to copy package&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ret;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; File libraryRoot = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(codeFile, LIB_DIR_NAME);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            NativeLibraryHelper.Handle handle = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                handle = NativeLibraryHelper.Handle.create(codeFile);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ret = NativeLibraryHelper.copyNativeBinariesWithOverride(handle, libraryRoot,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        abiOverride);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Slog.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Copying native libraries failed&quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ret = PackageManager.INSTALL_FAILED_INTERNAL_ERROR;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                IoUtils.closeQuietly(handle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ret;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œå®Œæˆäº†apkæ‹·è´åŠsoåº“çš„æ‹·è´ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-è§£æå®‰è£…åŒ…&quot;&gt;&lt;a href=&quot;#3-2-è§£æå®‰è£…åŒ…&quot; class=&quot;headerlink&quot; title=&quot;3.2 è§£æå®‰è£…åŒ…&quot;&gt;&lt;/a&gt;3.2 è§£æå®‰è£…åŒ…&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IPackageManager&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Stub&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;processPendingInstall&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; InstallArgs args, &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; currentStatus)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Queue up an async operation since the package installation may take a little while.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mHandler.post(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (res.returnCode == PackageManager.INSTALL_SUCCEEDED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    args.doPreInstall(res.returnCode);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (mInstallLock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        installPackageLI(args, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    args.doPostInstall(res.returnCode, res.uid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;installPackageLI&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(InstallArgs args, PackageInstalledInfo res)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        PackageParser pp = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageParser();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; PackageParser.Package pkg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pkg = pp.parsePackage(tmpPackageFile, parseFlags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (PackageParserException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            res.setError(&lt;span class=&quot;string&quot;&gt;&quot;Failed parse during installPackageLI&quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (replace) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            replacePackageLI(pkg, parseFlags, scanFlags | SCAN_REPLACING, args.user,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    installerPackageName, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            installNewPackageLI(pkg, parseFlags, scanFlags | SCAN_DELETE_DATA_ON_FAILURES,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    args.user, installerPackageName, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤å¤„å¯¹äºå®‰è£…åŒ…è¿›è¡Œè§£æï¼ŒåŒ…æ‹¬è§£æ&lt;code&gt;AndroidManifest&lt;/code&gt;ç‰ˆæœ¬ã€æƒé™ã€ç»„ä»¶ç­‰ï¼Œè¯¦è§&lt;code&gt;PackageParser::parsePackage(tmpPackageFile, parseFlags)&lt;/code&gt;ï¼Œè¿™éƒ¨åˆ†ä»£ç é‡è¾ƒå¤§ä½†æµç¨‹æ¸…æ™°ï¼Œè¿™é‡Œç®€å•çœ‹ä¸€ä¸‹&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageParser&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Package &lt;span class=&quot;title&quot;&gt;parsePackage&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File packageFile, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; PackageParserException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (packageFile.isDirectory()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; parseClusterPackage(packageFile, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; parseMonolithicPackage(packageFile, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Package &lt;span class=&quot;title&quot;&gt;parseMonolithicPackage&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File apkFile, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; PackageParserException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; AssetManager assets = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AssetManager();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Package pkg = parseBaseApk(apkFile, assets, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pkg.codePath = apkFile.getAbsolutePath();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; pkg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            IoUtils.closeQuietly(assets);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Package &lt;span class=&quot;title&quot;&gt;parseBaseApk&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File apkFile, AssetManager assets, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; PackageParserException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//å°†èµ„æºæ·»åŠ è¿›èµ„æºç®¡ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; cookie = loadApkIntoAssetManager(assets, apkPath, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            res = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Resources(assets, mMetrics, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String[] outError = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; String[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//è¿™é‡Œè§£æmanifestæ–‡ä»¶ï¼Œå…·ä½“å°±ä¸åœ¨å±•å¼€ï¼Œè¯¦çœ‹è¯·ç§»æ­¥æºç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Package pkg = parseBaseApk(res, parser, flags, outError);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; pkg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (PackageParserException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageParserException(INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;string&quot;&gt;&quot;Failed to read manifest from &quot;&lt;/span&gt; + apkPath, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            IoUtils.closeQuietly(parser);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;3-3-æ£€æµ‹æƒé™ã€æ³¨å†Œç»„ä»¶&quot;&gt;&lt;a href=&quot;#3-3-æ£€æµ‹æƒé™ã€æ³¨å†Œç»„ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3.3 æ£€æµ‹æƒé™ã€æ³¨å†Œç»„ä»¶&quot;&gt;&lt;/a&gt;3.3 æ£€æµ‹æƒé™ã€æ³¨å†Œç»„ä»¶&lt;/h4&gt;&lt;p&gt;æ¥ä¸‹æ¥çœ‹æ‰§è¡Œ&lt;code&gt;installNewPackageLI&lt;/code&gt;å‡½æ•°ï¼Œè¿™éƒ¨åˆ†ä»£ç æ ¸å¿ƒä¸º&lt;code&gt;scanPackageLI&lt;/code&gt;ã€&lt;code&gt;updateSettingsLI&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IPackageManager&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Stub&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;installNewPackageLI&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(PackageParser.Package pkg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; parseFlags, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; scanFlags, UserHandle user,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String installerPackageName, PackageInstalledInfo res)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            PackageParser.Package newPackage = scanPackageLI(pkg, parseFlags, scanFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.currentTimeMillis(), user);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            updateSettingsLI(newPackage, installerPackageName, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// delete the partially installed application. the data directory will have to be&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// restored if it was already existing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (res.returnCode != PackageManager.INSTALL_SUCCEEDED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// remove package from internal structures.  Note that we want deletePackageX to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// delete the package data and cache directories that it created in&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// scanPackageLocked, unless those directories existed before we even tried to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// install.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                deletePackageLI(pkgName, UserHandle.ALL, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        dataDirExists ? PackageManager.DELETE_KEEP_DATA : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                res.removedInfo, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (PackageManagerException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            res.setError(&lt;span class=&quot;string&quot;&gt;&quot;Package couldn&#39;t be installed in &quot;&lt;/span&gt; + pkg.codePath, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;scanPackageLIè´Ÿè´£å®‰è£…ï¼Œè€ŒupdateSettingLIåˆ™æ˜¯å®Œæˆå®‰è£…åçš„è®¾ç½®ä¿¡æ¯æ›´æ–°ã€‚å¦‚æœå®‰è£…å¤±è´¥åˆ™ä¼šåˆ é™¤å®‰è£…åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹&lt;code&gt;scanPackageLI&lt;/code&gt;è¿™éƒ¨åˆ†ä»£ç &lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IPackageManager&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Stub&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; PackageParser.&lt;span class=&quot;function&quot;&gt;Package &lt;span class=&quot;title&quot;&gt;scanPackageLI&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(PackageParser.Package pkg, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; parseFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; scanFlags, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; currentTime, UserHandle user)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; PackageManagerException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; success = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; PackageParser.Package res = scanPackageDirtyLI(pkg, parseFlags, scanFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    currentTime, user);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            success = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; res;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!success &amp;amp;&amp;amp; (scanFlags &amp;amp; SCAN_DELETE_DATA_ON_FAILURES) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                removeDataDirsLI(pkg.packageName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; PackageParser.&lt;span class=&quot;function&quot;&gt;Package &lt;span class=&quot;title&quot;&gt;scanPackageDirtyLI&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(PackageParser.Package pkg, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; parseFlags,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; scanFlags, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; currentTime, UserHandle user)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; PackageManagerException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// writer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (mPackages) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// éªŒè¯å·²æ³¨å†Œçš„ContentProvideræ˜¯å¦æœ‰å…¶ä»–åŒå&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((scanFlags &amp;amp; SCAN_NEW_INSTALL) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; N = pkg.providers.size();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i&amp;lt;N; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    PackageParser.Provider p = pkg.providers.get(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (p.info.authority != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        String names[] = p.info.authority.split(&lt;span class=&quot;string&quot;&gt;&quot;;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt; names.length; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mProvidersByAuthority.containsKey(names[j])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                PackageParser.Provider other = mProvidersByAuthority.get(names[j]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String otherPackageName =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        ((other != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; other.getComponentName() != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) ?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                other.getComponentName().getPackageName() : &lt;span class=&quot;string&quot;&gt;&quot;?&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageManagerException(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                        INSTALL_FAILED_CONFLICTING_PROVIDER,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                &lt;span class=&quot;string&quot;&gt;&quot;Can&#39;t install because provider name &quot;&lt;/span&gt; + names[j]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                + &lt;span class=&quot;string&quot;&gt;&quot; (in package &quot;&lt;/span&gt; + pkg.applicationInfo.packageName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                + &lt;span class=&quot;string&quot;&gt;&quot;) is already used by &quot;&lt;/span&gt; + otherPackageName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mPlatformPackage == pkg) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// This is a normal package, need to make its data directory.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dataPath = getDataPathForPackage(pkg.packageName, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dataPath.exists()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;//invoke installer to do the actual installation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;//è¿™é‡Œåˆ›å»ºäº†åº”ç”¨æ•°æ®ç›®å½•ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ret = createDataDirsLI(pkgName, pkg.applicationInfo.uid,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                           pkg.applicationInfo.seinfo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// We also need to dexopt any apps that are dependent on this library.  Note that&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// if these fail, we should abort the install since installing the library will&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// result in some apps being broken.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (clientLibPkgs != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((scanFlags &amp;amp; SCAN_NO_DEX) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; clientLibPkgs.size(); i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    PackageParser.Package clientPkg = clientLibPkgs.get(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (performDexOptLI(clientPkg, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* instruction sets */&lt;/span&gt;, forceDex,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            (scanFlags &amp;amp; SCAN_DEFER_DEX) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;) == DEX_OPT_FAILED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PackageManagerException(INSTALL_FAILED_DEXOPT,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;string&quot;&gt;&quot;scanPackageLI failed to dexopt clientLibPkgs&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// writer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (mPackages) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// ä»¥ä¸‹å¯¹å››å¤§ç»„ä»¶è¿›è¡Œæ³¨å†Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; N = pkg.providers.size();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            StringBuilder r = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i&amp;lt;N; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                PackageParser.Provider p = pkg.providers.get(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                p.info.processName = fixProcessName(pkg.applicationInfo.processName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        p.info.processName, pkg.applicationInfo.uid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                mProviders.addProvider(p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;scanPackageLI()æ–¹æ³•ä¸»è¦é€»è¾‘æ˜¯ç”±&lt;code&gt;scanPackageDirtyLI()&lt;/code&gt;å®ç°ã€‚è¿™é‡Œä¸»è¦å¯¹providerå†²çªæ£€æµ‹ï¼Œåˆ›å»ºåº”ç”¨æ•°æ®ç›®å½•ï¼Œdexoptæ“ä½œï¼Œå››å¤§ç»„ä»¶æ³¨å†Œï¼Œæƒé™æ³¨å†Œç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-4-å®‰è£…å®Œæˆ&quot;&gt;&lt;a href=&quot;#3-4-å®‰è£…å®Œæˆ&quot; class=&quot;headerlink&quot; title=&quot;3.4 å®‰è£…å®Œæˆ&quot;&gt;&lt;/a&gt;3.4 å®‰è£…å®Œæˆ&lt;/h4&gt;&lt;p&gt;ç»§ç»­çœ‹&lt;code&gt;processPendingInstall&lt;/code&gt;ï¼Œå®‰è£…æˆåŠŸåå¦‚éœ€è¦å¤‡ä»½åˆ™ä¼šé€šè¿‡&lt;code&gt;BackupManagerService&lt;/code&gt;è¿›è¡Œå¤‡ä»½ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;IPackageManager&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Stub&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;processPendingInstall&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; InstallArgs args, &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; currentStatus)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Queue up an async operation since the package installation may take a little while.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mHandler.post(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (res.returnCode == PackageManager.INSTALL_SUCCEEDED &amp;amp;&amp;amp; doRestore) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    IBackupManager bm = IBackupManager.Stub.asInterface(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            ServiceManager.getService(Context.BACKUP_SERVICE));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (bm != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_INSTALL) Log.v(TAG, &lt;span class=&quot;string&quot;&gt;&quot;token &quot;&lt;/span&gt; + token&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                + &lt;span class=&quot;string&quot;&gt;&quot; to BM for possible restore&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (bm.isBackupServiceActive(UserHandle.USER_OWNER)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                bm.restoreAtInstall(res.pkg.applicationInfo.packageName, token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                doRestore = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemoteException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;comment&quot;&gt;// can&#39;t happen; the backup manager is local&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            Slog.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Exception trying to enqueue restore&quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            doRestore = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Slog.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Backup Manager not found!&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        doRestore = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!doRestore) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// No restore possible, or the Backup Manager was mysteriously not&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// available -- just fire the post-install work request directly.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DEBUG_INSTALL) Log.v(TAG, &lt;span class=&quot;string&quot;&gt;&quot;No restore - queue post-install for &quot;&lt;/span&gt; + token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Message msg = mHandler.obtainMessage(POST_INSTALL, token, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    mHandler.sendMessage(msg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ— è®ºå¤‡ä»½ä¸å¦ï¼Œæœ€ç»ˆåˆ™ä¼šé€šè¿‡&lt;code&gt;PackageHandler&lt;/code&gt;å‘é€POST_INSTALLæ¶ˆæ¯ï¼Œæœ€ç»ˆé€šè¿‡å‘é€&lt;code&gt;Intent.ACTION_PACKAGE_ADDED&lt;/code&gt;å¹¿æ’­ï¼Œapkçš„å®‰è£…æµç¨‹å°±åˆ°æ­¤ç»“æŸäº†ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ®µæ—¶é—´åœ¨ç ”ç©¶æ’ä»¶åŒ–ç›¸å…³çš„æŠ€æœ¯ï¼Œè¿½æ ¹æº¯æºï¼Œæ‰€ä»¥å¹²è„†æŠŠApkçš„å®‰è£…æµç¨‹æ¢³ç†äº†ä¸€éï¼Œä¸å¤§å®¶å…±äº«ï¼Œæœ›æŒ‡æ­£ï¼&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºAndroid 5.1çš„æºç ï¼Œåˆ†æApkå®‰è£…æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Apkæ˜¯Android Pakageçš„ç¼©å†™ï¼Œå³Androidå®‰è£…åŒ…ï¼ŒApkæ–‡ä»¶å…¶å®æ˜¯zipæ ¼å¼ï¼Œä¸€èˆ¬åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªdexæ–‡ä»¶ã€resources.arscã€AndroidManifest.xmlã€resç›®å½•ã€META-INFç›®å½•åŠåŒ…å«soåº“çš„libç›®å½•ï¼Œè¿™é‡Œå°±ä¸åœ¨å•°å—¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Androidåº”ç”¨å¯åŠ¨æµç¨‹åˆ†æ</title>
    <link href="http://solart.cc/2016/08/20/launch_app/"/>
    <id>http://solart.cc/2016/08/20/launch_app/</id>
    <published>2016-08-20T09:32:08.000Z</published>
    <updated>2017-02-06T07:55:13.000Z</updated>
    
    <content type="html">&lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤§å®¶æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ç‚¹å‡»&lt;code&gt;Launcher&lt;/code&gt;å›¾æ ‡æ—¶ï¼Œåˆ°å”¤èµ·ä¸€ä¸ªåº”ç”¨é¡µé¢ï¼Œè¿™ä¸ªæµç¨‹ä¼šæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿæœ¬æ–‡çš„ç›®çš„å°±æ˜¯å°½å¯èƒ½æ¢³ç†æ¸…æ¥šæµç¨‹ï¼Œèƒ½å¤Ÿè®©å¤§å®¶å¯¹æ•´ä¸ªæµç¨‹æœ‰ä¸€ä¸ªç›¸å¯¹æ¸…æ™°çš„è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå¸Œæœ›æ‚¨èƒ½æœ€å¥½å·²ç»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰ä¸€ä»½ç¼–è¯‘åçš„Androidæºç ï¼ˆäº²è‡ªåŠ¨æ‰‹å®è·µæ‰ä¼šæœ‰æ›´æ·±å…¥çš„ç†è§£ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹Binderæœºåˆ¶æœ‰ä¸€å®šçš„äº†è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡å¯åŠ¨æµç¨‹åˆ†æåŸºäºAndroid 5.1çš„æºç ã€‚ä¸ºä»€ä¹ˆæ˜¯5.1çš„æºç å‘¢ï¼Ÿå› ä¸ºæ‰‹è¾¹ç¼–è¯‘å®Œçš„ä»£ç åªæœ‰è¿™ä¸ªç‰ˆæœ¬â€¦å¦å¤–ï¼Œç”¨ä»€ä¹ˆç‰ˆæœ¬çš„æºç å¹¶ä¸é‡è¦ï¼Œå¤§ä½“çš„æµç¨‹å¹¶æ— æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œä»…ä»…æ˜¯å®ç°ç»†èŠ‚çš„è°ƒæ•´ï¼Œæ‰¾ä¸€ä¸ªä½ ç†Ÿæ‚‰çš„ç‰ˆæœ¬å°±å¥½ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;1ã€å¯åŠ¨æ—¶åºå›¾&quot;&gt;&lt;a href=&quot;#1ã€å¯åŠ¨æ—¶åºå›¾&quot; class=&quot;headerlink&quot; title=&quot;1ã€å¯åŠ¨æ—¶åºå›¾&quot;&gt;&lt;/a&gt;1ã€å¯åŠ¨æ—¶åºå›¾&lt;/h2&gt;&lt;p&gt;ä½œä¸ºä¸€ä¸ªè½»å¾®å¼ºè¿«ç—‡çš„äººï¼Œæ•´ç†çš„æ—¶åºå›¾ï¼Œç›¸ä¿¡å¤§å®¶æŒ‰å›¾ç´¢éª¥ï¼Œä¸€å®šèƒ½ææ˜ç™½æ•´ä¸ªå¯åŠ¨æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/launcher_app.png&quot; alt=&quot;launcher_app&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/images/launcher_app.png&quot;&gt;ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹é«˜æ¸…æ— ç å¤§å›¾&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯´æ˜ï¼šä¸ºäº†è®©å¤§å®¶æ›´æ¸…æ¥šçš„ç†è§£æ•´ä¸ªè¿‡ç¨‹ï¼Œå°†æ—¶åºå›¾ä¸­åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šLauncherè¿›ç¨‹ã€Systemè¿›ç¨‹ã€Appè¿›ç¨‹ï¼Œå…¶ä¸­æœ‰æ¶‰åŠå…±ç”¨çš„ç±»ä»¥L / Aè¿›è¡ŒåŒºåˆ†è¡¨ç¤ºè·Ÿå“ªä¸ªè¿›ç¨‹æœ‰å…³ï¼Œä¾¿äºç†è§£ã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;2ã€å…³é”®ç±»è¯´æ˜&quot;&gt;&lt;a href=&quot;#2ã€å…³é”®ç±»è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;2ã€å…³é”®ç±»è¯´æ˜&quot;&gt;&lt;/a&gt;2ã€å…³é”®ç±»è¯´æ˜&lt;/h2&gt;&lt;p&gt;æ•´ä¸ªå¯åŠ¨æµç¨‹å› ä¸ºä¼šæ¶‰åŠåˆ°å¤šæ¬¡Binderé€šä¿¡ï¼Œè¿™é‡Œå…ˆç®€è¦è¯´æ˜ä¸€ä¸‹å‡ ä¸ªç±»çš„ç”¨é€”ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£æ•´ä¸ªäº¤äº’æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ActivityManagerService&lt;/strong&gt;ï¼šAMSæ˜¯Androidä¸­æœ€æ ¸å¿ƒçš„æœåŠ¡ä¹‹ä¸€ï¼Œä¸»è¦è´Ÿè´£ç³»ç»Ÿä¸­å››å¤§ç»„ä»¶çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦åŠåº”ç”¨è¿›ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦ç­‰å·¥ä½œï¼Œå…¶èŒè´£ä¸æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹ç®¡ç†å’Œè°ƒåº¦æ¨¡å—ç›¸ç±»ä¼¼ï¼Œå› æ­¤å®ƒåœ¨Androidä¸­éå¸¸é‡è¦ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªBinderçš„å®ç°ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Instrumentation&lt;/strong&gt;ï¼šé¡¾åæ€ä¹‰ï¼Œå®ƒç”¨æ¥ç›‘æ§åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„äº¤äº’ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ActivityThread&lt;/strong&gt;ï¼šåº”ç”¨çš„å…¥å£ç±»ï¼Œç³»ç»Ÿé€šè¿‡è°ƒç”¨mainå‡½æ•°ï¼Œå¼€å¯æ¶ˆæ¯å¾ªç¯é˜Ÿåˆ—ã€‚ActivityThreadæ‰€åœ¨çº¿ç¨‹è¢«ç§°ä¸ºåº”ç”¨çš„ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationThread&lt;/strong&gt;ï¼šApplicationThreadæä¾›Binderé€šè®¯æ¥å£ï¼ŒAMSåˆ™é€šè¿‡ä»£ç†è°ƒç”¨æ­¤Appè¿›ç¨‹çš„æœ¬åœ°æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ActivityManagerProxy&lt;/strong&gt;ï¼šAMSæœåŠ¡åœ¨å½“å‰è¿›ç¨‹çš„ä»£ç†ç±»ï¼Œè´Ÿè´£ä¸AMSé€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationThreadProxy&lt;/strong&gt;ï¼šApplicationThreadåœ¨AMSæœåŠ¡ä¸­çš„ä»£ç†ç±»ï¼Œè´Ÿè´£ä¸ApplicationThreadé€šä¿¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;3ã€æµç¨‹åˆ†æ&quot;&gt;&lt;a href=&quot;#3ã€æµç¨‹åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;3ã€æµç¨‹åˆ†æ&quot;&gt;&lt;/a&gt;3ã€æµç¨‹åˆ†æ&lt;/h2&gt;&lt;p&gt;é¦–å…ˆäº¤ä»£ä¸‹æ•´ä¸ªæµç¨‹åˆ†æçš„åœºæ™¯ï¼šç”¨æˆ·ç‚¹å‡»Launcherä¸Šçš„åº”ç”¨å›¾æ ‡åˆ°è¯¥åº”ç”¨ä¸»ç•Œé¢å¯åŠ¨å±•ç¤ºåœ¨ç”¨æˆ·çœ¼å‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°è·¨è¿›ç¨‹é€šä¿¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶åˆ’åˆ†ä¸ºæ—¶åºå›¾ä¸­æ‰€å±•ç¤ºä¸‰ä¸ªè¿›ç¨‹ï¼šLauncherè¿›ç¨‹ã€Systemè¿›ç¨‹ã€Appè¿›ç¨‹ã€‚ä¸ºäº†ä¸è´´è¿‡é•¿çš„ä»£ç åˆèƒ½è¯´æ¸…æ¥šè¿›ç¨‹é—´äº¤äº’çš„æµç¨‹ï¼Œè¿™é‡Œç®€è¿°å‡ ä¸ªé‡è¦çš„äº¤äº’ç‚¹ï¼Œå…¶ä»–ç»†èŠ‚æµç¨‹å¯å‚ç…§æ—¶åºå›¾ä»¥åŠç½—å‡é˜³è€å¸ˆçš„&lt;a href=&quot;http://blog.csdn.net/luoshengyang/article/details/6689748&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;Androidåº”ç”¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹æºä»£ç åˆ†æ&lt;/code&gt;&lt;/a&gt;æ¥è·Ÿè¸ªï¼Œè™½ç„¶ç½—è€å¸ˆæ–‡ç« ä¸­åˆ†ææºç çš„ç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œä½†æ•´ä½“æµç¨‹åˆ†æä»ç°åœ¨çš„ä»£ç æ¥çœ‹ä¾ç„¶ååˆ†æ¸…æ™°åˆ°ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä»æ—¶åºå›¾ä¸Šå¤§å®¶ä¹Ÿå¯ä»¥çœ‹åˆ°è°ƒç”¨é“¾ç›¸å½“é•¿ï¼Œå¯¹åº”çš„ä»£ç é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œè€Œä¸”æ—¶åºå›¾åªæ˜¯åˆ†æäº†è¿™ä¸ªä¸€ä¸ªåœºæ™¯ä¸‹çš„æµç¨‹ã€‚é“é˜»ä¸”é•¿ï¼Œè¡Œåˆ™å°†è‡³ï¼&lt;/p&gt;
&lt;h4 id=&quot;3-1-Launcherå“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œé€šçŸ¥AMS&quot;&gt;&lt;a href=&quot;#3-1-Launcherå“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œé€šçŸ¥AMS&quot; class=&quot;headerlink&quot; title=&quot;3.1 Launcherå“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œé€šçŸ¥AMS&quot;&gt;&lt;/a&gt;3.1 Launcherå“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œé€šçŸ¥AMS&lt;/h4&gt;&lt;p&gt;Launcheråšä¸ºåº”ç”¨çš„å…¥å£ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº¤ä»£ä¸€ä¸‹çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Launcherçš„ä»£ç ç‰‡æ®µï¼ŒLauncherä½¿ç”¨çš„æ˜¯packages/apps/Launcher3çš„çš„æºç ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Launcher&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Activity&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;OnClickListener&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;OnLongClickListener&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;LauncherModel&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Callbacks&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   &lt;span class=&quot;title&quot;&gt;View&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;OnTouchListener&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;PageSwitchListener&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;LauncherProviderChangeListener&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Launches the intent referred by the clicked shortcut.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; v The view representing the clicked shortcut.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Make sure that rogue clicks don&#39;t get through while allapps is launching, or after the&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// view has detached (it&#39;s possible for this to happen if the view is removed mid touch).&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (v.getWindowToken() == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Object tag = v.getTag();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; ShortcutInfo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            onClickAppShortcut(v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; FolderInfo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (v == mAllAppsButton) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            onClickAllAppsButton(v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; AppInfo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            startAppShortcutOrInfoActivity(v);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; LauncherAppWidgetInfo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startAppShortcutOrInfoActivity&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; success = startActivitySafely(v, intent, tag);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startActivitySafely&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v, Intent intent, Object tag)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            success = startActivity(v, intent, tag);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (ActivityNotFoundException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; success;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startActivity&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v, Intent intent, Object tag)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (user == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || user.equals(UserHandleCompat.myUserHandle())) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// Could be launching some bookkeeping activity&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                startActivity(intent, optsBundle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (SecurityException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡starActicityè¾—è½¬è°ƒç”¨åˆ°Activity:startActivityForResultè€Œååˆ™è°ƒç”¨è‡³Instrumentation:execStartActivityï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Instrumentation&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; ActivityResult &lt;span class=&quot;title&quot;&gt;execStartActivity&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Context who, IBinder contextThread, IBinder token, Activity target,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Intent intent, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; requestCode, Bundle options)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        IApplicationThread whoThread = (IApplicationThread) contextThread;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; result = ActivityManagerNative.getDefault()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .startActivity(whoThread, who.getBasePackageName(), intent,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        intent.resolveTypeIfNeeded(who.getContentResolver()),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        token, target != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? target.mEmbeddedID : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        requestCode, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, options);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemoteException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;ActivityManagerNative.getDefault&lt;/code&gt;è¿”å›ActivityManagerServiceçš„è¿œç¨‹æ¥å£ï¼Œå³&lt;code&gt;ActivityManagerProxy&lt;/code&gt;æ¥å£ï¼Œæœ‰äººå¯èƒ½ä¼šé—®äº†ä¸ºä»€ä¹ˆä¼šæ˜¯ActivityManagerProxyï¼Œè¿™å°±æ¶‰åŠåˆ°Binderé€šä¿¡äº†ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚é€šè¿‡Binderé©±åŠ¨ç¨‹åºï¼Œ&lt;code&gt;ActivityManagerProxy&lt;/code&gt;ä¸AMSæœåŠ¡é€šä¿¡ï¼Œåˆ™å®ç°äº†è·¨è¿›ç¨‹åˆ°Systemè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-2-AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚&quot;&gt;&lt;a href=&quot;#3-2-AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚&quot; class=&quot;headerlink&quot; title=&quot;3.2 AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚&quot;&gt;&lt;/a&gt;3.2 AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚&lt;/h4&gt;&lt;p&gt;ä»ä¸Šé¢çš„æµç¨‹æˆ‘ä»¬çŸ¥é“ï¼Œæ­¤æ—¶AMSåº”è¯¥å¤„ç†Launcherè¿›ç¨‹å‘æ¥çš„è¯·æ±‚ï¼Œè¯·å‚çœ‹æ—¶åºå›¾åŠæºç ï¼Œæ­¤æ—¶æˆ‘ä»¬æ¥çœ‹ActivityStackSupervisor:startActivityUncheckedLockedæ–¹æ³•ï¼Œç›®æµ‹è¿™ä¸ªæ–¹æ³•å·²ç»è¶…è¿‡600è¡Œä»£ç ï¼Œæ¥çœ‹ä¸€äº›å…³é”®ä»£ç ç‰‡æ®µï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityStackSupervisor&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DisplayListener&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startActivityUncheckedLocked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ActivityRecord r, ActivityRecord sourceRecord,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; startFlags, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; doResume, Bundle options, TaskRecord inTask)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Intent intent = r.intent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; callingUid = r.launchedFromUid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; launchSingleTop = r.launchMode == ActivityInfo.LAUNCH_SINGLE_TOP;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; launchSingleInstance = r.launchMode == ActivityInfo.LAUNCH_SINGLE_INSTANCE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; launchSingleTask = r.launchMode == ActivityInfo.LAUNCH_SINGLE_TASK; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; launchFlags = intent.getFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// We&#39;ll invoke onUserLeaving before onPause only if the launching&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// activity did not explicitly state that this is an automated launch.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mUserLeaving = (launchFlags &amp;amp; Intent.FLAG_ACTIVITY_NO_USER_ACTION) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         ActivityRecord notTop =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (launchFlags &amp;amp; Intent.FLAG_ACTIVITY_PREVIOUS_IS_TOP) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? r : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// If the onlyIfNeeded flag is set, then we can do this if the activity&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// being launched is the same as the one making the call...  or, as&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// a special case, if we do not know the caller then we count the&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// current top activity as the caller.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((startFlags&amp;amp;ActivityManager.START_FLAG_ONLY_IF_NEEDED) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;// If the caller is not coming from another activity, but has given us an&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// explicit task into which they would like us to launch the new activity,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// then let&#39;s see about doing that.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sourceRecord == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; inTask != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; inTask.stack != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Intent baseIntent = inTask.getBaseIntent();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ActivityRecord root = inTask.getRootActivity();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// If this task is empty, then we are adding the first activity -- it&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// determines the root, and must be launching as a NEW_TASK.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (launchSingleInstance || launchSingleTask) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (inTask == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sourceRecord == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// This activity is not being started from another...  in this&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// case we -always- start a new task.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((launchFlags &amp;amp; Intent.FLAG_ACTIVITY_NEW_TASK) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; inTask == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					Slog.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;startActivity called from non-Activity context; forcing &quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;string&quot;&gt;&quot;Intent.FLAG_ACTIVITY_NEW_TASK for: &quot;&lt;/span&gt; + intent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sourceRecord.launchMode == ActivityInfo.LAUNCH_SINGLE_INSTANCE) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// The original activity who is starting us is running as a single&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// instance...  this new activity it is starting must go on its&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// own task.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (launchSingleInstance || launchSingleTask) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// The activity being started is a single instance...  it always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// gets launched into its own task.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;// We may want to try to place the new activity in to an existing task.  We always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// do this if the target activity is singleTask or singleInstance; we will also do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// this if NEW_TASK has been requested, and there is not an additional qualifier telling&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// us to still place it in a new task: multi task, always doc mode, or being asked to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// launch this as a new task behind the current one.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (((launchFlags &amp;amp; Intent.FLAG_ACTIVITY_NEW_TASK) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (launchFlags &amp;amp; Intent.FLAG_ACTIVITY_MULTIPLE_TASK) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                || launchSingleInstance || launchSingleTask) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// If bring to front is requested, and no result is requested and we have not&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// been given an explicit task to launch in to, and&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// we can find a task that was started with this same&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// component, then instead of launching bring that one to the front.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (inTask == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; r.resultTo == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// See if there is a task to bring to the front.  If this is&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// a SINGLE_INSTANCE activity, there can be one and only one&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// instance of it in the history, and it is always in its own&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;comment&quot;&gt;// unique task, so we do a special search.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				ActivityRecord intentActivity = !launchSingleInstance ?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					findTaskLocked(r) : findActivityLocked(intent, r.info);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (intentActivity != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r.packageName != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// If the activity being launched is the same as the one currently&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// at the top, then we need to check if it should only be launched&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// once.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ActivityStack topStack = getFocusedStack();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ActivityRecord top = topStack.topRunningNonDelayedActivityLocked(notTop);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (top != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; r.resultTo == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (top.realActivity.equals(r.realActivity) &amp;amp;&amp;amp; top.userId == r.userId) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; newTask = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; keepCurTransition = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		TaskRecord taskToAffiliate = launchTaskBehind &amp;amp;&amp;amp; sourceRecord != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sourceRecord.task : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// Should this be considered a new task?&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r.resultTo == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; inTask == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !addingToTask&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;amp;&amp;amp; (launchFlags &amp;amp; Intent.FLAG_ACTIVITY_NEW_TASK) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (reuseTask == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                r.setTask(targetStack.createTaskRecord(getNextTaskId(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        newTaskInfo != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? newTaskInfo : r.info,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        newTaskIntent != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? newTaskIntent : intent,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        voiceSession, voiceInteractor, !launchTaskBehind &lt;span class=&quot;comment&quot;&gt;/* toTop */&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        taskToAffiliate);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                r.setTask(reuseTask, taskToAffiliate);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sourceRecord != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!addingToTask &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    (launchFlags&amp;amp;Intent.FLAG_ACTIVITY_REORDER_TO_FRONT) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (inTask != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		targetStack.startActivityLocked(r, newTask, doResume, keepCurTransition, options);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ActivityManager.START_SUCCESS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å‡½æ•°ç»è¿‡intentçš„æ ‡å¿—å€¼è®¾ç½®ï¼Œé€šè¿‡findTaskLockedå‡½æ•°æ¥æŸ¥æ‰¾å­˜ä¸å­˜è¿™æ ·çš„Taskï¼Œè¿™é‡Œè¿”å›çš„ç»“æœæ˜¯nullï¼Œå³intentActivityä¸ºnullï¼Œå› æ­¤ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Taskæ¥å¯åŠ¨è¿™ä¸ªActivityã€‚ç°åœ¨å¤„ç†å †æ ˆé¡¶ç«¯çš„Activityæ˜¯Launcherï¼Œä¸æˆ‘ä»¬å³å°†è¦å¯åŠ¨çš„MainActivityä¸æ˜¯åŒä¸€ä¸ªActivityï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Taské‡Œé¢æ¥å¯åŠ¨è¿™ä¸ªActivityã€‚&lt;/p&gt;
&lt;p&gt;ç»è¿‡æ ˆé¡¶æ£€æµ‹ï¼Œåˆ™éœ€è¦å°†Launcheræ¨å…¥PausedçŠ¶æ€ï¼Œæ‰å¯ä»¥å¯åŠ¨æ–°çš„Activityã€‚åç»­åˆ™è°ƒç”¨è‡³ActivityStack:startPausingLockedï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityStack&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startPausingLocked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; userLeaving, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; uiSleeping, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; resuming,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; dontWait)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mPausingActivity != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  ActivityRecord prev = mResumedActivity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (prev == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  mResumedActivity = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  mPausingActivity = prev;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  mLastPausedActivity = prev;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  mLastNoHistoryActivity = (prev.intent.getFlags() &amp;amp; Intent.FLAG_ACTIVITY_NO_HISTORY) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                || (prev.info.flags &amp;amp; ActivityInfo.FLAG_NO_HISTORY) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? prev : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  prev.state = ActivityState.PAUSING;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (prev.app != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; prev.app.thread != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		  prev.app.thread.schedulePauseActivity(prev.appToken, prev.finishing,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        userLeaving, prev.configChangeFlags, dontWait);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œçš„prev.app.threadæ˜¯ä¸€ä¸ªApplicationThreadå¯¹è±¡çš„è¿œç¨‹æ¥å£ï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªè¿œç¨‹æ¥å£çš„schedulePauseActivityæ¥é€šçŸ¥Launcherè¿›å…¥PausedçŠ¶æ€ã€‚è‡³æ­¤ï¼ŒAMSå¯¹Launcherçš„è¯·æ±‚å·²ç»å“åº”ï¼Œè¿™æ˜¯æˆ‘ä»¬å‘ç°åˆé€šè¿‡Binderé€šä¿¡å›è°ƒè‡³Launcherè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-3-Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS&quot;&gt;&lt;a href=&quot;#3-3-Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS&quot; class=&quot;headerlink&quot; title=&quot;3.3 Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS&quot;&gt;&lt;/a&gt;3.3 Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS&lt;/h4&gt;&lt;p&gt;è¿™ä¸ªæµç¨‹ç›¸å¯¹ä¼šç®€å•ä¸€äº›ï¼Œæˆ‘ä»¬æ¥çœ‹ActivityThread:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityThread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handlePauseActivity&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IBinder token, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; finished,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; userLeaving, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; configChanges, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; dontReport)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ActivityClientRecord r = mActivities.get(token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            performPauseActivity(token, finished, r.isPreHoneycomb());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Make sure any pending writes are now committed.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (r.isPreHoneycomb()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                QueuedWork.waitToFinish();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// Tell the activity manager we have paused.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!dontReport) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ActivityManagerNative.getDefault().activityPaused(token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemoteException ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™éƒ¨åˆ†Launcherçš„ActivityThreadå¤„ç†é¡µé¢Pausedå¹¶ä¸”å†æ¬¡é€šè¿‡ActivityManagerProxyé€šçŸ¥AMSã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-4-AMSåˆ›å»ºæ–°çš„è¿›ç¨‹&quot;&gt;&lt;a href=&quot;#3-4-AMSåˆ›å»ºæ–°çš„è¿›ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;3.4 AMSåˆ›å»ºæ–°çš„è¿›ç¨‹&quot;&gt;&lt;/a&gt;3.4 AMSåˆ›å»ºæ–°çš„è¿›ç¨‹&lt;/h4&gt;&lt;p&gt;åˆ›å»ºæ–°è¿›ç¨‹çš„æ—¶å€™ï¼ŒAMSä¼šä¿å­˜ä¸€ä¸ªProcessRecordä¿¡æ¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­çš„AndroidManifest.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šApplicationæ ‡ç­¾çš„processå±æ€§ï¼Œç³»ç»Ÿå°±ä¼šé»˜è®¤ä½¿ç”¨packageçš„åç§°ã€‚æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„uidï¼Œå› æ­¤ï¼Œè¿™é‡Œuid + processçš„ç»„åˆå°±å¯ä»¥ä¸ºæ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªProcessRecordã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityManagerService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityManagerNative&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Watchdog&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Monitor&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;BatteryStatsImpl&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;BatteryCallback&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;startProcessLocked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ProcessRecord app, String hostingType, String 	hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &lt;span class=&quot;comment&quot;&gt;// Start the process.  It will either succeed and return a result containing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &lt;span class=&quot;comment&quot;&gt;// the PID of the new process, or else throw a RuntimeException.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isActivityProcess = (entryPoint == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (entryPoint == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) entryPoint = &lt;span class=&quot;string&quot;&gt;&quot;android.app.ActivityThread&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      Process.ProcessStartResult startResult = Process.start(entryPoint,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    app.processName, uid, uid, gids, debugFlags, mountExternal,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    app.info.targetSdkVersion, app.info.seinfo, requiredAbi, instructionSet,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    app.info.dataDir, entryPointArgs);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦æ˜¯è°ƒç”¨Process:startæ¥å£æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹ä¼šå¯¼å…¥android.app.ActivityThreadç±»ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒçš„mainå‡½æ•°ï¼Œè¿™å°±æ˜¯æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªActivityThreadå®ä¾‹æ¥å¯¹åº”çš„åŸå› ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-5-åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#3-5-åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;3.5 åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–&quot;&gt;&lt;/a&gt;3.5 åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹Activityçš„mainå‡½æ•°ï¼Œè¿™é‡Œç»‘å®šäº†ä¸»çº¿ç¨‹çš„Looperï¼Œå¹¶è¿›å…¥æ¶ˆæ¯å¾ªç¯ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“ï¼Œæ•´ä¸ªAndroidç³»ç»Ÿæ˜¯æ¶ˆæ¯é©±åŠ¨çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹é»˜è®¤ç»‘å®šLooperçš„åŸå› ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityThread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    Looper.prepareMainLooper();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ActivityThread thread = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ActivityThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    thread.attach(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    Looper.loop();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; system)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!system) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; IActivityManager mgr = ActivityManagerNative.getDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	            mgr.attachApplication(mAppThread);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemoteException ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	            &lt;span class=&quot;comment&quot;&gt;// Ignore&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;attachå‡½æ•°æœ€ç»ˆè°ƒç”¨äº†ActivityManagerServiceçš„è¿œç¨‹æ¥å£ActivityManagerProxyçš„attachApplicationå‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯mAppThreadï¼Œè¿™æ˜¯ä¸€ä¸ªApplicationThreadç±»å‹çš„Binderå¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯AMSä¸åº”ç”¨è¿›ç¨‹è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;3-6-åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨å¯åŠ¨æ ˆé¡¶é¡µé¢&quot;&gt;&lt;a href=&quot;#3-6-åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨å¯åŠ¨æ ˆé¡¶é¡µé¢&quot; class=&quot;headerlink&quot; title=&quot;3.6 åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨å¯åŠ¨æ ˆé¡¶é¡µé¢&quot;&gt;&lt;/a&gt;3.6 åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨å¯åŠ¨æ ˆé¡¶é¡µé¢&lt;/h4&gt;&lt;p&gt;å‰é¢æˆ‘ä»¬æåˆ°äº†AMSè´Ÿè´£ç³»ç»Ÿä¸­å››å¤§ç»„ä»¶çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦åŠåº”ç”¨è¿›ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦ç­‰å·¥ä½œï¼Œé€šè¿‡ä¸Šä¸€ä¸ªæµç¨‹æˆ‘ä»¬çŸ¥é“åº”ç”¨è¿›ç¨‹åˆ›å»ºåé€šè¿‡Binderé©±åŠ¨ä¸AMSäº§ç”Ÿäº¤äº’ï¼Œæ­¤æ—¶AMSåˆ™å°†åº”ç”¨è¿›ç¨‹åˆ›å»ºåçš„ä¿¡æ¯è¿›è¡Œäº†ä¸€æ¬¡&lt;code&gt;æ³¨å†Œ&lt;/code&gt;ï¼Œå¦‚æœæ‹¿Windowsç³»ç»Ÿç¨‹åºæ³¨å†Œåˆ°çš„æ³¨å†Œè¡¨æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯èƒ½ä¼šæ›´å½¢è±¡ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;mMainStack.topRunningActivityLocked(null)ä»å †æ ˆé¡¶ç«¯å–å‡ºè¦å¯åŠ¨çš„Activityï¼Œå¹¶åœ¨realStartActivityLockedhanå‡½æ•°ä¸­é€šè¿‡ApplicationThreadProxyè°ƒå›Appè¿›ç¨‹å¯åŠ¨é¡µé¢ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityStackSupervisor&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DisplayListener&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;realStartActivityLocked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ActivityRecord r,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ProcessRecord app, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; andResume, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; checkConfig)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemoteException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    r.app = app;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      app.thread.scheduleLaunchActivity(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(r.intent), r.appToken,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    System.identityHashCode(r), r.info, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Configuration(mService.mConfiguration),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    r.compat, r.launchedFromPackage, r.task.voiceInteractor, app.repProcState,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    r.icicle, r.persistentState, results, newIntents, !andResume,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    mService.isNextTransitionForward(), profilerInfo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemoteException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤æ—¶åœ¨Appè¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡ä¸€äº›åˆ—çš„è°ƒç”¨é“¾æœ€ç»ˆè°ƒç”¨è‡³MainActivity:onCreateå‡½æ•°ï¼Œä¹‹åä¼šè°ƒç”¨è‡³onResumeï¼Œè€Œåä¼šé€šçŸ¥AMSè¯¥MainActivityå·²ç»å¤„äºresumeçŠ¶æ€ã€‚è‡³æ­¤ï¼Œæ•´ä¸ªå¯åŠ¨æµç¨‹å‘Šä¸€æ®µè½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4ã€æ€»ç»“&quot;&gt;&lt;a href=&quot;#4ã€æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;4ã€æ€»ç»“&quot;&gt;&lt;/a&gt;4ã€æ€»ç»“&lt;/h2&gt;&lt;p&gt;é€šè¿‡ä¸Šè¿°æµç¨‹ï¼Œç›¸ä¿¡å¤§å®¶å¯ä»¥æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„è®¤çŸ¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¿½ç•¥ç»†èŠ‚ç®€åŒ–æµç¨‹ï¼Œå•çº¯ä»è¿›ç¨‹è§’åº¦æ¥çœ‹ä¸‹å›¾ï¼š &lt;img src=&quot;/images/launch_app_sim.png&quot; alt=&quot;launch_app_sim&quot;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸Šæ‰€ç”»è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°ï¼ŒActivityå¯åŠ¨åè‡³ResumeçŠ¶æ€ï¼Œæ­¤æ—¶å¯äº¤äº’ã€‚æ¬¢è¿å¤§å®¶æŒ‡æ­£äº¤æµã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼š&lt;a href=&quot;mailto://imilko7@gmail.com&quot;&gt;solart&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å›¾æ–‡ä¸ºåšä¸»åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤§å®¶æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ç‚¹å‡»&lt;code&gt;Launcher&lt;/code&gt;å›¾æ ‡æ—¶ï¼Œåˆ°å”¤èµ·ä¸€ä¸ªåº”ç”¨é¡µé¢ï¼Œè¿™ä¸ªæµç¨‹ä¼šæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿæœ¬æ–‡çš„ç›®çš„å°±æ˜¯å°½å¯èƒ½æ¢³ç†æ¸…æ¥šæµç¨‹ï¼Œèƒ½å¤Ÿè®©å¤§å®¶å¯¹æ•´ä¸ªæµç¨‹æœ‰ä¸€ä¸ªç›¸å¯¹æ¸…æ™°çš„è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå¸Œæœ›æ‚¨èƒ½æœ€å¥½å·²ç»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰ä¸€ä»½ç¼–è¯‘åçš„Androidæºç ï¼ˆäº²è‡ªåŠ¨æ‰‹å®è·µæ‰ä¼šæœ‰æ›´æ·±å…¥çš„ç†è§£ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹Binderæœºåˆ¶æœ‰ä¸€å®šçš„äº†è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡å¯åŠ¨æµç¨‹åˆ†æåŸºäºAndroid 5.1çš„æºç ã€‚ä¸ºä»€ä¹ˆæ˜¯5.1çš„æºç å‘¢ï¼Ÿå› ä¸ºæ‰‹è¾¹ç¼–è¯‘å®Œçš„ä»£ç åªæœ‰è¿™ä¸ªç‰ˆæœ¬â€¦å¦å¤–ï¼Œç”¨ä»€ä¹ˆç‰ˆæœ¬çš„æºç å¹¶ä¸é‡è¦ï¼Œå¤§ä½“çš„æµç¨‹å¹¶æ— æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œä»…ä»…æ˜¯å®ç°ç»†èŠ‚çš„è°ƒæ•´ï¼Œæ‰¾ä¸€ä¸ªä½ ç†Ÿæ‚‰çš„ç‰ˆæœ¬å°±å¥½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Androidæ’ä»¶åŒ–å­¦ä¹ </title>
    <link href="http://solart.cc/2016/07/11/learn_plugin/"/>
    <id>http://solart.cc/2016/07/11/learn_plugin/</id>
    <published>2016-07-11T10:06:08.000Z</published>
    <updated>2016-08-02T07:14:52.000Z</updated>
    
    <content type="html">&lt;p&gt;æ’ä»¶åŒ–æŠ€æœ¯ï¼ˆä¹Ÿå«åŠ¨æ€åŠ è½½æŠ€æœ¯ï¼‰åœ¨æŠ€æœ¯é©±åŠ¨å‹çš„å…¬å¸ä¸­æ‰®æ¼”ç€ç›¸å½“é‡è¦çš„è§’è‰²ï¼Œå½“é¡¹ç›®è¶Šæ¥è¶Šåºå¤§çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡æ’ä»¶åŒ–æ¥ç»™åº”ç”¨ç˜¦èº«ï¼Œè¿˜å¯ä»¥å®ç°çƒ­æ’æ‹”ï¼Œå³åœ¨ä¸å‘å¸ƒæ–°ç‰ˆæœ¬çš„æƒ…å†µä¸‹æ›´æ–°æŸäº›æ¨¡å—ã€‚å¯¹äºä¸šåŠ¡è¿­ä»£è¾ƒå¿«çš„å…¬å¸ï¼Œå¯ä»¥å‡å°‘å‘åŒ…æ¬¡æ•°è€Œä¸”æœ‰å¾ˆå¥½çš„è¦†ç›–åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä¸ºè¿™æ®µæ—¶é—´å­¦ä¹ æ’ä»¶åŒ–çš„ä¸€äº›ç¬”è®°æˆ–æ‘˜è¦åŠè‡ªå·±çš„ä¸€äº›ç†è§£ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;1ã€Javaç±»åŠ è½½å™¨&quot;&gt;&lt;a href=&quot;#1ã€Javaç±»åŠ è½½å™¨&quot; class=&quot;headerlink&quot; title=&quot;1ã€Javaç±»åŠ è½½å™¨&quot;&gt;&lt;/a&gt;1ã€Javaç±»åŠ è½½å™¨&lt;/h2&gt;&lt;p&gt;æåˆ°Androidæ’ä»¶åŒ–ï¼Œä¸€ä¸ªåŸºç¡€çš„çŸ¥è¯†ç‚¹å°±æ˜¯javaçš„ç±»åŠ è½½æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;a href=&quot;#ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&quot;&gt;&lt;/a&gt;ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„&lt;/h4&gt;&lt;p&gt;Java ä¸­çš„ç±»åŠ è½½å™¨å¤§è‡´å¯ä»¥åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç³»ç»Ÿæä¾›çš„ï¼Œå¦å¤–ä¸€ç±»åˆ™æ˜¯ç”± Java åº”ç”¨å¼€å‘äººå‘˜ç¼–å†™çš„ã€‚ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒåº“ï¼Œæ˜¯ç”¨åŸç”Ÿä»£ç æ¥å®ç°çš„ï¼Œå¹¶ä¸ç»§æ‰¿è‡ª &lt;code&gt;java.lang.ClassLoader&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆextensions class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ã€‚Java è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsystem class loaderï¼‰ï¼šå®ƒæ ¹æ® Java åº”ç”¨çš„ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥åŠ è½½ Java ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ &lt;code&gt;ClassLoader.getSystemClassLoader()&lt;/code&gt;æ¥è·å–å®ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot;&gt;&lt;a href=&quot;#ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&quot;&gt;&lt;/a&gt;ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ç±»åŠ è½½å™¨&lt;/code&gt;åœ¨å°è¯•è‡ªå·±å»æŸ¥æ‰¾æŸä¸ªç±»çš„å­—èŠ‚ä»£ç å¹¶å®šä¹‰å®ƒæ—¶ï¼Œä¼šå…ˆä»£ç†ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œç”±çˆ¶ç±»åŠ è½½å™¨å…ˆå»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œä¾æ¬¡ç±»æ¨ã€‚åœ¨ä»‹ç»ä»£ç†æ¨¡å¼èƒŒåçš„åŠ¨æœºä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è¯´æ˜ä¸€ä¸‹ Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯ç›¸åŒçš„ã€‚Java è™šæ‹Ÿæœºä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä¾¿æ˜¯åŒæ ·çš„å­—èŠ‚ä»£ç ï¼Œè¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ä¹‹åæ‰€å¾—åˆ°çš„ç±»ï¼Œä¹Ÿæ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;åŠ è½½ç±»çš„è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#åŠ è½½ç±»çš„è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;åŠ è½½ç±»çš„è¿‡ç¨‹&quot;&gt;&lt;/a&gt;åŠ è½½ç±»çš„è¿‡ç¨‹&lt;/h4&gt;&lt;p&gt;åœ¨å‰é¢ä»‹ç»ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼çš„æ—¶å€™ï¼Œæåˆ°è¿‡ç±»åŠ è½½å™¨ä¼šé¦–å…ˆä»£ç†ç»™å…¶å®ƒç±»åŠ è½½å™¨æ¥å°è¯•åŠ è½½æŸä¸ªç±»ã€‚è¿™å°±æ„å‘³ç€çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ &lt;code&gt;defineClass&lt;/code&gt;æ¥å®ç°çš„ï¼›è€Œå¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ &lt;code&gt;loadClass&lt;/code&gt;æ¥å®ç°çš„ã€‚å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼šä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€åŠ¨æ€ä»£ç†&quot;&gt;&lt;a href=&quot;#2ã€åŠ¨æ€ä»£ç†&quot; class=&quot;headerlink&quot; title=&quot;2ã€åŠ¨æ€ä»£ç†&quot;&gt;&lt;/a&gt;2ã€åŠ¨æ€ä»£ç†&lt;/h2&gt;&lt;p&gt;ä»£ç†åŠåŠ¨æ€ä»£ç†åœ¨æ’ä»¶åŒ–çš„æŠ€æœ¯ä¸­ä¹Ÿèµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Java-å®ç°åŠ¨æ€ä»£ç†&quot;&gt;&lt;a href=&quot;#Java-å®ç°åŠ¨æ€ä»£ç†&quot; class=&quot;headerlink&quot; title=&quot;Java å®ç°åŠ¨æ€ä»£ç†&quot;&gt;&lt;/a&gt;Java å®ç°åŠ¨æ€ä»£ç†&lt;/h4&gt;&lt;p&gt;Javaå®ç°åŠ¨æ€ä»£ç†çš„å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰ä¸€ä¸ªå§”æ‰˜ç±»å’Œå…¬å…±æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»ï¼ˆè°ƒç”¨å¤„ç†å™¨ç±»ï¼Œå³å®ç° &lt;code&gt;InvocationHandler&lt;/code&gt; æ¥å£ï¼‰ï¼Œè¿™ä¸ªç±»çš„ç›®çš„æ˜¯æŒ‡å®šè¿è¡Œæ—¶å°†ç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦å®Œæˆçš„å…·ä½“ä»»åŠ¡ï¼ˆåŒ…æ‹¬Preprocesså’ŒPostprocessï¼‰ï¼Œå³ä»£ç†ç±»è°ƒç”¨ä»»ä½•æ–¹æ³•éƒ½ä¼šç»è¿‡è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆå½“ç„¶ä¹Ÿä¼šç”Ÿæˆä»£ç†ç±»ï¼‰ï¼Œéœ€è¦ä¸ºä»–æŒ‡å®š(1)å§”æ‰˜å¯¹è±¡(2)å®ç°çš„ä¸€ç³»åˆ—æ¥å£(3)è°ƒç”¨å¤„ç†å™¨ç±»çš„å®ä¾‹ã€‚å› æ­¤å¯ä»¥çœ‹å‡ºä¸€ä¸ªä»£ç†å¯¹è±¡å¯¹åº”ä¸€ä¸ªå§”æ‰˜å¯¹è±¡ï¼Œå¯¹åº”ä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Java å®ç°åŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;java.lang.reflect.Proxy&lt;/code&gt;: è¿™æ˜¯ç”Ÿæˆä»£ç†ç±»çš„ä¸»ç±»ï¼Œé€šè¿‡ Proxy ç±»ç”Ÿæˆçš„ä»£ç†ç±»éƒ½ç»§æ‰¿äº† Proxy ç±»ï¼Œå³ &lt;code&gt;DynamicProxyClass extends Proxy&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;java.lang.reflect.InvocationHandler&lt;/code&gt;: è¿™é‡Œç§°ä»–ä¸ºâ€è°ƒç”¨å¤„ç†å™¨â€ï¼Œä»–æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦å®Œæˆçš„å…·ä½“å†…å®¹éœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»ï¼Œè€Œè¿™ä¸ªç±»å¿…é¡»å®ç° InvocationHandler æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Proxy ç±»ä¸»è¦æ–¹æ³•ä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//åˆ›å»ºä»£ç†å¯¹è±¡  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ClassLoader loader, Class&amp;lt;?&amp;gt;[] interfaces, InvocationHandler handler)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™ä¸ªé™æ€å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åŠ è½½å™¨å¯¹è±¡ï¼ˆå³å“ªä¸ªç±»åŠ è½½å™¨æ¥åŠ è½½è¿™ä¸ªä»£ç†ç±»åˆ° JVM çš„æ–¹æ³•åŒºï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥å£ï¼ˆè¡¨æ˜ä½ è¿™ä¸ªä»£ç†ç±»éœ€è¦å®ç°å“ªäº›æ¥å£ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è°ƒç”¨å¤„ç†å™¨ç±»å®ä¾‹ï¼ˆæŒ‡å®šä»£ç†ç±»ä¸­å…·ä½“è¦å¹²ä»€ä¹ˆï¼‰ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ JDK ä¸ºäº†ç¨‹åºå‘˜æ–¹ä¾¿åˆ›å»ºä»£ç†å¯¹è±¡è€Œå°è£…çš„ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤ä½ è°ƒç”¨&lt;code&gt;newProxyInstance()&lt;/code&gt;æ—¶ç›´æ¥åˆ›å»ºäº†ä»£ç†å¯¹è±¡ï¼ˆç•¥å»äº†åˆ›å»ºä»£ç†ç±»çš„ä»£ç ï¼‰ã€‚å…¶å®ä»–ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å‡ ä¸ªå·¥ä½œï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ClassLoader loader, Class&amp;lt;?&amp;gt;[] interfaces, InvocationHandler handler)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//æºä»£ç ä¸­å…³é”®ä»£ç ä¸ºä¸‹é¢æ³¨é‡Šçš„ä»£ç ï¼Œå°†å…¶æ‹†è§£ä¸ºä¸‰ä¸ªè¿‡ç¨‹æ–¹ä¾¿é˜…è¯»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//return getProxyClass(loader, interfaces)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//                .getConstructor(InvocationHandler.class)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//                .newInstance(invocationHandler);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//1. æ ¹æ®ç±»åŠ è½½å™¨å’Œæ¥å£åˆ›å»ºä»£ç†ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class clazz = Proxy.getProxyClass(loader, interfaces); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//2. è·å¾—ä»£ç†ç±»çš„å¸¦å‚æ•°çš„æ„é€ å‡½æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Constructor constructor = clazz.getConstructor(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Class[] &amp;#123; InvocationHandler.class &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//3. åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶åˆ¶å®šè°ƒç”¨å¤„ç†å™¨å®ä¾‹ä¸ºå‚æ•°ä¼ å…¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Interface Proxy = (Interface)constructor.newInstance(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Object[] &amp;#123;handler&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;3ã€AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ä¸‰ä¸ªå…³é”®é—®é¢˜&quot;&gt;&lt;a href=&quot;#3ã€AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ä¸‰ä¸ªå…³é”®é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;3ã€AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ä¸‰ä¸ªå…³é”®é—®é¢˜&quot;&gt;&lt;/a&gt;3ã€AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ä¸‰ä¸ªå…³é”®é—®é¢˜&lt;/h2&gt;&lt;p&gt;ä¸åŒçš„æ’ä»¶åŒ–æ–¹æ¡ˆå„æœ‰å„çš„ç‰¹è‰²ï¼Œä½†æ˜¯å®ƒä»¬éƒ½å¿…é¡»è¦è§£å†³ä¸‰ä¸ªåŸºç¡€æ€§é—®é¢˜ï¼šClassLoaderçš„ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä»¥åŠèµ„æºçš„è®¿é—®ã€‚ &lt;/p&gt;
&lt;h4 id=&quot;ClassLoaderçš„ç®¡ç†&quot;&gt;&lt;a href=&quot;#ClassLoaderçš„ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;ClassLoaderçš„ç®¡ç†&quot;&gt;&lt;/a&gt;ClassLoaderçš„ç®¡ç†&lt;/h4&gt;&lt;p&gt;é’ˆå¯¹ClassLoaderçš„ç®¡ç†æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥å¯¹æ¯ä¸€ä¸ªæ’ä»¶åˆ†é…ä¸€ä¸ª&lt;code&gt;ClassLoader&lt;/code&gt;(è¿™æ˜¯ç›®å‰æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼)&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥åŠ¨æ€å¾—æŠŠæ’ä»¶åŠ è½½åˆ°å½“å‰è¿è¡Œç¯å¢ƒçš„classloaderä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†&quot;&gt;&lt;a href=&quot;#ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†&quot;&gt;&lt;/a&gt;ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†&lt;/h4&gt;&lt;p&gt;é€šè¿‡ClassLoaderåŠ è½½äº†å¤–éƒ¨dexï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å´ä¸èƒ½å¯åŠ¨æ’ä»¶ä¸­çš„åº”è¯¥å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼šActivityã€‚&lt;/p&gt;
&lt;p&gt;Activityç­‰ç»„ä»¶æ˜¯éœ€è¦åœ¨&lt;code&gt;AndroidManifest&lt;/code&gt;ä¸­æ³¨å†Œåæ‰èƒ½ä»¥æ ‡å‡†&lt;code&gt;Intent&lt;/code&gt;çš„æ–¹å¼å¯åŠ¨çš„ï¼Œé€šè¿‡ClassLoaderåŠ è½½å¹¶å®ä¾‹åŒ–çš„Activityå®ä¾‹åªæ˜¯ä¸€ä¸ªæ™®é€šçš„Javaå¯¹è±¡ï¼Œèƒ½è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œ&lt;code&gt;Activity&lt;/code&gt;ã€&lt;code&gt;Service&lt;/code&gt;ç­‰ç»„ä»¶æ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒä»¬ç»Ÿä¸€ç”±ç³»ç»ŸæœåŠ¡&lt;code&gt;AMS&lt;/code&gt;ç®¡ç†ï¼Œæ‰€ä»¥åœ¨Androidç³»ç»Ÿä¸Šï¼Œä»…ä»…å®ŒæˆåŠ¨æ€ç±»åŠ è½½æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•æŠŠæˆ‘ä»¬åŠ è½½è¿›æ¥çš„Activityç­‰ç»„ä»¶äº¤ç»™ç³»ç»Ÿç®¡ç†ï¼Œè®©&lt;code&gt;AMS&lt;/code&gt;èµ‹äºˆç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥æ‘†åœ¨çœ¼å‰çš„ä¸€ä¸ªå›°éš¾å°±æ˜¯å¦‚ä½•è®©ç»„ä»¶è·å¾—ç”Ÿå‘½æ´»åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œå¤§çº¦æœ‰ä»¥ä¸‹ä¸¤(ä¸‰)ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;é€šè¿‡ä»£ç†æ¨¡å¼ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆæœ‰åŒå­¦è¯„ä»·ä¸ºç‰µçº¿æœ¨å¶å¼ç®¡ç†ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä»£ç†ç»„ä»¶ä¸­é€šè¿‡åå°„è°ƒç”¨æ’ä»¶ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸï¼ˆæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œä¸æ¨èä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;å°†ç”Ÿå‘½å‘¨æœŸæŠ½è±¡ä¸ºæ¥å£ï¼Œåœ¨ä»£ç†ç»„ä»¶ä¸­è°ƒç”¨ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é€šè¿‡Hookæœºåˆ¶ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆç’å¤©è¿‡æµ·ã€å·æ¢æ¢æŸ±ã€å€Ÿå°¸è¿˜é­‚ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ç§æ–¹å¼ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DroidPlugin&lt;/code&gt;åŠå¤©æ‰å°‘å¹´lodyå¼€æºçš„&lt;a href=&quot;https://github.com/asLody/VirtualApp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;VirtualApp&lt;/a&gt;ä¸­å‡é€šè¿‡åŠ¨æ€ä»£ç†Hookåçš„ç³»ç»ŸBinderæœåŠ¡ï¼Œä»è€Œå·§å¦™çš„æŒæ§äº†ä¸Šå¸è§†è§’ã€‚ä¸åŒçš„æ˜¯&lt;code&gt;VirtualApp&lt;/code&gt;åŸºäºæ³¨è§£çš„ä¾èµ–æ³¨å…¥å¤„ç†Hookï¼Œåœ¨ä»£ç ä¸Šæ›´æ¸…æ™°ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; IBinder baseBinder;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Interface mBaseObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Interface mProxyObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.baseBinder = queryBaseBinder();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (baseBinder != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mBaseObject = createInterface(baseBinder);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mProxyObject = (Interface) Proxy.newProxyInstance(mBaseObject.getClass().getClassLoader(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				mBaseObject.getClass().getInterfaces(), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HookHandler());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IInterface &lt;span class=&quot;title&quot;&gt;queryLocalInterface&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String descriptor)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; getProxyObject();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Hookæœºåˆ¶ä¸ä½†è§£å†³äº†ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œè€Œä¸”ä½¿å¾—æ’ä»¶èƒ½å¤Ÿ&lt;strong&gt;æ— ç¼åœ°&lt;/strong&gt;ä½¿ç”¨è¿™äº›ç³»ç»ŸæœåŠ¡ï¼Œå¯¹äºæ’ä»¶apkçš„å¼€å‘å°±è·Ÿå¹³å¸¸å¼€å‘appå¹¶æ— åŒºåˆ«ï¼Œä¸ç”¨å…³å¿ƒä¸€äº›è§„åˆ™çš„é™åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;èµ„æºçš„è®¿é—®&quot;&gt;&lt;a href=&quot;#èµ„æºçš„è®¿é—®&quot; class=&quot;headerlink&quot; title=&quot;èµ„æºçš„è®¿é—®&quot;&gt;&lt;/a&gt;èµ„æºçš„è®¿é—®&lt;/h4&gt;&lt;p&gt;å¯¹äºèµ„æºçš„è®¿é—®ï¼Œæˆ‘ä»¬æ¥è¿½å¯»ä¸€ä¸‹æºç ä¸­æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥è·å–èµ„æºçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“&lt;code&gt;Activity&lt;/code&gt;æ˜¯ç»§æ‰¿è‡ª&lt;code&gt;Context&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;Context&lt;/code&gt;å”¯ä¸€å®ç°ç±»æ˜¯&lt;code&gt;ContxtImpl&lt;/code&gt;ï¼ŒActivityä¸­æœ‰ä¸€ä¸ªå«&lt;code&gt;mBase&lt;/code&gt;çš„æˆå‘˜å˜é‡ï¼Œå®ƒçš„ç±»å‹å°±æ˜¯&lt;code&gt;ContextImpl&lt;/code&gt;ã€‚æ³¨æ„åˆ°Contextä¸­æœ‰å¦‚ä¸‹ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œçœ‹èµ·æ¥æ˜¯å’Œèµ„æºæœ‰å…³ çš„ï¼Œå®é™…ä¸ŠContextå°±æ˜¯é€šè¿‡å®ƒä»¬æ¥è·å–èµ„æºçš„ã€‚è¿™ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•çš„çœŸæ­£å®ç°åœ¨ContextImplä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥è§£å†³èµ„æºé—®é¢˜äº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/** Return an AssetManager instance for your application&#39;s package. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; AssetManager &lt;span class=&quot;title&quot;&gt;getAssets&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/** Return a Resources instance for your application&#39;s package. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; Resources &lt;span class=&quot;title&quot;&gt;getResources&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥çœ‹ç³»ç»Ÿçš„&lt;a href=&quot;https://developer.android.com/reference/android/content/res/Resources.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;Resources&lt;/code&gt;&lt;/a&gt;æºç ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªç±»ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼Œé¦–å½“å…¶å†²çš„å½“ç„¶æ˜¯è®¿é—®èµ„æºï¼Œå¦å¤–ä¸€ä»¶å°±æ˜¯ç®¡ç†èµ„æºé…ç½®ä¿¡æ¯ã€‚å¯¹äºèµ„æºçš„åŠ¨æ€åŠ è½½æ¥è¯´ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯å®ƒå¦‚ä½•åšç¬¬ä¸€ä»¶äº‹çš„ã€‚æˆ‘ä»¬å‘ç°ï¼Œ&lt;code&gt;Resources&lt;/code&gt;å¯¹èµ„æºçš„è®¿é—®ï¼Œå…¨éƒ¨ä»£ç†ç»™äº†å¦ä¸€ä¸ªé‡è¦çš„å¯¹è±¡&lt;code&gt;AssetManager&lt;/code&gt;ã€‚é‚£ä¹ˆé—®é¢˜è½¬åŒ–æˆäº†ï¼Œ&lt;a href=&quot;https://developer.android.com/reference/android/content/res/AssetManager.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;AssetManager&lt;/code&gt;&lt;/a&gt;æ˜¯å¦‚ä½•åšåˆ°å¯¹èµ„æºçš„è®¿é—®çš„ã€‚&lt;code&gt;Resources&lt;/code&gt;ç±»åœ¨å®ƒçš„æ„é€ å‡½æ•°é‡Œå¯¹&lt;code&gt;AssetManager&lt;/code&gt;åšäº†ä¸€äº›é‡è¦çš„åˆå§‹åŒ–:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Creates a new Resources object with CompatibilityInfo.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; assets Previously created AssetManager. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; metrics Current display metrics to consider when &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *                selecting/computing resource values.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; config Desired device configuration to consider when &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *               selecting/computing resource values (optional).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; compatInfo this resource&#39;s compatibility info. Must not be null.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; token The Activity token for determining stack affiliation. Usually null.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@hide&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Resources&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(AssetManager assets, DisplayMetrics metrics, Configuration config,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CompatibilityInfo compatInfo, IBinder token)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mAssets = assets;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mMetrics.setToDefaults();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (compatInfo != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mCompatibilityInfo = compatInfo;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mToken = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WeakReference&amp;lt;IBinder&amp;gt;(token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    updateConfiguration(config, metrics);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assets.ensureStringBlocks();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­çš„é‡ç‚¹å°±æ˜¯è°ƒç”¨äº†&lt;code&gt;AssetManager&lt;/code&gt;å¯¹è±¡çš„ensureStringBlocks()å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å®ç°å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*package*/&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ensureStringBlocks&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mStringBlocks == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mStringBlocks == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 makeStringBlocks(sSystem.mStringBlocks);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…ˆåˆ¤æ–­&lt;code&gt;mStringBlocks&lt;/code&gt;å˜é‡æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œè¡¨ç¤ºéœ€è¦è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯è°ƒç”¨makeStringBlockså‡½æ•°åˆå§‹åŒ–mStringBlocks:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*package*/&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;makeStringBlocks&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(StringBlock[] seed)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; seedNum = (seed != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) ? seed.length : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; num = getStringBlockCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     mStringBlocks = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBlock[num];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (localLOGV) Log.v(TAG, &lt;span class=&quot;string&quot;&gt;&quot;Making string blocks for &quot;&lt;/span&gt; + &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             + &lt;span class=&quot;string&quot;&gt;&quot;: &quot;&lt;/span&gt; + num);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i&amp;lt;num; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (i &amp;lt; seedNum) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             mStringBlocks[i] = seed[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             mStringBlocks[i] = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBlock(getNativeStringBlock(i), &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œçš„mStringBlockså¯¹è±¡æ˜¯ä¸€ä¸ª&lt;code&gt;StringBlock&lt;/code&gt;æ•°ç»„ï¼Œè¿™ä¸ªç±»è¢«æ ‡è®°ä¸º&lt;code&gt;@hide&lt;/code&gt;ï¼Œè¡¨ç¤ºåº”ç”¨å±‚æ ¹æœ¬ä¸éœ€è¦å…³å¿ƒå®ƒçš„å­˜åœ¨ã€‚é‚£ä¹ˆå®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Œå®ƒå°±æ˜¯&lt;code&gt;AssetManager&lt;/code&gt;èƒ½å¤Ÿè®¿é—®èµ„æºçš„å¥¥ç§˜æ‰€åœ¨ï¼Œ&lt;code&gt;AssetManager&lt;/code&gt;æ‰€æœ‰è®¿é—®èµ„æºçš„å‡½æ•°ï¼Œä¾‹å¦‚getResourceTextArray()ï¼Œéƒ½æœ€ç»ˆé€šè¿‡StringBlockå†ä»£ç†åˆ°nativeè¿›è¡Œè®¿é—®çš„ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä¾ç„¶æ²¡æœ‰ä»»ä½•çœ‹åˆ°èƒ½å¤ŸæŒ‡ç¤ºä¸ºä»€ä¹ˆå¼€å‘è€…å¯ä»¥è®¿é—®è‡ªå·±åº”ç”¨çš„èµ„æºï¼Œé‚£ä¹ˆæˆ‘ä»¬å†å¾€å‰çœ‹ä¸€ç‚¹ï¼Œçœ‹çœ‹ä¼ å…¥&lt;code&gt;Resources&lt;/code&gt;çš„æ„é€ å‡½æ•°ä¹‹å‰ï¼Œassetå‚æ•°æ˜¯ä¸æ˜¯è¢«â€œåšè¿‡æ‰‹è„šâ€ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹&lt;code&gt;Resources&lt;/code&gt;è¢«å®ä¾‹åŒ–çš„åœ°æ–¹ï¼Œç»è¿‡ç¿»é˜…ä»£ç å‘ç°ï¼Œåœ¨&lt;code&gt;ResourceManager&lt;/code&gt;çš„&lt;code&gt;getTopLevelResources&lt;/code&gt;å‡½æ•°è¢«å®ä¾‹åŒ–ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * Creates the top level Resources for applications with the given compatibility info.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; resDir the resource directory.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; overlayDirs the resource overlay directories.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; libDirs the shared library resource dirs this app references.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; compatInfo the compability info. Must not be null.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; token the application token for determining stack bounds.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Resources &lt;span class=&quot;title&quot;&gt;getTopLevelResources&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String resDir, String[] splitResDirs,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          String[] overlayDirs, String[] libDirs, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; displayId,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          Configuration overrideConfiguration, CompatibilityInfo compatInfo, IBinder token)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       Resources r;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       AssetManager assets = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AssetManager();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// resDir can be null if the &#39;android&#39; package is creating a new Resources object.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// This is fine, since each AssetManager automatically loads the &#39;android&#39; package&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// already.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (resDir != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (assets.addAssetPath(resDir) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      r = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Resources(assets, dm, config, compatInfo, token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»£ç æœ‰ç‚¹å¤šï¼Œæˆªå–æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯ç³»ç»Ÿé€šè¿‡è°ƒç”¨&lt;code&gt;AssetManager&lt;/code&gt;çš„&lt;code&gt;addAssetPath&lt;/code&gt;å‡½æ•°ï¼Œå°†éœ€è¦åŠ è½½çš„èµ„æºè·¯å¾„åŠ äº†è¿›å»ã€‚&lt;code&gt;addAssetPath&lt;/code&gt;å‡½æ•°è¿”å›ä¸€ä¸ªintç±»å‹ï¼Œå®ƒæŒ‡ç¤ºäº†æ¯ä¸ªè¢«æ·»åŠ çš„èµ„æºè·¯å¾„åœ¨nativeå±‚ä¸€ä¸ªæ•°ç»„ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªæ•°ç»„ä¿å­˜äº†ç³»ç»Ÿèµ„æºè·¯å¾„(framework-res.apk)ï¼Œå’Œåº”ç”¨è‡ªå·±æ·»åŠ çš„æ‰€æœ‰çš„èµ„æºè·¯å¾„ã€‚å†å›è¿‡å¤´çœ‹makeStringBlockså‡½æ•°ï¼Œå°±è±ç„¶å¼€æœ—äº†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;makeStringBlockså‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªStringBlockæ•°ç»„ï¼Œå®ƒè¡¨ç¤ºç³»ç»Ÿèµ„æºï¼Œé¦–å…ˆå®ƒè°ƒç”¨getStringBlockCountå‡½æ•°å¾—åˆ°å½“å‰åº”ç”¨æ‰€æœ‰è¦åŠ è½½çš„èµ„æºè·¯å¾„æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åè¿›å…¥å¾ªç¯ï¼Œå¦‚æœå±äºç³»ç»Ÿèµ„æºï¼Œå°±ç›´æ¥ç”¨ä¼ å…¥å‚æ•°seedä¸­çš„å¯¹è±¡æ¥èµ‹å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åº”ç”¨è‡ªå·±çš„èµ„æºï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„StringBlockå¯¹è±¡æ¥èµ‹å€¼ã€‚å¹¶åœ¨StringBlockçš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨getNativeStringBlockå‡½æ•°æ¥è·å–ä¸€ä¸ªnativeå±‚çš„å¯¹è±¡æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆè¢«javaå±‚StringBlockå¯¹è±¡ç”¨æ¥è°ƒç”¨nativeå‡½æ•°ï¼Œæœ€ç»ˆè¾¾åˆ°è®¿é—®èµ„æºçš„ç›®çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;æ’ä»¶åŒ–æŠ€æœ¯æ¯”è¾ƒå—åˆ°å›½å†…å¼€å‘è€…é’çï¼Œå›½å¤–åˆ™æ›´å¤šçš„çƒ­è¡·äºFacebookå¼€æºçš„&lt;a href=&quot;https://github.com/facebook/react-native&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;react native&lt;/a&gt;æŠ€æœ¯ï¼Œå‡ºäºå¿«é€Ÿè¿­ä»£çš„ç›®çš„å…¶å®è¿˜æœ‰å¦ä¸€ç§åšæ³•ï¼Œåœ¨æ—©å‡ å¹´å·²ç»æœ‰è¡Œä¸šå†…ä¸€çº¿å…¬å¸é‡‡ç”¨ï¼Œä½¿ç”¨æœ¬åœ°H5é…åˆ&lt;code&gt;WebView&lt;/code&gt;è¾¾åˆ°å¿«é€Ÿè¿­ä»£ï¼ŒH5ä»£ç åˆ™é€šè¿‡çº¿ä¸Šæ‰“åŒ…æ›´æ–°(å…¨é‡æˆ–å¢é‡)çš„æ–¹å¼ï¼Œå°†å…¶æœ€æ–°ç‰ˆæœ¬æ›´æ–°è‡³æœ¬åœ°åŠ è½½ï¼Œè¿™ä¸€æ–¹é¢è§£å†³äº†å…¬å¸å¯¹ä¸šåŠ¡å¿«é€Ÿè¿­ä»£çš„éœ€æ±‚ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿç¼“è§£äº†çº¿ä¸ŠH5å¯¹ç½‘ç»œç¯å¢ƒçš„ä¾èµ–ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§æˆç†Ÿå¯ç”¨çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å‚è€ƒæ–‡æ¡£&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡æ¡£&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡æ¡£&quot;&gt;&lt;/a&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-classloader/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ·±å…¥æ¢è®¨Java ç±»åŠ è½½å™¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/6f6bb2f0ece9&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä»£ç†æ¨¡å¼åŠJavaå®ç°åŠ¨æ€ä»£ç†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.tingyun.com/web/article/detail/166&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ä¸‰ä¸ªå…³é”®é—®é¢˜è¯¦è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzAwMTcwNTE0NA==&amp;amp;mid=400217391&amp;amp;idx=1&amp;amp;sn=86181541ce0164156dfab135ed99bb5c&amp;amp;scene=0&amp;amp;key=b410d3164f5f798e61a5d4afb759fa38371c8b119384c6163a30c28163b4d4d5f59399f2400800ec842f1d0e0ffb84af&amp;amp;ascene=0&amp;amp;uin=MjExMjQ&amp;amp;pass_ticket=Nt5Jaa28jjFxcQO9o%2BvQiXX%2B0iXG5DlZlHNW97Fk1Ew%3D&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æºç¨‹Android Appæ’ä»¶åŒ–å’ŒåŠ¨æ€åŠ è½½å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://mogu.io/117-117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è˜‘è‡è¡— App çš„ç»„ä»¶åŒ–ä¹‹è·¯(ä¸€)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://mogu.io/119-119&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è˜‘è‡è¡— App çš„ç»„ä»¶åŒ–ä¹‹è·¯(äºŒ)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://weishu.me/2016/03/21/understand-plugin-framework-activity-management/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ’ä»¶åŒ–åŸç†è§£æâ€”Activityç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://weishu.me/2016/02/16/understand-plugin-framework-binder-hook/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ’ä»¶åŒ–åŸç†è§£æâ€”Hookæœºåˆ¶ä¹‹Binder Hook&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ’ä»¶åŒ–æŠ€æœ¯ï¼ˆä¹Ÿå«åŠ¨æ€åŠ è½½æŠ€æœ¯ï¼‰åœ¨æŠ€æœ¯é©±åŠ¨å‹çš„å…¬å¸ä¸­æ‰®æ¼”ç€ç›¸å½“é‡è¦çš„è§’è‰²ï¼Œå½“é¡¹ç›®è¶Šæ¥è¶Šåºå¤§çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡æ’ä»¶åŒ–æ¥ç»™åº”ç”¨ç˜¦èº«ï¼Œè¿˜å¯ä»¥å®ç°çƒ­æ’æ‹”ï¼Œå³åœ¨ä¸å‘å¸ƒæ–°ç‰ˆæœ¬çš„æƒ…å†µä¸‹æ›´æ–°æŸäº›æ¨¡å—ã€‚å¯¹äºä¸šåŠ¡è¿­ä»£è¾ƒå¿«çš„å…¬å¸ï¼Œå¯ä»¥å‡å°‘å‘åŒ…æ¬¡æ•°è€Œä¸”æœ‰å¾ˆå¥½çš„è¦†ç›–åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä¸ºè¿™æ®µæ—¶é—´å­¦ä¹ æ’ä»¶åŒ–çš„ä¸€äº›ç¬”è®°æˆ–æ‘˜è¦åŠè‡ªå·±çš„ä¸€äº›ç†è§£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>TurboRecyclerViewHelperä¹‹å®ç°Adapterçš„ä¼˜åŒ–å°è£…</title>
    <link href="http://solart.cc/2016/06/18/turbo-recyclerview-helper-2/"/>
    <id>http://solart.cc/2016/06/18/turbo-recyclerview-helper-2/</id>
    <published>2016-06-18T05:52:08.000Z</published>
    <updated>2016-11-16T12:40:57.000Z</updated>
    
    <content type="html">&lt;p&gt;ä¸Šæ¬¡è®²åˆ°&lt;a href=&quot;http://solart.cc/2016/06/01/turbo-recyclerview-helper-1/&quot;&gt;å®ç°RecyclerViewçš„åŠŸèƒ½æ‰©å±•&lt;/a&gt;,æœ¬æ¬¡å°±æ¥ç€ä»‹ç»é’ˆå¯¹&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;çš„å°è£…çš„ä¸€äº›æƒ³æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1ã€åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1ã€åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1ã€åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1ã€åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;éšç€ç§»åŠ¨ç«¯çš„è“¬å‹ƒå‘å±•ï¼Œå¤æ‚çš„äº§å“å¸ƒå±€ä¹Ÿå˜æˆäº†å®¶å¸¸ä¾¿é¥­ï¼Œå¤æ‚çš„å¸ƒå±€æ’åˆ—ç»„åˆä¹Ÿæˆäº†å¸¸æ€ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;img src=&quot;/images/home_model.png&quot;&gt;
&lt;p&gt;æ¯”å¦‚åœ¨æ‹¿åˆ°è¿™ä¸ªéœ€æ±‚ä¹‹åï¼Œå¦‚æœæ”¾åœ¨ä¹‹å‰æˆ‘å¤§å¤šæ˜¯ç”¨ScrollViewæˆ–è€…ListViewçš„å¤šTypeç±»å‹æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä»Šï¼Œé‡‡ç”¨&lt;code&gt;RecyclerView&lt;/code&gt;å¯ä»¥å®ç°ä¸€ä¸ªæ€§èƒ½æ›´ä¼˜çš„æ–¹æ¡ˆï¼Œ&lt;code&gt;RecyclerView&lt;/code&gt;æä¾›äº†ä¸€ç§æ’æ‹”å¼çš„æ¶æ„è®¾è®¡ï¼Œé«˜åº¦çš„è§£è€¦ï¼Œå¼‚å¸¸çš„çµæ´»ï¼Œä¹Ÿå› ä¸ºè¿™äº›ç‰¹æ€§éœ€è¦è°ƒç”¨è€…è‡ªå·±æ¥å®ç°çš„ä»£ç å°±ç›¸å¯¹å¤šä¸€äº›ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ¿€å‘äº†è‡ªå·±æƒ³è¿›ä¸€æ­¥å°è£…ä¸€ä¸ªæ›´å¥½ç”¨å¹¶ä¸”ä¸å¤±çµæ´»æ€§çš„&lt;code&gt;Adapter&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¯¹äºå®ç°ä»¥ä¸Šéœ€æ±‚è¿˜é…åˆäº†&lt;code&gt;ItemDecoration&lt;/code&gt;æ¥å®ç°é—´éš”ï¼Œè¿™é‡Œå°±å…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ•°æ®æºçš„æ·»åŠ /åˆ é™¤/é‡ç½®&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šç±»å‹å¸ƒå±€&lt;/li&gt;
&lt;li&gt;æ·»åŠ /ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ·»åŠ ç‚¹å‡»äº‹ä»¶&lt;/li&gt;
&lt;li&gt;é…åˆTurboRecyclerViewä¸Šæ‹‰/å·¦æ»‘åŠ è½½&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œé’ˆå¯¹ä»¥ä¸Šéœ€æ±‚å±•å¼€ä»‹ç»ã€‚&lt;/p&gt;
&lt;h1 id=&quot;2ã€æ•°æ®æºçš„æ·»åŠ -åˆ é™¤-é‡ç½®&quot;&gt;&lt;a href=&quot;#2ã€æ•°æ®æºçš„æ·»åŠ -åˆ é™¤-é‡ç½®&quot; class=&quot;headerlink&quot; title=&quot;2ã€æ•°æ®æºçš„æ·»åŠ /åˆ é™¤/é‡ç½®&quot;&gt;&lt;/a&gt;2ã€æ•°æ®æºçš„æ·»åŠ /åˆ é™¤/é‡ç½®&lt;/h1&gt;&lt;p&gt;å¤§å®¶çŸ¥é“&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;æ˜¯RecyclerViewä¸æ•°æ®ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ‰€ä»¥é’ˆå¯¹æ•°æ®æºæˆ‘çš„æƒ³æ³•æ˜¯åœ¨Adapterä¸­ç»´æŠ¤ä¸€ä¸ª&lt;code&gt;List&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œè¿™æ ·å¯ä»¥ä¸ä¾èµ–å¤–éƒ¨æ•°æ®æºï¼Œä¿è¯List&lt;t&gt;å¯¹Adapterçš„å¯è§æ€§ï¼Œåœ¨Adapterçš„å°è£…ä¸­ä»…æä¾›å¢ã€åˆ ä»¥åŠé‡ç½®çš„æ–¹æ³•ï¼Œæ‰€æœ‰å¯¹æ•°æ®æºæ“ä½œéƒ½é€šè¿‡Adapterä¸­æä¾›çš„æ¥å£æ¥å®ç°å¢åˆ ã€‚&lt;/t&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; List&amp;lt;T&amp;gt; mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseTurboAdapter&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, List&amp;lt;T&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mData = data == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;T&amp;gt;() : &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;T&amp;gt;(data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ·»åŠ æ•°æ®çš„æ¥å£ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(T item)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isAdd = mData.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isAdd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        notifyItemInserted(mData.size() + getHeaderViewCount());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; position, T item)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (position &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; || position &amp;gt; mData.size()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;add position = &quot;&lt;/span&gt; + position + &lt;span class=&quot;string&quot;&gt;&quot;, IndexOutOfBounds, please check your code!&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mData.add(position, item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    notifyItemInserted(position + getHeaderViewCount());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(List&amp;lt;T&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (data != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mData.addAll(data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦æä¸€ä¸‹ï¼Œé’ˆå¯¹add(postion,T)ä¸­çš„&lt;code&gt;position&lt;/code&gt;æ˜¯æ•´ä¸ªAdapterä¸­getItemCount()åéœ€è¦å‡å»å¤´éƒ¨çš„è®¡æ•°ï¼Œåé¢ä¼šè®²åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤æ•°æ®çš„æ¥å£ä¸æ·»åŠ ç±»ä¼¼ï¼Œå°±ä¸åœ¨è´´ä»£ç äº†ï¼Œè¿™é‡Œæˆ‘ä»¬åˆæä¾›ä¸€ä¸ªé‡ç½®æ•°æ®çš„æ–¹æ³•ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;resetData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(List&amp;lt;T&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mData.clear();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    addData(data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æœ‰é‡æ–°åˆ·æ–°æ—¶ï¼Œè¯·è°ƒç”¨è¿™ä¸ªæ–¹æ³•é‡ç½®æ•°æ®æºã€‚&lt;/p&gt;
&lt;h1 id=&quot;3ã€æ·»åŠ -ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨&quot;&gt;&lt;a href=&quot;#3ã€æ·»åŠ -ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨&quot; class=&quot;headerlink&quot; title=&quot;3ã€æ·»åŠ /ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨&quot;&gt;&lt;/a&gt;3ã€æ·»åŠ /ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨&lt;/h1&gt;&lt;p&gt;RecyclerViewæ˜¯ä¸€ä¸ªæ€§èƒ½æ›´ä¼˜çš„æ§ä»¶ï¼Œæ‰€ä»¥å¯¹å¤šå¸ƒå±€çš„æ”¯æŒä¹Ÿæ›´å¥½ã€‚Headerå’ŒFooteræ˜¯é…åˆgetItemViewType(position)æ¥å®ç°ï¼Œæˆ‘ä»¬çŸ¥é“Headerã€Footerçš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥å¯¹äºå¤´éƒ¨å’Œå°¾éƒ¨çš„Typeç±»å‹å¤„ç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getItemViewType&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; position)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mHeaderView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; position == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; TYPE_HEADER_VIEW;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (position == mData.size() + getHeaderViewCount()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mLoading) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mFooterView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; TYPE_FOOTER_VIEW;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ·»åŠ /ç§»é™¤å¤´éƒ¨å’Œå°¾éƒ¨ä¼šå¯¹&lt;code&gt;ItemCount&lt;/code&gt;æœ‰å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°getItemCountï¼Œå…ˆæ¥çœ‹çœ‹æºç ä¸Šçš„æ³¨è§£ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Returns the total number of items in the data set hold by the adapter.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; The total number of items in this adapter.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getItemCount&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥çœ‹çœ‹å…·ä½“çš„å®ç°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getItemCount&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mLoading) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//if loading ignore footer view&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        count = mData.size() + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + getHeaderViewCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        count = mData.size() + getHeaderViewCount() + getFooterViewCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ•°æ®æºçš„åŸºç¡€ä¸Šè®¡ç®—Headerä»¥åŠFooterçš„æ•°é‡å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹é’ˆå¯¹Headeræ·»åŠ ã€ç§»é™¤ï¼ˆFooteråŒç†ï¼‰ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; View mHeaderView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addHeaderView&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View header)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (header == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;header is null!!!&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mHeaderView = header;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;removeHeaderView&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mHeaderView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mHeaderView = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;4ã€ç‚¹å‡»äº‹ä»¶çš„å¤„ç†&quot;&gt;&lt;a href=&quot;#4ã€ç‚¹å‡»äº‹ä»¶çš„å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;4ã€ç‚¹å‡»äº‹ä»¶çš„å¤„ç†&quot;&gt;&lt;/a&gt;4ã€ç‚¹å‡»äº‹ä»¶çš„å¤„ç†&lt;/h1&gt;&lt;p&gt;åœ¨åˆšå¼€å§‹å†™è¿™ä¸ªé¡¹ç›®çš„åˆæœŸï¼Œå…¶å®æˆ‘æœŸæœ›æ˜¯ç”¨ä¸€ç§æ›´ç®€æ´çš„æ›´ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†itemç‚¹å‡»äº‹ä»¶ï¼ŒæœŸé—´ä¹Ÿå°è¯•ä½¿ç”¨&lt;code&gt;RecyclerView.OnItemTouchListener&lt;/code&gt;æ¥å®ç°ç‚¹å‡»äº‹ä»¶ï¼Œè™½ç„¶åŠŸèƒ½ä¸Šå®ç°äº†ç‚¹å‡»äº‹ä»¶ï¼Œä½†å¯¹ç‚¹å‡»æ•ˆæœçš„æ”¯æŒæ²¡èƒ½æœ‰æ•ˆçš„è§£å†³ï¼Œåæ¥ä¸å¾—ä¸æ”¾å¼ƒçš„è¿™ä¸€æ–¹æ¡ˆã€‚æœ€ç»ˆï¼Œè¿™é‡Œè¿˜æ˜¯é€šè¿‡itemViewçš„ç‚¹å‡»äº‹ä»¶æ¥å®ç°ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vh = onCreateDefViewHolder(parent, viewType);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatchItemClickListener(vh);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;dispatchItemClickListener&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; BaseViewHolder vh)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mOnItemClickListeners != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; mOnItemClickListeners.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!(vh.itemView &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; AdapterView)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            vh.itemView.setOnClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; View.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; mOnItemClickListeners.size(); i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; OnItemClickListener listener = mOnItemClickListeners.get(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        listener.onItemClick(vh, vh.getLayoutPosition() - getHeaderViewCount());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mOnItemLongClickListeners != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; mOnItemLongClickListeners.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!(vh.itemView &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; AdapterView)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            vh.itemView.setOnLongClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; View.OnLongClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onLongClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; mOnItemLongClickListeners.size(); i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; OnItemLongClickListener listener = mOnItemLongClickListeners.get(i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        listener.onItemLongClick(vh, vh.getLayoutPosition() - getHeaderViewCount());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¹&lt;code&gt;Adapter&lt;/code&gt;æŠ½è±¡å°è£…ä»£ç ä¸Šå¹¶ä¸å¤æ‚ï¼Œåªæ˜¯åŸºäºè¿™äº›æŠ½è±¡åŠå°è£…ï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿å¿«æ·ã€‚ä¹Ÿæ¬¢è¿æ”¯æŒä¸€ä¸‹&lt;a href=&quot;https://github.com/Solartisan/TurboRecyclerViewHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ä¸ªé¡¹ç›®&lt;/a&gt;~ æŒç»­ç»´æŠ¤~ğŸ˜Š&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šæ¬¡è®²åˆ°&lt;a href=&quot;http://solart.cc/2016/06/01/turbo-recyclerview-helper-1/&quot;&gt;å®ç°RecyclerViewçš„åŠŸèƒ½æ‰©å±•&lt;/a&gt;,æœ¬æ¬¡å°±æ¥ç€ä»‹ç»é’ˆå¯¹&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;çš„å°è£…çš„ä¸€äº›æƒ³æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1ã€åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1ã€åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1ã€åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1ã€åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;éšç€ç§»åŠ¨ç«¯çš„è“¬å‹ƒå‘å±•ï¼Œå¤æ‚çš„äº§å“å¸ƒå±€ä¹Ÿå˜æˆäº†å®¶å¸¸ä¾¿é¥­ï¼Œå¤æ‚çš„å¸ƒå±€æ’åˆ—ç»„åˆä¹Ÿæˆäº†å¸¸æ€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>TurboRecyclerViewHelperä¹‹å®ç°RecyclerViewçš„åŠŸèƒ½æ‰©å±•</title>
    <link href="http://solart.cc/2016/06/01/turbo-recyclerview-helper-1/"/>
    <id>http://solart.cc/2016/06/01/turbo-recyclerview-helper-1/</id>
    <published>2016-06-01T10:06:08.000Z</published>
    <updated>2016-06-03T05:11:15.000Z</updated>
    
    <content type="html">&lt;p&gt;è‡ªä»ä½¿ç”¨äº†&lt;code&gt;RecyclerView&lt;/code&gt;å†ä¹Ÿå›ä¸å»äº†ï¼Œä»€ä¹ˆListViewã€GridViewç»Ÿç»Ÿè®©ä»–ä»¬é€€ä¼‘äº†ã€‚å¿…é¡»å®‰åˆ©èµ·æ¥ï¼Œç”¨äº†æ‰èƒ½ä½“ä¼šå®ƒçš„ç¥å¥‡ï¼&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä½¿ç”¨&lt;code&gt;RecyclerView&lt;/code&gt;ä»¥æ¥ï¼Œæ‹“å±•çš„ä¸€äº›åŠŸèƒ½åŠå¯¹&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;çš„å°è£…ï¼Œæƒ³åœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«ä¸€äº›ç»éªŒï¼Œè¿˜æœ›æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1-åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1-åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1. åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1. åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;åŸºäºå¯¹&lt;code&gt;RecyclerView&lt;/code&gt;åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›ç—›ç‚¹å†™äº†è¿™ä¸ªå¼€æºé¡¹ç›® &lt;a href=&quot;https://github.com/Solartisan/TurboRecyclerViewHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TurboRecyclerViewHelper&lt;/a&gt; ã€‚åŠŸèƒ½ç‚¹è¯¦è§READMEã€‚&lt;/p&gt;
&lt;img src=&quot;/images/turbo_simple.gif&quot;&gt;
&lt;p&gt;æœ¬æ¬¡ä¸»è¦ä»‹ç»é’ˆå¯¹&lt;code&gt;TurboRecyclerView&lt;/code&gt;ä¸Šæ‹‰/å·¦æ»‘çš„åŠŸèƒ½çš„å®ç°åŠæ€è·¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç›´æ¥è¿›å…¥æ­£é¢˜â€¦&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;2-çŠ¶æ€åˆ†æ&quot;&gt;&lt;a href=&quot;#2-çŠ¶æ€åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;2. çŠ¶æ€åˆ†æ&quot;&gt;&lt;/a&gt;2. çŠ¶æ€åˆ†æ&lt;/h1&gt;&lt;p&gt;ä»¥ä¸Šæ‹‰åŠ è½½çš„è¿‡ç¨‹ä½œä¸ºæœ¬æ¬¡åˆ†äº«çš„ä¸€ä¸ªæ —å­(å·¦æ»‘åŒç†)ã€‚çŠ¶æ€å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;img src=&quot;/images/turbo_state_analysis.png&quot;&gt;
&lt;p&gt;æˆ‘ä»¬æ‰€å…³å¿ƒçš„æ˜¯RecyclerViewæ»‘åŠ¨åˆ°åº•éƒ¨çš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸‹æ˜¯æˆ‘ä»¬éœ€è¦å¤„ç†çš„&lt;code&gt;ä¸´ç•ŒçŠ¶æ€&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ–‡ä¸­å‡ºç°çš„ä»£ç å‡ä¸ºç²¾ç®€åçš„ä»£ç ç‰‡æ®µï¼Œæœ¬æ–‡é‡åœ¨ä»‹ç»æ€è·¯ï¼Œæ‰€æ¶‰åŠçš„çŸ¥è¯†ç‚¹å‡è®¾æ‚¨å·²ç»æŒæ¡ï¼Œæ•…ä¸å†å±•å¼€èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h1 id=&quot;3-ä¸´ç•ŒçŠ¶æ€çš„é™åˆ¶æ¡ä»¶&quot;&gt;&lt;a href=&quot;#3-ä¸´ç•ŒçŠ¶æ€çš„é™åˆ¶æ¡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3. ä¸´ç•ŒçŠ¶æ€çš„é™åˆ¶æ¡ä»¶&quot;&gt;&lt;/a&gt;3. ä¸´ç•ŒçŠ¶æ€çš„é™åˆ¶æ¡ä»¶&lt;/h1&gt;&lt;p&gt;åºŸè¯ä¸å¤šè¯´ç›´æ¥çœ‹ä»£ç ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!mLoadEnabled || canScrollEnd() || mIsLoading || isEmpty()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;...;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»ä¸¤ä¸ªæ–¹é¢æ¥åˆ†æå¯ä»¥å¼€å§‹å¤„ç†Touchäº‹ä»¶çš„æ¡ä»¶ï¼š&lt;/p&gt;
&lt;h2 id=&quot;3-1-å®¢è§‚æ¡ä»¶&quot;&gt;&lt;a href=&quot;#3-1-å®¢è§‚æ¡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;3.1 å®¢è§‚æ¡ä»¶&quot;&gt;&lt;/a&gt;3.1 å®¢è§‚æ¡ä»¶&lt;/h2&gt;&lt;p&gt;æ‰€è°“å®¢è§‚æ¡ä»¶å³æ˜¯RecyclerViewæ»‘åŠ¨åˆ°åº•éƒ¨çš„è¿™ä¸ªçŠ¶æ€çš„ç‰©ç†çŠ¶æ€ï¼Œä½“ç°åœ¨ä»£ç ä¸Šå°±æ˜¯&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;canScrollEnd&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//åˆ¤æ–­åœ¨çºµå‘æ˜¯å¦è¿˜èƒ½å‘ä¸Šæ»‘åŠ¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ViewCompat.canScrollVertically(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œä¸ºäº†ç®€åŒ–åªåˆ¤æ–­äº†çºµå‘æ˜¯å¦å¯ä»¥å‘ä¸‹æ»‘åŠ¨ï¼Œå®é™…ä»£ç ä¸­è¿™é‡Œæ˜¯åˆ¤æ–­æ¡ä»¶ä¸º&lt;code&gt;ViewCompat.canScrollVertically(this, 1) || ViewCompat.canScrollHorizontally(this, 1)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¡ä»¶è¿”å›å€¼å¦‚æœæ˜¯falseï¼Œåˆ™ä»£è¡¨æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªä¸´ç•ŒçŠ¶æ€å¼€å§‹å¤„ç†Touchäº‹ä»¶ï¼Œå¦åˆ™ä¸å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3-2-é€»è¾‘æ¡ä»¶ï¼ˆä¸»è§‚æ¡ä»¶ï¼‰&quot;&gt;&lt;a href=&quot;#3-2-é€»è¾‘æ¡ä»¶ï¼ˆä¸»è§‚æ¡ä»¶ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;3.2 é€»è¾‘æ¡ä»¶ï¼ˆä¸»è§‚æ¡ä»¶ï¼‰&quot;&gt;&lt;/a&gt;3.2 é€»è¾‘æ¡ä»¶ï¼ˆä¸»è§‚æ¡ä»¶ï¼‰&lt;/h2&gt;&lt;p&gt;é€»è¾‘æ¡ä»¶ï¼ˆæˆ–è€…ç§°ä¸ºä¸»è§‚æ¡ä»¶ï¼‰æ˜¯è®¾è®¡æ§ä»¶æœ¬èº«æ‰€è€ƒè™‘çš„é™åˆ¶æ¡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;åˆ¤æ–­æ¡ä»¶å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//æ˜¯å¦å…è®¸ä¸Šæ‹‰ || æ˜¯å¦æ­£å¤„äºåˆ·æ–°çŠ¶æ€ || æ˜¯å¦å¤„ç†ç©ºçŠ¶æ€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!mLoadEnabled || mIsLoading || isEmpty())&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä»¥ä¸Šæ¡ä»¶ä¸‹æˆ‘ä»¬è®¤ä¸ºæ˜¯æ§ä»¶æœ¬èº«åº”å¤„äºä¸å¯ä¸Šæ‹‰çš„çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸åšå¤„ç†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;4-Touchäº‹ä»¶çš„å¤„ç†&quot;&gt;&lt;a href=&quot;#4-Touchäº‹ä»¶çš„å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;4. Touchäº‹ä»¶çš„å¤„ç†&quot;&gt;&lt;/a&gt;4. Touchäº‹ä»¶çš„å¤„ç†&lt;/h1&gt;&lt;p&gt;åœ¨åŒæ—¶æ»¡è¶³å®¢è§‚æ¡ä»¶å’Œé€»è¾‘æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¤„ç†ä¸Šæ‹‰çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;h2 id=&quot;4-1-è®°å½•åˆå§‹å€¼&quot;&gt;&lt;a href=&quot;#4-1-è®°å½•åˆå§‹å€¼&quot; class=&quot;headerlink&quot; title=&quot;4.1 è®°å½•åˆå§‹å€¼&quot;&gt;&lt;/a&gt;4.1 è®°å½•åˆå§‹å€¼&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬éœ€è¦åœ¨&lt;code&gt;MotionEvent.ACTION_DOWN&lt;/code&gt; &lt;code&gt;MotionEvent.ACTION_POINTER_DOWN&lt;/code&gt;æ—¶è®°å½•åˆå§‹å€¼:&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mInitialMotionX = getMotionEventX(e, actionIndex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mInitialMotionY = getMotionEventY(e, actionIndex);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;4-2-åˆ¤æ–­æ»‘åŠ¨æ˜¯å¦ç¬¦åˆé¢„æœŸå€¼&quot;&gt;&lt;a href=&quot;#4-2-åˆ¤æ–­æ»‘åŠ¨æ˜¯å¦ç¬¦åˆé¢„æœŸå€¼&quot; class=&quot;headerlink&quot; title=&quot;4.2 åˆ¤æ–­æ»‘åŠ¨æ˜¯å¦ç¬¦åˆé¢„æœŸå€¼&quot;&gt;&lt;/a&gt;4.2 åˆ¤æ–­æ»‘åŠ¨æ˜¯å¦ç¬¦åˆé¢„æœŸå€¼&lt;/h2&gt;&lt;p&gt;åœ¨&lt;code&gt;MotionEvent.ACTION_MOVE&lt;/code&gt;æ—¶åˆ¤æ–­æ˜¯å¦æ˜¯ä¸Šæ‹‰çš„çŠ¶æ€ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//LayoutManagerä¸­æä¾›çš„åˆ¤æ–­æ˜¯å¦çºµå‘å¯ä»¥æ»‘åŠ¨çš„æ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; canScrollVertically = getLayoutManager().canScrollVertically();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; y = getMotionEventY(e, index);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; deltaY = y - mInitialMotionY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (canScrollVertically &amp;amp;&amp;amp; Math.abs(deltaY) &amp;gt; mTouchSlop &amp;amp;&amp;amp; deltaY &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123; ... &lt;span class=&quot;comment&quot;&gt;//å¤„ç†ä¸Šæ‹‰æ•ˆæœ&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è®°å½•å½“å‰Yå€¼ï¼Œä¸”åˆ¤æ–­æ˜¯å¦æ‰‹æŒ‡åœ¨ä¸Šæ»‘çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4-3-å®ç°ä¸Šæ‹‰æ•ˆæœ&quot;&gt;&lt;a href=&quot;#4-3-å®ç°ä¸Šæ‹‰æ•ˆæœ&quot; class=&quot;headerlink&quot; title=&quot;4.3 å®ç°ä¸Šæ‹‰æ•ˆæœ&quot;&gt;&lt;/a&gt;4.3 å®ç°ä¸Šæ‹‰æ•ˆæœ&lt;/h2&gt;&lt;p&gt;åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ï¼Œå®ç°ä¸Šæ‹‰æ•ˆæœæœ‰å¤šç§é€”å¾„ï¼Œä¾‹å¦‚å¤§å®¶å¸¸ç”¨çš„åˆ©ç”¨&lt;code&gt;Scroller&lt;/code&gt;é…åˆ&lt;code&gt;scrollTo&lt;/code&gt;æ¥å®ç°æ»‘åŠ¨ï¼Œä½†æ˜¯åœ¨RecyclerViewçš„å®ç°ä¸­å¹¶ä¸æ”¯æŒè¿™ç§æ–¹å¼ã€‚è¿™ä¸ªæ–¹æ¡ˆClose!&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;scrollTo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; x, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; y)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Log.w(TAG, &lt;span class=&quot;string&quot;&gt;&quot;RecyclerView does not support scrolling to an absolute position. &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            + &lt;span class=&quot;string&quot;&gt;&quot;Use scrollToPosition instead&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œé‡‡ç”¨&lt;code&gt;setTranslationY&lt;/code&gt;æ¥å®ç°ä¸Šæ‹‰æ•ˆæœï¼Œæ ¹æ®æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»è®¡ç®—å‡ºç§»åŠ¨è·ç¦»æ¥æ”¹å˜RecyclerViewçš„ä½ç½®ã€‚&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; targetEnd = -dampAxis(deltaY); &lt;span class=&quot;comment&quot;&gt;//é˜»å°¼å€¼çš„è®¡ç®—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;setTranslationY(targetEnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;  &lt;span class=&quot;comment&quot;&gt;//æ¶ˆè´¹æ‰æ­¤äº‹ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œä¸Šæ‹‰çš„æ•ˆæœå·²ç»å®ç°å®Œæ¯•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4-4-å¤ä½åŠåˆ·æ–°&quot;&gt;&lt;a href=&quot;#4-4-å¤ä½åŠåˆ·æ–°&quot; class=&quot;headerlink&quot; title=&quot;4.4 å¤ä½åŠåˆ·æ–°&quot;&gt;&lt;/a&gt;4.4 å¤ä½åŠåˆ·æ–°&lt;/h2&gt;&lt;p&gt;è·ç¦»æˆåŠŸåªå·®ä¸€ç‚¹ç‚¹ã€‚&lt;br&gt;åœ¨ç”¨æˆ·æ‰‹æŒ‡æ¾å¼€ä»¥åï¼Œæˆ‘ä»¬è¦è€ƒè™‘åšä¸¤ä»¶äº‹ï¼šRecyclerViewçš„å¤ä½åŠæ˜¯å¦å¯ä»¥å¤„äºåˆ·æ–°çŠ¶æ€ã€‚&lt;br&gt;é’ˆå¯¹å¤ä½æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦é€†å‘&lt;code&gt;setTranslationY&lt;/code&gt;å€¼å³å¯ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å±æ€§åŠ¨ç”»æ¥å®ç°&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;animateOffsetToEnd&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String propertyName, &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Interpolator interpolator, &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt;... value)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mResetAnimator == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           mResetAnimator = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ObjectAnimator();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           mResetAnimator.setTarget(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mResetAnimator.cancel();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mResetAnimator.setPropertyName(propertyName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mResetAnimator.setFloatValues(value);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mResetAnimator.setInterpolator(interpolator);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mResetAnimator.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(canScrollVertically)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	animateOffsetToEnd(&lt;span class=&quot;string&quot;&gt;&quot;translationY&quot;&lt;/span&gt;, mInterpolator, &lt;span class=&quot;number&quot;&gt;0f&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºåˆ·æ–°æˆ‘ä»¬è¦åšçš„äº‹æƒ…ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåˆ¤æ–­å½“å‰ç§»åŠ¨è·ç¦»è¾¾åˆ°é˜ˆå€¼åï¼Œå›è°ƒç›‘å¬äº‹ä»¶å¹¶æ˜¾ç¤ºLOAING_VIEWã€‚&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Log.i(TAG, &lt;span class=&quot;string&quot;&gt;&quot;refreshing...&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mIsLoading = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatchOnLoadingMoreListeners();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;smoothScrollToPosition(mLastVisibleItemPosition + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åˆ·æ–°å®Œæ¯•åï¼Œè®°å¾—é€šçŸ¥TurboRecyclerViewæ›´æ–°çŠ¶æ€å“¦ï¼&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mTurboRecyclerView.addOnLoadingMoreListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OnLoadMoreListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onLoadingMore&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           handler.postDelayed(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   mRecyclerView.loadMoreComplete(Arrays.asList(sCheeseStrings));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;, &lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è‡³æ­¤æ•´ä¸ªä¸Šæ‹‰åˆ°å¤ä½åˆ·æ–°çš„è¿‡ç¨‹å®Œæˆã€‚&lt;br&gt;å®Œæ•´ä»£ç è¯¦è§ &lt;a href=&quot;https://github.com/Solartisan/TurboRecyclerViewHelper/blob/master/turbo-recyclerview-helper/src/main/java/cc/solart/turbo/TurboRecyclerView.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TurboRecyclerView.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¸Œæœ›æˆ‘çš„åˆ†äº«èƒ½è®©æ‚¨èƒ½æœ‰æ‰€æ”¶è·ã€‚ä¹Ÿæ¬¢è¿æ”¯æŒä¸€ä¸‹&lt;a href=&quot;https://github.com/Solartisan/TurboRecyclerViewHelper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™ä¸ªé¡¹ç›®&lt;/a&gt;~ æŒç»­ç»´æŠ¤~&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡å‡†å¤‡ä»‹ç»ä¸€ä¸‹å¯¹&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;çš„å°è£…ï¼Œè¿˜è¯·å…³æ³¨ï¼ğŸ˜Š&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;è‡ªä»ä½¿ç”¨äº†&lt;code&gt;RecyclerView&lt;/code&gt;å†ä¹Ÿå›ä¸å»äº†ï¼Œä»€ä¹ˆListViewã€GridViewç»Ÿç»Ÿè®©ä»–ä»¬é€€ä¼‘äº†ã€‚å¿…é¡»å®‰åˆ©èµ·æ¥ï¼Œç”¨äº†æ‰èƒ½ä½“ä¼šå®ƒçš„ç¥å¥‡ï¼&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä½¿ç”¨&lt;code&gt;RecyclerView&lt;/code&gt;ä»¥æ¥ï¼Œæ‹“å±•çš„ä¸€äº›åŠŸèƒ½åŠå¯¹&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;çš„å°è£…ï¼Œæƒ³åœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«ä¸€äº›ç»éªŒï¼Œè¿˜æœ›æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1-åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1-åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1. åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1. åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;åŸºäºå¯¹&lt;code&gt;RecyclerView&lt;/code&gt;åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›ç—›ç‚¹å†™äº†è¿™ä¸ªå¼€æºé¡¹ç›® &lt;a href=&quot;https://github.com/Solartisan/TurboRecyclerViewHelper&quot;&gt;TurboRecyclerViewHelper&lt;/a&gt; ã€‚åŠŸèƒ½ç‚¹è¯¦è§READMEã€‚&lt;/p&gt;
&lt;img src=&quot;/images/turbo_simple.gif&quot;&gt;
&lt;p&gt;æœ¬æ¬¡ä¸»è¦ä»‹ç»é’ˆå¯¹&lt;code&gt;TurboRecyclerView&lt;/code&gt;ä¸Šæ‹‰/å·¦æ»‘çš„åŠŸèƒ½çš„å®ç°åŠæ€è·¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç›´æ¥è¿›å…¥æ­£é¢˜â€¦&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Androidä»£ç è§„èŒƒ</title>
    <link href="http://solart.cc/2016/05/14/code-specification/"/>
    <id>http://solart.cc/2016/05/14/code-specification/</id>
    <published>2016-05-14T03:19:20.000Z</published>
    <updated>2016-05-14T06:04:57.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡æ¡£ä¸»è¦ç”¨äºå¸®åŠ©Androidå¼€å‘äººå‘˜è§„èŒƒä»£ç åŠèµ„æºæ–‡ä»¶å‘½åç­‰ï¼Œä½¿å¤§å®¶å°½é‡ä¿è¯ä¸€ä¸ªæ•´æ´çš„ç¼–ç¨‹é£æ ¼ã€‚&lt;/p&gt;
&lt;h1 id=&quot;äºŒã€Javaå‘½åè§„èŒƒ&quot;&gt;&lt;a href=&quot;#äºŒã€Javaå‘½åè§„èŒƒ&quot; class=&quot;headerlink&quot; title=&quot;äºŒã€Javaå‘½åè§„èŒƒ&quot;&gt;&lt;/a&gt;äºŒã€Javaå‘½åè§„èŒƒ&lt;/h1&gt;&lt;p&gt;æœ¬å‘½åè§„èŒƒä¸»è¦åŸºäº&lt;code&gt;éª†é©¼å‘½å&lt;/code&gt;è§„åˆ™(å¯¹äºè¿™ä¸ªéƒ½ä¿è¯ä¸äº†çš„ä»£ç ç®€ç›´ä¸èƒ½å¿)ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-1-ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot;&gt;&lt;a href=&quot;#2-1-ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot; class=&quot;headerlink&quot; title=&quot;2.1 ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot;&gt;&lt;/a&gt;2.1 ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&lt;/h2&gt;&lt;p&gt;# æ‰€æœ‰çš„åç§°å‘½ååº”è¯¥&lt;code&gt;ç®€æ´è€Œå¯Œæœ‰æ„ä¹‰&lt;/code&gt;ï¼Œå°½é‡ä½¿ç”¨å®Œæ•´å•è¯ã€‚å¢åŠ å¿…è¦çš„æ³¨é‡Šã€‚&lt;/p&gt;
&lt;p&gt;# &lt;code&gt;é™¤éè¯¥ç¼©å†™è¢«æ›´å¹¿æ³›çš„ä½¿ç”¨&lt;/code&gt;ï¼Œä¾‹å¦‚URLã€HTMLã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-2-åŒ…çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-2-åŒ…çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.2 åŒ…çš„å‘½å&quot;&gt;&lt;/a&gt;2.2 åŒ…çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;åŒ…åç”±å°å†™çš„å­—æ¯ç»„æˆ&lt;/code&gt;ï¼Œä¾‹å¦‚ä»¥ cc.solart.&amp;lt;ä¸šåŠ¡æ¨¡å—å&amp;gt;.&amp;lt;å­æ¨¡å—å&amp;gt;å‘½å&lt;/p&gt;
&lt;p&gt;# ä¸€ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„æ¨¡å—ï¼Œ&lt;code&gt;åº”è°¨æ…åˆ›å»ºæ–°çš„æ¨¡å—å&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&quot;2-3-ç±»çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-3-ç±»çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.3 ç±»çš„å‘½å&quot;&gt;&lt;/a&gt;2.3 ç±»çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;ç±»åçš„é¦–å­—æ¯å¿…é¡»å¤§å†™&lt;/code&gt;ï¼Œå¦‚æœç”±å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ç›´æ¥è¿æ¥ï¼Œ&lt;code&gt;æ¯ä¸ªå•è¯çš„é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œå…¶ä»–å­—æ¯å°å†™&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼špublic class LoginActivity &lt;/p&gt;
&lt;p&gt;# ç±»çš„åŸŸå®šä¹‰è€ƒé‡, éå…¬å¼€ç±»ä¸è¦ç”¨public&lt;code&gt;(æ³¨æ„ç±»çš„æœ‰æ•ˆä½œç”¨åŸŸ)&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&quot;2-4-æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-4-æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.4 æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot;&gt;&lt;/a&gt;2.4 æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&lt;/h2&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;# å¯¹äºæŠ½è±¡ç±»ï¼Œ&lt;code&gt;èŒè´£æ¯”è¾ƒå•ä¸€çš„ä»¥Abså¼€å¤´&lt;/code&gt;ï¼Œä¾‹å¦‚:AbsJsonRequestï¼ŒåªåŒ…å«å•ä¸€çš„ç½‘ç»œè¯·æ±‚ï¼›&lt;code&gt;å¯¹äºä¸€äº›åŸºç±»æŠ½è±¡å°è£…ä¸€èˆ¬é‡‡ç”¨Baseå¼€å¤´&lt;/code&gt;ï¼Œä¾‹å¦‚BaseActivityã€‚&lt;/p&gt;
&lt;p&gt;# å¯¹äºæœ‰æ˜æ˜¾æ¥å£ç‰¹å¾çš„æ¥å£(å¦‚åç¼€å«æœ‰Listener/Observer)ï¼Œå‚è€ƒç±»å‘½åè§„èŒƒå³å¯ï¼Œä¾‹å¦‚ï¼špublic interface ResponseListenerã€‚&lt;/p&gt;
&lt;p&gt;# &lt;code&gt;å¯¹äºæ²¡æœ‰æ˜æ˜¾æ¥å£ç‰¹å¾çš„æ¥å£å‘½åï¼Œé¦–å­—æ¯ç»Ÿä¸€ä¸ºå¤§å†™ I&lt;/code&gt;ï¼Œå…¶å®ƒå•è¯é¦–å­—æ¯å¤§å†™, ä¾‹å¦‚:public interface ILocationã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-5-æ–¹æ³•åŠå‚æ•°çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-5-æ–¹æ³•åŠå‚æ•°çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.5 æ–¹æ³•åŠå‚æ•°çš„å‘½å&quot;&gt;&lt;/a&gt;2.5 æ–¹æ³•åŠå‚æ•°çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;æ–¹æ³•åçš„é¦–å­—æ¯å¿…é¡»å°å†™&lt;/code&gt;ï¼Œéµå¾ªé©¼å³°å‘½åã€‚public void checkAuthToken()&lt;/p&gt;
&lt;p&gt;# æ–¹æ³•å‚æ•°åä»¥è¯¥å‚æ•°åŠŸèƒ½å‘½åï¼Œæ ¼å¼åŒæ–¹æ³•åå‘½åè§„åˆ™ç›¸åŒã€‚ public void checkAuthToken(String token)&lt;/p&gt;
&lt;h2 id=&quot;2-6-å¸¸é‡çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-6-å¸¸é‡çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.6 å¸¸é‡çš„å‘½å&quot;&gt;&lt;/a&gt;2.6 å¸¸é‡çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;ç”¨ final static ä¿®é¥°ï¼Œåç§°éƒ½å¤§å†™&lt;/code&gt;ï¼Œå¤šä¸ªå•è¯ä»¥ä¸‹åˆ’çº¿ â€œ_â€ è¿æ¥ï¼Œå¦‚:public final static String HTTP_HOST = â€œ&lt;a href=&quot;http://127.0.0.1:8080/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://127.0.0.1:8080/&lt;/a&gt;â€œ; ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-7-å˜é‡çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-7-å˜é‡çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.7 å˜é‡çš„å‘½å&quot;&gt;&lt;/a&gt;2.7 å˜é‡çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;é static çš„æˆå‘˜å˜é‡ï¼Œå‘½åå¿…é¡»å†™&amp;#39;m&amp;#39;å‰ç¼€&lt;/code&gt;ï¼Œå¦‚ï¼špublic Handler mHandler; &lt;/p&gt;
&lt;p&gt;# &lt;code&gt;staticä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œå‘½åå¿…é¡»å†™&amp;#39;s&amp;#39;å‰ç¼€&lt;/code&gt;ï¼Œå¦‚ï¼špublic static String sAppKey; &lt;/p&gt;
&lt;p&gt;# &lt;code&gt;æšä¸¾å˜é‡ä½¿ç”¨ç”¨&amp;#39;e&amp;#39;å‰ç¼€&lt;/code&gt;ï¼Œå¦‚ private Weekday eWeekday;&lt;/p&gt;
&lt;p&gt;# &lt;code&gt;å±€éƒ¨å˜é‡å‘½åé¦–å­—æ¯å°å†™å³å¯&lt;/code&gt;ï¼Œé‡‡ç”¨é©¼å³°å‘½åï¼Œå¦‚Context context;  &lt;/p&gt;
&lt;h1 id=&quot;ä¸‰ã€Androidèµ„æºæ–‡ä»¶å‘½åè§„åˆ™&quot;&gt;&lt;a href=&quot;#ä¸‰ã€Androidèµ„æºæ–‡ä»¶å‘½åè§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰ã€Androidèµ„æºæ–‡ä»¶å‘½åè§„åˆ™&quot;&gt;&lt;/a&gt;ä¸‰ã€Androidèµ„æºæ–‡ä»¶å‘½åè§„åˆ™&lt;/h1&gt;&lt;p&gt;è§„èŒƒèµ„æºæ–‡ä»¶å‘½åï¼Œç»Ÿä¸€é£æ ¼ã€‚&lt;/p&gt;
&lt;h2 id=&quot;3-1-æ–‡ä»¶å‘½å&quot;&gt;&lt;a href=&quot;#3-1-æ–‡ä»¶å‘½å&quot; class=&quot;headerlink&quot; title=&quot;3.1 æ–‡ä»¶å‘½å&quot;&gt;&lt;/a&gt;3.1 æ–‡ä»¶å‘½å&lt;/h2&gt;&lt;p&gt;# res/layoutç›®å½•ä¸‹æ–‡ä»¶:ç»Ÿä¸€ä»¥å¸ƒå±€ç±»å‹å¼€å¤´ï¼Œç”¨å°å†™å’Œä¸‹åˆ’çº¿â€_â€ç»„åˆå‘½åï¼Œå¦‚ï¼šé¦–é¡µ xml å¸ƒå±€æ–‡ä»¶: ä¾‹å¦‚:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;activity_home.xml &lt;span class=&quot;comment&quot;&gt;# HomeActivityé¡µé¢å¸ƒå±€&lt;/span&gt;
 fragment_account.xml &lt;span class=&quot;comment&quot;&gt;# AccountFragmentå¸ƒå±€&lt;/span&gt;
 item_tips.xml &lt;span class=&quot;comment&quot;&gt;# Adapter itemå¸ƒå±€&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;# res/drawableç›®å½•ä¸‹æ–‡ä»¶:ç»Ÿä¸€ç”¨å°å†™åŠ ä¸‹åˆ’çº¿â€_â€ç»„åˆå‘½åï¼ŒåŒä¸Šï¼Œæ¯ä¸ªèµ„æºæ–‡ä»¶åŠ å‰ç¼€ä»¥ä¾¿åŒºåˆ†ç”¨é€”ã€‚å¦‚:&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#13;bg_selector_normal.xml&amp;#10;&amp;#13;icon_submit_default.png&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;3-2-èµ„æºIDå‘½å&quot;&gt;&lt;a href=&quot;#3-2-èµ„æºIDå‘½å&quot; class=&quot;headerlink&quot; title=&quot;3.2 èµ„æºIDå‘½å&quot;&gt;&lt;/a&gt;3.2 èµ„æºIDå‘½å&lt;/h2&gt;&lt;p&gt;# @id/@+id &lt;code&gt;åç§°çš„å¿…é¡»å…¨éƒ¨å°å†™ï¼Œå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿éš”å¼€&lt;/code&gt;ï¼Œåç§°ä¸éœ€è¦å¤æ‚çš„å±‚çº§å®šä½ï¼Œåªè¦å‡†ç¡®æè¿°æ‰€ä»£è¡¨æ§ä»¶çš„åŠŸèƒ½ä½œç”¨å³å¯ï¼Œåœ¨åç§°&lt;code&gt;ä½¿ç”¨å½“å‰æ§ä»¶ç±»å‹çš„ç¼©å†™ä½œä¸ºå‰ç¼€&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼š@+id/tv_nameã€‚&lt;/p&gt;
&lt;p&gt;# res/values/demins: ç»Ÿä¸€ç”¨å°å†™åŠ ä¸‹åˆ’çº¿â€_â€œç»„åˆå‘½åï¼Œå®šä¹‰è·ç¦»é€šç”¨å€¼ï¼Œå®šä¹‰å­—ä½“å¤§å°é€šç”¨å€¼ï¼Œå…¶ä»–é¢œè‰²ç»Ÿä¸€ç”¨sp/dp_&amp;lt;æ•°å€¼&amp;gt;è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;activity_horizontal_margin&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;activity_vertical_margin&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;fab_margin&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;app_bar_height&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;180dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;1dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_2&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;2dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_3&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;3dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_4&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;4dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_5&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;5dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;value&quot;&gt;&quot;dp_16&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16dp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;title&quot;&gt;dimen&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;# res/values/colors: ç»Ÿä¸€ç”¨å°å†™åŠ ä¸‹åˆ’çº¿â€_â€œç»„åˆå‘½åï¼Œå®šä¹‰é€šç”¨çš„èƒŒæ™¯è‰²bg_colorï¼Œå®šä¹‰å­—ä½“é€šç”¨è‰²å€¼ï¼Œå…¶ä»–é¢œè‰²ç»Ÿä¸€ç”¨app_&amp;lt;è‰²å€¼&amp;gt;è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;xml&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--è½½ä½“é¢œè‰²--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;bg_color&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#E5E5E5&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;    
 &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--Material design color--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--æ­£å¸¸å­—ä½“87%é€æ˜é»‘è‰²--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;font_color_normal_black_87&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#DD000000&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--æ­£å¸¸å­—ä½“54%é€æ˜é»‘è‰²--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;font_color_light_black_54&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#89000000&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--ä¸å¯ç”¨çŠ¶æ€ä½¿ç”¨çš„é¢œè‰²26%é€æ˜--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;font_color_enable_black_26&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#42000000&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;

 &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--å…¶ä»–éé€šç”¨è‰²å€¼ é‡‡ç”¨app_&amp;lt;å°å†™è‰²å€¼ç¼–ç &amp;gt;å‘½åå³å¯ï¼Œvalueè‰²å€¼å­—æ¯å¤§å†™--&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;app_d2322a&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#FFD2322A&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;app_f36754&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#FFF36754&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;app_d4503e&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;#FFD4503E&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;color&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&quot;å››ã€ç¼–ç é£æ ¼&quot;&gt;&lt;a href=&quot;#å››ã€ç¼–ç é£æ ¼&quot; class=&quot;headerlink&quot; title=&quot;å››ã€ç¼–ç é£æ ¼&quot;&gt;&lt;/a&gt;å››ã€ç¼–ç é£æ ¼&lt;/h1&gt;&lt;h2 id=&quot;4-1-ä¸€èˆ¬æ€§è¯´æ˜&quot;&gt;&lt;a href=&quot;#4-1-ä¸€èˆ¬æ€§è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;4.1 ä¸€èˆ¬æ€§è¯´æ˜&quot;&gt;&lt;/a&gt;4.1 ä¸€èˆ¬æ€§è¯´æ˜&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;æ–¹æ³•ä½“è¡Œæ•°ä¸å¾—è¶…è¿‡ 40 è¡Œ&lt;/code&gt;(ä¸€èˆ¬æ¥è¯´40è¡Œç»å¯¹å¤Ÿç”¨ï¼Œä¸”æ˜“äºç»´æŠ¤)ï¼›&lt;br&gt;# é™¤å»ç¼©è¿›é•¿åº¦ï¼Œ&lt;code&gt;å•è¡Œé•¿åº¦ä¸å¾—è¶…è¿‡ 100 ä¸ªå­—ç¬¦&lt;/code&gt;ï¼›&lt;br&gt;# &lt;code&gt;åœˆå¤æ‚åº¦ä¸èƒ½è¶…è¿‡ 2 å±‚&lt;/code&gt;ï¼›&lt;br&gt;# å•ä¸ªæ–‡ä»¶é•¿åº¦ä¸€èˆ¬ä¸è¶…è¿‡ 1500 è¡Œ(ç¬¬ä¸‰æ–¹ä»£ç é™¤å¤–)ï¼›&lt;br&gt;# å…¬å¼€ API ä¸­æ‰€æœ‰å‚æ•°éƒ½å¿…é¡»è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯ï¼›&lt;br&gt;# æ¯æ¬¡ä»£ç æäº¤ä¹‹å‰å¿…é¡»åˆ é™¤å¤§é‡æ— æ•ˆä»£ç ï¼Œå»é™¤æ— ç”¨çš„ç±»importï¼›&lt;br&gt;# &lt;code&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹APIå¢åŠ å¼‚å¸¸æ•è·&lt;/code&gt;ï¼Œé™ä½ä½¿ç”¨é£é™©ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡æ¡£ä¸»è¦ç”¨äºå¸®åŠ©Androidå¼€å‘äººå‘˜è§„èŒƒä»£ç åŠèµ„æºæ–‡ä»¶å‘½åç­‰ï¼Œä½¿å¤§å®¶å°½é‡ä¿è¯ä¸€ä¸ªæ•´æ´çš„ç¼–ç¨‹é£æ ¼ã€‚&lt;/p&gt;
&lt;h1 id=&quot;äºŒã€Javaå‘½åè§„èŒƒ&quot;&gt;&lt;a href=&quot;#äºŒã€Javaå‘½åè§„èŒƒ&quot; class=&quot;headerlink&quot; title=&quot;äºŒã€Javaå‘½åè§„èŒƒ&quot;&gt;&lt;/a&gt;äºŒã€Javaå‘½åè§„èŒƒ&lt;/h1&gt;&lt;p&gt;æœ¬å‘½åè§„èŒƒä¸»è¦åŸºäº&lt;code&gt;éª†é©¼å‘½å&lt;/code&gt;è§„åˆ™(å¯¹äºè¿™ä¸ªéƒ½ä¿è¯ä¸äº†çš„ä»£ç ç®€ç›´ä¸èƒ½å¿)ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-1-ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot;&gt;&lt;a href=&quot;#2-1-ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot; class=&quot;headerlink&quot; title=&quot;2.1 ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&quot;&gt;&lt;/a&gt;2.1 ä¸è¦ä½¿ç”¨æ‹¼éŸ³å‘½ï¼Œé¿å…ä½¿ç”¨ç¼©å†™&lt;/h2&gt;&lt;p&gt;# æ‰€æœ‰çš„åç§°å‘½ååº”è¯¥&lt;code&gt;ç®€æ´è€Œå¯Œæœ‰æ„ä¹‰&lt;/code&gt;ï¼Œå°½é‡ä½¿ç”¨å®Œæ•´å•è¯ã€‚å¢åŠ å¿…è¦çš„æ³¨é‡Šã€‚&lt;/p&gt;
&lt;p&gt;# &lt;code&gt;é™¤éè¯¥ç¼©å†™è¢«æ›´å¹¿æ³›çš„ä½¿ç”¨&lt;/code&gt;ï¼Œä¾‹å¦‚URLã€HTMLã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-2-åŒ…çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-2-åŒ…çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.2 åŒ…çš„å‘½å&quot;&gt;&lt;/a&gt;2.2 åŒ…çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;åŒ…åç”±å°å†™çš„å­—æ¯ç»„æˆ&lt;/code&gt;ï¼Œä¾‹å¦‚ä»¥ cc.solart.&amp;lt;ä¸šåŠ¡æ¨¡å—å&amp;gt;.&amp;lt;å­æ¨¡å—å&amp;gt;å‘½å&lt;/p&gt;
&lt;p&gt;# ä¸€ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„æ¨¡å—ï¼Œ&lt;code&gt;åº”è°¨æ…åˆ›å»ºæ–°çš„æ¨¡å—å&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&quot;2-3-ç±»çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-3-ç±»çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.3 ç±»çš„å‘½å&quot;&gt;&lt;/a&gt;2.3 ç±»çš„å‘½å&lt;/h2&gt;&lt;p&gt;# &lt;code&gt;ç±»åçš„é¦–å­—æ¯å¿…é¡»å¤§å†™&lt;/code&gt;ï¼Œå¦‚æœç”±å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ç›´æ¥è¿æ¥ï¼Œ&lt;code&gt;æ¯ä¸ªå•è¯çš„é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œå…¶ä»–å­—æ¯å°å†™&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼špublic class LoginActivity &lt;/p&gt;
&lt;p&gt;# ç±»çš„åŸŸå®šä¹‰è€ƒé‡, éå…¬å¼€ç±»ä¸è¦ç”¨public&lt;code&gt;(æ³¨æ„ç±»çš„æœ‰æ•ˆä½œç”¨åŸŸ)&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&quot;2-4-æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot;&gt;&lt;a href=&quot;#2-4-æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot; class=&quot;headerlink&quot; title=&quot;2.4 æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&quot;&gt;&lt;/a&gt;2.4 æŠ½è±¡ç±»ã€æ¥å£çš„å‘½å&lt;/h2&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Android WebViewåŠ è½½html5åŠJSäº¤äº’æ¡†æ¶</title>
    <link href="http://solart.cc/2016/03/25/open-web/"/>
    <id>http://solart.cc/2016/03/25/open-web/</id>
    <published>2016-03-25T08:06:04.000Z</published>
    <updated>2016-06-29T06:02:35.000Z</updated>
    
    <content type="html">&lt;p&gt;å½“å‰è¶Šæ¥è¶Šå¤šçš„appä¸­åµŒå…¥H5ï¼Œæƒ³è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹å…·ä½“åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨å’Œè®¾è®¡ï¼Œæ•…å†™äº†è¿™ä¸ª&lt;a href=&quot;https://github.com/Solartisan/OpenWeb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å¼€æºé¡¹ç›®&lt;/a&gt;ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œä»‹ç»ä¸€ä¸‹OpenWebé¡¹ç›®åŸºç¡€çš„æ¡†æ¶è®¾è®¡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1-åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1-åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1.åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1.åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;åŸºäºWebViewè®¾è®¡çš„H5é¡µé¢çš„åŠ è½½æ¡†æ¶ï¼Œå¯ä»¥è‡ªåŠ¨ç®¡ç†å›é€€æ ˆï¼Œå¯ä»¥æ”¯æŒjsä¸nativeçš„äº¤äº’ï¼Œå¯é…åˆä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œå¯ä¿®æ”¹æ¨ªå‘è¿›åº¦æ¡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;2-è®¾è®¡&quot;&gt;&lt;a href=&quot;#2-è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;2.è®¾è®¡&quot;&gt;&lt;/a&gt;2.è®¾è®¡&lt;/h1&gt;&lt;img src=&quot;/images/open_web.png&quot;&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;3-æ ¸å¿ƒç±»åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#3-æ ¸å¿ƒç±»åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;3.æ ¸å¿ƒç±»åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;3.æ ¸å¿ƒç±»åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;h2 id=&quot;3-1-WebUrl-java&quot;&gt;&lt;a href=&quot;#3-1-WebUrl-java&quot; class=&quot;headerlink&quot; title=&quot;3.1 WebUrl.java&quot;&gt;&lt;/a&gt;3.1 WebUrl.java&lt;/h2&gt;&lt;p&gt;å®šä¹‰äº†&lt;code&gt;String getCurrentUrl()&lt;/code&gt;æ¥å£ï¼Œè·å–å½“å‰é¡µé¢çš„çš„URLï¼Œç”¨äºè®°å½•å½“å‰é¡µé¢çš„jså›è°ƒæ³¨å†Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;3-2-BaseWebEvent-java&quot;&gt;&lt;a href=&quot;#3-2-BaseWebEvent-java&quot; class=&quot;headerlink&quot; title=&quot;3.2 BaseWebEvent.java&quot;&gt;&lt;/a&gt;3.2 BaseWebEvent.java&lt;/h2&gt;&lt;p&gt;è¯¥ç±»ä¸»è¦å°è£…äº†åŸºç¡€çš„&lt;code&gt;@JavascriptInterface&lt;/code&gt;æ¥å£ï¼ŒHandleræ¶ˆæ¯å¸¸é‡å®šä¹‰åŠjsçš„å›è°ƒæ³¨å†Œã€‚&lt;/p&gt;
&lt;p&gt;æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseWebEvent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, Handler handler, WebUrl url)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mContext = context;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mHandler = handler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mListener = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mUrlSource = url;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Handleræ¶ˆæ¯å°è£…å¦‚ä¸‹ï¼Œç”¨äº&lt;code&gt;@JavascriptInterface&lt;/code&gt;æ¥å£å‘é€æ¶ˆæ¯å¤„ç†ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; what&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; obj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sendAsyncCallbackMessage&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; what, Object obj)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sendAsyncCallbackMessageDelay(what,obj,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; what&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; obj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; delay&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sendAsyncCallbackMessageDelay&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; what, Object obj,&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; delay)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mHandler != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         Message msg = mHandler.obtainMessage();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         msg.what = what;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         msg.obj = obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         mHandler.sendMessageDelayed(msg,delay);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;3-3-BaseWebFragment-java&quot;&gt;&lt;a href=&quot;#3-3-BaseWebFragment-java&quot; class=&quot;headerlink&quot; title=&quot;3.3 BaseWebFragment.java&quot;&gt;&lt;/a&gt;3.3 BaseWebFragment.java&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªç±»ä¸ºæŠ½è±¡ç±»æ˜¯ä¸»è¦çš„WebViewæ‰¿è½½ç±»ï¼Œå†…éƒ¨å®šä¹‰äº†WebViewåŠBaseWebEventåŠç½‘ç»œçŠ¶æ€å˜åŒ–çš„ç›‘å¬ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;WebViewçš„&lt;code&gt;Settings&lt;/code&gt;é…ç½®ï¼Œä¸»è¦é’ˆå¯¹WebViewåšåŸºç¡€çš„è®¾ç½®ï¼Œ&lt;code&gt;WebChromeClient&lt;/code&gt;,&lt;code&gt;WebViewClient&lt;/code&gt;è®¾ç½®ï¼Œä»¥åŠå¯¹ä¸‹è½½ç›‘å¬çš„è®¾ç½®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onInitWebViewSettings&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//è¿™é‡Œè®¾ç½®äº†åŸºç¡€çš„Settings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    WebSettingsUtil.initSettings(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mActivity, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mWebView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    WebChromeClient webChromeClient = onCreateWebChromeClient();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (webChromeClient != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mWebView.setWebChromeClient(webChromeClient);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    WebViewClient webViewClient = onCreateWebViewClient();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (webViewClient != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mWebView.setWebViewClient(webViewClient);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mWebView.setOverScrollMode(View.OVER_SCROLL_NEVER);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mWebView.requestFocus();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mWebView.setDownloadListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WebDownloadListener(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨å­ç±»çš„å®ç°ä¸­åº”è¯¥è¦†å†™ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ç”¨äº&lt;code&gt;WebChromeClient&lt;/code&gt;,&lt;code&gt;WebViewClient&lt;/code&gt;çš„è®¾ç½®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; WebChromeClient &lt;span class=&quot;title&quot;&gt;onCreateWebChromeClient&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseWebChromeClient(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; WebViewClient &lt;span class=&quot;title&quot;&gt;onCreateWebViewClient&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseWebViewClient(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¦å…³æ³¨WebViewå¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨Fragmentçš„ç”Ÿå‘½å‘¨æœŸä¸­é’ˆå¯¹WebViewåšç›¸åº”æ“ä½œï¼Œé¿å…å†…å­˜æ³„éœ²é—®é¢˜&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onResume();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mWebView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mWebView.onResume();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onPause&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onPause();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mWebView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mWebView.onPause();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDestroy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onDestroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mWebView != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((ViewGroup) mWebView.getParent()).removeView(mWebView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mWebView.destroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mWebView = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½œä¸ºå®ç°ç±»å¿…é¡»å®ç°ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºæä¾›ä¸€ä¸ªlayoutå’Œä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°çš„ç›‘å¬&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;loadLayoutRes&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getWebViewId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;3-5-OpenWebFragment-java&quot;&gt;&lt;a href=&quot;#3-5-OpenWebFragment-java&quot; class=&quot;headerlink&quot; title=&quot;3.5 OpenWebFragment.java&quot;&gt;&lt;/a&gt;3.5 OpenWebFragment.java&lt;/h2&gt;&lt;p&gt;BaseWebFragmentçš„å­ç±»ï¼Œä¸»è¦å…·ä½“å®ç°H5åŠ è½½çš„ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œè¦†å†™&lt;code&gt;onInitWebViewSettings&lt;/code&gt;æ–¹æ³•ï¼Œåˆå§‹åŒ–&lt;code&gt;mBaseEvent&lt;/code&gt;ä»¥åŠæ·»åŠ JavascriptInterfaceæ”¯æŒ&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onInitWebViewSettings&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onInitWebViewSettings();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mHandler = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WebFragmentHandler(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mWebEvent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OpenWebEvent(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mActivity, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mHandler, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; WebUrl() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getCurrentUrl&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mWebView.getUrl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mWebView.addJavascriptInterface(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mWebEvent, &lt;span class=&quot;string&quot;&gt;&quot;MyJsBridge&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;å½“å‰è¶Šæ¥è¶Šå¤šçš„appä¸­åµŒå…¥H5ï¼Œæƒ³è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹å…·ä½“åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨å’Œè®¾è®¡ï¼Œæ•…å†™äº†è¿™ä¸ª&lt;a href=&quot;https://github.com/Solartisan/OpenWeb&quot;&gt;å¼€æºé¡¹ç›®&lt;/a&gt;ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œä»‹ç»ä¸€ä¸‹OpenWebé¡¹ç›®åŸºç¡€çš„æ¡†æ¶è®¾è®¡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1-åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;a href=&quot;#1-åŠŸèƒ½ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1.åŠŸèƒ½ä»‹ç»&quot;&gt;&lt;/a&gt;1.åŠŸèƒ½ä»‹ç»&lt;/h1&gt;&lt;p&gt;åŸºäºWebViewè®¾è®¡çš„H5é¡µé¢çš„åŠ è½½æ¡†æ¶ï¼Œå¯ä»¥è‡ªåŠ¨ç®¡ç†å›é€€æ ˆï¼Œå¯ä»¥æ”¯æŒjsä¸nativeçš„äº¤äº’ï¼Œå¯é…åˆä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œå¯ä¿®æ”¹æ¨ªå‘è¿›åº¦æ¡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;2-è®¾è®¡&quot;&gt;&lt;a href=&quot;#2-è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;2.è®¾è®¡&quot;&gt;&lt;/a&gt;2.è®¾è®¡&lt;/h1&gt;&lt;img src=&quot;/images/open_web.png&quot;&gt;
    
    </summary>
    
      <category term="Android" scheme="http://solart.cc/categories/Android/"/>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://solart.cc/2016/02/20/hello-world/"/>
    <id>http://solart.cc/2016/02/20/hello-world/</id>
    <published>2016-02-20T02:08:22.000Z</published>
    <updated>2016-05-01T04:18:02.000Z</updated>
    
    <content type="html">&lt;p&gt;Welcome to &lt;a href=&quot;http://solart.cc/&quot;&gt;Solart&lt;/a&gt;! &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªåšå®¢ä¸»è¦æ˜¯ä¸ºäº†è´¡çŒ®é«˜è´¨é‡çš„æŠ€æœ¯åˆ†æåŠå¼€æºé¡¹ç›®ï¼Œç›®å‰ä¸»è¦æ·±è€•ç§»åŠ¨ç«¯Androidæ–¹å‘ã€‚æ¬¢è¿æ›´å¤šçš„æœ‹å‹åŠ å…¥æˆ‘ä»¬!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Github &lt;a href=&quot;https://github.com/solartisan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Solartisan&lt;/a&gt;&lt;/p&gt;
&lt;img src=&quot;/images/clock.jpg&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;http://solart.cc/&quot;&gt;Solart&lt;/a&gt;! &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªåšå®¢ä¸»è¦æ˜¯ä¸ºäº†è´¡çŒ®é«˜è´¨é‡çš„æŠ€æœ¯åˆ†æåŠå¼€æºé¡¹ç›®ï¼Œç›®å‰ä¸»è¦æ·±è€•ç§»åŠ¨ç«¯Androidæ–¹å‘ã€‚æ¬¢è¿æ›´å¤šçš„æœ‹å‹åŠ å…¥æˆ‘ä»¬!&lt;/p&gt;
&lt;/bl
    
    </summary>
    
    
  </entry>
  
</feed>
